<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: EtherMAC.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_493eba74639f722aa88bd3d010f621b5.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_15f4b73e4143e94d16b8a3f5620d968f.html">linklayer</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c733baf8c334314a68529aad4637aad1.html">ethernet</a>
  </div>
</div>
<div class="contents">
<h1>EtherMAC.cc</h1><a href="_ether_m_a_c_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2003 Andras Varga; CTIE, Monash University, Australia</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU Lesser General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU Lesser General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00016"></a>00016 <span class="comment">*/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;omnetpp.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_ether_m_a_c_8h.html">EtherMAC.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_ieee802_ctrl__m_8h.html">Ieee802Ctrl_m.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_i_passive_queue_8h.html">IPassiveQueue.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">static</span> std::ostream&amp; <a class="code" href="_u_d_p_video_stream_svr_8cc.html#a635f24433df826fed0b3245212fac075">operator&lt;&lt; </a>(std::ostream&amp; out, cMessage *msg)
<a name="l00028"></a>00028 {
<a name="l00029"></a>00029     out &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; msg-&gt;getClassName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; msg-&gt;getFullName();
<a name="l00030"></a>00030     <span class="keywordflow">return</span> out;
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <a class="code" href="_ether_app_cli_8cc.html#abf346c028a3c694e3a78e998c663a6c7">Define_Module</a>( <a class="code" href="class_ether_m_a_c.html">EtherMAC</a> );
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="class_ether_m_a_c.html#a936a9d50c3e4cda99c3004c4778cadf4">00036</a> <a class="code" href="class_ether_m_a_c.html#a936a9d50c3e4cda99c3004c4778cadf4">EtherMAC::EtherMAC</a>()
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038     <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = NULL;
<a name="l00039"></a>00039     <a class="code" href="class_ether_m_a_c.html#a1d0fc561153186e5cc32c3c7347fd175">endJammingMsg</a> = <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a> = <a class="code" href="class_ether_m_a_c.html#ab33a400a74d73295145562de67ae0abf">endBackoffMsg</a> = NULL;
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="class_ether_m_a_c.html#a52727b8fdc3ddb6ead25d8beab1fe817">00042</a> <a class="code" href="class_ether_m_a_c.html#a52727b8fdc3ddb6ead25d8beab1fe817">EtherMAC::~EtherMAC</a>()
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>;
<a name="l00045"></a>00045     cancelAndDelete(<a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00046"></a>00046     cancelAndDelete(<a class="code" href="class_ether_m_a_c.html#ab33a400a74d73295145562de67ae0abf">endBackoffMsg</a>);
<a name="l00047"></a>00047     cancelAndDelete(<a class="code" href="class_ether_m_a_c.html#a1d0fc561153186e5cc32c3c7347fd175">endJammingMsg</a>);
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="class_ether_m_a_c.html#ad8e31ebe719a1be991c6d390313cea51">00050</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#ad8e31ebe719a1be991c6d390313cea51">EtherMAC::initialize</a>()
<a name="l00051"></a>00051 {
<a name="l00052"></a>00052     <a class="code" href="class_ether_m_a_c.html#ad8e31ebe719a1be991c6d390313cea51">EtherMACBase::initialize</a>();
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;EndReception&quot;</span>, <a class="code" href="_ether_m_a_c_base_8h.html#a9330bc9c8a7ef3d0acef63b2e9573c08">ENDRECEPTION</a>);
<a name="l00055"></a>00055     <a class="code" href="class_ether_m_a_c.html#ab33a400a74d73295145562de67ae0abf">endBackoffMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;EndBackoff&quot;</span>, <a class="code" href="_ether_m_a_c_base_8h.html#a64b191c4f0a78fe8aa485d15bb8ee30e">ENDBACKOFF</a>);
<a name="l00056"></a>00056     <a class="code" href="class_ether_m_a_c.html#a1d0fc561153186e5cc32c3c7347fd175">endJammingMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;EndJamming&quot;</span>, <a class="code" href="_ether_m_a_c_base_8h.html#a4f424177ed127c705b0e598400fd60e9">ENDJAMMING</a>);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <span class="comment">// check: datarate is forbidden with EtherMAC -- module&apos;s txrate must be used</span>
<a name="l00059"></a>00059     cGate *g = <a class="code" href="class_ether_m_a_c_base.html#aa83bcb5c4f6024e598c2bbbd2f7773bf">physOutGate</a>;
<a name="l00060"></a>00060     <span class="keywordflow">while</span> (g)
<a name="l00061"></a>00061     {
<a name="l00062"></a>00062         cDatarateChannel *chan = <span class="keyword">dynamic_cast&lt;</span>cDatarateChannel*<span class="keyword">&gt;</span>(g-&gt;getChannel());
<a name="l00063"></a>00063         <span class="keywordflow">if</span> (chan &amp;&amp; chan-&gt;par(<span class="stringliteral">&quot;datarate&quot;</span>).doubleValue()&gt;0)
<a name="l00064"></a>00064             error(<span class="stringliteral">&quot;connection on gate %s has data rate set: using data rate with EtherMAC &quot;</span>
<a name="l00065"></a>00065                   <span class="stringliteral">&quot;is forbidden, module&apos;s txrate parameter must be used instead&quot;</span>,
<a name="l00066"></a>00066                   g-&gt;getFullPath().c_str());
<a name="l00067"></a>00067         g = g-&gt;getNextGate();
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="comment">// launch autoconfig process</span>
<a name="l00071"></a>00071     <span class="keywordtype">bool</span> performAutoconfig = <span class="keyword">true</span>;
<a name="l00072"></a>00072     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#a3ab55f66782d6fae503fd9c062896dc7">disabled</a> &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#ace95f162bb4a264cded6f61154885b04">connected</a> &amp;&amp; performAutoconfig)
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074         <a class="code" href="class_ether_m_a_c.html#a00e227576a4ff0bff41d35f06309c139">startAutoconfig</a>();
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordflow">else</span>
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         <a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a> = <span class="keyword">false</span>;
<a name="l00079"></a>00079         <a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> = par(<span class="stringliteral">&quot;duplexEnabled&quot;</span>);
<a name="l00080"></a>00080         <a class="code" href="class_ether_m_a_c_base.html#abf74598139ff3d6b072bdafdaea84a63">calculateParameters</a>();
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082     WATCH(<a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">// initialize state info</span>
<a name="l00085"></a>00085     <a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a> = 0;
<a name="l00086"></a>00086     <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a> = 0;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     WATCH(<a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a>);
<a name="l00089"></a>00089     WATCH(<a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="comment">// initialize statistics</span>
<a name="l00092"></a>00092     <a class="code" href="class_ether_m_a_c.html#a4a14c7389b4f0174c421ea2ab2e38884">totalCollisionTime</a> = 0.0;
<a name="l00093"></a>00093     <a class="code" href="class_ether_m_a_c.html#a7ea84aee874e2a47b305917d5d05cb0e">totalSuccessfulRxTxTime</a> = 0.0;
<a name="l00094"></a>00094     <a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a> = <a class="code" href="class_ether_m_a_c.html#a1102e2facae32b0696ca147ac0d1c8ee">numBackoffs</a> = 0;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     WATCH(<a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>);
<a name="l00097"></a>00097     WATCH(<a class="code" href="class_ether_m_a_c.html#a1102e2facae32b0696ca147ac0d1c8ee">numBackoffs</a>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <a class="code" href="class_ether_m_a_c.html#ac5eadf348b48dafe8f5bb2d879f65866">numCollisionsVector</a>.setName(<span class="stringliteral">&quot;collisions&quot;</span>);
<a name="l00100"></a>00100     <a class="code" href="class_ether_m_a_c.html#a3ba7ca3372df18a5c74e6792ebed9045">numBackoffsVector</a>.setName(<span class="stringliteral">&quot;backoffs&quot;</span>);
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="class_ether_m_a_c.html#a92d05279e9e43258d310d019ebe79ea0">00103</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a92d05279e9e43258d310d019ebe79ea0">EtherMAC::initializeTxrate</a>()
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a> = par(<span class="stringliteral">&quot;txrate&quot;</span>);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="class_ether_m_a_c.html#a00e227576a4ff0bff41d35f06309c139">00108</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a00e227576a4ff0bff41d35f06309c139">EtherMAC::startAutoconfig</a>()
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a> = <span class="keyword">true</span>;
<a name="l00111"></a>00111     <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a> = 0;  <span class="comment">// none suggested</span>
<a name="l00112"></a>00112     <a class="code" href="class_ether_m_a_c.html#a0b1a0ff4e165028710640042773459de">duplexVetoed</a> = <span class="keyword">false</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordtype">double</span> initialTxrate = par(<span class="stringliteral">&quot;txrate&quot;</span>);
<a name="l00115"></a>00115     <span class="keywordtype">bool</span> duplexEnabled = par(<span class="stringliteral">&quot;duplexEnabled&quot;</span>);
<a name="l00116"></a>00116     <a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a> = 0;
<a name="l00117"></a>00117     <a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> = duplexEnabled;
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (!duplexEnabled || initialTxrate&gt;0)
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Autoconfig: advertising our settings: &quot;</span> &lt;&lt; initialTxrate/1000000 &lt;&lt; <span class="stringliteral">&quot;Mb, &quot;</span>
<a name="l00121"></a>00121            &lt;&lt; (<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> ? <span class="stringliteral">&quot;duplex&quot;</span> : <span class="stringliteral">&quot;half-duplex&quot;</span>) &lt;&lt; endl;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a> *autoconf = <span class="keyword">new</span> <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a>(<span class="stringliteral">&quot;autoconf&quot;</span>);
<a name="l00124"></a>00124         <span class="keywordflow">if</span> (!duplexEnabled)
<a name="l00125"></a>00125             autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#ae86c236316561382c4b2e31a10c4307e">setHalfDuplex</a>(<span class="keyword">true</span>);
<a name="l00126"></a>00126         <span class="keywordflow">if</span> (initialTxrate&gt;0)
<a name="l00127"></a>00127             autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#ab9709e0853368ef3993734a9f6a83f51">setTxrate</a>(initialTxrate);
<a name="l00128"></a>00128         send(autoconf, <a class="code" href="class_ether_m_a_c_base.html#aa83bcb5c4f6024e598c2bbbd2f7773bf">physOutGate</a>);
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     scheduleAt(simTime()+<a class="code" href="_ether_m_a_c_8h.html#a1df9f117db9f094bb52bf213fdf70628">AUTOCONFIG_PERIOD</a>, <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;EndAutoconfig&quot;</span>,<a class="code" href="_ether_m_a_c_base_8h.html#a24863fe0bcb7303a1201d982d1debea6">ENDAUTOCONFIG</a>));
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="class_ether_m_a_c.html#a2155aa702e03e8c9341b69ae8ddfeea0">00133</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a2155aa702e03e8c9341b69ae8ddfeea0">EtherMAC::handleAutoconfigMessage</a>(cMessage *msg)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (!msg-&gt;isSelfMessage())
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (msg-&gt;getArrivalGate() == gate(<span class="stringliteral">&quot;upperLayerIn&quot;</span>))
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139             <span class="comment">// from upper layer</span>
<a name="l00140"></a>00140             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Received frame from upper layer during autoconfig period: &quot;</span> &lt;&lt; msg &lt;&lt; endl;
<a name="l00141"></a>00141             <a class="code" href="class_ether_m_a_c.html#a770c337725b006c9d89a81db7bff1985">processFrameFromUpperLayer</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">else</span>
<a name="l00144"></a>00144         {
<a name="l00145"></a>00145             <span class="comment">// from network: must be autoconfig message</span>
<a name="l00146"></a>00146             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Message from network during autoconfig period: &quot;</span> &lt;&lt; msg &lt;&lt; endl;
<a name="l00147"></a>00147             <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a> *autoconf = check_and_cast&lt;<a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a> *&gt;(msg);
<a name="l00148"></a>00148             <span class="keywordtype">double</span> acTxrate = autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#a63a7d9ee7cad07f16e31330580200993">getTxrate</a>();
<a name="l00149"></a>00149 
<a name="l00150"></a>00150             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Autoconfig message: &quot;</span>;
<a name="l00151"></a>00151             <span class="keywordflow">if</span> (acTxrate&gt;0)
<a name="l00152"></a>00152                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; acTxrate/1000000 &lt;&lt; <span class="stringliteral">&quot;Mb &quot;</span>;
<a name="l00153"></a>00153             <span class="keywordflow">if</span> (autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#a554b6bcffa1b38ed1a1ad796c7325952">getHalfDuplex</a>())
<a name="l00154"></a>00154                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;non-duplex&quot;</span>;
<a name="l00155"></a>00155             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157             <span class="keywordflow">if</span> (acTxrate&gt;0 &amp;&amp; (acTxrate&lt;<a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a> || <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a>==0))
<a name="l00158"></a>00158                 <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a> = acTxrate;
<a name="l00159"></a>00159             <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c.html#a0b1a0ff4e165028710640042773459de">duplexVetoed</a> &amp;&amp; autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#a554b6bcffa1b38ed1a1ad796c7325952">getHalfDuplex</a>())
<a name="l00160"></a>00160                 <a class="code" href="class_ether_m_a_c.html#a0b1a0ff4e165028710640042773459de">duplexVetoed</a> = <span class="keyword">true</span>;
<a name="l00161"></a>00161             <span class="keyword">delete</span> msg;
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164     <span class="keywordflow">else</span>
<a name="l00165"></a>00165     {
<a name="l00166"></a>00166         <span class="comment">// self-message signals end of autoconfig period</span>
<a name="l00167"></a>00167         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Self-message during autoconfig period: &quot;</span> &lt;&lt; msg &lt;&lt; endl;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="keyword">delete</span> msg;
<a name="l00170"></a>00170         <a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a> = <span class="keyword">false</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="keywordtype">double</span> initialTxrate = par(<span class="stringliteral">&quot;txrate&quot;</span>);
<a name="l00173"></a>00173         <span class="keywordtype">bool</span> duplexEnabled = par(<span class="stringliteral">&quot;duplexEnabled&quot;</span>);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a> = (initialTxrate==0 &amp;&amp; <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a>==0) ? 100000000 <span class="comment">/* 100 Mb */</span>:
<a name="l00176"></a>00176                  (initialTxrate==0) ? <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a> :
<a name="l00177"></a>00177                  (<a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a>==0) ? initialTxrate :
<a name="l00178"></a>00178                  (<a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a>&lt;initialTxrate) ? <a class="code" href="class_ether_m_a_c.html#adc8ea8365dd52091a665378c0e0fdecf">lowestTxrateSuggested</a> : initialTxrate;
<a name="l00179"></a>00179         <a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> = (duplexEnabled &amp;&amp; !<a class="code" href="class_ether_m_a_c.html#a0b1a0ff4e165028710640042773459de">duplexVetoed</a>);
<a name="l00180"></a>00180         <a class="code" href="class_ether_m_a_c_base.html#abf74598139ff3d6b072bdafdaea84a63">calculateParameters</a>();
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Parameters after autoconfig: txrate=&quot;</span> &lt;&lt; <a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a>/1000000 &lt;&lt; <span class="stringliteral">&quot;Mb, &quot;</span> &lt;&lt; (<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> ? <span class="stringliteral">&quot;duplex&quot;</span> : <span class="stringliteral">&quot;half-duplex&quot;</span>) &lt;&lt; endl;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (ev.isGUI())
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             <span class="keywordtype">char</span> modestr[64];
<a name="l00187"></a>00187             sprintf(modestr, <span class="stringliteral">&quot;%dMb\n%s&quot;</span>, <span class="keywordtype">int</span>(<a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a>/1000000), (<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> ? <span class="stringliteral">&quot;full duplex&quot;</span> : <span class="stringliteral">&quot;half duplex&quot;</span>));
<a name="l00188"></a>00188             getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>,0,modestr);
<a name="l00189"></a>00189             <span class="comment">//getDisplayString().setTagArg(&quot;t&quot;,1,&quot;r&quot;);</span>
<a name="l00190"></a>00190             sprintf(modestr, <span class="stringliteral">&quot;%s: %dMb %s&quot;</span>, getFullName(), <span class="keywordtype">int</span>(<a class="code" href="class_ether_m_a_c_base.html#a82f73bf45cef382be21dcc17c512e644">txrate</a>/1000000), (<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> ? <span class="stringliteral">&quot;duplex&quot;</span> : <span class="stringliteral">&quot;half duplex&quot;</span>));
<a name="l00191"></a>00191             getParentModule()-&gt;bubble(modestr);
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.empty())
<a name="l00195"></a>00195         {
<a name="l00196"></a>00196             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Autoconfig period over, starting to send frames\n&quot;</span>;
<a name="l00197"></a>00197             <a class="code" href="class_ether_m_a_c_base.html#a42b361fc78ad32e17e3f33cf336d6a7f">scheduleEndIFGPeriod</a>();
<a name="l00198"></a>00198         }
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="class_ether_m_a_c.html#a7b8fce39a1befbef2a3baddaf7fb8ecc">00202</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a7b8fce39a1befbef2a3baddaf7fb8ecc">EtherMAC::handleMessage</a> (cMessage *msg)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a3ab55f66782d6fae503fd9c062896dc7">disabled</a>)
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;MAC is disabled -- dropping message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00207"></a>00207         <span class="keyword">delete</span> msg;
<a name="l00208"></a>00208         <span class="keywordflow">return</span>;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a>)
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212         <a class="code" href="class_ether_m_a_c.html#a2155aa702e03e8c9341b69ae8ddfeea0">handleAutoconfigMessage</a>(msg);
<a name="l00213"></a>00213         <span class="keywordflow">return</span>;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <a class="code" href="class_ether_m_a_c.html#ab1091e4dd64112bac3bbcfb3e43005af">printState</a>();
<a name="l00217"></a>00217     <span class="comment">// some consistency check</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2cee1ac453a7df93ad9e888e99f01773">TRANSMITTING_STATE</a> &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>!=<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>)
<a name="l00219"></a>00219         error(<span class="stringliteral">&quot;Inconsistent state -- transmitting and receiving at the same time&quot;</span>);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (!msg-&gt;isSelfMessage())
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223         <span class="comment">// either frame from upper layer, or frame/jam signal from the network</span>
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (msg-&gt;getArrivalGate() == gate(<span class="stringliteral">&quot;upperLayerIn&quot;</span>))
<a name="l00225"></a>00225             <a class="code" href="class_ether_m_a_c.html#a770c337725b006c9d89a81db7bff1985">processFrameFromUpperLayer</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
<a name="l00226"></a>00226         <span class="keywordflow">else</span>
<a name="l00227"></a>00227             <a class="code" href="class_ether_m_a_c.html#a71c21fb4c966e819abbf041ea42f056f">processMsgFromNetwork</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">else</span>
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231         <span class="comment">// Process different self-messages (timer signals)</span>
<a name="l00232"></a>00232         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Self-message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received\n&quot;</span>;
<a name="l00233"></a>00233         <span class="keywordflow">switch</span> (msg-&gt;getKind())
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#ac45d3cc5822040e35e2937be632832b9">ENDIFG</a>:
<a name="l00236"></a>00236                 <a class="code" href="class_ether_m_a_c.html#aac09d6f301dc86d8571b5357723df86a">handleEndIFGPeriod</a>();
<a name="l00237"></a>00237                 <span class="keywordflow">break</span>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a4bb2ae3fedcd3dacd0f824a7b658cff8">ENDTRANSMISSION</a>:
<a name="l00240"></a>00240                 <a class="code" href="class_ether_m_a_c.html#af94eb578c2dcc59eba5f13c88910a2a7">handleEndTxPeriod</a>();
<a name="l00241"></a>00241                 <span class="keywordflow">break</span>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a9330bc9c8a7ef3d0acef63b2e9573c08">ENDRECEPTION</a>:
<a name="l00244"></a>00244                 <a class="code" href="class_ether_m_a_c.html#ac928ada773c433249bbfc213866ecd76">handleEndRxPeriod</a>();
<a name="l00245"></a>00245                 <span class="keywordflow">break</span>;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a64b191c4f0a78fe8aa485d15bb8ee30e">ENDBACKOFF</a>:
<a name="l00248"></a>00248                 <a class="code" href="class_ether_m_a_c.html#ac1bf54200283ab7e0345c959d7a42a5b">handleEndBackoffPeriod</a>();
<a name="l00249"></a>00249                 <span class="keywordflow">break</span>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a4f424177ed127c705b0e598400fd60e9">ENDJAMMING</a>:
<a name="l00252"></a>00252                 <a class="code" href="class_ether_m_a_c.html#a1d46c3efdf2ba5b8ce90f68960541ca1">handleEndJammingPeriod</a>();
<a name="l00253"></a>00253                 <span class="keywordflow">break</span>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a8c8095093aff928ef167df7aeca1ec59">ENDPAUSE</a>:
<a name="l00256"></a>00256                 <a class="code" href="class_ether_m_a_c_base.html#ae6b022b3261a68de11dd41fdcaf26adf">handleEndPausePeriod</a>();
<a name="l00257"></a>00257                 <span class="keywordflow">break</span>;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259             <span class="keywordflow">default</span>:
<a name="l00260"></a>00260                 error(<span class="stringliteral">&quot;self-message with unexpected message kind %d&quot;</span>, msg-&gt;getKind());
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     <a class="code" href="class_ether_m_a_c.html#ab1091e4dd64112bac3bbcfb3e43005af">printState</a>();
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (ev.isGUI())
<a name="l00266"></a>00266         <a class="code" href="class_ether_m_a_c_base.html#a34f2526399ce9f2acc43eb80998f59bc">updateDisplayString</a>();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a><a class="code" href="class_ether_m_a_c.html#a770c337725b006c9d89a81db7bff1985">00270</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a770c337725b006c9d89a81db7bff1985">EtherMAC::processFrameFromUpperLayer</a>(<a class="code" href="class_ether_frame.html">EtherFrame</a> *frame)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="class_ether_m_a_c.html#a770c337725b006c9d89a81db7bff1985">EtherMACBase::processFrameFromUpperLayer</a>(frame);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c.html#a0cfed26778963f7ae08927551c45211b">autoconfigInProgress</a> &amp;&amp; (<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> || <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>) &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a743f3e7b25f8aea548d06e5ae9f574bd">TX_IDLE_STATE</a>)
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;No incoming carrier signals detected, frame clear to send, wait IFG first\n&quot;</span>;
<a name="l00277"></a>00277         <a class="code" href="class_ether_m_a_c_base.html#a42b361fc78ad32e17e3f33cf336d6a7f">scheduleEndIFGPeriod</a>();
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="class_ether_m_a_c.html#a71c21fb4c966e819abbf041ea42f056f">00282</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a71c21fb4c966e819abbf041ea42f056f">EtherMAC::processMsgFromNetwork</a>(cPacket *msg)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <a class="code" href="class_ether_m_a_c.html#a71c21fb4c966e819abbf041ea42f056f">EtherMACBase::processMsgFromNetwork</a>(msg);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     simtime_t endRxTime = simTime() + msg-&gt;getBitLength()*<a class="code" href="class_ether_m_a_c_base.html#ad8c1ea02550aef25d24526dbacfd92f3">bitTime</a>;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2cee1ac453a7df93ad9e888e99f01773">TRANSMITTING_STATE</a>)
<a name="l00289"></a>00289     {
<a name="l00290"></a>00290         <span class="comment">// since we&apos;re halfduplex, receiveState must be RX_IDLE_STATE (asserted at top of handleMessage)</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> (dynamic_cast&lt;EtherJam*&gt;(msg) != NULL)
<a name="l00292"></a>00292             error(<span class="stringliteral">&quot;Stray jam signal arrived while transmitting (usual cause is cable length exceeding allowed maximum)&quot;</span>);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Transmission interrupted by incoming frame, handling collision\n&quot;</span>;
<a name="l00295"></a>00295         cancelEvent(<a class="code" href="class_ether_m_a_c_base.html#a9b054b17bf4311eae452c82b7345129c">endTxMsg</a>);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Transmitting jam signal\n&quot;</span>;
<a name="l00298"></a>00298         <a class="code" href="class_ether_m_a_c.html#a9631222986440dc566b8bba2f018d00a">sendJamSignal</a>(); <span class="comment">// backoff will be executed when jamming finished</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="comment">// set receive state and schedule end of reception</span>
<a name="l00301"></a>00301         <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a5bd43cc4f64aaeb7c20d49fc4e817fdc">RX_COLLISION_STATE</a>;
<a name="l00302"></a>00302         <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>++;
<a name="l00303"></a>00303         simtime_t endJamTime = simTime()+<a class="code" href="class_ether_m_a_c_base.html#af44252e3f1e9b60d8ff8a8dbfb78bc3a">jamDuration</a>;
<a name="l00304"></a>00304         scheduleAt(endRxTime&lt;endJamTime ? endJamTime : endRxTime, <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00305"></a>00305         <span class="keyword">delete</span> msg;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>++;
<a name="l00308"></a>00308         <a class="code" href="class_ether_m_a_c.html#ac5eadf348b48dafe8f5bb2d879f65866">numCollisionsVector</a>.record(<a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>);
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>)
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312         <span class="keywordflow">if</span> (dynamic_cast&lt;EtherJam*&gt;(msg) != NULL)
<a name="l00313"></a>00313             error(<span class="stringliteral">&quot;Stray jam signal arrived (usual cause is cable length exceeding allowed maximum)&quot;</span>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Start reception of frame\n&quot;</span>;
<a name="l00316"></a>00316         <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>++;
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>)
<a name="l00318"></a>00318             error(<span class="stringliteral">&quot;frameBeingReceived!=0 in RX_IDLE_STATE&quot;</span>);
<a name="l00319"></a>00319         <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *)msg;
<a name="l00320"></a>00320         <a class="code" href="class_ether_m_a_c.html#a5b7f05eeb8fa2d3424256837b72e6305">scheduleEndRxPeriod</a>(msg);
<a name="l00321"></a>00321         <a class="code" href="class_ether_m_a_c.html#a092179c05dca493d0bfa237057c766f1">channelBusySince</a> = simTime();
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a> &amp;&amp; dynamic_cast&lt;EtherJam*&gt;(msg)==NULL &amp;&amp; <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>-&gt;getArrivalTime()-simTime()&lt;<a class="code" href="class_ether_m_a_c_base.html#ad8c1ea02550aef25d24526dbacfd92f3">bitTime</a>)
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325         <span class="comment">// With the above condition we filter out &quot;false&quot; collisions that may occur with</span>
<a name="l00326"></a>00326         <span class="comment">// back-to-back frames. That is: when &quot;beginning of frame&quot; message (this one) occurs</span>
<a name="l00327"></a>00327         <span class="comment">// BEFORE &quot;end of previous frame&quot; event (endRxMsg) -- same simulation time,</span>
<a name="l00328"></a>00328         <span class="comment">// only wrong order.</span>
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Back-to-back frames: completing reception of current frame, starting reception of next one\n&quot;</span>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="comment">// complete reception of previous frame</span>
<a name="l00333"></a>00333         cancelEvent(<a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00334"></a>00334         <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>;
<a name="l00335"></a>00335         <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = NULL;
<a name="l00336"></a>00336         <a class="code" href="class_ether_m_a_c_base.html#a08b5bf7bcb012584912397eb8fcae7fd">frameReceptionComplete</a>(frame);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="comment">// start receiving next frame</span>
<a name="l00339"></a>00339         <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *)msg;
<a name="l00340"></a>00340         <a class="code" href="class_ether_m_a_c.html#a5b7f05eeb8fa2d3424256837b72e6305">scheduleEndRxPeriod</a>(msg);
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342     <span class="keywordflow">else</span> <span class="comment">// (receiveState==RECEIVING_STATE || receiveState==RX_COLLISION_STATE)</span>
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344         <span class="comment">// handle overlapping receptions</span>
<a name="l00345"></a>00345         <span class="keywordflow">if</span> (dynamic_cast&lt;EtherJam*&gt;(msg) != NULL)
<a name="l00346"></a>00346         {
<a name="l00347"></a>00347             <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>&lt;=0)
<a name="l00348"></a>00348                 error(<span class="stringliteral">&quot;numConcurrentTransmissions=%d on jam arrival (stray jam?)&quot;</span>,<a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350             <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>--;
<a name="l00351"></a>00351             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Jam signal received, this marks end of one transmission\n&quot;</span>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353             <span class="comment">// by the time jamming ends, all transmissions will have been aborted</span>
<a name="l00354"></a>00354             <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>==0)
<a name="l00355"></a>00355             {
<a name="l00356"></a>00356                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Last jam signal received, collision will ends when jam ends\n&quot;</span>;
<a name="l00357"></a>00357                 cancelEvent(<a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00358"></a>00358                 scheduleAt(endRxTime, <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361         <span class="keywordflow">else</span> <span class="comment">// EtherFrame or EtherPauseFrame</span>
<a name="l00362"></a>00362         {
<a name="l00363"></a>00363             <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>++;
<a name="l00364"></a>00364             <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>-&gt;getArrivalTime() &lt; endRxTime)
<a name="l00365"></a>00365             {
<a name="l00366"></a>00366                 <span class="comment">// otherwise just wait until the end of the longest transmission</span>
<a name="l00367"></a>00367                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Overlapping receptions -- setting collision state and extending collision period\n&quot;</span>;
<a name="l00368"></a>00368                 cancelEvent(<a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00369"></a>00369                 scheduleAt(endRxTime, <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00370"></a>00370             }
<a name="l00371"></a>00371             <span class="keywordflow">else</span>
<a name="l00372"></a>00372             {
<a name="l00373"></a>00373                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Overlapping receptions -- setting collision state\n&quot;</span>;
<a name="l00374"></a>00374             }
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         <span class="comment">// delete collided frames: arrived frame as well as the one we&apos;re currently receiving</span>
<a name="l00378"></a>00378         <span class="keyword">delete</span> msg;
<a name="l00379"></a>00379         <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a>)
<a name="l00380"></a>00380         {
<a name="l00381"></a>00381             <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>;
<a name="l00382"></a>00382             <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = NULL;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384             <a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>++;
<a name="l00385"></a>00385             <a class="code" href="class_ether_m_a_c.html#ac5eadf348b48dafe8f5bb2d879f65866">numCollisionsVector</a>.record(<a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>);
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="comment">// go to collision state</span>
<a name="l00389"></a>00389         <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a5bd43cc4f64aaeb7c20d49fc4e817fdc">RX_COLLISION_STATE</a>;
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a><a class="code" href="class_ether_m_a_c.html#aac09d6f301dc86d8571b5357723df86a">00394</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#aac09d6f301dc86d8571b5357723df86a">EtherMAC::handleEndIFGPeriod</a>()
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396     <a class="code" href="class_ether_m_a_c.html#aac09d6f301dc86d8571b5357723df86a">EtherMACBase::handleEndIFGPeriod</a>();
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="comment">// End of IFG period, okay to transmit, if Rx idle OR duplexMode</span>
<a name="l00399"></a>00399     cPacket *frame = (cPacket *)<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.front();
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">// Perform carrier extension if in Gigabit Ethernet</span>
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#aad587d87f0ee21cf37f7c18ceb173a60">carrierExtension</a> &amp;&amp; frame-&gt;getByteLength() &lt; <a class="code" href="_ethernet_8h.html#a3111bb851481ce2404040b2385afe5de">GIGABIT_MIN_FRAME_WITH_EXT</a>)
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Performing carrier extension of small frame\n&quot;</span>;
<a name="l00405"></a>00405         frame-&gt;setByteLength(<a class="code" href="_ethernet_8h.html#a3111bb851481ce2404040b2385afe5de">GIGABIT_MIN_FRAME_WITH_EXT</a>);
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="comment">// send frame to network</span>
<a name="l00409"></a>00409     <a class="code" href="class_ether_m_a_c.html#a38a8c421c3bee0282b4fa9660d6e71bf">startFrameTransmission</a>();
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="class_ether_m_a_c.html#a38a8c421c3bee0282b4fa9660d6e71bf">00412</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a38a8c421c3bee0282b4fa9660d6e71bf">EtherMAC::startFrameTransmission</a>()
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     cPacket *origFrame = (cPacket *)<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.front();
<a name="l00415"></a>00415     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Transmitting a copy of frame &quot;</span> &lt;&lt; origFrame &lt;&lt; endl;
<a name="l00416"></a>00416     cPacket *frame = origFrame-&gt;dup();
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="comment">// add preamble and SFD (Starting Frame Delimiter), then send out</span>
<a name="l00419"></a>00419     frame-&gt;addByteLength(<a class="code" href="_ethernet_8h.html#a7d9c5baa3aead7d06ae791833bde0d88">PREAMBLE_BYTES</a>+<a class="code" href="_ethernet_8h.html#ad9ee8ec9d34ff29becf20068ee649edd">SFD_BYTES</a>);
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (ev.isGUI())  <a class="code" href="class_ether_m_a_c_base.html#aa827c8d34ae90fe0c4b63c2a7bb2fde5">updateConnectionColor</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a2cee1ac453a7df93ad9e888e99f01773">TRANSMITTING_STATE</a>);
<a name="l00421"></a>00421     send(frame, <a class="code" href="class_ether_m_a_c_base.html#aa83bcb5c4f6024e598c2bbbd2f7773bf">physOutGate</a>);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="comment">// update burst variables</span>
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a2d3576698535f9092562070198820198">frameBursting</a>)
<a name="l00425"></a>00425     {
<a name="l00426"></a>00426         <a class="code" href="class_ether_m_a_c_base.html#a84c2b0ce05482d8dc50182d880f30d58">bytesSentInBurst</a> = frame-&gt;getByteLength();
<a name="l00427"></a>00427         <a class="code" href="class_ether_m_a_c_base.html#ac375b2d52a008a9d67cc5a39d1142f94">framesSentInBurst</a>++;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">// check for collisions (there might be an ongoing reception which we don&apos;t know about, see below)</span>
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a> &amp;&amp; <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>!=<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433         <span class="comment">// During the IFG period the hardware cannot listen to the channel,</span>
<a name="l00434"></a>00434         <span class="comment">// so it might happen that receptions have begun during the IFG,</span>
<a name="l00435"></a>00435         <span class="comment">// and even collisions might be in progress.</span>
<a name="l00436"></a>00436         <span class="comment">//</span>
<a name="l00437"></a>00437         <span class="comment">// But we don&apos;t know of any ongoing transmission so we blindly</span>
<a name="l00438"></a>00438         <span class="comment">// start transmitting, immediately collide and send a jam signal.</span>
<a name="l00439"></a>00439         <span class="comment">//</span>
<a name="l00440"></a>00440         <a class="code" href="class_ether_m_a_c.html#a9631222986440dc566b8bba2f018d00a">sendJamSignal</a>();
<a name="l00441"></a>00441         <span class="comment">// numConcurrentTransmissions stays the same: +1 transmission, -1 jam</span>
<a name="l00442"></a>00442 
<a name="l00443"></a>00443         <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a>)
<a name="l00444"></a>00444         {
<a name="l00445"></a>00445             <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>;
<a name="l00446"></a>00446             <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = NULL;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448             <a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>++;
<a name="l00449"></a>00449             <a class="code" href="class_ether_m_a_c.html#ac5eadf348b48dafe8f5bb2d879f65866">numCollisionsVector</a>.record(<a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>);
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451         <span class="comment">// go to collision state</span>
<a name="l00452"></a>00452         <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a5bd43cc4f64aaeb7c20d49fc4e817fdc">RX_COLLISION_STATE</a>;
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="keywordflow">else</span>
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         <span class="comment">// no collision</span>
<a name="l00457"></a>00457         <a class="code" href="class_ether_m_a_c_base.html#a53f70dc888b2e24464d524581de3f8f3">scheduleEndTxPeriod</a>(frame);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         <span class="comment">// only count transmissions in totalSuccessfulRxTxTime if channel is half-duplex</span>
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a>)
<a name="l00461"></a>00461             <a class="code" href="class_ether_m_a_c.html#a092179c05dca493d0bfa237057c766f1">channelBusySince</a> = simTime();
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a><a class="code" href="class_ether_m_a_c.html#af94eb578c2dcc59eba5f13c88910a2a7">00465</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#af94eb578c2dcc59eba5f13c88910a2a7">EtherMAC::handleEndTxPeriod</a>()
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467     <a class="code" href="class_ether_m_a_c.html#af94eb578c2dcc59eba5f13c88910a2a7">EtherMACBase::handleEndTxPeriod</a>();
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="comment">// only count transmissions in totalSuccessfulRxTxTime if channel is half-duplex</span>
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#ad33267145e8bb8bec8ccdaf1b4419a40">duplexMode</a>)
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472         simtime_t dt = simTime()-<a class="code" href="class_ether_m_a_c.html#a092179c05dca493d0bfa237057c766f1">channelBusySince</a>;
<a name="l00473"></a>00473         <a class="code" href="class_ether_m_a_c.html#a7ea84aee874e2a47b305917d5d05cb0e">totalSuccessfulRxTxTime</a> += dt;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a> = 0;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="comment">// check for and obey received PAUSE frames after each transmission</span>
<a name="l00479"></a>00479     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#aab5753d09b37edd82c1a853b8363d7b1">checkAndScheduleEndPausePeriod</a>())
<a name="l00480"></a>00480         <span class="keywordflow">return</span>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">// Gigabit Ethernet: now decide if we transmit next frame right away (burst) or wait IFG</span>
<a name="l00483"></a>00483     <span class="comment">// FIXME! this is not entirely correct, there must be IFG between burst frames too</span>
<a name="l00484"></a>00484     <span class="keywordtype">bool</span> burstFrame=<span class="keyword">false</span>;
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a2d3576698535f9092562070198820198">frameBursting</a> &amp;&amp; !<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.empty())
<a name="l00486"></a>00486     {
<a name="l00487"></a>00487         <span class="comment">// check if max bytes for burst not exceeded</span>
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a84c2b0ce05482d8dc50182d880f30d58">bytesSentInBurst</a>&lt;<a class="code" href="_ethernet_8h.html#afe56617bc748c0c74c417cdcc1b76505">GIGABIT_MAX_BURST_BYTES</a>)
<a name="l00489"></a>00489         {
<a name="l00490"></a>00490              burstFrame=<span class="keyword">true</span>;
<a name="l00491"></a>00491              <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Transmitting next frame in current burst\n&quot;</span>;
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493         <span class="keywordflow">else</span>
<a name="l00494"></a>00494         {
<a name="l00495"></a>00495              <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Next frame does not fit in current burst\n&quot;</span>;
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (burstFrame)
<a name="l00500"></a>00500         <a class="code" href="class_ether_m_a_c.html#a38a8c421c3bee0282b4fa9660d6e71bf">startFrameTransmission</a>();
<a name="l00501"></a>00501     <span class="keywordflow">else</span>
<a name="l00502"></a>00502         <a class="code" href="class_ether_m_a_c_base.html#a1badd37f8bafc8901b37402dbe3184f2">beginSendFrames</a>();
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="class_ether_m_a_c.html#ac928ada773c433249bbfc213866ecd76">00505</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#ac928ada773c433249bbfc213866ecd76">EtherMAC::handleEndRxPeriod</a>()
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Frame reception complete\n&quot;</span>;
<a name="l00508"></a>00508     simtime_t dt = simTime()-<a class="code" href="class_ether_m_a_c.html#a092179c05dca493d0bfa237057c766f1">channelBusySince</a>;
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a>) <span class="comment">// i.e. not RX_COLLISION_STATE</span>
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a>;
<a name="l00512"></a>00512         <a class="code" href="class_ether_m_a_c.html#a16f286d37d477fc83724c8b125ff5270">frameBeingReceived</a> = NULL;
<a name="l00513"></a>00513         <a class="code" href="class_ether_m_a_c_base.html#a08b5bf7bcb012584912397eb8fcae7fd">frameReceptionComplete</a>(frame);
<a name="l00514"></a>00514         <a class="code" href="class_ether_m_a_c.html#a7ea84aee874e2a47b305917d5d05cb0e">totalSuccessfulRxTxTime</a> += dt;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">else</span>
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         <a class="code" href="class_ether_m_a_c.html#a4a14c7389b4f0174c421ea2ab2e38884">totalCollisionTime</a> += dt;
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>;
<a name="l00522"></a>00522     <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a> = 0;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a743f3e7b25f8aea548d06e5ae9f574bd">TX_IDLE_STATE</a> &amp;&amp; !<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.empty())
<a name="l00525"></a>00525     {
<a name="l00526"></a>00526         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Receiver now idle, can transmit frames in output buffer after IFG period\n&quot;</span>;
<a name="l00527"></a>00527         <a class="code" href="class_ether_m_a_c_base.html#a42b361fc78ad32e17e3f33cf336d6a7f">scheduleEndIFGPeriod</a>();
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="class_ether_m_a_c.html#ac1bf54200283ab7e0345c959d7a42a5b">00531</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#ac1bf54200283ab7e0345c959d7a42a5b">EtherMAC::handleEndBackoffPeriod</a>()
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> != <a class="code" href="_ether_m_a_c_base_8h.html#a6ef9793e5ef80133ad65789aab1e271f">BACKOFF_STATE</a>)
<a name="l00534"></a>00534         error(<span class="stringliteral">&quot;At end of BACKOFF not in BACKOFF_STATE!&quot;</span>);
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.empty())
<a name="l00536"></a>00536         error(<span class="stringliteral">&quot;At end of BACKOFF and buffer empty!&quot;</span>);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>==<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>)
<a name="l00539"></a>00539     {
<a name="l00540"></a>00540         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Backoff period ended, wait IFG\n&quot;</span>;
<a name="l00541"></a>00541         <a class="code" href="class_ether_m_a_c_base.html#a42b361fc78ad32e17e3f33cf336d6a7f">scheduleEndIFGPeriod</a>();
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     <span class="keywordflow">else</span>
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Backoff period ended but channel not free, idling\n&quot;</span>;
<a name="l00546"></a>00546         <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a743f3e7b25f8aea548d06e5ae9f574bd">TX_IDLE_STATE</a>;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="class_ether_m_a_c.html#a1d46c3efdf2ba5b8ce90f68960541ca1">00550</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a1d46c3efdf2ba5b8ce90f68960541ca1">EtherMAC::handleEndJammingPeriod</a>()
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> != <a class="code" href="_ether_m_a_c_base_8h.html#a6148d5d92429d7c40e7dbc1da199afd6">JAMMING_STATE</a>)
<a name="l00553"></a>00553         error(<span class="stringliteral">&quot;At end of JAMMING not in JAMMING_STATE!&quot;</span>);
<a name="l00554"></a>00554     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Jamming finished, executing backoff\n&quot;</span>;
<a name="l00555"></a>00555     <a class="code" href="class_ether_m_a_c.html#af15db7ca7aea23ee77e75c047bbd46a3">handleRetransmission</a>();
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="class_ether_m_a_c.html#a9631222986440dc566b8bba2f018d00a">00558</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a9631222986440dc566b8bba2f018d00a">EtherMAC::sendJamSignal</a>()
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     cPacket *jam = <span class="keyword">new</span> <a class="code" href="class_ether_jam.html">EtherJam</a>(<span class="stringliteral">&quot;JAM_SIGNAL&quot;</span>);
<a name="l00561"></a>00561     jam-&gt;setByteLength(<a class="code" href="_ethernet_8h.html#a7723123f880ac4868c09146452417300">JAM_SIGNAL_BYTES</a>);
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (ev.isGUI())  <a class="code" href="class_ether_m_a_c_base.html#aa827c8d34ae90fe0c4b63c2a7bb2fde5">updateConnectionColor</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a6148d5d92429d7c40e7dbc1da199afd6">JAMMING_STATE</a>);
<a name="l00563"></a>00563     send(jam, <a class="code" href="class_ether_m_a_c_base.html#aa83bcb5c4f6024e598c2bbbd2f7773bf">physOutGate</a>);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     scheduleAt(simTime()+<a class="code" href="class_ether_m_a_c_base.html#af44252e3f1e9b60d8ff8a8dbfb78bc3a">jamDuration</a>, <a class="code" href="class_ether_m_a_c.html#a1d0fc561153186e5cc32c3c7347fd175">endJammingMsg</a>);
<a name="l00566"></a>00566     <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a6148d5d92429d7c40e7dbc1da199afd6">JAMMING_STATE</a>;
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a><a class="code" href="class_ether_m_a_c.html#a5b7f05eeb8fa2d3424256837b72e6305">00569</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a5b7f05eeb8fa2d3424256837b72e6305">EtherMAC::scheduleEndRxPeriod</a>(cPacket *frame)
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571     scheduleAt(simTime()+frame-&gt;getBitLength()*<a class="code" href="class_ether_m_a_c_base.html#ad8c1ea02550aef25d24526dbacfd92f3">bitTime</a>, <a class="code" href="class_ether_m_a_c.html#ab79b95dcdd4fd99014b65b20480079ef">endRxMsg</a>);
<a name="l00572"></a>00572     <a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a>;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="class_ether_m_a_c.html#af15db7ca7aea23ee77e75c047bbd46a3">00575</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#af15db7ca7aea23ee77e75c047bbd46a3">EtherMAC::handleRetransmission</a>()
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (++<a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a> &gt; <a class="code" href="_ethernet_8h.html#a7e1856ac7c6ed757978fc30bb92ace74">MAX_ATTEMPTS</a>)
<a name="l00578"></a>00578     {
<a name="l00579"></a>00579         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Number of retransmit attempts of frame exceeds maximum, cancelling transmission of frame\n&quot;</span>;
<a name="l00580"></a>00580         <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.pop();
<a name="l00581"></a>00581 
<a name="l00582"></a>00582         <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a743f3e7b25f8aea548d06e5ae9f574bd">TX_IDLE_STATE</a>;
<a name="l00583"></a>00583         <a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a> = 0;
<a name="l00584"></a>00584         <span class="comment">// no beginSendFrames(), because end of jam signal sending will trigger it automatically</span>
<a name="l00585"></a>00585         <span class="keywordflow">return</span>;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Executing backoff procedure\n&quot;</span>;
<a name="l00589"></a>00589     <span class="keywordtype">int</span> backoffrange = (<a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a>&gt;=<a class="code" href="_ethernet_8h.html#a1592d1d1a4a90325054c3a62b56337f3">BACKOFF_RANGE_LIMIT</a>) ? 1024 : (1 &lt;&lt; <a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a>);
<a name="l00590"></a>00590     <span class="keywordtype">int</span> slotNumber = intuniform(0,backoffrange-1);
<a name="l00591"></a>00591     simtime_t backofftime = slotNumber*<a class="code" href="class_ether_m_a_c_base.html#a172ecc082bd83ba47278fad39d3e656c">slotTime</a>;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     scheduleAt(simTime()+backofftime, <a class="code" href="class_ether_m_a_c.html#ab33a400a74d73295145562de67ae0abf">endBackoffMsg</a>);
<a name="l00594"></a>00594     <a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a6ef9793e5ef80133ad65789aab1e271f">BACKOFF_STATE</a>;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <a class="code" href="class_ether_m_a_c.html#a1102e2facae32b0696ca147ac0d1c8ee">numBackoffs</a>++;
<a name="l00597"></a>00597     <a class="code" href="class_ether_m_a_c.html#a3ba7ca3372df18a5c74e6792ebed9045">numBackoffsVector</a>.record(<a class="code" href="class_ether_m_a_c.html#a1102e2facae32b0696ca147ac0d1c8ee">numBackoffs</a>);
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a><a class="code" href="class_ether_m_a_c.html#ab1091e4dd64112bac3bbcfb3e43005af">00600</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#ab1091e4dd64112bac3bbcfb3e43005af">EtherMAC::printState</a>()
<a name="l00601"></a>00601 {
<a name="l00602"></a>00602 <span class="preprocessor">#define CASE(x) case x: EV &lt;&lt; #x; break</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>    <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmitState: &quot;</span>;
<a name="l00604"></a>00604     <span class="keywordflow">switch</span> (<a class="code" href="class_ether_m_a_c_base.html#a1b69935f2d60c8df93d459b82da99dfc">transmitState</a>) {
<a name="l00605"></a>00605         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a743f3e7b25f8aea548d06e5ae9f574bd">TX_IDLE_STATE</a>);
<a name="l00606"></a>00606         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#ab1ad012473593829a3005e2fd881d987">WAIT_IFG_STATE</a>);
<a name="l00607"></a>00607         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a2cee1ac453a7df93ad9e888e99f01773">TRANSMITTING_STATE</a>);
<a name="l00608"></a>00608         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a6148d5d92429d7c40e7dbc1da199afd6">JAMMING_STATE</a>);
<a name="l00609"></a>00609         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a6ef9793e5ef80133ad65789aab1e271f">BACKOFF_STATE</a>);
<a name="l00610"></a>00610         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#af922d8152d8f868d834d1627fbd90e81">PAUSE_STATE</a>);
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;,  receiveState: &quot;</span>;
<a name="l00613"></a>00613     <span class="keywordflow">switch</span> (<a class="code" href="class_ether_m_a_c_base.html#af65a4115222e836e9aa1883a50dd6859">receiveState</a>) {
<a name="l00614"></a>00614         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a172dd8a0691f58fedfadb4a29632fba8">RX_IDLE_STATE</a>);
<a name="l00615"></a>00615         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a2aca0dfa94e8e793bf8c576ca1dafae5">RECEIVING_STATE</a>);
<a name="l00616"></a>00616         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_ether_m_a_c_base_8h.html#a5bd43cc4f64aaeb7c20d49fc4e817fdc">RX_COLLISION_STATE</a>);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;,  backoffs: &quot;</span> &lt;&lt; <a class="code" href="class_ether_m_a_c.html#adaa6c4898c554a32a5c527c3fa0cd61f">backoffs</a>;
<a name="l00619"></a>00619     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;,  numConcurrentTransmissions: &quot;</span> &lt;&lt; <a class="code" href="class_ether_m_a_c.html#ab387cd871e256012011122abfddab12a">numConcurrentTransmissions</a>;
<a name="l00620"></a>00620     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;,  queueLength: &quot;</span> &lt;&lt; <a class="code" href="class_ether_m_a_c_base.html#af821fd79d625be2536582fb50f4eadd9">txQueue</a>.length() &lt;&lt; endl;
<a name="l00621"></a>00621 <span class="preprocessor">#undef CASE</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>}
<a name="l00623"></a>00623 
<a name="l00624"></a><a class="code" href="class_ether_m_a_c.html#a32d76cb953c50e550638319aad976c89">00624</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a32d76cb953c50e550638319aad976c89">EtherMAC::finish</a>()
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626     <a class="code" href="class_ether_m_a_c.html#a32d76cb953c50e550638319aad976c89">EtherMACBase::finish</a>();
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     simtime_t t = simTime();
<a name="l00629"></a>00629     simtime_t totalChannelIdleTime = t - <a class="code" href="class_ether_m_a_c.html#a7ea84aee874e2a47b305917d5d05cb0e">totalSuccessfulRxTxTime</a> - <a class="code" href="class_ether_m_a_c.html#a4a14c7389b4f0174c421ea2ab2e38884">totalCollisionTime</a>;
<a name="l00630"></a>00630     recordScalar(<span class="stringliteral">&quot;rx channel idle (%)&quot;</span>, 100*(totalChannelIdleTime/t));
<a name="l00631"></a>00631     recordScalar(<span class="stringliteral">&quot;rx channel utilization (%)&quot;</span>, 100*(<a class="code" href="class_ether_m_a_c.html#a7ea84aee874e2a47b305917d5d05cb0e">totalSuccessfulRxTxTime</a>/t));
<a name="l00632"></a>00632     recordScalar(<span class="stringliteral">&quot;rx channel collision (%)&quot;</span>, 100*(totalCollisionTime/t));
<a name="l00633"></a>00633     recordScalar(<span class="stringliteral">&quot;collisions&quot;</span>,     <a class="code" href="class_ether_m_a_c.html#ab9950c06d98064cf81fc1421d01ae282">numCollisions</a>);
<a name="l00634"></a>00634     recordScalar(<span class="stringliteral">&quot;backoffs&quot;</span>,       <a class="code" href="class_ether_m_a_c.html#a1102e2facae32b0696ca147ac0d1c8ee">numBackoffs</a>);
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="class_ether_m_a_c.html#a388be3d4571873fa7251757a39d679a8">00637</a> <span class="keywordtype">void</span> <a class="code" href="class_ether_m_a_c.html#a388be3d4571873fa7251757a39d679a8">EtherMAC::updateHasSubcribers</a>()
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639     <a class="code" href="class_ether_m_a_c_base.html#a302d966ed62ce375d5a3e320b2131ecd">hasSubscribers</a> = <span class="keyword">false</span>;  <span class="comment">// currently we don&apos;t fire any notifications</span>
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:27 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
