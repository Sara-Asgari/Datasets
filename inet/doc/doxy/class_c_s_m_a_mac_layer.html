<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: CSMAMacLayer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>CSMAMacLayer Class Reference</h1><!-- doxytag: class="CSMAMacLayer" --><!-- doxytag: inherits="WirelessMacBase,INotifiable" -->
<p>MAC module which provides non-persistent CSMA.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CSMAMacLayer:</div>
<div class="dynsection">
 <div class="center">
  <img src="class_c_s_m_a_mac_layer.gif" usemap="#CSMAMacLayer_map" alt=""/>
  <map id="CSMAMacLayer_map" name="CSMAMacLayer_map">
<area href="class_wireless_mac_base.html" alt="WirelessMacBase" shape="rect" coords="0,0,113,24"/>
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="123,0,236,24"/>
</map>
 </div>
</div>

<p><a href="class_c_s_m_a_mac_layer-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a52ea80af0023e1d7002d4bdbc6ae39cc">CSMAMacLayer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a670e9734cd2d4300fb9dd23f1873409f">~CSMAMacLayer</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#af0b2c470ab7f10fe061cf2daf9907e39">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#af0b2c470ab7f10fe061cf2daf9907e39"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#ade403acd57e58a03f974b7f48a32d734">registerInterface</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register the interface in <a class="el" href="class_interface_table.html">InterfaceTable</a>.  <a href="#ade403acd57e58a03f974b7f48a32d734"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#aeaffa0655b4e87224a9a2f09b96805d7">finish</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete all dynamically allocated objects of the module.  <a href="#aeaffa0655b4e87224a9a2f09b96805d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a131f9fa39f15a2e1a995a5581ba05fb1">handleLowerMsg</a> (cPacket *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle packets from lower layer.  <a href="#a131f9fa39f15a2e1a995a5581ba05fb1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#ad4e68633095418d62399d0eaa8a4b0ce">handleCommand</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle commands from upper layer.  <a href="#ad4e68633095418d62399d0eaa8a4b0ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a6df436f9290586658dc48738d7cd2160">handleUpperMsg</a> (cPacket *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle packets from upper layer.  <a href="#a6df436f9290586658dc48738d7cd2160"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a254a29c1cc1f0292039d57c1d189cda3">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle self messages such as timers.  <a href="#a254a29c1cc1f0292039d57c1d189cda3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_mac_pkt.html">MacPkt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#adf48e62e08023a725d932f6fb6d59d28">encapsMsg</a> (cPacket *netw)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encapsulate the given higher-layer packet into <a class="el" href="class_mac_pkt.html">MacPkt</a>.  <a href="#adf48e62e08023a725d932f6fb6d59d28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a086c3e39266c68e144bd6443797a4051">receiveChangeNotification</a> (int category, const cPolymorphic *details)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called by the <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever a change occurs we're interested in.  <a href="#a086c3e39266c68e144bd6443797a4051"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_m_a_c_address.html">MACAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46">myMacAddr</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mac address  <a href="#afdf97d7f96e7f3af317915cb8c67fb46"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449">RadioState::State</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191">radioState</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current state of the radio (kept updated by <a class="el" href="class_c_s_m_a_mac_layer.html#a086c3e39266c68e144bd6443797a4051" title="Called by the NotificationBoard whenever a change occurs we&#39;re interested in...">receiveChangeNotification()</a>).  <a href="#a8cef547042b1676d1ddce0dea22f0191"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cQueue&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a">macQueue</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A queue to store packets from upper layer in case another packet is still waiting for transmission..  <a href="#a7520d042d75476c466a6c22b2f39677a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd">queueLength</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">length of the queue  <a href="#a592653908837e5acbe36dfe7f20efbdd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf">timer</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timer for backoff in case the channel is busy.  <a href="#a4aa3b46aa38d83fd86f2ef499caa48bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_s_m_a_mac_layer.html#ab7ea060c217bbfb8a06bc39c1dfeaa9f">sendTime</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to store the last time a message was sent.  <a href="#ab7ea060c217bbfb8a06bc39c1dfeaa9f"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>MAC module which provides non-persistent CSMA. </p>
<p>This is an implementation of a simple non-persistent CSMA. The idea of nonpersistent CSMA is "listen before talk". Before attempting to transmit, a station will sense the medium for a carrier signal, which, if present, indicates that some other station is sending.</p>
<p>If the channel is busy a random waiting time is computed and after this time the channel is sensed again. Once the channel gets idle the message is sent. (State of the channel is obtained from <a class="el" href="class_snr_eval.html" title="Keeps track of the different snir levels when receiving a packet.">SnrEval</a> via <a class="el" href="class_notification_board.html">NotificationBoard</a>.)</p>
<p>An option of this module is to use a queue. If a packet from the upper layer arrives although there is still another packet waiting for its transmission or being transmitted the new packet can be stored in this queue. The length of this queue can be specified by the user in the omnetpp.ini file. By default the length is 0. If the queue is full or there is no queue (length = 0) new packet(s) will be deleted.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Inform upper layers about the full queue!</dd></dl>
<p>ATTENTION: Imagine the following scenario:</p>
<p>Several stations receive a broadcast request packet, usally exactly at the same time. They will all try to answer at exactly the same time, i.e. they all will sense the channel at exactly the same time and start to transmit because the channel was sensed idle by all of them. Therefore a small random delay should be built into one/some of the upper layers to simulate a random processing time!</p>
<p>The TestApplLayer e.g. implements such a processing delay!</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Marc Lï¿½bbers, Yosia Hadisusanto </dd></dl>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00071">71</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a52ea80af0023e1d7002d4bdbc6ae39cc"></a><!-- doxytag: member="CSMAMacLayer::CSMAMacLayer" ref="a52ea80af0023e1d7002d4bdbc6ae39cc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CSMAMacLayer::CSMAMacLayer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00030">30</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032     <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a> = NULL;
<a name="l00033"></a>00033 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a670e9734cd2d4300fb9dd23f1873409f"></a><!-- doxytag: member="CSMAMacLayer::~CSMAMacLayer" ref="a670e9734cd2d4300fb9dd23f1873409f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CSMAMacLayer::~CSMAMacLayer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00035">35</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00036"></a>00036 {
<a name="l00037"></a>00037     cancelAndDelete(<a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>);
<a name="l00038"></a>00038 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adf48e62e08023a725d932f6fb6d59d28"></a><!-- doxytag: member="CSMAMacLayer::encapsMsg" ref="adf48e62e08023a725d932f6fb6d59d28" args="(cPacket *netw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_mac_pkt.html">MacPkt</a> * CSMAMacLayer::encapsMsg </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>netw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Encapsulate the given higher-layer packet into <a class="el" href="class_mac_pkt.html">MacPkt</a>. </p>
<p>Encapsulates the received network-layer packet into a <a class="el" href="class_mac_pkt.html">MacPkt</a> and set all needed header fields. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00234">234</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00235"></a>00235 {
<a name="l00236"></a>00236     <a class="code" href="class_mac_pkt.html">MacPkt</a> *pkt = <span class="keyword">new</span> <a class="code" href="class_mac_pkt.html">MacPkt</a>(netw-&gt;getName());
<a name="l00237"></a>00237     pkt-&gt;setBitLength(272);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">// copy dest address from the Control Info attached to the network</span>
<a name="l00240"></a>00240     <span class="comment">// mesage by the network layer</span>
<a name="l00241"></a>00241     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *ctrl = check_and_cast&lt;<a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *&gt;(netw-&gt;removeControlInfo());
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;ctrl removed, mac addr=&quot;</span> &lt;&lt; ctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a44abf8e022b465968d9d0aa6bd08d626">getDest</a>() &lt;&lt; endl;
<a name="l00244"></a>00244     pkt-&gt;<a class="code" href="class_mac_pkt.html#af609a2487833119cf327886ef6a59bb5">setDestAddr</a>(ctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a44abf8e022b465968d9d0aa6bd08d626">getDest</a>());
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="comment">//delete the control info</span>
<a name="l00247"></a>00247     <span class="keyword">delete</span> ctrl;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="comment">//set the src address to own mac address</span>
<a name="l00250"></a>00250     pkt-&gt;<a class="code" href="class_mac_pkt.html#a836e58e0ceb5fada634e306e4047d9c3">setSrcAddr</a>(<a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a>);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">//encapsulate the network packet</span>
<a name="l00253"></a>00253     pkt-&gt;encapsulate(netw);
<a name="l00254"></a>00254     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;pkt encapsulated\n&quot;</span>;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">return</span> pkt;
<a name="l00257"></a>00257 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeaffa0655b4e87224a9a2f09b96805d7"></a><!-- doxytag: member="CSMAMacLayer::finish" ref="aeaffa0655b4e87224a9a2f09b96805d7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::finish </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete all dynamically allocated objects of the module. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00109">109</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4e68633095418d62399d0eaa8a4b0ce"></a><!-- doxytag: member="CSMAMacLayer::handleCommand" ref="ad4e68633095418d62399d0eaa8a4b0ce" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleCommand </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle commands from upper layer. </p>

<p>Implements <a class="el" href="class_wireless_mac_base.html#a2a5fd20a6064b4754954638bc93f8d8d">WirelessMacBase</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00113">113</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <span class="comment">// no commands supported by CSMAMacLayer</span>
<a name="l00116"></a>00116     error(<span class="stringliteral">&quot;Non-packet message arrived from higher layer: (%s)%s&quot;</span>, msg-&gt;getClassName(), msg-&gt;getName());
<a name="l00117"></a>00117 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a131f9fa39f15a2e1a995a5581ba05fb1"></a><!-- doxytag: member="CSMAMacLayer::handleLowerMsg" ref="a131f9fa39f15a2e1a995a5581ba05fb1" args="(cPacket *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleLowerMsg </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle packets from lower layer. </p>
<p>Compare the address of this Host with the destination address in frame. If they are equal or the frame is broadcast, we send this frame to the upper layer. If not delete it. </p>

<p>Implements <a class="el" href="class_wireless_mac_base.html#ab1db1fa4fd9ecec9d8fa1a38a9a365e1">WirelessMacBase</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00213">213</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00214"></a>00214 {
<a name="l00215"></a>00215     <a class="code" href="class_mac_pkt.html">MacPkt</a> *mac = check_and_cast&lt;<a class="code" href="class_mac_pkt.html">MacPkt</a> *&gt;(msg);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">//only foward to upper layer if message is for me or broadcast</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (mac-&gt;<a class="code" href="class_mac_pkt.html#a4be021c42528e2ce233fc55d4c625df2">getDestAddr</a>() == <a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a> || mac-&gt;<a class="code" href="class_mac_pkt.html#a4be021c42528e2ce233fc55d4c625df2">getDestAddr</a>().<a class="code" href="class_m_a_c_address.html#aa65a288ef8fe0e08e66912ffda5e3706">isBroadcast</a>())
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;sending pkt to upper...\n&quot;</span>;
<a name="l00221"></a>00221         <a class="code" href="class_wireless_mac_base.html#a5454ec5040663e5af4ddb00f525a3caf" title="Sends a message to the upper layer.">sendUp</a>(mac);
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">else</span>
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;packet not for me, deleting...\n&quot;</span>;
<a name="l00226"></a>00226         <span class="keyword">delete</span> mac;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a254a29c1cc1f0292039d57c1d189cda3"></a><!-- doxytag: member="CSMAMacLayer::handleSelfMsg" ref="a254a29c1cc1f0292039d57c1d189cda3" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleSelfMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle self messages such as timers. </p>
<p>After the timer expires try to retransmit the message by calling handleUpperMsg again. </p>

<p>Implements <a class="el" href="class_wireless_mac_base.html#a1c7f3c2581f66d7de17af4a730ae0c4d">WirelessMacBase</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00199">199</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00200"></a>00200 {
<a name="l00201"></a>00201     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;timer expired, calling handleUpperMsg again.. time: &quot;</span> &lt;&lt; simTime() &lt;&lt; endl;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">// timer expired for a buffered frame, try to send again</span>
<a name="l00204"></a>00204     <a class="code" href="class_c_s_m_a_mac_layer.html#a6df436f9290586658dc48738d7cd2160" title="Handle packets from upper layer.">handleUpperMsg</a>((<a class="code" href="class_mac_pkt.html">MacPkt</a> *) msg-&gt;getContextPointer());
<a name="l00205"></a>00205 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6df436f9290586658dc48738d7cd2160"></a><!-- doxytag: member="CSMAMacLayer::handleUpperMsg" ref="a6df436f9290586658dc48738d7cd2160" args="(cPacket *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleUpperMsg </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle packets from upper layer. </p>
<p>First it has to be checked whether a frame is currently being transmitted or waiting to be transmitted. If so the newly arrived message is stored in a queue. If there is no queue or it is full print a warning.</p>
<p>Before transmitting a frame it is tested whether the channel is busy at the moment or not. If the channel is busy, a short random time will be generated and the <a class="el" href="class_mac_pkt.html">MacPkt</a> is buffered for this time, before a next attempt to send the packet is started.</p>
<p>If channel is idle the frame will be transmitted immediately. </p>

<p>Implements <a class="el" href="class_wireless_mac_base.html#ab44661d865472b3799cbe4b086e131b9">WirelessMacBase</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">132</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00199">handleSelfMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <a class="code" href="class_mac_pkt.html">MacPkt</a> *mac = <a class="code" href="class_c_s_m_a_mac_layer.html#adf48e62e08023a725d932f6fb6d59d28" title="Encapsulate the given higher-layer packet into MacPkt.">encapsMsg</a>(msg);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">// message has to be queued if another message is waiting to be send</span>
<a name="l00137"></a>00137     <span class="comment">// or if we are already trying to send another message</span>
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">// the comparison with sendTime is necessary so that concurrently</span>
<a name="l00140"></a>00140     <span class="comment">// arriving messages are handled sequentially. As soon as one</span>
<a name="l00141"></a>00141     <span class="comment">// message arrived at simTime() is passed to lower layers all other</span>
<a name="l00142"></a>00142     <span class="comment">// messages arriving at the same time will be buffered.</span>
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (<a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>-&gt;isScheduled() || <a class="code" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191" title="Current state of the radio (kept updated by receiveChangeNotification()).">radioState</a> == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a> || <a class="code" href="class_c_s_m_a_mac_layer.html#ab7ea060c217bbfb8a06bc39c1dfeaa9f" title="Used to store the last time a message was sent.">sendTime</a> == simTime())
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="comment">// if there is no queue the message will be deleted</span>
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (<a class="code" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd" title="length of the queue">queueLength</a> == 0)
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;New packet arrived though another is still waiting for being sent, &quot;</span>
<a name="l00150"></a>00150                 <span class="stringliteral">&quot; and buffer size is zero. New packet is deleted.\n&quot;</span>;
<a name="l00151"></a>00151             <span class="comment">// TODO: Signal this to upper layer!</span>
<a name="l00152"></a>00152             <span class="keyword">delete</span> mac;
<a name="l00153"></a>00153             <span class="keywordflow">return</span>;
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="comment">// the queue is not full yet so we can queue the message</span>
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (<a class="code" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a" title="A queue to store packets from upper layer in case another packet is still waiting...">macQueue</a>.length() &lt; <a class="code" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd" title="length of the queue">queueLength</a>)
<a name="l00158"></a>00158         {
<a name="l00159"></a>00159             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;already transmitting, putting pkt into queue...\n&quot;</span>;
<a name="l00160"></a>00160             <a class="code" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a" title="A queue to store packets from upper layer in case another packet is still waiting...">macQueue</a>.insert(mac);
<a name="l00161"></a>00161             <span class="keywordflow">return</span>;
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163         <span class="comment">// queue is full, message has to be deleted</span>
<a name="l00164"></a>00164         <span class="keywordflow">else</span>
<a name="l00165"></a>00165         {
<a name="l00166"></a>00166             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;New packet arrived, but queue is FULL, so new packet is deleted\n&quot;</span>;
<a name="l00167"></a>00167             <span class="comment">// TODO: Signal this to upper layer!!</span>
<a name="l00168"></a>00168             <span class="keyword">delete</span> mac;
<a name="l00169"></a>00169             <span class="keywordflow">return</span>;
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="comment">// no message is scheduled for sending or currently being sent</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">// check the radio status and transmit the message if the channel is</span>
<a name="l00176"></a>00176     <span class="comment">// idle. Otherwise backoff for a random time and try again</span>
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (<a class="code" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191" title="Current state of the radio (kept updated by receiveChangeNotification()).">radioState</a> == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;CHANNEL IDLE, send...\n&quot;</span>;
<a name="l00180"></a>00180         <a class="code" href="class_wireless_mac_base.html#a97af424876ed4fc77702d183f38dc83c" title="Sends a message to the lower layer.">sendDown</a>(mac);
<a name="l00181"></a>00181         <span class="comment">//store the sending time</span>
<a name="l00182"></a>00182         <a class="code" href="class_c_s_m_a_mac_layer.html#ab7ea060c217bbfb8a06bc39c1dfeaa9f" title="Used to store the last time a message was sent.">sendTime</a> = simTime();
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">else</span>
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186         <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>-&gt;setContextPointer(mac);
<a name="l00187"></a>00187         simtime_t randomTime = intuniform(0, 10) / 100.0;
<a name="l00188"></a>00188         scheduleAt(simTime() + randomTime, <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>);
<a name="l00189"></a>00189         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;CHANNEL BUSY, I will try to retransmit at &quot;</span> &lt;&lt; simTime() + randomTime &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af0b2c470ab7f10fe061cf2daf9907e39"></a><!-- doxytag: member="CSMAMacLayer::initialize" ref="af0b2c470ab7f10fe061cf2daf9907e39" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::initialize </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialization of the module and some variables. </p>

<p>Reimplemented from <a class="el" href="class_wireless_mac_base.html#a74866aacf342c21cd220d959698d87af">WirelessMacBase</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00040">40</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00041"></a>00041 {
<a name="l00042"></a>00042     <a class="code" href="class_c_s_m_a_mac_layer.html#af0b2c470ab7f10fe061cf2daf9907e39" title="Initialization of the module and some variables.">WirelessMacBase::initialize</a>(stage);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044     <span class="keywordflow">if</span> (stage == 0)
<a name="l00045"></a>00045     {
<a name="l00046"></a>00046         <a class="code" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd" title="length of the queue">queueLength</a> = hasPar(<span class="stringliteral">&quot;queueLength&quot;</span>) ? (int)par(<span class="stringliteral">&quot;queueLength&quot;</span>) : 0;
<a name="l00047"></a>00047         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;queueLength = &quot;</span> &lt;&lt; <a class="code" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd" title="length of the queue">queueLength</a> &lt;&lt; endl;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">//subscribe for the information of the carrier sense</span>
<a name="l00050"></a>00050         <a class="code" href="class_wireless_mac_base.html#a779ea8a0af7e4ef85c5faa85d6a281ed" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#aeb02a282e6c807c1cb064a28e8409ff2">subscribe</a>(<span class="keyword">this</span>, <a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">// initialize the timer</span>
<a name="l00053"></a>00053         <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;backoff&quot;</span>);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <a class="code" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191" title="Current state of the radio (kept updated by receiveChangeNotification()).">radioState</a> = <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>; <span class="comment">// until 1st receiveChangeNotification()</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="comment">// get registered in IInterfaceTable</span>
<a name="l00058"></a>00058         <a class="code" href="class_c_s_m_a_mac_layer.html#ade403acd57e58a03f974b7f48a32d734" title="Register the interface in InterfaceTable.">registerInterface</a>();
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a086c3e39266c68e144bd6443797a4051"></a><!-- doxytag: member="CSMAMacLayer::receiveChangeNotification" ref="a086c3e39266c68e144bd6443797a4051" args="(int category, const cPolymorphic *details)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::receiveChangeNotification </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const cPolymorphic *&nbsp;</td>
          <td class="paramname"> <em>details</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called by the <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever a change occurs we're interested in. </p>
<p>Update the internal copy of the <a class="el" href="class_radio_state.html">RadioState</a>.</p>
<p>If the <a class="el" href="class_radio_state.html">RadioState</a> switched from TRANSMIT to IDLE and there are still messages in the queue, call handleUpperMsg in order to try to send those now. </p>

<p>Implements <a class="el" href="class_i_notifiable.html#a67d757190e1128eaec8f0a8e51ed38f6">INotifiable</a>.</p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00266">266</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00267"></a>00267 {
<a name="l00268"></a>00268     Enter_Method(<span class="stringliteral">&quot;receiveChangeNotification(%s, %s)&quot;</span>, <a class="code" href="_notifier_consts_8cc.html#a6808a262fcec2a310a9e7ed7d75c029f">notificationCategoryName</a>(category),
<a name="l00269"></a>00269                  details?details-&gt;info().c_str() : <span class="stringliteral">&quot;n/a&quot;</span>);
<a name="l00270"></a>00270     <a class="code" href="_notifier_consts_8cc.html#a68fd4b933fae636048bb9ee52fd922e5">printNotificationBanner</a>(category, details);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (category == <a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>)
<a name="l00273"></a>00273     {
<a name="l00274"></a>00274         <span class="comment">// update the local copy of the radio state</span>
<a name="l00275"></a>00275         <a class="code" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191" title="Current state of the radio (kept updated by receiveChangeNotification()).">radioState</a> = check_and_cast&lt;<a class="code" href="class_radio_state.html">RadioState</a> *&gt;(details)-&gt;getState();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">// NOTE: we may be invoked during INIT STAGE 1 too, when SnrEval notifies us</span>
<a name="l00278"></a>00278         <span class="comment">// about the initial radio state. This function has to work correctly</span>
<a name="l00279"></a>00279         <span class="comment">// even when called during initialization phase!</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="comment">// if the channel is idle now, the queue is not empty and no timer</span>
<a name="l00282"></a>00282         <span class="comment">// is scheduled, this means that sending the previous message is</span>
<a name="l00283"></a>00283         <span class="comment">// complete and the next one can be taken out of the queue</span>
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (<a class="code" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191" title="Current state of the radio (kept updated by receiveChangeNotification()).">radioState</a> == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a> &amp;&amp; !<a class="code" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a" title="A queue to store packets from upper layer in case another packet is still waiting...">macQueue</a>.empty() &amp;&amp; !<a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>-&gt;isScheduled())
<a name="l00285"></a>00285         {
<a name="l00286"></a>00286             <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>-&gt;setContextPointer(<a class="code" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a" title="A queue to store packets from upper layer in case another packet is still waiting...">macQueue</a>.pop());
<a name="l00287"></a>00287             simtime_t randomTime = intuniform(0, 10) / 100.0;
<a name="l00288"></a>00288             scheduleAt(simTime() + randomTime, <a class="code" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf" title="Timer for backoff in case the channel is busy.">timer</a>);
<a name="l00289"></a>00289             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;taking next pkt out of queue, schedule at &quot;</span> &lt;&lt; simTime() + randomTime &lt;&lt; endl;
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade403acd57e58a03f974b7f48a32d734"></a><!-- doxytag: member="CSMAMacLayer::registerInterface" ref="ade403acd57e58a03f974b7f48a32d734" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::registerInterface </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register the interface in <a class="el" href="class_interface_table.html">InterfaceTable</a>. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00062">62</a> of file <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00040">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063 {
<a name="l00064"></a>00064     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *e = <span class="keyword">new</span> <a class="code" href="class_interface_entry.html">InterfaceEntry</a>();
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="comment">// interface name: NetworkInterface module&apos;s name without special characters ([])</span>
<a name="l00067"></a>00067     <span class="keywordtype">char</span> *interfaceName = <span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(getParentModule()-&gt;getFullName()) + 1];
<a name="l00068"></a>00068     <span class="keywordtype">char</span> *d = interfaceName;
<a name="l00069"></a>00069     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *s = getParentModule()-&gt;getFullName(); *s; s++)
<a name="l00070"></a>00070         <span class="keywordflow">if</span> (isalnum(*s))
<a name="l00071"></a>00071             *d++ = *s;
<a name="l00072"></a>00072     *d = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     e-&gt;<a class="code" href="class_interface_entry.html#af9ca0c7af3a0f45e7d7102e6cc2b089e">setName</a>(interfaceName);
<a name="l00075"></a>00075     <span class="keyword">delete</span> [] interfaceName;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keyword">const</span> <span class="keywordtype">char</span> *addrstr = par(<span class="stringliteral">&quot;address&quot;</span>);
<a name="l00078"></a>00078     <span class="keywordflow">if</span> (!strcmp(addrstr, <span class="stringliteral">&quot;auto&quot;</span>))
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080         <span class="comment">// assign automatic address</span>
<a name="l00081"></a>00081         <a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a> = <a class="code" href="class_m_a_c_address.html#a020d8e71aa50506e2b29a15833fedfd9">MACAddress::generateAutoAddress</a>();
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="comment">// change module parameter from &quot;auto&quot; to concrete address</span>
<a name="l00084"></a>00084         par(<span class="stringliteral">&quot;address&quot;</span>).setStringValue(<a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a>.<a class="code" href="class_m_a_c_address.html#a5eed6450abcdd795b2a3d59828a29802">str</a>().c_str());
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086     <span class="keywordflow">else</span>
<a name="l00087"></a>00087     {
<a name="l00088"></a>00088         <a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a>.<a class="code" href="class_m_a_c_address.html#a8098d36b9f4a40ef61e1a3cb62cb27dd">setAddress</a>(addrstr);
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     e-&gt;<a class="code" href="class_interface_entry.html#ac10c228cc65a2c799c798ca75de593dc">setMACAddress</a>(<a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">// generate interface identifier for IPv6</span>
<a name="l00093"></a>00093     e-&gt;<a class="code" href="class_interface_entry.html#a7fad57b268a57abe1de80d30299d4c45">setInterfaceToken</a>(<a class="code" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46" title="mac address">myMacAddr</a>.<a class="code" href="class_m_a_c_address.html#af646c7d6a3dbe4a94465fd3ec144f08f">formInterfaceIdentifier</a>());
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">// MTU on 802.11 = ?</span>
<a name="l00096"></a>00096     e-&gt;<a class="code" href="class_interface_entry.html#aaebcf5970e29877b0a4b68ddaaaf540f">setMtu</a>(1500);  <span class="comment">// FIXME</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="comment">// capabilities</span>
<a name="l00099"></a>00099     e-&gt;<a class="code" href="class_interface_entry.html#a6f9c79da187d1d56c028b616f3be28fe">setBroadcast</a>(<span class="keyword">true</span>);
<a name="l00100"></a>00100     e-&gt;<a class="code" href="class_interface_entry.html#a0b9fca7071b37185a18b6693c3502f69">setMulticast</a>(<span class="keyword">true</span>);
<a name="l00101"></a>00101     e-&gt;<a class="code" href="class_interface_entry.html#af207b6ea20ecd9bedd4acfae50a3500f">setPointToPoint</a>(<span class="keyword">false</span>);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <span class="comment">// add</span>
<a name="l00104"></a>00104     <a class="code" href="class_i_interface_table.html">IInterfaceTable</a> *ift = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
<a name="l00105"></a>00105     ift-&gt;<a class="code" href="class_i_interface_table.html#a2159ab6dc917bd6f1b2061980bbdf107">addInterface</a>(e, <span class="keyword">this</span>);
<a name="l00106"></a>00106 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a7520d042d75476c466a6c22b2f39677a"></a><!-- doxytag: member="CSMAMacLayer::macQueue" ref="a7520d042d75476c466a6c22b2f39677a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cQueue <a class="el" href="class_c_s_m_a_mac_layer.html#a7520d042d75476c466a6c22b2f39677a">CSMAMacLayer::macQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A queue to store packets from upper layer in case another packet is still waiting for transmission.. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00114">114</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>, and <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00266">receiveChangeNotification()</a>.</p>

</div>
</div>
<a class="anchor" id="afdf97d7f96e7f3af317915cb8c67fb46"></a><!-- doxytag: member="CSMAMacLayer::myMacAddr" ref="afdf97d7f96e7f3af317915cb8c67fb46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_m_a_c_address.html">MACAddress</a> <a class="el" href="class_c_s_m_a_mac_layer.html#afdf97d7f96e7f3af317915cb8c67fb46">CSMAMacLayer::myMacAddr</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mac address </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00107">107</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00234">encapsMsg()</a>, <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00213">handleLowerMsg()</a>, and <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00062">registerInterface()</a>.</p>

</div>
</div>
<a class="anchor" id="a592653908837e5acbe36dfe7f20efbdd"></a><!-- doxytag: member="CSMAMacLayer::queueLength" ref="a592653908837e5acbe36dfe7f20efbdd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_c_s_m_a_mac_layer.html#a592653908837e5acbe36dfe7f20efbdd">CSMAMacLayer::queueLength</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>length of the queue </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00117">117</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>, and <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00040">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a8cef547042b1676d1ddce0dea22f0191"></a><!-- doxytag: member="CSMAMacLayer::radioState" ref="a8cef547042b1676d1ddce0dea22f0191" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449">RadioState::State</a> <a class="el" href="class_c_s_m_a_mac_layer.html#a8cef547042b1676d1ddce0dea22f0191">CSMAMacLayer::radioState</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Current state of the radio (kept updated by <a class="el" href="class_c_s_m_a_mac_layer.html#a086c3e39266c68e144bd6443797a4051" title="Called by the NotificationBoard whenever a change occurs we&#39;re interested in...">receiveChangeNotification()</a>). </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00110">110</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>, <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00040">initialize()</a>, and <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00266">receiveChangeNotification()</a>.</p>

</div>
</div>
<a class="anchor" id="ab7ea060c217bbfb8a06bc39c1dfeaa9f"></a><!-- doxytag: member="CSMAMacLayer::sendTime" ref="ab7ea060c217bbfb8a06bc39c1dfeaa9f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="class_c_s_m_a_mac_layer.html#ab7ea060c217bbfb8a06bc39c1dfeaa9f">CSMAMacLayer::sendTime</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used to store the last time a message was sent. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00123">123</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>.</p>

</div>
</div>
<a class="anchor" id="a4aa3b46aa38d83fd86f2ef499caa48bf"></a><!-- doxytag: member="CSMAMacLayer::timer" ref="a4aa3b46aa38d83fd86f2ef499caa48bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_c_s_m_a_mac_layer.html#a4aa3b46aa38d83fd86f2ef499caa48bf">CSMAMacLayer::timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Timer for backoff in case the channel is busy. </p>

<p>Definition at line <a class="el" href="_c_s_m_a_mac_layer_8h_source.html#l00120">120</a> of file <a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00030">CSMAMacLayer()</a>, <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00132">handleUpperMsg()</a>, <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00040">initialize()</a>, <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00266">receiveChangeNotification()</a>, and <a class="el" href="_c_s_m_a_mac_layer_8cc_source.html#l00035">~CSMAMacLayer()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_c_s_m_a_mac_layer_8h_source.html">CSMAMacLayer.h</a></li>
<li><a class="el" href="_c_s_m_a_mac_layer_8cc_source.html">CSMAMacLayer.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:32 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
