<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: UDP Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>UDP Class Reference</h1><!-- doxytag: class="UDP" -->
<p><code>#include &lt;<a class="el" href="_u_d_p_8h_source.html">UDP.h</a>&gt;</code></p>

<p><a href="class_u_d_p-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a></td></tr>
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::list&lt; <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; int, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a68d5e94d3be14183856abf7f7ac8002a">SocketsByIdMap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; int, <br class="typebreak"/>
<a class="el" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a829a029b999e1f99838cd59e10eab3a9">SocketsByPortMap</a></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ac9e9b89f827804de5bb675e8adbc9eab">UDP</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ac9c6eaf3e5f1bd64ea3ac0552137ca0e">~UDP</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a5c2df70abc011c2753a47cbff187a306">updateDisplayString</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a7ad4f9f51d27f92e0d23041f9b64a896">bind</a> (int gateIndex, <a class="el" href="class_u_d_p_control_info.html">UDPControlInfo</a> *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a9fb94355db86e280d8de7b1ef7ced43c">connect</a> (int sockId, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> addr, int port)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a92b95e9e592cd6beff8f0b20228bc214">unbind</a> (int sockId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a56d497b22c8f110dbfc52ee7e85c9f1b">getEphemeralPort</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a7e436c2b0a7b563bae29603603422cc0">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udp, <a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a6529b4917795bbb08f2fe013045718aa">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udp, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a2b23bb364855683d34fdfb3bcb06eceb">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;localAddr, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;remoteAddr, short remotePort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#affa73f57d52206f4aa5bc2539ac63c0f">sendUp</a> (cPacket *payload, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpHeader, <a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ac693a0a152b8577d646493c325f15b45">sendUp</a> (cPacket *payload, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpHeader, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a5a411e560693182d2cde11ab5566e1fc">processUndeliverablePacket</a> (<a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket, cPolymorphic *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a787238b9470b0fd4235b1c347cdb0639">sendUpErrorNotification</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, int msgkind, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;localAddr, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;remoteAddr, short remotePort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a8f0e27d03d3e209f437bfa72dd3efe38">processICMPError</a> (cPacket *icmpErrorMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a333fddcf308d3c6348c9cc5e6bfa796d">processUDPPacket</a> (<a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a1d2e34c55abb9e373694d77d3bac8f09">processMsgFromApp</a> (cPacket *appData)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ae251c9826aa3b5242ad02d6620ea2616">processCommandFromApp</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#af5e2c13d9e3a33936212cefdfa723d18">createUDPPacket</a> (const char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a9ff0a87c6965238d54bb67997d6912ca">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a79daccc47126abbf6740b029d7a57089">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_u_d_p.html#a68d5e94d3be14183856abf7f7ac8002a">SocketsByIdMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_u_d_p.html#a829a029b999e1f99838cd59e10eab3a9">SocketsByPortMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_c_m_p.html">ICMP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a4995c941113ffc075a8a4b6051fb1ca4">icmp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">icmpv6</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">numSent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a9ed09aeb9c434f9c7931dc82d3b2d34c">numDroppedBadChecksum</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Implements the <a class="el" href="class_u_d_p.html">UDP</a> protocol: encapsulates/decapsulates user data into/from <a class="el" href="class_u_d_p.html">UDP</a>.</p>
<p>More info in the NED file. </p>

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00046">46</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>
<hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a17d5eac534fa0d896ceef2831cd28d77"></a><!-- doxytag: member="UDP::SockDescList" ref="a17d5eac534fa0d896ceef2831cd28d77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::list&lt;<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&gt; <a class="el" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">UDP::SockDescList</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00062">62</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

</div>
</div>
<a class="anchor" id="a68d5e94d3be14183856abf7f7ac8002a"></a><!-- doxytag: member="UDP::SocketsByIdMap" ref="a68d5e94d3be14183856abf7f7ac8002a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;int,<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&gt; <a class="el" href="class_u_d_p.html#a68d5e94d3be14183856abf7f7ac8002a">UDP::SocketsByIdMap</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00063">63</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

</div>
</div>
<a class="anchor" id="a829a029b999e1f99838cd59e10eab3a9"></a><!-- doxytag: member="UDP::SocketsByPortMap" ref="a829a029b999e1f99838cd59e10eab3a9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;int,<a class="el" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a>&gt; <a class="el" href="class_u_d_p.html#a829a029b999e1f99838cd59e10eab3a9">UDP::SocketsByPortMap</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00064">64</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac9e9b89f827804de5bb675e8adbc9eab"></a><!-- doxytag: member="UDP::UDP" ref="ac9e9b89f827804de5bb675e8adbc9eab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UDP::UDP </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00122">122</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00122"></a>00122 {}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac9c6eaf3e5f1bd64ea3ac0552137ca0e"></a><!-- doxytag: member="UDP::~UDP" ref="ac9c6eaf3e5f1bd64ea3ac0552137ca0e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UDP::~UDP </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00075">75</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (SocketsByIdMap::iterator i=<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.begin(); i!=<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.end(); ++i)
<a name="l00078"></a>00078         <span class="keyword">delete</span> i-&gt;second;
<a name="l00079"></a>00079 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a7ad4f9f51d27f92e0d23041f9b64a896"></a><!-- doxytag: member="UDP::bind" ref="a7ad4f9f51d27f92e0d23041f9b64a896" args="(int gateIndex, UDPControlInfo *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::bind </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gateIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_u_d_p_control_info.html">UDPControlInfo</a> *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00100">100</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00531">processCommandFromApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102     <span class="comment">// XXX checks could be added, of when the bind should be allowed to proceed</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">// create and fill in SockDesc</span>
<a name="l00105"></a>00105     SockDesc *sd = <span class="keyword">new</span> SockDesc();
<a name="l00106"></a>00106     sd-&gt;sockId = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a846212bd94f8f2b59ea56c3238ae6f">getSockId</a>();
<a name="l00107"></a>00107     sd-&gt;userId = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#aa77dbd727be5ceb2a7921ed96349ae82">getUserId</a>();
<a name="l00108"></a>00108     sd-&gt;appGateIndex = gateIndex;
<a name="l00109"></a>00109     sd-&gt;localAddr = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a0dbca3fa110977e974dba0c3f7e28604">getSrcAddr</a>();
<a name="l00110"></a>00110     sd-&gt;remoteAddr = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a477fd2ebd3ff52956f283bf4a8f8a0d8">getDestAddr</a>();
<a name="l00111"></a>00111     sd-&gt;localPort = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a174a1520000a47394c851bcc9990b1b5">getSrcPort</a>();
<a name="l00112"></a>00112     sd-&gt;remotePort = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a288303fcf9d8740a3d285ab82a2ded">getDestPort</a>();
<a name="l00113"></a>00113     sd-&gt;interfaceId = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a371cfc0b09b71bf2cb851dfcfdc37583">getInterfaceId</a>();
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (sd-&gt;sockId==-1)
<a name="l00116"></a>00116         error(<span class="stringliteral">&quot;sockId in BIND message not filled in&quot;</span>);
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (sd-&gt;localPort==0)
<a name="l00118"></a>00118         sd-&gt;localPort = <a class="code" href="class_u_d_p.html#a56d497b22c8f110dbfc52ee7e85c9f1b">getEphemeralPort</a>();
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     sd-&gt;onlyLocalPortIsSet = sd-&gt;localAddr.isUnspecified() &amp;&amp;
<a name="l00121"></a>00121                              sd-&gt;remoteAddr.isUnspecified() &amp;&amp;
<a name="l00122"></a>00122                              sd-&gt;remotePort==0 &amp;&amp;
<a name="l00123"></a>00123                              sd-&gt;interfaceId==-1;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Binding socket: &quot;</span> &lt;&lt; *sd &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">// add to socketsByIdMap</span>
<a name="l00128"></a>00128     ASSERT(<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.find(sd-&gt;sockId)==<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.end());
<a name="l00129"></a>00129     <a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>[sd-&gt;sockId] = sd;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">// add to socketsByPortMap</span>
<a name="l00132"></a>00132     <a class="code" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a>&amp; list = <a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>[sd-&gt;localPort]; <span class="comment">// create if doesn&apos;t exist</span>
<a name="l00133"></a>00133     list.push_back(sd);
<a name="l00134"></a>00134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fb94355db86e280d8de7b1ef7ced43c"></a><!-- doxytag: member="UDP::connect" ref="a9fb94355db86e280d8de7b1ef7ced43c" args="(int sockId, IPvXAddress addr, int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::connect </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sockId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00136">136</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00531">processCommandFromApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137 {
<a name="l00138"></a>00138     SocketsByIdMap::iterator it = <a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.find(sockId);
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.end())
<a name="l00140"></a>00140         error(<span class="stringliteral">&quot;socket id=%d doesn&apos;t exist (already closed?)&quot;</span>, sockId);
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (addr.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00142"></a>00142         opp_error(<span class="stringliteral">&quot;connect: unspecified remote address&quot;</span>);
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (port&lt;=0 || port&gt;65535)
<a name="l00144"></a>00144         opp_error(<span class="stringliteral">&quot;connect: invalid remote port number %d&quot;</span>, port);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     SockDesc *sd = it-&gt;second;
<a name="l00147"></a>00147     sd-&gt;remoteAddr = addr;
<a name="l00148"></a>00148     sd-&gt;remotePort = port;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     sd-&gt;onlyLocalPortIsSet = <span class="keyword">false</span>;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Connecting socket: &quot;</span> &lt;&lt; *sd &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00153"></a>00153 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5e2c13d9e3a33936212cefdfa723d18"></a><!-- doxytag: member="UDP::createUDPPacket" ref="af5e2c13d9e3a33936212cefdfa723d18" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> * UDP::createUDPPacket </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00526">526</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00483">processMsgFromApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00527"></a>00527 {
<a name="l00528"></a>00528     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_u_d_p_packet.html">UDPPacket</a>(name);
<a name="l00529"></a>00529 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a56d497b22c8f110dbfc52ee7e85c9f1b"></a><!-- doxytag: member="UDP::getEphemeralPort" ref="a56d497b22c8f110dbfc52ee7e85c9f1b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short UDP::getEphemeralPort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00176">176</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00100">bind()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <span class="comment">// start at the last allocated port number + 1, and search for an unused one</span>
<a name="l00179"></a>00179     <span class="keywordtype">short</span> searchUntil = <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a>++;
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (<a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> == <a class="code" href="_t_c_p_8cc.html#a689da7c4b794eb247004b316117da9d9">EPHEMERAL_PORTRANGE_END</a>) <span class="comment">// wrap</span>
<a name="l00181"></a>00181         <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> = <a class="code" href="_t_c_p_8cc.html#ae0f9dd1223cbb93271a6c1d5789b5be5">EPHEMERAL_PORTRANGE_START</a>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">while</span> (<a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.find(<a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a>)!=<a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.end())
<a name="l00184"></a>00184     {
<a name="l00185"></a>00185         <span class="keywordflow">if</span> (<a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> == searchUntil) <span class="comment">// got back to starting point?</span>
<a name="l00186"></a>00186             error(<span class="stringliteral">&quot;Ephemeral port range %d..%d exhausted, all ports occupied&quot;</span>, <a class="code" href="_t_c_p_8cc.html#ae0f9dd1223cbb93271a6c1d5789b5be5">EPHEMERAL_PORTRANGE_START</a>, <a class="code" href="_t_c_p_8cc.html#a689da7c4b794eb247004b316117da9d9">EPHEMERAL_PORTRANGE_END</a>);
<a name="l00187"></a>00187         <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a>++;
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (<a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> == <a class="code" href="_t_c_p_8cc.html#a689da7c4b794eb247004b316117da9d9">EPHEMERAL_PORTRANGE_END</a>) <span class="comment">// wrap</span>
<a name="l00189"></a>00189             <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> = <a class="code" href="_t_c_p_8cc.html#ae0f9dd1223cbb93271a6c1d5789b5be5">EPHEMERAL_PORTRANGE_START</a>;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="comment">// found a free one, return it</span>
<a name="l00193"></a>00193     <span class="keywordflow">return</span> <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a>;
<a name="l00194"></a>00194 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79daccc47126abbf6740b029d7a57089"></a><!-- doxytag: member="UDP::handleMessage" ref="a79daccc47126abbf6740b029d7a57089" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::handleMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00196">196</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198     <span class="comment">// received from IP layer</span>
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (msg-&gt;arrivedOn(<span class="stringliteral">&quot;ipIn&quot;</span>) || msg-&gt;arrivedOn(<span class="stringliteral">&quot;ipv6In&quot;</span>))
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPMessage *&gt;(msg) || <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *<span class="keyword">&gt;</span>(msg))
<a name="l00202"></a>00202             <a class="code" href="class_u_d_p.html#a8f0e27d03d3e209f437bfa72dd3efe38">processICMPError</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
<a name="l00203"></a>00203         <span class="keywordflow">else</span>
<a name="l00204"></a>00204             <a class="code" href="class_u_d_p.html#a333fddcf308d3c6348c9cc5e6bfa796d">processUDPPacket</a>(check_and_cast&lt;UDPPacket *&gt;(msg));
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206     <span class="keywordflow">else</span> <span class="comment">// received from application layer</span>
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (msg-&gt;getKind()==<a class="code" href="_u_d_p_control_info__m_8h.html#a33f565d232e66cb696ba21aa616c2a87a33e7476202418b695b319318e70c894e">UDP_C_DATA</a>)
<a name="l00209"></a>00209             <a class="code" href="class_u_d_p.html#a1d2e34c55abb9e373694d77d3bac8f09">processMsgFromApp</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
<a name="l00210"></a>00210         <span class="keywordflow">else</span>
<a name="l00211"></a>00211             <a class="code" href="class_u_d_p.html#ae251c9826aa3b5242ad02d6620ea2616">processCommandFromApp</a>(msg);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (ev.isGUI())
<a name="l00215"></a>00215         <a class="code" href="class_u_d_p.html#a5c2df70abc011c2753a47cbff187a306">updateDisplayString</a>();
<a name="l00216"></a>00216 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9ff0a87c6965238d54bb67997d6912ca"></a><!-- doxytag: member="UDP::initialize" ref="a9ff0a87c6965238d54bb67997d6912ca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00081">81</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00082"></a>00082 {
<a name="l00083"></a>00083     WATCH_PTRMAP(<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>);
<a name="l00084"></a>00084     WATCH_MAP(<a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <a class="code" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">lastEphemeralPort</a> = <a class="code" href="_t_c_p_8cc.html#ae0f9dd1223cbb93271a6c1d5789b5be5">EPHEMERAL_PORTRANGE_START</a>;
<a name="l00087"></a>00087     <a class="code" href="structicmp.html">icmp</a> = NULL;
<a name="l00088"></a>00088     <a class="code" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">icmpv6</a> = NULL;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <a class="code" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">numSent</a> = 0;
<a name="l00091"></a>00091     <a class="code" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a> = 0;
<a name="l00092"></a>00092     <a class="code" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a> = 0;
<a name="l00093"></a>00093     <a class="code" href="class_u_d_p.html#a9ed09aeb9c434f9c7931dc82d3b2d34c">numDroppedBadChecksum</a> = 0;
<a name="l00094"></a>00094     WATCH(<a class="code" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">numSent</a>);
<a name="l00095"></a>00095     WATCH(<a class="code" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a>);
<a name="l00096"></a>00096     WATCH(<a class="code" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a>);
<a name="l00097"></a>00097     WATCH(<a class="code" href="class_u_d_p.html#a9ed09aeb9c434f9c7931dc82d3b2d34c">numDroppedBadChecksum</a>);
<a name="l00098"></a>00098 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b23bb364855683d34fdfb3bcb06eceb"></a><!-- doxytag: member="UDP::matchesSocket" ref="a2b23bb364855683d34fdfb3bcb06eceb" args="(SockDesc *sd, const IPvXAddress &amp;localAddr, const IPvXAddress &amp;remoteAddr, short remotePort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool UDP::matchesSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>localAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>remoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>remotePort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00258">258</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 {
<a name="l00260"></a>00260     <span class="keywordflow">return</span> (sd-&gt;remotePort==0 || sd-&gt;remotePort!=remotePort) &amp;&amp;
<a name="l00261"></a>00261            (sd-&gt;localAddr.isUnspecified() || sd-&gt;localAddr==localAddr) &amp;&amp;
<a name="l00262"></a>00262            (sd-&gt;remoteAddr.isUnspecified() || sd-&gt;remoteAddr==remoteAddr);
<a name="l00263"></a>00263 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6529b4917795bbb08f2fe013045718aa"></a><!-- doxytag: member="UDP::matchesSocket" ref="a6529b4917795bbb08f2fe013045718aa" args="(SockDesc *sd, UDPPacket *udp, IPv6ControlInfo *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool UDP::matchesSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00244">244</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <span class="comment">// IPv6 version</span>
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (sd-&gt;remotePort!=0 &amp;&amp; sd-&gt;remotePort!=udp-&gt;<a class="code" href="class_u_d_p_packet.html#a68edddd0010b738746cf2f95dcc1f093">getSourcePort</a>())
<a name="l00248"></a>00248         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (!sd-&gt;localAddr.isUnspecified() &amp;&amp; sd-&gt;localAddr.get6()!=ipCtrl-&gt;getDestAddr())
<a name="l00250"></a>00250         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (!sd-&gt;remoteAddr.isUnspecified() &amp;&amp; sd-&gt;remoteAddr.get6()!=ipCtrl-&gt;getSrcAddr())
<a name="l00252"></a>00252         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (sd-&gt;interfaceId!=-1 &amp;&amp; sd-&gt;interfaceId!=ipCtrl-&gt;getInterfaceId())
<a name="l00254"></a>00254         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00255"></a>00255     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00256"></a>00256 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e436c2b0a7b563bae29603603422cc0"></a><!-- doxytag: member="UDP::matchesSocket" ref="a7e436c2b0a7b563bae29603603422cc0" args="(SockDesc *sd, UDPPacket *udp, IPControlInfo *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool UDP::matchesSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00230">230</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00326">processICMPError()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00408">processUDPPacket()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00231"></a>00231 {
<a name="l00232"></a>00232     <span class="comment">// IPv4 version</span>
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (sd-&gt;remotePort!=0 &amp;&amp; sd-&gt;remotePort!=udp-&gt;<a class="code" href="class_u_d_p_packet.html#a68edddd0010b738746cf2f95dcc1f093">getSourcePort</a>())
<a name="l00234"></a>00234         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (!sd-&gt;localAddr.isUnspecified() &amp;&amp; sd-&gt;localAddr.get4()!=ipCtrl-&gt;getDestAddr())
<a name="l00236"></a>00236         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (!sd-&gt;remoteAddr.isUnspecified() &amp;&amp; sd-&gt;remoteAddr.get4()!=ipCtrl-&gt;getSrcAddr())
<a name="l00238"></a>00238         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00239"></a>00239     <span class="keywordflow">if</span> (sd-&gt;interfaceId!=-1 &amp;&amp; sd-&gt;interfaceId!=ipCtrl-&gt;getInterfaceId())
<a name="l00240"></a>00240         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00241"></a>00241     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00242"></a>00242 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae251c9826aa3b5242ad02d6620ea2616"></a><!-- doxytag: member="UDP::processCommandFromApp" ref="ae251c9826aa3b5242ad02d6620ea2616" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::processCommandFromApp </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00531">531</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00196">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = check_and_cast&lt;<a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *&gt;(msg-&gt;removeControlInfo());
<a name="l00534"></a>00534     <span class="keywordflow">switch</span> (msg-&gt;getKind())
<a name="l00535"></a>00535     {
<a name="l00536"></a>00536         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a33f565d232e66cb696ba21aa616c2a87aadaa32df8db2d6eaa9cf5779f6f7e8c1">UDP_C_BIND</a>:
<a name="l00537"></a>00537             <a class="code" href="class_u_d_p.html#a7ad4f9f51d27f92e0d23041f9b64a896">bind</a>(msg-&gt;getArrivalGate()-&gt;getIndex(), udpCtrl);
<a name="l00538"></a>00538             <span class="keywordflow">break</span>;
<a name="l00539"></a>00539         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a33f565d232e66cb696ba21aa616c2a87af6f0e0f8d0d70fe99c7869d59b055b24">UDP_C_CONNECT</a>:
<a name="l00540"></a>00540             <a class="code" href="class_u_d_p.html#a9fb94355db86e280d8de7b1ef7ced43c">connect</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a846212bd94f8f2b59ea56c3238ae6f">getSockId</a>(), udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a477fd2ebd3ff52956f283bf4a8f8a0d8">getDestAddr</a>(), udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a288303fcf9d8740a3d285ab82a2ded">getDestPort</a>());
<a name="l00541"></a>00541             <span class="keywordflow">break</span>;
<a name="l00542"></a>00542         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a33f565d232e66cb696ba21aa616c2a87ae9cd828ab4c679755e7fad0da1ee1413">UDP_C_UNBIND</a>:
<a name="l00543"></a>00543             <a class="code" href="class_u_d_p.html#a92b95e9e592cd6beff8f0b20228bc214">unbind</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a846212bd94f8f2b59ea56c3238ae6f">getSockId</a>());
<a name="l00544"></a>00544             <span class="keywordflow">break</span>;
<a name="l00545"></a>00545         <span class="keywordflow">default</span>:
<a name="l00546"></a>00546             error(<span class="stringliteral">&quot;unknown command code (message kind) %d received from app&quot;</span>, msg-&gt;getKind());
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <span class="keyword">delete</span> udpCtrl;
<a name="l00550"></a>00550     <span class="keyword">delete</span> msg;
<a name="l00551"></a>00551 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f0e27d03d3e209f437bfa72dd3efe38"></a><!-- doxytag: member="UDP::processICMPError" ref="a8f0e27d03d3e209f437bfa72dd3efe38" args="(cPacket *icmpErrorMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::processICMPError </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>icmpErrorMsg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00326">326</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00196">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00327"></a>00327 {
<a name="l00328"></a>00328     <span class="comment">// extract details from the error message, then try to notify socket that sent bogus packet</span>
<a name="l00329"></a>00329     <span class="keywordtype">int</span> type, code;
<a name="l00330"></a>00330     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> localAddr, remoteAddr;
<a name="l00331"></a>00331     <span class="keywordtype">int</span> localPort, remotePort;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPMessage *&gt;(msg))
<a name="l00334"></a>00334     {
<a name="l00335"></a>00335         <a class="code" href="class_i_c_m_p_message.html">ICMPMessage</a> *icmpMsg = (<a class="code" href="class_i_c_m_p_message.html">ICMPMessage</a> *)msg;
<a name="l00336"></a>00336         type = icmpMsg-&gt;<a class="code" href="class_i_c_m_p_message.html#a93a1643bfbdfe838cb8b26207b5d7673">getType</a>();
<a name="l00337"></a>00337         code = icmpMsg-&gt;<a class="code" href="class_i_c_m_p_message.html#a1eb1213018b26b5d182b37ef78cdb358">getCode</a>();
<a name="l00338"></a>00338         <span class="comment">// Note: we must NOT use decapsulate() because payload in ICMP is conceptually truncated</span>
<a name="l00339"></a>00339         <a class="code" href="class_i_p_datagram.html">IPDatagram</a> *datagram = check_and_cast&lt;<a class="code" href="class_i_p_datagram.html">IPDatagram</a> *&gt;(icmpMsg-&gt;getEncapsulatedMsg());
<a name="l00340"></a>00340         <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *packet = check_and_cast&lt;<a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *&gt;(datagram-&gt;getEncapsulatedMsg());
<a name="l00341"></a>00341         localAddr = datagram-&gt;<a class="code" href="class_i_p_datagram.html#ab024d29cffd3dbb1ba4d34fe64794cdd">getSrcAddress</a>();
<a name="l00342"></a>00342         remoteAddr = datagram-&gt;<a class="code" href="class_i_p_datagram.html#afe5a14d5aefc5cc9e0ffeedb31a62d1c">getDestAddress</a>();
<a name="l00343"></a>00343         localPort = packet-&gt;getSourcePort();
<a name="l00344"></a>00344         remotePort = packet-&gt;getDestinationPort();
<a name="l00345"></a>00345         <span class="keyword">delete</span> icmpMsg;
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6Message *&gt;(msg))
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349         <a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *icmpMsg = (<a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *)msg;
<a name="l00350"></a>00350         type = icmpMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a92fc7e6a2fd2f99b271a9029f1ec490a">getType</a>();
<a name="l00351"></a>00351         code = -1; <span class="comment">// FIXME this is dependent on getType()...</span>
<a name="l00352"></a>00352         <span class="comment">// Note: we must NOT use decapsulate() because payload in ICMP is conceptually truncated</span>
<a name="l00353"></a>00353         <a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram = check_and_cast&lt;<a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *&gt;(icmpMsg-&gt;getEncapsulatedMsg());
<a name="l00354"></a>00354         <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *packet = check_and_cast&lt;<a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *&gt;(datagram-&gt;getEncapsulatedMsg());
<a name="l00355"></a>00355         localAddr = datagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#aa9bdf8fb570741abc6a1611e204b7140">getSrcAddress</a>();
<a name="l00356"></a>00356         remoteAddr = datagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#ae8dcba44d11a32fef197cc663b026f05">getDestAddress</a>();
<a name="l00357"></a>00357         localPort = packet-&gt;getSourcePort();
<a name="l00358"></a>00358         remotePort = packet-&gt;getDestinationPort();
<a name="l00359"></a>00359         <span class="keyword">delete</span> icmpMsg;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;ICMP error received: type=&quot;</span> &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot; code=&quot;</span> &lt;&lt; code
<a name="l00362"></a>00362        &lt;&lt; <span class="stringliteral">&quot; about packet &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span>
<a name="l00363"></a>00363        &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <span class="comment">// identify socket and report error to it</span>
<a name="l00366"></a>00366     SocketsByPortMap::iterator it = <a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.find(localPort);
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.end())
<a name="l00368"></a>00368     {
<a name="l00369"></a>00369         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;No socket on that local port, ignoring ICMP error\n&quot;</span>;
<a name="l00370"></a>00370         <span class="keywordflow">return</span>;
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372     <a class="code" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a>&amp; list = it-&gt;second;
<a name="l00373"></a>00373     SockDesc *srcSocket = NULL;
<a name="l00374"></a>00374     <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
<a name="l00375"></a>00375     {
<a name="l00376"></a>00376         SockDesc *sd = *it;
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#a7e436c2b0a7b563bae29603603422cc0">matchesSocket</a>(sd, localAddr, remoteAddr, remotePort))
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379             srcSocket = sd; <span class="comment">// FIXME what to do if there&apos;s more than one matching socket ???</span>
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (!srcSocket)
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;No matching socket, ignoring ICMP error\n&quot;</span>;
<a name="l00385"></a>00385         <span class="keywordflow">return</span>;
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="comment">// send UDP_I_ERROR to socket</span>
<a name="l00389"></a>00389     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Source socket is sockId=&quot;</span> &lt;&lt; srcSocket-&gt;sockId &lt;&lt; <span class="stringliteral">&quot;, notifying.\n&quot;</span>;
<a name="l00390"></a>00390     <a class="code" href="class_u_d_p.html#a787238b9470b0fd4235b1c347cdb0639">sendUpErrorNotification</a>(srcSocket, <a class="code" href="_u_d_p_control_info__m_8h.html#a0cb49935325d643afaee9208fcb27733a484b0da8b16fcb50610630a68c1bf8d7">UDP_I_ERROR</a>, localAddr, remoteAddr, remotePort);
<a name="l00391"></a>00391 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d2e34c55abb9e373694d77d3bac8f09"></a><!-- doxytag: member="UDP::processMsgFromApp" ref="a1d2e34c55abb9e373694d77d3bac8f09" args="(cPacket *appData)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::processMsgFromApp </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>appData</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00483">483</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00196">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00484"></a>00484 {
<a name="l00485"></a>00485     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = check_and_cast&lt;<a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *&gt;(appData-&gt;removeControlInfo());
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket = <a class="code" href="class_u_d_p.html#af5e2c13d9e3a33936212cefdfa723d18">createUDPPacket</a>(appData-&gt;getName());
<a name="l00488"></a>00488     udpPacket-&gt;setByteLength(<a class="code" href="_u_d_p_8h.html#aef334ff0aa0d9bd45ea8385f98a49805">UDP_HEADER_BYTES</a>);
<a name="l00489"></a>00489     udpPacket-&gt;encapsulate(appData);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">// set source and destination port</span>
<a name="l00492"></a>00492     udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a9c28ca4ee2e727821098778284828cb1">setSourcePort</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a174a1520000a47394c851bcc9990b1b5">getSrcPort</a>());
<a name="l00493"></a>00493     udpPacket-&gt;setDestinationPort(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8a288303fcf9d8740a3d285ab82a2ded">getDestPort</a>());
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (!udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a477fd2ebd3ff52956f283bf4a8f8a0d8">getDestAddr</a>().<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497         <span class="comment">// send to IPv4</span>
<a name="l00498"></a>00498         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Sending app packet &quot;</span> &lt;&lt; appData-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; over IPv4.\n&quot;</span>;
<a name="l00499"></a>00499         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ipControlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00500"></a>00500         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70ab9e6b0f8ec9223d758f4825004489bd2">IP_PROT_UDP</a>);
<a name="l00501"></a>00501         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a0dbca3fa110977e974dba0c3f7e28604">getSrcAddr</a>().<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00502"></a>00502         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a477fd2ebd3ff52956f283bf4a8f8a0d8">getDestAddr</a>().<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00503"></a>00503         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ad2c753e259f7539febeef85ab51e8580">setInterfaceId</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a371cfc0b09b71bf2cb851dfcfdc37583">getInterfaceId</a>());
<a name="l00504"></a>00504         udpPacket-&gt;setControlInfo(ipControlInfo);
<a name="l00505"></a>00505         <span class="keyword">delete</span> udpCtrl;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         send(udpPacket,<span class="stringliteral">&quot;ipOut&quot;</span>);
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509     <span class="keywordflow">else</span>
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <span class="comment">// send to IPv6</span>
<a name="l00512"></a>00512         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Sending app packet &quot;</span> &lt;&lt; appData-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; over IPv6.\n&quot;</span>;
<a name="l00513"></a>00513         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ipControlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00514"></a>00514         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70ab9e6b0f8ec9223d758f4825004489bd2">IP_PROT_UDP</a>);
<a name="l00515"></a>00515         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a0dbca3fa110977e974dba0c3f7e28604">getSrcAddr</a>().<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00516"></a>00516         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a477fd2ebd3ff52956f283bf4a8f8a0d8">getDestAddr</a>().<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00517"></a>00517         <span class="comment">// ipControlInfo-&gt;setInterfaceId(udpCtrl-&gt;InterfaceId()); FIXME extend IPv6 with this!!!</span>
<a name="l00518"></a>00518         udpPacket-&gt;setControlInfo(ipControlInfo);
<a name="l00519"></a>00519         <span class="keyword">delete</span> udpCtrl;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         send(udpPacket,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523     <a class="code" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">numSent</a>++;
<a name="l00524"></a>00524 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a333fddcf308d3c6348c9cc5e6bfa796d"></a><!-- doxytag: member="UDP::processUDPPacket" ref="a333fddcf308d3c6348c9cc5e6bfa796d" args="(UDPPacket *udpPacket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::processUDPPacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udpPacket</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00408">408</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00196">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00409"></a>00409 {
<a name="l00410"></a>00410     <span class="comment">// simulate checksum: discard packet if it has bit error</span>
<a name="l00411"></a>00411     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Packet &quot;</span> &lt;&lt; udpPacket-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; received from network, dest port &quot;</span> &lt;&lt; udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a7bb08c4bb25f612dc60dc51726082c46">getDestinationPort</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (udpPacket-&gt;hasBitError())
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Packet has bit error, discarding\n&quot;</span>;
<a name="l00415"></a>00415         <span class="keyword">delete</span> udpPacket;
<a name="l00416"></a>00416         <a class="code" href="class_u_d_p.html#a9ed09aeb9c434f9c7931dc82d3b2d34c">numDroppedBadChecksum</a>++;
<a name="l00417"></a>00417         <span class="keywordflow">return</span>;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordtype">int</span> destPort = udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a7bb08c4bb25f612dc60dc51726082c46">getDestinationPort</a>();
<a name="l00421"></a>00421     cPolymorphic *ctrl = udpPacket-&gt;removeControlInfo();
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="comment">// send back ICMP error if no socket is bound to that port</span>
<a name="l00424"></a>00424     SocketsByPortMap::iterator it = <a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.find(destPort);
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.end())
<a name="l00426"></a>00426     {
<a name="l00427"></a>00427         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;No socket registered on port &quot;</span> &lt;&lt; destPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00428"></a>00428         <a class="code" href="class_u_d_p.html#a5a411e560693182d2cde11ab5566e1fc">processUndeliverablePacket</a>(udpPacket, ctrl);
<a name="l00429"></a>00429         <span class="keywordflow">return</span>;
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431     <a class="code" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a>&amp; list = it-&gt;second;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keywordtype">int</span> matches = 0;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="comment">// deliver a copy of the packet to each matching socket</span>
<a name="l00436"></a>00436     cPacket *payload = udpPacket-&gt;getEncapsulatedMsg();
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (dynamic_cast&lt;IPControlInfo *&gt;(ctrl)!=NULL)
<a name="l00438"></a>00438     {
<a name="l00439"></a>00439         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl4 = (<a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *)ctrl;
<a name="l00440"></a>00440         <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
<a name="l00441"></a>00441         {
<a name="l00442"></a>00442             SockDesc *sd = *it;
<a name="l00443"></a>00443             <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#a7e436c2b0a7b563bae29603603422cc0">matchesSocket</a>(sd, udpPacket, ctrl4))
<a name="l00444"></a>00444             {
<a name="l00445"></a>00445                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Socket sockId=&quot;</span> &lt;&lt; sd-&gt;sockId &lt;&lt; <span class="stringliteral">&quot; matches, sending up a copy.\n&quot;</span>;
<a name="l00446"></a>00446                 <a class="code" href="class_u_d_p.html#affa73f57d52206f4aa5bc2539ac63c0f">sendUp</a>((cPacket*)payload-&gt;dup(), udpPacket, ctrl4, sd);
<a name="l00447"></a>00447                 matches++;
<a name="l00448"></a>00448             }
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6ControlInfo *&gt;(udpPacket-&gt;getControlInfo())!=NULL)
<a name="l00452"></a>00452     {
<a name="l00453"></a>00453         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl6 = (<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *)ctrl;
<a name="l00454"></a>00454         <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
<a name="l00455"></a>00455         {
<a name="l00456"></a>00456             SockDesc *sd = *it;
<a name="l00457"></a>00457             <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#a7e436c2b0a7b563bae29603603422cc0">matchesSocket</a>(sd, udpPacket, ctrl6))
<a name="l00458"></a>00458             {
<a name="l00459"></a>00459                 <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Socket sockId=&quot;</span> &lt;&lt; sd-&gt;sockId &lt;&lt; <span class="stringliteral">&quot; matches, sending up a copy.\n&quot;</span>;
<a name="l00460"></a>00460                 <a class="code" href="class_u_d_p.html#affa73f57d52206f4aa5bc2539ac63c0f">sendUp</a>((cPacket*)payload-&gt;dup(), udpPacket, ctrl6, sd);
<a name="l00461"></a>00461                 matches++;
<a name="l00462"></a>00462             }
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465     <span class="keywordflow">else</span>
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467         error(<span class="stringliteral">&quot;(%s)%s arrived from lower layer without control info&quot;</span>, udpPacket-&gt;getClassName(), udpPacket-&gt;getName());
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="comment">// send back ICMP error if there is no matching socket</span>
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (matches==0)
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;None of the sockets on port &quot;</span> &lt;&lt; destPort &lt;&lt; <span class="stringliteral">&quot; matches the packet\n&quot;</span>;
<a name="l00474"></a>00474         <a class="code" href="class_u_d_p.html#a5a411e560693182d2cde11ab5566e1fc">processUndeliverablePacket</a>(udpPacket, ctrl);
<a name="l00475"></a>00475         <span class="keywordflow">return</span>;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keyword">delete</span> udpPacket;
<a name="l00479"></a>00479     <span class="keyword">delete</span> ctrl;
<a name="l00480"></a>00480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5a411e560693182d2cde11ab5566e1fc"></a><!-- doxytag: member="UDP::processUndeliverablePacket" ref="a5a411e560693182d2cde11ab5566e1fc" args="(UDPPacket *udpPacket, cPolymorphic *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::processUndeliverablePacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udpPacket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00299">299</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00408">processUDPPacket()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00300"></a>00300 {
<a name="l00301"></a>00301     <a class="code" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a>++;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="comment">// send back ICMP PORT_UNREACHABLE</span>
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (dynamic_cast&lt;IPControlInfo *&gt;(ctrl)!=NULL)
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (!<a class="code" href="structicmp.html">icmp</a>)
<a name="l00307"></a>00307             <a class="code" href="structicmp.html">icmp</a> = <a class="code" href="class_i_c_m_p_access.html">ICMPAccess</a>().get();
<a name="l00308"></a>00308         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl4 = (<a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *)ctrl;
<a name="l00309"></a>00309         <span class="keywordflow">if</span> (!ctrl4-&gt;<a class="code" href="class_i_p_control_info___base.html#a7bf28cf9cabb8990038a769ed578aa13">getDestAddr</a>().<a class="code" href="class_i_p_address.html#a9b6b5a118e8e1f6f83f2ccffd5a72125">isMulticast</a>())
<a name="l00310"></a>00310             <a class="code" href="structicmp.html">icmp</a>-&gt;sendErrorMessage(udpPacket, ctrl4, <a class="code" href="_i_c_m_p_message__m_8h.html#a58484b3a48e17f8f130c3c0f890d21b6a3fdf41118f21173da27f0001f4c37535">ICMP_DESTINATION_UNREACHABLE</a>, <a class="code" href="_i_c_m_p_message__m_8h.html#afbe2051fc16d270d8016371533b8d632af99b57d67aef38527f238049ed756ea5">ICMP_DU_PORT_UNREACHABLE</a>);
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6ControlInfo *&gt;(udpPacket-&gt;getControlInfo())!=NULL)
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (!<a class="code" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">icmpv6</a>)
<a name="l00315"></a>00315             <a class="code" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">icmpv6</a> = <a class="code" href="class_i_c_m_pv6_access.html">ICMPv6Access</a>().get();
<a name="l00316"></a>00316         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl6 = (<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *)ctrl;
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (!ctrl6-&gt;<a class="code" href="class_i_pv6_control_info___base.html#abd1d2c1cca62a40e351304d8584b4fd7">getDestAddr</a>().<a class="code" href="class_i_pv6_address.html#a3c3bb6898821e044b12cf31911c90201">isMulticast</a>())
<a name="l00318"></a>00318             <a class="code" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">icmpv6</a>-&gt;<a class="code" href="class_i_c_m_pv6.html#a3968b2c9964bb40a3d14b3fda9fdbba5">sendErrorMessage</a>(udpPacket, ctrl6, <a class="code" href="_i_c_m_pv6_message__m_8h.html#a007402fd73fa0142d3b888578b1280f8a41a9a5f4838bc4483b77b0fdcd13f72b">ICMPv6_DESTINATION_UNREACHABLE</a>, <a class="code" href="_i_c_m_pv6_message__m_8h.html#a0de5d721e9e426e7acecf6830de1331fab2b3f40a670851f27dce16f11123f05c">PORT_UNREACHABLE</a>);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     <span class="keywordflow">else</span>
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322         error(<span class="stringliteral">&quot;(%s)%s arrived from lower layer without control info&quot;</span>, udpPacket-&gt;getClassName(), udpPacket-&gt;getName());
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac693a0a152b8577d646493c325f15b45"></a><!-- doxytag: member="UDP::sendUp" ref="ac693a0a152b8577d646493c325f15b45" args="(cPacket *payload, UDPPacket *udpHeader, IPv6ControlInfo *ctrl, SockDesc *sd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::sendUp </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udpHeader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00282">282</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <span class="comment">// send payload with UDPControlInfo up to the application -- IPv6 version</span>
<a name="l00285"></a>00285     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
<a name="l00286"></a>00286     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7e967a5de6a63108ef71234d6d3a776c">setSockId</a>(sd-&gt;sockId);
<a name="l00287"></a>00287     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9530da4d40bbfbebdc94d8b3b5e92d9c">setUserId</a>(sd-&gt;userId);
<a name="l00288"></a>00288     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ab57fbe096480605dcf870a03e322c229">setSrcAddr</a>(ipCtrl-&gt;getSrcAddr());
<a name="l00289"></a>00289     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a3deaa1c1ccc124db8104cb6ea710c3a9">setDestAddr</a>(ipCtrl-&gt;getDestAddr());
<a name="l00290"></a>00290     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#aa7ab223982d1c05cedac68348ff065c6">setSrcPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a68edddd0010b738746cf2f95dcc1f093">getSourcePort</a>());
<a name="l00291"></a>00291     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ae2dc723a3ade849c1eb21b3bc849b5da">setDestPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a7bb08c4bb25f612dc60dc51726082c46">getDestinationPort</a>());
<a name="l00292"></a>00292     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a743cd5b201ff86b062f73ee84eb6dcfd">setInterfaceId</a>(ipCtrl-&gt;getInterfaceId());
<a name="l00293"></a>00293     payload-&gt;setControlInfo(udpCtrl);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     send(payload, <span class="stringliteral">&quot;appOut&quot;</span>, sd-&gt;appGateIndex);
<a name="l00296"></a>00296     <a class="code" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a>++;
<a name="l00297"></a>00297 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="affa73f57d52206f4aa5bc2539ac63c0f"></a><!-- doxytag: member="UDP::sendUp" ref="affa73f57d52206f4aa5bc2539ac63c0f" args="(cPacket *payload, UDPPacket *udpHeader, IPControlInfo *ctrl, SockDesc *sd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::sendUp </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>udpHeader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *&nbsp;</td>
          <td class="paramname"> <em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00265">265</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00408">processUDPPacket()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <span class="comment">// send payload with UDPControlInfo up to the application -- IPv4 version</span>
<a name="l00268"></a>00268     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
<a name="l00269"></a>00269     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7e967a5de6a63108ef71234d6d3a776c">setSockId</a>(sd-&gt;sockId);
<a name="l00270"></a>00270     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9530da4d40bbfbebdc94d8b3b5e92d9c">setUserId</a>(sd-&gt;userId);
<a name="l00271"></a>00271     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ab57fbe096480605dcf870a03e322c229">setSrcAddr</a>(ipCtrl-&gt;getSrcAddr());
<a name="l00272"></a>00272     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a3deaa1c1ccc124db8104cb6ea710c3a9">setDestAddr</a>(ipCtrl-&gt;getDestAddr());
<a name="l00273"></a>00273     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#aa7ab223982d1c05cedac68348ff065c6">setSrcPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a68edddd0010b738746cf2f95dcc1f093">getSourcePort</a>());
<a name="l00274"></a>00274     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ae2dc723a3ade849c1eb21b3bc849b5da">setDestPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a7bb08c4bb25f612dc60dc51726082c46">getDestinationPort</a>());
<a name="l00275"></a>00275     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a743cd5b201ff86b062f73ee84eb6dcfd">setInterfaceId</a>(ipCtrl-&gt;getInterfaceId());
<a name="l00276"></a>00276     payload-&gt;setControlInfo(udpCtrl);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     send(payload, <span class="stringliteral">&quot;appOut&quot;</span>, sd-&gt;appGateIndex);
<a name="l00279"></a>00279     <a class="code" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a>++;
<a name="l00280"></a>00280 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a787238b9470b0fd4235b1c347cdb0639"></a><!-- doxytag: member="UDP::sendUpErrorNotification" ref="a787238b9470b0fd4235b1c347cdb0639" args="(SockDesc *sd, int msgkind, const IPvXAddress &amp;localAddr, const IPvXAddress &amp;remoteAddr, short remotePort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::sendUpErrorNotification </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="paramname"> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>msgkind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>localAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>remoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>remotePort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00393">393</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00326">processICMPError()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00394"></a>00394 {
<a name="l00395"></a>00395     cPacket *notifyMsg = <span class="keyword">new</span> cPacket(<span class="stringliteral">&quot;ERROR&quot;</span>, msgkind);
<a name="l00396"></a>00396     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
<a name="l00397"></a>00397     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7e967a5de6a63108ef71234d6d3a776c">setSockId</a>(sd-&gt;sockId);
<a name="l00398"></a>00398     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9530da4d40bbfbebdc94d8b3b5e92d9c">setUserId</a>(sd-&gt;userId);
<a name="l00399"></a>00399     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ab57fbe096480605dcf870a03e322c229">setSrcAddr</a>(localAddr);
<a name="l00400"></a>00400     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a3deaa1c1ccc124db8104cb6ea710c3a9">setDestAddr</a>(remoteAddr);
<a name="l00401"></a>00401     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#aa7ab223982d1c05cedac68348ff065c6">setSrcPort</a>(sd-&gt;localPort);
<a name="l00402"></a>00402     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#ae2dc723a3ade849c1eb21b3bc849b5da">setDestPort</a>(remotePort);
<a name="l00403"></a>00403     notifyMsg-&gt;setControlInfo(udpCtrl);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     send(notifyMsg, <span class="stringliteral">&quot;appOut&quot;</span>, sd-&gt;appGateIndex);
<a name="l00406"></a>00406 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a92b95e9e592cd6beff8f0b20228bc214"></a><!-- doxytag: member="UDP::unbind" ref="a92b95e9e592cd6beff8f0b20228bc214" args="(int sockId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::unbind </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sockId</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00155">155</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00531">processCommandFromApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00156"></a>00156 {
<a name="l00157"></a>00157     <span class="comment">// remove from socketsByIdMap</span>
<a name="l00158"></a>00158     SocketsByIdMap::iterator it = <a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.find(sockId);
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.end())
<a name="l00160"></a>00160         error(<span class="stringliteral">&quot;socket id=%d doesn&apos;t exist (already closed?)&quot;</span>, sockId);
<a name="l00161"></a>00161     SockDesc *sd = it-&gt;second;
<a name="l00162"></a>00162     <a class="code" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">socketsByIdMap</a>.erase(it);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Unbinding socket: &quot;</span> &lt;&lt; *sd &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">// remove from socketsByPortMap</span>
<a name="l00167"></a>00167     <a class="code" href="class_u_d_p.html#a17d5eac534fa0d896ceef2831cd28d77">SockDescList</a>&amp; list = <a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>[sd-&gt;localPort];
<a name="l00168"></a>00168     <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
<a name="l00169"></a>00169         <span class="keywordflow">if</span> (*it == sd)
<a name="l00170"></a>00170             {list.erase(it); <span class="keywordflow">break</span>;}
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (list.empty())
<a name="l00172"></a>00172         <a class="code" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">socketsByPortMap</a>.erase(sd-&gt;localPort);
<a name="l00173"></a>00173     <span class="keyword">delete</span> sd;
<a name="l00174"></a>00174 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c2df70abc011c2753a47cbff187a306"></a><!-- doxytag: member="UDP::updateDisplayString" ref="a5c2df70abc011c2753a47cbff187a306" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UDP::updateDisplayString </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8cc_source.html#l00218">218</a> of file <a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00196">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00219"></a>00219 {
<a name="l00220"></a>00220     <span class="keywordtype">char</span> buf[80];
<a name="l00221"></a>00221     sprintf(buf, <span class="stringliteral">&quot;passed up: %d pks\nsent: %d pks&quot;</span>, <a class="code" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">numPassedUp</a>, <a class="code" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">numSent</a>);
<a name="l00222"></a>00222     <span class="keywordflow">if</span> (<a class="code" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a>&gt;0)
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224         sprintf(buf+strlen(buf), <span class="stringliteral">&quot;\ndropped (no app): %d pks&quot;</span>, <a class="code" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">numDroppedWrongPort</a>);
<a name="l00225"></a>00225         getDisplayString().setTagArg(<span class="stringliteral">&quot;i&quot;</span>,1,<span class="stringliteral">&quot;red&quot;</span>);
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>,0,buf);
<a name="l00228"></a>00228 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a4995c941113ffc075a8a4b6051fb1ca4"></a><!-- doxytag: member="UDP::icmp" ref="a4995c941113ffc075a8a4b6051fb1ca4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_c_m_p.html">ICMP</a>* <a class="el" href="class_u_d_p.html#a4995c941113ffc075a8a4b6051fb1ca4">UDP::icmp</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00073">73</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

</div>
</div>
<a class="anchor" id="a63a772449305921a2f57b9066336c389"></a><!-- doxytag: member="UDP::icmpv6" ref="a63a772449305921a2f57b9066336c389" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a>* <a class="el" href="class_u_d_p.html#a63a772449305921a2f57b9066336c389">UDP::icmpv6</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00074">74</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00299">processUndeliverablePacket()</a>.</p>

</div>
</div>
<a class="anchor" id="afe1f879c3d04242bda6a3572266ce406"></a><!-- doxytag: member="UDP::lastEphemeralPort" ref="afe1f879c3d04242bda6a3572266ce406" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short <a class="el" href="class_u_d_p.html#afe1f879c3d04242bda6a3572266ce406">UDP::lastEphemeralPort</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00072">72</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00176">getEphemeralPort()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a9ed09aeb9c434f9c7931dc82d3b2d34c"></a><!-- doxytag: member="UDP::numDroppedBadChecksum" ref="a9ed09aeb9c434f9c7931dc82d3b2d34c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_u_d_p.html#a9ed09aeb9c434f9c7931dc82d3b2d34c">UDP::numDroppedBadChecksum</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00080">80</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00408">processUDPPacket()</a>.</p>

</div>
</div>
<a class="anchor" id="ac262e3d6e3c88dbb2ff457c1c8837162"></a><!-- doxytag: member="UDP::numDroppedWrongPort" ref="ac262e3d6e3c88dbb2ff457c1c8837162" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_u_d_p.html#ac262e3d6e3c88dbb2ff457c1c8837162">UDP::numDroppedWrongPort</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00079">79</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00299">processUndeliverablePacket()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00218">updateDisplayString()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6bee27f7907a894de4173e003adbd69"></a><!-- doxytag: member="UDP::numPassedUp" ref="ab6bee27f7907a894de4173e003adbd69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_u_d_p.html#ab6bee27f7907a894de4173e003adbd69">UDP::numPassedUp</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00078">78</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00265">sendUp()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00218">updateDisplayString()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7f7b7568b014af23fb3f7c2efc218c1"></a><!-- doxytag: member="UDP::numSent" ref="aa7f7b7568b014af23fb3f7c2efc218c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_u_d_p.html#aa7f7b7568b014af23fb3f7c2efc218c1">UDP::numSent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00077">77</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00483">processMsgFromApp()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00218">updateDisplayString()</a>.</p>

</div>
</div>
<a class="anchor" id="a7019475e3a2bd786a634fbbe72aa91c6"></a><!-- doxytag: member="UDP::socketsByIdMap" ref="a7019475e3a2bd786a634fbbe72aa91c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_u_d_p.html#a68d5e94d3be14183856abf7f7ac8002a">SocketsByIdMap</a> <a class="el" href="class_u_d_p.html#a7019475e3a2bd786a634fbbe72aa91c6">UDP::socketsByIdMap</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00068">68</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00100">bind()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00136">connect()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00155">unbind()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00075">~UDP()</a>.</p>

</div>
</div>
<a class="anchor" id="af6f8ebb75300e83c3b28ba5bd0ed585d"></a><!-- doxytag: member="UDP::socketsByPortMap" ref="af6f8ebb75300e83c3b28ba5bd0ed585d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_u_d_p.html#a829a029b999e1f99838cd59e10eab3a9">SocketsByPortMap</a> <a class="el" href="class_u_d_p.html#af6f8ebb75300e83c3b28ba5bd0ed585d">UDP::socketsByPortMap</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_u_d_p_8h_source.html#l00069">69</a> of file <a class="el" href="_u_d_p_8h_source.html">UDP.h</a>.</p>

<p>Referenced by <a class="el" href="_u_d_p_8cc_source.html#l00100">bind()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00176">getEphemeralPort()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00081">initialize()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00326">processICMPError()</a>, <a class="el" href="_u_d_p_8cc_source.html#l00408">processUDPPacket()</a>, and <a class="el" href="_u_d_p_8cc_source.html#l00155">unbind()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_u_d_p_8h_source.html">UDP.h</a></li>
<li><a class="el" href="_u_d_p_8cc_source.html">UDP.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:38 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
