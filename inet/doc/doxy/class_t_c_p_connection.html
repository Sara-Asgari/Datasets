<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: TCPConnection Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>TCPConnection Class Reference</h1><!-- doxytag: class="TCPConnection" -->
<p><code>#include &lt;<a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>&gt;</code></p>

<p><a href="class_t_c_p_connection-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData</a> (bool fullSegmentsOnly, uint32 congestionWindow)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a15eda66a013f23ebc129adcea81a68b4">retransmitOneSegment</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a> (uint32 seqNo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3dc25263bb2f0b1013ee398c1587b128">sendRst</a> (uint32 seq, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a> (uint32 seq, uint32 ack, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a> (uint32 bytes)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a> (const char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a264eb196b44591ed68422a9e70dab680">signalConnectionTimeout</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a> (cMessage *msg, simtime_t timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, bool doAlways=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection</a> (<a class="el" href="class_t_c_p.html">TCP</a> *mod, int <a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>, int <a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpSeg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> srcAddr, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> destAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a> (uint32 seqNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4fb6aaf244a5da2eaa02af271099a06b">sendDataDuringLossRecoveryPhase</a> (uint32 congestionWindow)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase</a> (uint32 seqNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment</a> (bool fullSegmentsOnly, uint32 congestionWindow)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Various getters</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp26e628a23ff98795702a97504bd19aa1"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa96e386d3f5d597dd0c03c52a103071d">getFsmState</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a2bf497c23b9c58dbf704a511e36f19f1">getState</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1ef81a39ac3ed1ef11b5d141136c1926">getSendQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1eebaa12717ee8c8197b744275e0c7b0">getRexmitQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3c6829af5f8233ce0a666cda858374e6">getReceiveQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6a70265d4b753e5eefb47c2cdc54e9f5">getTcpAlgorithm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5c9318d9fe504d7e5779a5b2eab87e09">getTcpMain</a> ()</td></tr>
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a> (int <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a> (int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a> (int code)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad7429706bcb29990ebfc65ff24970faa">optionName</a> (int option)</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_connection.html">TCPConnection</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a> (<a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a> (int code)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a> ()</td></tr>
<tr><td colspan="2"><div class="groupHeader">FSM transitions: analysing events and executing state transitions</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp52261dc2667793c40346362ca3dc011c"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a> (int commandCode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a> (const <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a> (int <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing app commands. Invoked from processAppCommand().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpf0aace6d2184c496338bf0629165a07b"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing TCP segment arrivals. Invoked from processTCPSegment().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp5d91dcf8ebf758ad360bdfc9a638a31d"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing of TCP options. Invoked from readHeaderOptions(). Return value indicates whether the option was valid.</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp47970889b85da1c60e22ce9783d444e2"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;option)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing timeouts. Invoked from processTimer().</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp4a0f56bc2108064113507ad06d79aca2"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event)</td></tr>
<tr><td colspan="2"><h2>Static Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8763146770969da7d0a1196efe23615c">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cFSM&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Manages a <a class="el" href="class_t_c_p.html">TCP</a> connection. This class itself implements the <a class="el" href="class_t_c_p.html">TCP</a> state machine as well as handling control PDUs (SYN, SYN+ACK, RST, FIN, etc.), timers (2MSL, CONN-ESTAB, FIN-WAIT-2) and events (OPEN, SEND, etc) associated with <a class="el" href="class_t_c_p.html">TCP</a> state changes.</p>
<p>The implementation largely follows the functional specification at the end of RFC 793. Code comments extensively quote RFC 793 to make it easier to understand.</p>
<p><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> objects are not used alone -- they are instantiated and managed by a <a class="el" href="class_t_c_p.html">TCP</a> module.</p>
<p><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> "outsources" several tasks to objects subclassed from <a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>, <a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> and <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>; see overview of this with <a class="el" href="class_t_c_p.html">TCP</a> documentation.</p>
<p>Connection variables (TCB) are kept in <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>. <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> implementations can extend <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> to add their own stuff (see <a class="el" href="class_t_c_p_algorithm.html#a07ec2c74836af2485af586023ca9c915">TCPAlgorithm::createStateVariables()</a> factory method.)</p>
<p>The "entry points" of TCPConnnection from <a class="el" href="class_t_c_p.html">TCP</a> are:</p>
<ul>
<li><a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer(cMessage *msg)</a>: handle self-messages which belong to the connection</li>
<li><a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)</a>: handle segment arrivals</li>
<li><a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand(cMessage *msg)</a>: process commands which arrive from the application (TCP_C_xxx)</li>
</ul>
<p>All three methods follow a common structure:</p>
<ol type="1">
<li>dispatch to specific methods. For example, <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a> invokes one of <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a> or <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, etc., and <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a> dispatches to <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a> or <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>. Those methods will do the REAL JOB.</li>
<li>after they return, we'll know the state machine event (TCPEventCode, TCP_E_xxx) for sure, so we can:</li>
<li>invoke <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> which executes the necessary state transition (for example, TCP_E_RCV_SYN will take the state machine from TCP_S_LISTEN to TCP_S_SYN_RCVD). No other actions are taken in this step.</li>
<li>if there was a state change (for example, we entered the TCP_S_ESTABLISHED state), <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> invokes <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, which performs some necessary housekeeping (cancel the CONN-ESTAB timer).</li>
</ol>
<p>When the CLOSED state is reached, <a class="el" href="class_t_c_p.html">TCP</a> will delete the <a class="el" href="class_t_c_p_connection.html">TCPConnection</a> object. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00294">294</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aab510bb961623a41ade36bfbda9f86b6"></a><!-- doxytag: member="TCPConnection::TCPConnection" ref="aab510bb961623a41ade36bfbda9f86b6" args="(TCP *mod, int appGateIndex, int connId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td>
          <td class="paramname"> <em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>appGateIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>connId</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The "normal" constructor. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">162</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164     <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a> = _mod;
<a name="l00165"></a>00165     <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a> = _appGateIndex;
<a name="l00166"></a>00166     <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> = _connId;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> = <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a> = -1;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordtype">char</span> fsmname[24];
<a name="l00171"></a>00171     sprintf(fsmname, <span class="stringliteral">&quot;fsm-%d&quot;</span>, <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
<a name="l00172"></a>00172     <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.setName(fsmname);
<a name="l00173"></a>00173     <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.setState(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// queues and algorithm will be created on active or passive open</span>
<a name="l00177"></a>00177     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = NULL;
<a name="l00178"></a>00178     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = NULL;
<a name="l00179"></a>00179     <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = NULL;
<a name="l00180"></a>00180     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = NULL;
<a name="l00181"></a>00181     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = NULL;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;2MSL&quot;</span>);
<a name="l00184"></a>00184     <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;CONN-ESTAB&quot;</span>);
<a name="l00185"></a>00185     <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;FIN-WAIT-2&quot;</span>);
<a name="l00186"></a>00186     <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;SYN-REXMIT&quot;</span>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00189"></a>00189     <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00190"></a>00190     <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00191"></a>00191     <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">// statistics</span>
<a name="l00194"></a>00194     <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = NULL;
<a name="l00195"></a>00195     <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = NULL;
<a name="l00196"></a>00196     <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = NULL;
<a name="l00197"></a>00197     <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = NULL;
<a name="l00198"></a>00198     <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = NULL;
<a name="l00199"></a>00199     <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = NULL;
<a name="l00200"></a>00200     <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = NULL;
<a name="l00201"></a>00201     <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> = NULL;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = NULL;
<a name="l00204"></a>00204     <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = NULL;
<a name="l00205"></a>00205     <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = NULL;
<a name="l00206"></a>00206     <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> = NULL;
<a name="l00207"></a>00207     <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = NULL;
<a name="l00208"></a>00208     <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = NULL;
<a name="l00209"></a>00209     <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = NULL;
<a name="l00210"></a>00210     <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = NULL;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a5c9318d9fe504d7e5779a5b2eab87e09">getTcpMain</a>()-&gt;recordStatistics)
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214         <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;send window&quot;</span>);
<a name="l00215"></a>00215         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;receive window&quot;</span>);
<a name="l00216"></a>00216         <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;advertised window&quot;</span>);
<a name="l00217"></a>00217         <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent seq&quot;</span>);
<a name="l00218"></a>00218         <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent ack&quot;</span>);
<a name="l00219"></a>00219         <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd seq&quot;</span>);
<a name="l00220"></a>00220         <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd ack&quot;</span>);
<a name="l00221"></a>00221         <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;unacked bytes&quot;</span>);
<a name="l00222"></a>00222         <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd dupAcks&quot;</span>);
<a name="l00223"></a>00223         <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;pipe&quot;</span>);
<a name="l00224"></a>00224         <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent sacks&quot;</span>);
<a name="l00225"></a>00225         <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd sacks&quot;</span>);
<a name="l00226"></a>00226         <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd oooseg&quot;</span>);
<a name="l00227"></a>00227         <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd sackedBytes&quot;</span>);
<a name="l00228"></a>00228         <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;tcpRcvQueueBytes&quot;</span>);
<a name="l00229"></a>00229         <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;tcpRcvQueueDrops&quot;</span>);
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11a3cccb118b0b66bee1a07929510e4c"></a><!-- doxytag: member="TCPConnection::TCPConnection" ref="a11a3cccb118b0b66bee1a07929510e4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Note: this default ctor is NOT used to create live connections, only temporary ones so that TCPMain can invoke their <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">143</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00144"></a>00144 {
<a name="l00145"></a>00145     <span class="comment">// Note: this ctor is NOT used to create live connections, only</span>
<a name="l00146"></a>00146     <span class="comment">// temporary ones to invoke segmentArrivalWhileClosed() on</span>
<a name="l00147"></a>00147     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = NULL;
<a name="l00148"></a>00148     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = NULL;
<a name="l00149"></a>00149     <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = NULL;
<a name="l00150"></a>00150     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = NULL;
<a name="l00151"></a>00151     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = NULL;
<a name="l00152"></a>00152     <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a> = <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a> = <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = NULL;
<a name="l00153"></a>00153     <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> =
<a name="l00154"></a>00154     <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> =
<a name="l00155"></a>00155     <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = NULL;
<a name="l00156"></a>00156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0b79ac9c31e99766954c9cca733a362d"></a><!-- doxytag: member="TCPConnection::~TCPConnection" ref="a0b79ac9c31e99766954c9cca733a362d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::~TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">233</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 {
<a name="l00235"></a>00235     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>;
<a name="l00236"></a>00236     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>;
<a name="l00237"></a>00237     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>;
<a name="l00238"></a>00238     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>;
<a name="l00239"></a>00239     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)   <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)  <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="comment">// statistics</span>
<a name="l00247"></a>00247     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>;
<a name="l00248"></a>00248     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>;
<a name="l00249"></a>00249     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>;
<a name="l00250"></a>00250     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a>;
<a name="l00251"></a>00251     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>;
<a name="l00252"></a>00252     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>;
<a name="l00253"></a>00253     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>;
<a name="l00254"></a>00254     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>;
<a name="l00255"></a>00255     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>;
<a name="l00256"></a>00256     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>;
<a name="l00257"></a>00257     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>;
<a name="l00258"></a>00258     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>;
<a name="l00259"></a>00259     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>;
<a name="l00260"></a>00260     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>;
<a name="l00261"></a>00261     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>;
<a name="l00262"></a>00262     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>;
<a name="l00263"></a>00263 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="afada098bf955db81aa1786f33c813363"></a><!-- doxytag: member="TCPConnection::addSacks" ref="afada098bf955db81aa1786f33c813363" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> TCPConnection::addSacks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: adds SACKs to segments header options field </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01059">1059</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00955">writeHeaderOptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01060"></a>01060 {
<a name="l01061"></a>01061     <a class="code" href="class_t_c_p_option.html">TCPOption</a> option;
<a name="l01062"></a>01062     <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> options_len = 0;
<a name="l01063"></a>01063     <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> used_options_len = 0;
<a name="l01064"></a>01064     <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> m = 0; <span class="comment">// number of sack blocks to be sent in current segment</span>
<a name="l01065"></a>01065     <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> n = 0; <span class="comment">// number of sack blocks in sacks_array before sending current segment</span>
<a name="l01066"></a>01066     <span class="keywordtype">bool</span> skip_sacks_array = <span class="keyword">false</span>; <span class="comment">// set if dsack is subsets of a bigger sack block recently reported</span>
<a name="l01067"></a>01067     <span class="keywordtype">bool</span> overlap = <span class="keyword">false</span>; <span class="comment">// set if recently reported sack blocks are subsets of &quot;sacks_array[0]&quot;</span>
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     uint32 start = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a>;
<a name="l01070"></a>01070     uint32 end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     ASSERT(start!=0 || end!=0);
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <span class="comment">// delete old sacks (below rcv_nxt), delete duplicates and print previous status of sacks_array:</span>
<a name="l01075"></a>01075     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Previous status of sacks_array: \n&quot;</span>;
<a name="l01076"></a>01076     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=0; a&lt;<a class="code" href="_t_c_p_connection_8h.html#a07b8719be91287fc05f5e527852bc1ec">MAX_SACK_BLOCKS</a>; a++) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
<a name="l01077"></a>01077     {
<a name="l01078"></a>01078         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>()!=0 &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
<a name="l01079"></a>01079         {
<a name="l01080"></a>01080             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(0);
<a name="l01081"></a>01081             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(0);
<a name="l01082"></a>01082         }
<a name="l01083"></a>01083         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>()!=0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>()!=0) <span class="comment">// do not print empty entries</span>
<a name="l01084"></a>01084             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; (a+1) &lt;&lt; <span class="stringliteral">&quot;. SACK in sacks_array:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l01085"></a>01085         <span class="keywordflow">else</span>
<a name="l01086"></a>01086             <span class="keywordflow">break</span>;
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;MAX_SACK_BLOCKS-1; a++)
<a name="l01090"></a>01090     {
<a name="l01091"></a>01091         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() != 0)
<a name="l01092"></a>01092             m++;
<a name="l01093"></a>01093         <span class="keywordflow">else</span>
<a name="l01094"></a>01094             <span class="keywordflow">break</span>;
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096     n = m + 1; <span class="comment">// +1 for new the new sack block</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="comment">// 2 padding bytes are prefixed</span>
<a name="l01099"></a>01099     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()&gt;0)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101         <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>(); i++)
<a name="l01102"></a>01102             used_options_len = used_options_len + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2358acbf0a5fdc1b7b27fd972087dca0">getOptions</a>(i).<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>();
<a name="l01103"></a>01103         <span class="keywordflow">if</span> (used_options_len&gt;30)
<a name="l01104"></a>01104         {
<a name="l01105"></a>01105             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Failed to addSacks - at least 10 free bytes needed for SACK - used_options_len=&quot;</span> &lt;&lt; used_options_len &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01106"></a>01106             <span class="comment">//reset flags:</span>
<a name="l01107"></a>01107             skip_sacks_array = <span class="keyword">false</span>;
<a name="l01108"></a>01108             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a>  = <span class="keyword">false</span>;
<a name="l01109"></a>01109             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">false</span>;
<a name="l01110"></a>01110             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = 0;
<a name="l01111"></a>01111             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = 0;
<a name="l01112"></a>01112             <span class="keywordflow">return</span> *tcpseg;
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114         <span class="keywordflow">else</span>
<a name="l01115"></a>01115         {
<a name="l01116"></a>01116             n = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (n, (((40-used_options_len)-2)/8));
<a name="l01117"></a>01117             option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(n*2);
<a name="l01118"></a>01118         }
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120     <span class="keywordflow">else</span>
<a name="l01121"></a>01121     {
<a name="l01122"></a>01122         n = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (n, <a class="code" href="_t_c_p_segment__m_8h.html#a2fadb4d802e0a9be57f70fbe6f86b7ba">MAX_SACK_ENTRIES</a>);
<a name="l01123"></a>01123         option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(n*2);
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126     <span class="comment">// before adding a new sack move old sacks by one to the right</span>
<a name="l01127"></a>01127     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=(MAX_SACK_BLOCKS-1); a&gt;=0; a--) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
<a name="l01128"></a>01128         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     if (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>) <span class="comment">// SequenceNo &lt; rcv_nxt</span>
<a name="l01131"></a>01131     {
<a name="l01132"></a>01132         <span class="comment">// RFC 2883, page 3:</span>
<a name="l01133"></a>01133         <span class="comment">// &quot;(3) The left edge of the D-SACK block specifies the first sequence</span>
<a name="l01134"></a>01134         <span class="comment">// number of the duplicate contiguous sequence, and the right edge of</span>
<a name="l01135"></a>01135         <span class="comment">// the D-SACK block specifies the sequence number immediately following</span>
<a name="l01136"></a>01136         <span class="comment">// the last sequence in the duplicate contiguous sequence.&quot;</span>
<a name="l01137"></a>01137         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(start, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>) &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, end))
<a name="l01138"></a>01138             end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>;
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start==0 &amp;&amp; end==0) <span class="comment">// rcv_nxt_old != rcv_nxt</span>
<a name="l01141"></a>01141     {
<a name="l01142"></a>01142         <span class="comment">// RFC 2018, page 4:</span>
<a name="l01143"></a>01143         <span class="comment">// &quot;* The first SACK block (i.e., the one immediately following the</span>
<a name="l01144"></a>01144         <span class="comment">// kind and length fields in the option) MUST specify the contiguous</span>
<a name="l01145"></a>01145         <span class="comment">// block of data containing the segment which triggered this ACK,</span>
<a name="l01146"></a>01146         <span class="comment">// unless that segment advanced the Acknowledgment Number field in</span>
<a name="l01147"></a>01147         <span class="comment">// the header.  This assures that the ACK with the SACK option</span>
<a name="l01148"></a>01148         <span class="comment">// reflects the most recent change in the data receiver&apos;s buffer</span>
<a name="l01149"></a>01149         <span class="comment">// queue.&quot;</span>
<a name="l01150"></a>01150         start = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>();
<a name="l01151"></a>01151         end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>();
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153     <span class="keywordflow">else</span> <span class="comment">// rcv_nxt_old == rcv_nxt or end &lt;= rcv_nxt</span>
<a name="l01154"></a>01154     {
<a name="l01155"></a>01155         <span class="comment">// RFC 2018, page 4:</span>
<a name="l01156"></a>01156         <span class="comment">// &quot;* The first SACK block (i.e., the one immediately following the</span>
<a name="l01157"></a>01157         <span class="comment">// kind and length fields in the option) MUST specify the contiguous</span>
<a name="l01158"></a>01158         <span class="comment">// block of data containing the segment which triggered this ACK,&quot;</span>
<a name="l01159"></a>01159         start = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a63808618fe6b4b592302c440414ac093">getLE</a>(start);
<a name="l01160"></a>01160         end = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a747e434e4b2f48059269f6ba81c6593c">getRE</a>(end);
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(start);
<a name="l01164"></a>01164     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(end);
<a name="l01165"></a>01165 
<a name="l01166"></a>01166     <span class="comment">// RFC 2883, page 3:</span>
<a name="l01167"></a>01167     <span class="comment">// &quot;(4) If the D-SACK block reports a duplicate contiguous sequence from</span>
<a name="l01168"></a>01168     <span class="comment">// a (possibly larger) block of data in the receiver&apos;s data queue above</span>
<a name="l01169"></a>01169     <span class="comment">// the cumulative acknowledgement, then the second SACK block in that</span>
<a name="l01170"></a>01170     <span class="comment">// SACK option should specify that (possibly larger) block of data.</span>
<a name="l01171"></a>01171     <span class="comment">//</span>
<a name="l01172"></a>01172     <span class="comment">// (5) Following the SACK blocks described above for reporting duplicate</span>
<a name="l01173"></a>01173     <span class="comment">// segments, additional SACK blocks can be used for reporting additional</span>
<a name="l01174"></a>01174     <span class="comment">// blocks of data, as specified in RFC 2018.&quot;</span>
<a name="l01175"></a>01175     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         uint32 start_new = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a63808618fe6b4b592302c440414ac093">getLE</a>(start);
<a name="l01178"></a>01178         uint32 end_new = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a747e434e4b2f48059269f6ba81c6593c">getRE</a>(end);
<a name="l01179"></a>01179         <span class="keywordflow">if</span> (start_new != start || end_new != end)
<a name="l01180"></a>01180         {
<a name="l01181"></a>01181             skip_sacks_array = <span class="keyword">true</span>;
<a name="l01182"></a>01182             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=(MAX_SACK_BLOCKS-1); a&gt;=1; a--) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
<a name="l01183"></a>01183                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];
<a name="l01184"></a>01184             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[1].<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(start_new); <span class="comment">// specifies larger block of data</span>
<a name="l01185"></a>01185             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[1].<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(end_new);     <span class="comment">// specifies larger block of data</span>
<a name="l01186"></a>01186         }
<a name="l01187"></a>01187     }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189     <span class="comment">// RFC 2018, page 4:</span>
<a name="l01190"></a>01190     <span class="comment">// &quot;* The SACK option SHOULD be filled out by repeating the most</span>
<a name="l01191"></a>01191     <span class="comment">// recently reported SACK blocks (based on first SACK blocks in</span>
<a name="l01192"></a>01192     <span class="comment">// previous SACK options) that are not subsets of a SACK block</span>
<a name="l01193"></a>01193     <span class="comment">// already included in the SACK option being constructed.&quot;</span>
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="comment">// check if recently reported SACK blocks are subsets of &quot;sacks_array[0]&quot;</span>
<a name="l01196"></a>01196     <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;MAX_SACK_BLOCKS-1; a++)
<a name="l01197"></a>01197     {
<a name="l01198"></a>01198         <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i = 1;
<a name="l01199"></a>01199         <span class="keywordtype">bool</span> matched = <span class="keyword">false</span>;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201         <span class="keywordflow">if</span> (a==0 &amp;&amp; skip_sacks_array)
<a name="l01202"></a>01202             a = 1;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() == 0)
<a name="l01205"></a>01205             <span class="keywordflow">break</span>;
<a name="l01206"></a>01206 
<a name="l01207"></a>01207         <span class="keywordflow">while</span> ((<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() ||
<a name="l01208"></a>01208             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() ||
<a name="l01209"></a>01209             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>())
<a name="l01210"></a>01210             &amp;&amp; a+i &lt; MAX_SACK_BLOCKS &amp;&amp; state-&gt;sacks_array[a].getStart()!=0) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
<a name="l01211"></a>01211         {
<a name="l01212"></a>01212             matched = <span class="keyword">true</span>;
<a name="l01213"></a>01213             i++;
<a name="l01214"></a>01214             overlap = <span class="keyword">true</span>;
<a name="l01215"></a>01215         }
<a name="l01216"></a>01216         <span class="keywordflow">if</span> (matched)
<a name="l01217"></a>01217             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i];
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <span class="keywordflow">if</span> (!skip_sacks_array &amp;&amp; overlap &amp;&amp; m&lt;4)
<a name="l01221"></a>01221         n--;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     option.<a class="code" href="class_t_c_p_option.html#a83b39a10e62a284f6ccea47ecd70fdf6">setKind</a>(<a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a9c8c6796fa51976bab9885c5744fa49c">TCPOPTION_SACK</a>);
<a name="l01224"></a>01224     option.<a class="code" href="class_t_c_p_option.html#a789b9b31949bedfd5a60f47901b65561">setLength</a>(8*n+2);
<a name="l01225"></a>01225     option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(2*n);
<a name="l01226"></a>01226 
<a name="l01227"></a>01227     <span class="comment">// write sacks from sacks_array to options</span>
<a name="l01228"></a>01228     <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> counter = 0;
<a name="l01229"></a>01229     <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;n; a++)
<a name="l01230"></a>01230     {
<a name="l01231"></a>01231         option.<a class="code" href="class_t_c_p_option.html#ae3f3c11eeb6511721f6530f081ea6cd1">setValues</a>(counter,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>());
<a name="l01232"></a>01232         counter++;
<a name="l01233"></a>01233         option.<a class="code" href="class_t_c_p_option.html#ae3f3c11eeb6511721f6530f081ea6cd1">setValues</a>(counter,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>());
<a name="l01234"></a>01234         counter++;
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236 
<a name="l01237"></a>01237     <span class="comment">// independent of &quot;n&quot; we always need 2 padding bytes (NOP) to make: (used_options_len % 4 == 0)</span>
<a name="l01238"></a>01238     options_len = used_options_len + 8*n + 2; <span class="comment">// 8 bytes for each SACK (n) + 2 bytes for kind&amp;length</span>
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     <span class="keywordflow">if</span> (options_len &lt;= 40) <span class="comment">// Options length allowed? - maximum: 40 Bytes</span>
<a name="l01241"></a>01241     {
<a name="l01242"></a>01242         tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()+1);
<a name="l01243"></a>01243         tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>((tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()-1),option);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         <span class="comment">// update number of sent sacks</span>
<a name="l01246"></a>01246         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a>+n;
<a name="l01247"></a>01247         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>)
<a name="l01248"></a>01248             <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a>);
<a name="l01249"></a>01249 
<a name="l01250"></a>01250         <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> counter = 0;
<a name="l01251"></a>01251         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; SACK(s) added to header:\n&quot;</span>;
<a name="l01252"></a>01252         <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> t=0; t&lt;(n*2); t++)
<a name="l01253"></a>01253         {
<a name="l01254"></a>01254             counter++;
<a name="l01255"></a>01255             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; counter &lt;&lt; <span class="stringliteral">&quot;. SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(t);
<a name="l01256"></a>01256             t++;
<a name="l01257"></a>01257             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(t) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l01258"></a>01258             <span class="keywordflow">if</span> (t==1)
<a name="l01259"></a>01259             {
<a name="l01260"></a>01260                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
<a name="l01261"></a>01261                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot; (D-SACK)&quot;</span>;
<a name="l01262"></a>01262                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(t),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
<a name="l01263"></a>01263                 {
<a name="l01264"></a>01264                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot; (received segment filled out a gap)&quot;</span>;
<a name="l01265"></a>01265                     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>; <span class="comment">// Note: Set snd_dsack to delete first sack from sacks_array</span>
<a name="l01266"></a>01266                 }
<a name="l01267"></a>01267             }
<a name="l01268"></a>01268             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01269"></a>01269         }
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271     <span class="keywordflow">else</span>
<a name="l01272"></a>01272         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Option length exceeded! Segment will be sent without SACK(s)&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="comment">// RFC 2883, page 3:</span>
<a name="l01275"></a>01275     <span class="comment">// &quot;(1) A D-SACK block is only used to report a duplicate contiguous</span>
<a name="l01276"></a>01276     <span class="comment">// sequence of data received by the receiver in the most recent packet.</span>
<a name="l01277"></a>01277     <span class="comment">//</span>
<a name="l01278"></a>01278     <span class="comment">// (2) Each duplicate contiguous sequence of data received is reported</span>
<a name="l01279"></a>01279     <span class="comment">// in at most one D-SACK block.  (I.e., the receiver sends two identical</span>
<a name="l01280"></a>01280     <span class="comment">// D-SACK blocks in subsequent packets only if the receiver receives two</span>
<a name="l01281"></a>01281     <span class="comment">// duplicate segments.)//</span>
<a name="l01282"></a>01282     <span class="comment">//</span>
<a name="l01283"></a>01283     <span class="comment">// In case of d-sack: delete first sack (d-sack) and move old sacks by one to the left</span>
<a name="l01284"></a>01284     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
<a name="l01285"></a>01285     {
<a name="l01286"></a>01286         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=1; a&lt;MAX_SACK_BLOCKS; a++) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
<a name="l01287"></a>01287             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a-1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];
<a name="l01288"></a>01288 
<a name="l01289"></a>01289         <span class="comment">// delete/reset last sack to avoid duplicates</span>
<a name="l01290"></a>01290         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[MAX_SACK_BLOCKS-1].<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(0);
<a name="l01291"></a>01291         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[MAX_SACK_BLOCKS-1].<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(0);
<a name="l01292"></a>01292     }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294     <span class="comment">// reset flags:</span>
<a name="l01295"></a>01295     skip_sacks_array = <span class="keyword">false</span>;
<a name="l01296"></a>01296     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a>  = <span class="keyword">false</span>;
<a name="l01297"></a>01297     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">false</span>;
<a name="l01298"></a>01298     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = 0;
<a name="l01299"></a>01299     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = 0;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     <span class="keywordflow">return</span> *tcpseg;
<a name="l01302"></a>01302 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aecded14193441e78c31ca0c635ac19c8"></a><!-- doxytag: member="TCPConnection::cancelEvent" ref="aecded14193441e78c31ca0c635ac19c8" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* TCPConnection::cancelEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: cancel a timer </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00494">494</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01244">startSynRexmitTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00494"></a>00494 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;cancelEvent(msg);}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d5624dcbc77e79d142f6a886b3e788d"></a><!-- doxytag: member="TCPConnection::cloneListeningConnection" ref="a1d5624dcbc77e79d142f6a886b3e788d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> * TCPConnection::cloneListeningConnection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: clone a listening connection. Used for forking. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">151</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00152"></a>00152 {
<a name="l00153"></a>00153     <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a>(<a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>,<a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>,<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="comment">// following code to be kept consistent with initConnection()</span>
<a name="l00156"></a>00156     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;getClassName();
<a name="l00157"></a>00157     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
<a name="l00158"></a>00158     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a9e052fb6c65615916039b5e1da8a1abf">setConnection</a>(conn);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;getClassName();
<a name="l00161"></a>00161     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
<a name="l00162"></a>00162     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a19f45b8c7cc06b456227a67d533218f7">setConnection</a>(conn);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="comment">// create SACK retransmit queue</span>
<a name="l00165"></a>00165     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = <span class="keyword">new</span> <a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>();
<a name="l00166"></a>00166     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a76c212912f59518e0b05a79c494ac0e2">setConnection</a>(<span class="keyword">this</span>);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;getClassName();
<a name="l00169"></a>00169     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
<a name="l00170"></a>00170     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ac014216e698c557621bc907eb6d5ea6b">setConnection</a>(conn);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a98bebe4904ec8d6c85056adff9526697">getStateVariables</a>();
<a name="l00173"></a>00173     <a class="code" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
<a name="l00174"></a>00174     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a0b15a6a2f11c4a482ecec6208f5ee23d">initialize</a>();
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// put it into LISTEN, with our localAddr/localPort</span>
<a name="l00177"></a>00177     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">false</span>;
<a name="l00178"></a>00178     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a> = <span class="keyword">true</span>;
<a name="l00179"></a>00179     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a> = <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>;
<a name="l00180"></a>00180     conn-&gt;<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> = <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>;
<a name="l00181"></a>00181     FSM_Goto(conn-&gt;<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">return</span> conn;
<a name="l00184"></a>00184 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ddd3d422b9d6e00ad15cf99f9870ef4"></a><!-- doxytag: member="TCPConnection::configureStateVariables" ref="a8ddd3d422b9d6e00ad15cf99f9870ef4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::configureStateVariables </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: set snd_mss, rcv_wnd and sack in newly created state variables block </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00336">336</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00337"></a>00337 {
<a name="l00338"></a>00338     <span class="keywordtype">long</span> advertisedWindowPar = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;advertisedWindow&quot;</span>).longValue();
<a name="l00339"></a>00339     <span class="keywordflow">if</span> (advertisedWindowPar &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> || advertisedWindowPar &lt;= 0)
<a name="l00340"></a>00340         <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;Invalid advertisedWindow parameter: %ld&quot;</span>, advertisedWindowPar);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a43536d5fd1e75c068cbcfe4ccf8fc79d">delayed_acks_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;delayedAcksEnabled&quot;</span>); <span class="comment">// delayed ACKs enabled/disabled</span>
<a name="l00343"></a>00343     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad0a43b2fd46e7659e79c3cfd90c926a2">nagle_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;nagleEnabled&quot;</span>); <span class="comment">// Nagle&apos;s algorithm (RFC 896) enabled/disabled</span>
<a name="l00344"></a>00344     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a406b24dd2a997eae7618c762dfe2e48d">limited_transmit_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;limitedTransmitEnabled&quot;</span>); <span class="comment">// Limited Transmit algorithm (RFC 3042) enabled/disabled</span>
<a name="l00345"></a>00345     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a7c3d5a7916b1d457f6065c488684d1d5">increased_IW_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;increasedIWEnabled&quot;</span>); <span class="comment">// Increased Initial Window (RFC 3390) enabled/disabled</span>
<a name="l00346"></a>00346     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> = advertisedWindowPar;
<a name="l00347"></a>00347     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = advertisedWindowPar;
<a name="l00348"></a>00348     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> = advertisedWindowPar;
<a name="l00349"></a>00349     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;mss&quot;</span>).longValue(); <span class="comment">// maximum segment size</span>
<a name="l00350"></a>00350     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;sackSupport&quot;</span>); <span class="comment">// if set, this means that current host supports SACK (RFC 2018, 2883, 3517)</span>
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a>)
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353         std::string algorithmName1 = <span class="stringliteral">&quot;TCPReno&quot;</span>;
<a name="l00354"></a>00354         std::string algorithmName2 = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;tcpAlgorithmClass&quot;</span>);
<a name="l00355"></a>00355         <span class="keywordflow">if</span> (algorithmName1!=algorithmName2) <span class="comment">// TODO add additional checks for new SACK supporting algorithms here once they are implemented</span>
<a name="l00356"></a>00356         {
<a name="l00357"></a>00357             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;If you want to use TCP SACK please set tcpAlgorithmClass to TCPReno&quot;</span> &lt;&lt; endl;
<a name="l00358"></a>00358             ASSERT(<span class="keyword">false</span>);
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a462206e0bc50ae521a47a797552a0057"></a><!-- doxytag: member="TCPConnection::createTCPSegment" ref="a462206e0bc50ae521a47a797552a0057" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> * TCPConnection::createTCPSegment </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: This factory method gets invoked throughout the <a class="el" href="class_t_c_p.html">TCP</a> model to create a <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. Override it if you need to subclass <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00260">260</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="queues_2_t_c_p_virtual_data_send_queue_8cc_source.html#l00057">TCPVirtualDataSendQueue::createSegmentWithBytes()</a>, <a class="el" href="queues_2_t_c_p_msg_based_send_queue_8cc_source.html#l00063">TCPMsgBasedSendQueue::createSegmentWithBytes()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00452">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00466">sendRstAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00261"></a>00261 {
<a name="l00262"></a>00262     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(name);
<a name="l00263"></a>00263 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af199cd53f71f27341684145c3bdab306"></a><!-- doxytag: member="TCPConnection::eventName" ref="af199cd53f71f27341684145c3bdab306" args="(int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::eventName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_E_xxx constants </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00060">60</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00061"></a>00061 {
<a name="l00062"></a>00062 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00064"></a>00064     <span class="keywordflow">switch</span> (event)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>);
<a name="l00067"></a>00067         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>);
<a name="l00068"></a>00068         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>);
<a name="l00069"></a>00069         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>);
<a name="l00070"></a>00070         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>);
<a name="l00071"></a>00071         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>);
<a name="l00072"></a>00072         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>);
<a name="l00073"></a>00073         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea304f695bbcba57cc5d6bb6ccbca5cfac">TCP_E_RCV_DATA</a>);
<a name="l00074"></a>00074         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>);
<a name="l00075"></a>00075         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>);
<a name="l00076"></a>00076         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>);
<a name="l00077"></a>00077         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>);
<a name="l00078"></a>00078         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>);
<a name="l00079"></a>00079         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>);
<a name="l00080"></a>00080         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>);
<a name="l00081"></a>00081         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>);
<a name="l00082"></a>00082         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>);
<a name="l00083"></a>00083         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>);
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085     <span class="keywordflow">return</span> s;
<a name="l00086"></a>00086 <span class="preprocessor">#undef CASE</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa96e386d3f5d597dd0c03c52a103071d"></a><!-- doxytag: member="TCPConnection::getFsmState" ref="aa96e386d3f5d597dd0c03c52a103071d" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TCPConnection::getFsmState </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00555">555</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00555"></a>00555 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState();}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3c6829af5f8233ce0a666cda858374e6"></a><!-- doxytag: member="TCPConnection::getReceiveQueue" ref="a3c6829af5f8233ce0a666cda858374e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* TCPConnection::getReceiveQueue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00559">559</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00559"></a>00559 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1eebaa12717ee8c8197b744275e0c7b0"></a><!-- doxytag: member="TCPConnection::getRexmitQueue" ref="a1eebaa12717ee8c8197b744275e0c7b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>* TCPConnection::getRexmitQueue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00558">558</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00558"></a>00558 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ef81a39ac3ed1ef11b5d141136c1926"></a><!-- doxytag: member="TCPConnection::getSendQueue" ref="a1ef81a39ac3ed1ef11b5d141136c1926" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* TCPConnection::getSendQueue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00557">557</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00557"></a>00557 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2bf497c23b9c58dbf704a511e36f19f1"></a><!-- doxytag: member="TCPConnection::getState" ref="a2bf497c23b9c58dbf704a511e36f19f1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* TCPConnection::getState </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00556">556</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00556"></a>00556 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6a70265d4b753e5eefb47c2cdc54e9f5"></a><!-- doxytag: member="TCPConnection::getTcpAlgorithm" ref="a6a70265d4b753e5eefb47c2cdc54e9f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* TCPConnection::getTcpAlgorithm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00560">560</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00560"></a>00560 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c9318d9fe504d7e5779a5b2eab87e09"></a><!-- doxytag: member="TCPConnection::getTcpMain" ref="a5c9318d9fe504d7e5779a5b2eab87e09" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p.html">TCP</a>* TCPConnection::getTcpMain </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00561">561</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00059">DumbTCP::connectionClosed()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00115">DumbTCP::dataSent()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00122">TCPBaseAlg::initialize()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>, and <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00034">DumbTCP::~DumbTCP()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00561"></a>00561 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>;}
</pre></div></p>

</div>
</div>
<a class="anchor" id="adeef1c0b8f04a744168a107f68c397ba"></a><!-- doxytag: member="TCPConnection::indicationName" ref="adeef1c0b8f04a744168a107f68c397ba" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::indicationName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_I_xxx constants </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00089">89</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00270">sendIndicationToApp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00093"></a>00093     <span class="keywordflow">switch</span> (code)
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba78bce3d41e158816c5212ed2fc959b06">TCP_I_DATA</a>);
<a name="l00096"></a>00096         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba9b994384633a16021eef2cbb604d6ac7">TCP_I_URGENT_DATA</a>);
<a name="l00097"></a>00097         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>);
<a name="l00098"></a>00098         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00099"></a>00099         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00100"></a>00100         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba21824d5a95e3b86c41f35775bb5f23ab">TCP_I_CONNECTION_REFUSED</a>);
<a name="l00101"></a>00101         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00102"></a>00102         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l00103"></a>00103         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956babe4b456d5340a1c5d9ed0b0384409159">TCP_I_STATUS</a>);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">return</span> s;
<a name="l00106"></a>00106 <span class="preprocessor">#undef CASE</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69caa8ea0ffbe8d9f73f935aac1b29d9"></a><!-- doxytag: member="TCPConnection::initConnection" ref="a69caa8ea0ffbe8d9f73f935aac1b29d9" args="(TCPOpenCommand *openCmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::initConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>openCmd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: creates send/receive queues and tcpAlgorithm </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">303</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, and <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00304"></a>00304 {
<a name="l00305"></a>00305     <span class="comment">// create send queue</span>
<a name="l00306"></a>00306     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#ac93aa56190dd09b5a957043766a057b7">getSendQueueClass</a>();
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (!sendQueueClass || !sendQueueClass[0])
<a name="l00308"></a>00308         sendQueueClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;sendQueueClass&quot;</span>);
<a name="l00309"></a>00309     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
<a name="l00310"></a>00310     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a9e052fb6c65615916039b5e1da8a1abf">setConnection</a>(<span class="keyword">this</span>);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">// create receive queue</span>
<a name="l00313"></a>00313     <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#af13ad188ff7db724d703a097cd5827f2">getReceiveQueueClass</a>();
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (!receiveQueueClass || !receiveQueueClass[0])
<a name="l00315"></a>00315         receiveQueueClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;receiveQueueClass&quot;</span>);
<a name="l00316"></a>00316     <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
<a name="l00317"></a>00317     <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a19f45b8c7cc06b456227a67d533218f7">setConnection</a>(<span class="keyword">this</span>);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// create SACK retransmit queue</span>
<a name="l00320"></a>00320     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = <span class="keyword">new</span> <a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>();
<a name="l00321"></a>00321     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a76c212912f59518e0b05a79c494ac0e2">setConnection</a>(<span class="keyword">this</span>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="comment">// create algorithm</span>
<a name="l00324"></a>00324     <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a6405afe94b3bd1915952553a1117e819">getTcpAlgorithmClass</a>();
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (!tcpAlgorithmClass || !tcpAlgorithmClass[0])
<a name="l00326"></a>00326         tcpAlgorithmClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;tcpAlgorithmClass&quot;</span>);
<a name="l00327"></a>00327     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
<a name="l00328"></a>00328     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ac014216e698c557621bc907eb6d5ea6b">setConnection</a>(<span class="keyword">this</span>);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <span class="comment">// create state block</span>
<a name="l00331"></a>00331     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a98bebe4904ec8d6c85056adff9526697">getStateVariables</a>();
<a name="l00332"></a>00332     <a class="code" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
<a name="l00333"></a>00333     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a0b15a6a2f11c4a482ecec6208f5ee23d">initialize</a>();
<a name="l00334"></a>00334 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a261dc1ebd41e03d655b112f2b82b3f08"></a><!-- doxytag: member="TCPConnection::isLost" ref="a261dc1ebd41e03d655b112f2b82b3f08" args="(uint32 seqNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isLost </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seqNum</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: This routine returns whether the given sequence number is considered to be lost. The routine returns true when either DupThresh discontiguous SACKed sequences have arrived above 'SeqNum' or (DupThresh * SMSS) bytes with sequence numbers greater than 'SeqNum' have been SACKed. Otherwise, the routine returns false. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01370">1370</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01457">nextSeg()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01392">setPipe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01371"></a>01371 {
<a name="l01372"></a>01372     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
<a name="l01373"></a>01373     <span class="comment">// RFC 3517, page 3: &quot;This routine returns whether the given sequence number is</span>
<a name="l01374"></a>01374     <span class="comment">// considered to be lost.  The routine returns true when either</span>
<a name="l01375"></a>01375     <span class="comment">// DupThresh discontiguous SACKed sequences have arrived above</span>
<a name="l01376"></a>01376     <span class="comment">// &apos;SeqNum&apos; or (DupThresh * SMSS) bytes with sequence numbers greater</span>
<a name="l01377"></a>01377     <span class="comment">// than &apos;SeqNum&apos; have been SACKed.  Otherwise, the routine returns</span>
<a name="l01378"></a>01378     <span class="comment">// false.&quot;</span>
<a name="l01379"></a>01379     <span class="keywordtype">bool</span> <a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a> = <span class="keyword">false</span>;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381     ASSERT(<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(seqNum,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>)); <span class="comment">// HighAck = snd_una</span>
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a54be5e710f72ed92239d5e20b0729b97">getNumOfDiscontiguousSacks</a>(seqNum) &gt;= <a class="code" href="_t_c_p_connection_8h.html#a6d22725191167fb4feaacff2c1291afd">DUPTHRESH</a> ||     <span class="comment">// DUPTHRESH = 3</span>
<a name="l01384"></a>01384         <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#ab41d57345e37e6db6d9e7a0db5ae0580">getAmountOfSackedBytes</a>(seqNum) &gt;= (<a class="code" href="_t_c_p_connection_8h.html#a6d22725191167fb4feaacff2c1291afd">DUPTHRESH</a> * <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>))
<a name="l01385"></a>01385         isLost = <span class="keyword">true</span>;
<a name="l01386"></a>01386     <span class="keywordflow">else</span>
<a name="l01387"></a>01387         isLost = <span class="keyword">false</span>;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389     <span class="keywordflow">return</span> isLost;
<a name="l01390"></a>01390 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acceb561b23349d06b298858e39433435"></a><!-- doxytag: member="TCPConnection::isSegmentAcceptable" ref="acceb561b23349d06b298858e39433435" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isSegmentAcceptable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: check if segment is acceptable (all bytes are in receive window) </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00374">374</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <span class="comment">// check that segment entirely falls in receive window</span>
<a name="l00377"></a>00377     <span class="comment">// RFC 793, page 69:</span>
<a name="l00378"></a>00378     <span class="comment">// There are four cases for the acceptability test for an incoming segment:</span>
<a name="l00379"></a>00379     uint32 len = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00380"></a>00380     uint32 seqNo = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (len == 0)
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> == 0)
<a name="l00385"></a>00385             <span class="keywordflow">return</span> seqNo == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>;
<a name="l00386"></a>00386         <span class="keywordflow">else</span> <span class="comment">// rcv_wnd &gt; 0</span>
<a name="l00387"></a>00387             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo) &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389     <span class="keywordflow">else</span> <span class="comment">// len &gt; 0</span>
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> == 0)
<a name="l00392"></a>00392             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00393"></a>00393         <span class="keywordflow">else</span> <span class="comment">// rcv_wnd &gt; 0</span>
<a name="l00394"></a>00394             <span class="keywordflow">return</span> (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo) &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>))
<a name="l00395"></a>00395             ||
<a name="l00396"></a>00396             (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo + len - 1) &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo + len - 1, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>));
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae8d9450252219a54062112f6d8688309"></a><!-- doxytag: member="TCPConnection::nextSeg" ref="ae8d9450252219a54062112f6d8688309" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 TCPConnection::nextSeg </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: This routine uses the scoreboard data structure maintained by the Update() function to determine what to transmit based on the SACK information that has arrived from the data receiver (and hence been marked in the scoreboard). NextSeg () MUST return the sequence number range of the next segment that is to be transmitted... </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01457">1457</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01569">sendDataDuringLossRecoveryPhase()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01458"></a>01458 {
<a name="l01459"></a>01459     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
<a name="l01460"></a>01460     <span class="comment">// RFC 3517, page 5: &quot;This routine uses the scoreboard data structure maintained by the</span>
<a name="l01461"></a>01461     <span class="comment">// Update() function to determine what to transmit based on the SACK</span>
<a name="l01462"></a>01462     <span class="comment">// information that has arrived from the data receiver (and hence</span>
<a name="l01463"></a>01463     <span class="comment">// been marked in the scoreboard).  NextSeg () MUST return the</span>
<a name="l01464"></a>01464     <span class="comment">// sequence number range of the next segment that is to be</span>
<a name="l01465"></a>01465     <span class="comment">// transmitted, per the following rules:&quot;</span>
<a name="l01466"></a>01466 
<a name="l01467"></a>01467     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l01468"></a>01468     uint32 seqNum = 0;
<a name="l01469"></a>01469     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l01470"></a>01470 
<a name="l01471"></a>01471     <span class="comment">// RFC 3517, page 5: &quot;(1) If there exists a smallest unSACKed sequence number &apos;S2&apos; that</span>
<a name="l01472"></a>01472     <span class="comment">// meets the following three criteria for determining loss, the</span>
<a name="l01473"></a>01473     <span class="comment">// sequence range of one segment of up to SMSS octets starting</span>
<a name="l01474"></a>01474     <span class="comment">// with S2 MUST be returned.</span>
<a name="l01475"></a>01475     <span class="comment">//</span>
<a name="l01476"></a>01476     <span class="comment">// (1.a) S2 is greater than HighRxt.</span>
<a name="l01477"></a>01477     <span class="comment">//</span>
<a name="l01478"></a>01478     <span class="comment">// (1.b) S2 is less than the highest octet covered by any</span>
<a name="l01479"></a>01479     <span class="comment">//       received SACK.</span>
<a name="l01480"></a>01480     <span class="comment">//</span>
<a name="l01481"></a>01481     <span class="comment">// (1.c) IsLost (S2) returns true.&quot;</span>
<a name="l01482"></a>01482     <span class="keywordflow">for</span> (uint32 s2=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s2&lt;state-&gt;snd_max; s2=s2+<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// Note: Would be better use byte ranges</span>
<a name="l01483"></a>01483     {
<a name="l01484"></a>01484         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s2)==<span class="keyword">false</span>)
<a name="l01485"></a>01485         {
<a name="l01486"></a>01486             <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(s2,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>) &amp;&amp;
<a name="l01487"></a>01487                 <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s2,(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a56303d12ec8a593e9f4f58dabbb79d8d">getHighestSackedSeqNum</a>())) &amp;&amp;
<a name="l01488"></a>01488                 <a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a>(s2))
<a name="l01489"></a>01489             {
<a name="l01490"></a>01490                 seqNum = s2;
<a name="l01491"></a>01491                 found = <span class="keyword">true</span>;
<a name="l01492"></a>01492                 <span class="keywordflow">return</span> seqNum;
<a name="l01493"></a>01493             }
<a name="l01494"></a>01494         }
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497     <span class="comment">// RFC 3517, page 5: &quot;(2) If no sequence number &apos;S2&apos; per rule (1) exists but there</span>
<a name="l01498"></a>01498     <span class="comment">// exists available unsent data and the receiver&apos;s advertised</span>
<a name="l01499"></a>01499     <span class="comment">// window allows, the sequence range of one segment of up to SMSS</span>
<a name="l01500"></a>01500     <span class="comment">// octets of previously unsent data starting with sequence number</span>
<a name="l01501"></a>01501     <span class="comment">// HighData+1 MUST be returned.&quot;</span>
<a name="l01502"></a>01502     <span class="keywordflow">if</span> (!found)
<a name="l01503"></a>01503     {
<a name="l01504"></a>01504         <span class="comment">// check how many unsent bytes we have</span>
<a name="l01505"></a>01505         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
<a name="l01506"></a>01506         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> maxWindow = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>;
<a name="l01507"></a>01507         <span class="comment">// effectiveWindow: number of bytes we&apos;re allowed to send now</span>
<a name="l01508"></a>01508         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> effectiveWin = maxWindow - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>;
<a name="l01509"></a>01509         <span class="keywordflow">if</span> (buffered &gt; 0 &amp;&amp; effectiveWin &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
<a name="l01510"></a>01510         {
<a name="l01511"></a>01511             seqNum = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>; <span class="comment">// HighData = snd_max</span>
<a name="l01512"></a>01512             found = <span class="keyword">true</span>;
<a name="l01513"></a>01513             <span class="keywordflow">return</span> seqNum;
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516 
<a name="l01517"></a>01517     <span class="comment">// RFC 3517, pages 5 and 6: &quot;(3) If the conditions for rules (1) and (2) fail, but there exists</span>
<a name="l01518"></a>01518     <span class="comment">// an unSACKed sequence number &apos;S3&apos; that meets the criteria for</span>
<a name="l01519"></a>01519     <span class="comment">// detecting loss given in steps (1.a) and (1.b) above</span>
<a name="l01520"></a>01520     <span class="comment">// (specifically excluding step (1.c)) then one segment of up to</span>
<a name="l01521"></a>01521     <span class="comment">// SMSS octets starting with S3 MAY be returned.</span>
<a name="l01522"></a>01522     <span class="comment">//</span>
<a name="l01523"></a>01523     <span class="comment">// Note that rule (3) is a sort of retransmission &quot;last resort&quot;.</span>
<a name="l01524"></a>01524     <span class="comment">// It allows for retransmission of sequence numbers even when the</span>
<a name="l01525"></a>01525     <span class="comment">// sender has less certainty a segment has been lost than as with</span>
<a name="l01526"></a>01526     <span class="comment">// rule (1).  Retransmitting segments via rule (3) will help</span>
<a name="l01527"></a>01527     <span class="comment">// sustain TCP&apos;s ACK clock and therefore can potentially help</span>
<a name="l01528"></a>01528     <span class="comment">// avoid retransmission timeouts.  However, in sending these</span>
<a name="l01529"></a>01529     <span class="comment">// segments the sender has two copies of the same data considered</span>
<a name="l01530"></a>01530     <span class="comment">// to be in the network (and also in the Pipe estimate).  When an</span>
<a name="l01531"></a>01531     <span class="comment">// ACK or SACK arrives covering this retransmitted segment, the</span>
<a name="l01532"></a>01532     <span class="comment">// sender cannot be sure exactly how much data left the network</span>
<a name="l01533"></a>01533     <span class="comment">// (one of the two transmissions of the packet or both</span>
<a name="l01534"></a>01534     <span class="comment">// transmissions of the packet).  Therefore the sender may</span>
<a name="l01535"></a>01535     <span class="comment">// underestimate Pipe by considering both segments to have left</span>
<a name="l01536"></a>01536     <span class="comment">// the network when it is possible that only one of the two has.</span>
<a name="l01537"></a>01537     <span class="comment">//</span>
<a name="l01538"></a>01538     <span class="comment">// We believe that the triggering of rule (3) will be rare and</span>
<a name="l01539"></a>01539     <span class="comment">// that the implications are likely limited to corner cases</span>
<a name="l01540"></a>01540     <span class="comment">// relative to the entire recovery algorithm.  Therefore we leave</span>
<a name="l01541"></a>01541     <span class="comment">// the decision of whether or not to use rule (3) to</span>
<a name="l01542"></a>01542     <span class="comment">// implementors.&quot;</span>
<a name="l01543"></a>01543     <span class="keywordflow">if</span> (!found)
<a name="l01544"></a>01544     {
<a name="l01545"></a>01545         <span class="keywordflow">for</span> (uint32 s3=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s3&lt;state-&gt;snd_max; s3=s3+<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// Note: Would be better use byte ranges</span>
<a name="l01546"></a>01546         {
<a name="l01547"></a>01547             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s3)==<span class="keyword">false</span>)
<a name="l01548"></a>01548             {
<a name="l01549"></a>01549                 <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(s3,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>) &amp;&amp;
<a name="l01550"></a>01550                     <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s3,(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a56303d12ec8a593e9f4f58dabbb79d8d">getHighestSackedSeqNum</a>())))
<a name="l01551"></a>01551                 {
<a name="l01552"></a>01552                     seqNum = s3;
<a name="l01553"></a>01553                     found = <span class="keyword">true</span>;
<a name="l01554"></a>01554                     <span class="keywordflow">return</span> seqNum;
<a name="l01555"></a>01555                 }
<a name="l01556"></a>01556             }
<a name="l01557"></a>01557         }
<a name="l01558"></a>01558     }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     <span class="comment">// RFC 3517, page 6: &quot;(4) If the conditions for each of (1), (2), and (3) are not met,</span>
<a name="l01561"></a>01561     <span class="comment">// then NextSeg () MUST indicate failure, and no segment is</span>
<a name="l01562"></a>01562     <span class="comment">// returned.&quot;</span>
<a name="l01563"></a>01563     <span class="keywordflow">if</span> (!found)
<a name="l01564"></a>01564         seqNum = 0;
<a name="l01565"></a>01565 
<a name="l01566"></a>01566     <span class="keywordflow">return</span> seqNum;
<a name="l01567"></a>01567 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad7429706bcb29990ebfc65ff24970faa"></a><!-- doxytag: member="TCPConnection::optionName" ref="ad7429706bcb29990ebfc65ff24970faa" args="(int option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::optionName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>option</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCPOPTION_xxx constants </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00109">109</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00747">readHeaderOptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <span class="keywordflow">switch</span> (option)
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a4ae49568e5542f0b26db05424e61bd37">TCPOPTION_END_OF_OPTION_LIST</a>:   <span class="keywordflow">return</span> <span class="stringliteral">&quot;EOL&quot;</span>;
<a name="l00114"></a>00114         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a3815105fc6965c050aceeac9863abbcb">TCPOPTION_NO_OPERATION</a>:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOP&quot;</span>;
<a name="l00115"></a>00115         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a2284ab19f96a9994ca8082801c427119">TCPOPTION_MAXIMUM_SEGMENT_SIZE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;MSS&quot;</span>;
<a name="l00116"></a>00116         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0ab2a60921ef5e80121ed52f6603897d91">TCPOPTION_SACK_PERMITTED</a>:       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SACK_PERMITTED&quot;</span>;
<a name="l00117"></a>00117         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a9c8c6796fa51976bab9885c5744fa49c">TCPOPTION_SACK</a>:                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SACK&quot;</span>;
<a name="l00118"></a>00118         <span class="keywordflow">default</span>:                             <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1fe5fa359d4063c984d686e4166b798"></a><!-- doxytag: member="TCPConnection::performStateTransition" ref="aa1fe5fa359d4063c984d686e4166b798" args="(const TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::performStateTransition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Implemements the pure <a class="el" href="class_t_c_p.html">TCP</a> state machine </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">365</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00366"></a>00366 {
<a name="l00367"></a>00367     ASSERT(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="comment">// closed connections should be deleted immediately</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (event==<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>)  <span class="comment">// e.g. discarded segment</span>
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (no FSM event)\n&quot;</span>;
<a name="l00372"></a>00372         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">// state machine</span>
<a name="l00376"></a>00376     <span class="comment">// TBD add handling of connection timeout event (KEEP-ALIVE), with transition to CLOSED</span>
<a name="l00377"></a>00377     <span class="comment">// Note: empty &quot;default:&quot; lines are for gcc&apos;s benefit which would otherwise spit warnings</span>
<a name="l00378"></a>00378     <span class="keywordtype">int</span> oldState = <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState();
<a name="l00379"></a>00379     <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00380"></a>00380     {
<a name="l00381"></a>00381         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00382"></a>00382             <span class="keywordflow">switch</span> (event)
<a name="l00383"></a>00383             {
<a name="l00384"></a>00384                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>:FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00385"></a>00385                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00386"></a>00386                 <span class="keywordflow">default</span>:;
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388             <span class="keywordflow">break</span>;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
<a name="l00391"></a>00391             <span class="keywordflow">switch</span> (event)
<a name="l00392"></a>00392             {
<a name="l00393"></a>00393                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00394"></a>00394                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>:        FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
<a name="l00395"></a>00395                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00396"></a>00396                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00397"></a>00397                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>);<span class="keywordflow">break</span>;
<a name="l00398"></a>00398                 <span class="keywordflow">default</span>:;
<a name="l00399"></a>00399             }
<a name="l00400"></a>00400             <span class="keywordflow">break</span>;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00403"></a>00403             <span class="keywordflow">switch</span> (event)
<a name="l00404"></a>00404             {
<a name="l00405"></a>00405                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
<a name="l00406"></a>00406                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00407"></a>00407                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> ? <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a> : <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00408"></a>00408                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> ? <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a> : <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
<a name="l00409"></a>00409                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
<a name="l00410"></a>00410                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00411"></a>00411                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00412"></a>00412                 <span class="keywordflow">default</span>:;
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414             <span class="keywordflow">break</span>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
<a name="l00417"></a>00417             <span class="keywordflow">switch</span> (event)
<a name="l00418"></a>00418             {
<a name="l00419"></a>00419                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00420"></a>00420                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00421"></a>00421                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00422"></a>00422                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00423"></a>00423                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
<a name="l00424"></a>00424                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>); <span class="keywordflow">break</span>;
<a name="l00425"></a>00425                 <span class="keywordflow">default</span>:;
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427             <span class="keywordflow">break</span>;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00430"></a>00430             <span class="keywordflow">switch</span> (event)
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
<a name="l00433"></a>00433                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00434"></a>00434                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00435"></a>00435                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00436"></a>00436                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00437"></a>00437                 <span class="keywordflow">default</span>:;
<a name="l00438"></a>00438             }
<a name="l00439"></a>00439             <span class="keywordflow">break</span>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00442"></a>00442             <span class="keywordflow">switch</span> (event)
<a name="l00443"></a>00443             {
<a name="l00444"></a>00444                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>); <span class="keywordflow">break</span>;
<a name="l00445"></a>00445                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00446"></a>00446                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00447"></a>00447                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00448"></a>00448                 <span class="keywordflow">default</span>:;
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450             <span class="keywordflow">break</span>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
<a name="l00453"></a>00453             <span class="keywordflow">switch</span> (event)
<a name="l00454"></a>00454             {
<a name="l00455"></a>00455                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00456"></a>00456                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00457"></a>00457                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00458"></a>00458                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00459"></a>00459                 <span class="keywordflow">default</span>:;
<a name="l00460"></a>00460             }
<a name="l00461"></a>00461             <span class="keywordflow">break</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00464"></a>00464             <span class="keywordflow">switch</span> (event)
<a name="l00465"></a>00465             {
<a name="l00466"></a>00466                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00467"></a>00467                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>); <span class="keywordflow">break</span>;
<a name="l00468"></a>00468                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>); <span class="keywordflow">break</span>;
<a name="l00469"></a>00469                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00470"></a>00470                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00471"></a>00471                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00472"></a>00472                 <span class="keywordflow">default</span>:;
<a name="l00473"></a>00473             }
<a name="l00474"></a>00474             <span class="keywordflow">break</span>;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00477"></a>00477             <span class="keywordflow">switch</span> (event)
<a name="l00478"></a>00478             {
<a name="l00479"></a>00479                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00480"></a>00480                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00481"></a>00481                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00482"></a>00482                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00483"></a>00483                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00484"></a>00484                 <span class="keywordflow">default</span>:;
<a name="l00485"></a>00485             }
<a name="l00486"></a>00486             <span class="keywordflow">break</span>;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
<a name="l00489"></a>00489             <span class="keywordflow">switch</span> (event)
<a name="l00490"></a>00490             {
<a name="l00491"></a>00491                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00492"></a>00492                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
<a name="l00493"></a>00493                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00494"></a>00494                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00495"></a>00495                 <span class="keywordflow">default</span>:;
<a name="l00496"></a>00496             }
<a name="l00497"></a>00497             <span class="keywordflow">break</span>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00500"></a>00500             <span class="keywordflow">switch</span> (event)
<a name="l00501"></a>00501             {
<a name="l00502"></a>00502                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00503"></a>00503                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00504"></a>00504                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00505"></a>00505                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
<a name="l00506"></a>00506                 <span class="keywordflow">default</span>:;
<a name="l00507"></a>00507             }
<a name="l00508"></a>00508             <span class="keywordflow">break</span>;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>:
<a name="l00511"></a>00511             <span class="keywordflow">break</span>;
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordflow">if</span> (oldState!=<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00515"></a>00515     {
<a name="l00516"></a>00516         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Transition: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (event was: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00517"></a>00517         <a class="code" href="_t_c_p_8h.html#a85ddacbb6727d1260826a130068eef15">testingEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (on &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="comment">// cancel timers, etc.</span>
<a name="l00520"></a>00520         <a class="code" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <span class="keywordflow">else</span>
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (event was: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>;
<a name="l00528"></a>00528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a792d9159b4e64b344cac79d0716c907a"></a><!-- doxytag: member="TCPConnection::preanalyseAppCommandEvent" ref="a792d9159b4e64b344cac79d0716c907a" args="(int commandCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::preanalyseAppCommandEvent </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>commandCode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Maps app command codes (msg kind of app command msgs) to TCP_E_xxx event codes </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00350">350</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352     <span class="keywordflow">switch</span> (commandCode)
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a9cf8b93f6f9a392ec92dc8c0735d0099">TCP_C_OPEN_ACTIVE</a>:  <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>;
<a name="l00355"></a>00355         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a973f05e12deb1f283795b6eedc476cb8">TCP_C_OPEN_PASSIVE</a>: <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>;
<a name="l00356"></a>00356         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a5551d7ad54c2f8afd61355444ec620a6">TCP_C_SEND</a>:         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>;
<a name="l00357"></a>00357         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6aa18cb807579ad3b72293d3023883ba0a">TCP_C_CLOSE</a>:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
<a name="l00358"></a>00358         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a50eccd3eb23bdd7758a5e67a5e36c533">TCP_C_ABORT</a>:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>;
<a name="l00359"></a>00359         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a3a8aac9b74215a1768eeaa375c3cc7d6a77c74858a4d11f1ac6bcfc26e20a44e2">TCP_C_STATUS</a>:       <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>;
<a name="l00360"></a>00360         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;Unknown message kind in app command&quot;</span>);
<a name="l00361"></a>00361                  <span class="keywordflow">return</span> (<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>)0; <span class="comment">// to satisfy compiler</span>
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8aaec47dd8098dbaa015f2e3e7b16442"></a><!-- doxytag: member="TCPConnection::printConnBrief" ref="a8aaec47dd8098dbaa015f2e3e7b16442" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printConnBrief </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints local/remote addr/port and app gate index/connId </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">122</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00123"></a>00123 {
<a name="l00124"></a>00124     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection &quot;</span>;
<a name="l00125"></a>00125     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>;
<a name="l00126"></a>00126     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  on app[&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a> &lt;&lt; <span class="stringliteral">&quot;],connId=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>;
<a name="l00127"></a>00127     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  in &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
<a name="l00128"></a>00128     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  (ptr=0x&quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00129"></a>00129 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a188549e7c936c8cad622c180d3200c69"></a><!-- doxytag: member="TCPConnection::printSegmentBrief" ref="a188549e7c936c8cad622c180d3200c69" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printSegmentBrief </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints important header fields </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00131">131</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span>;
<a name="l00134"></a>00134     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>() ? <span class="stringliteral">&quot;SYN+ACK &quot;</span> : <span class="stringliteral">&quot;SYN &quot;</span>);
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN(+ACK) &quot;</span>;
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>() ? <span class="stringliteral">&quot;RST+ACK &quot;</span> : <span class="stringliteral">&quot;RST &quot;</span>);
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;PSH &quot;</span>;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0 || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()) &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;
<a name="l00144"></a>00144         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;(l=&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ack &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00147"></a>00147     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;win &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;urg &quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a03ba1de6fcc042310e77da13885ce0d0">getUrgentPointer</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00149"></a>00149 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb2189f1428627dcde1d1b0bfbc50833"></a><!-- doxytag: member="TCPConnection::process_ABORT" ref="afb2189f1428627dcde1d1b0bfbc50833" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_ABORT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00221">221</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="keyword">delete</span> tcpCommand;
<a name="l00224"></a>00224     <span class="keyword">delete</span> msg;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">//</span>
<a name="l00227"></a>00227     <span class="comment">// The ABORT event will automatically take the connection to the CLOSED</span>
<a name="l00228"></a>00228     <span class="comment">// state, flush queues etc -- no need to do it here. Also, we don&apos;t need to</span>
<a name="l00229"></a>00229     <span class="comment">// send notification to the user, they know what&apos;s going on.</span>
<a name="l00230"></a>00230     <span class="comment">//</span>
<a name="l00231"></a>00231     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00234"></a>00234             opp_error(<span class="stringliteral">&quot;Error processing command ABORT: connection not open&quot;</span>);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00237"></a>00237         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00238"></a>00238         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00239"></a>00239         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00240"></a>00240         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00241"></a>00241             <span class="comment">//&quot;</span>
<a name="l00242"></a>00242             <span class="comment">// Send a reset segment:</span>
<a name="l00243"></a>00243             <span class="comment">//</span>
<a name="l00244"></a>00244             <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;CTL=RST&gt;</span>
<a name="l00245"></a>00245             <span class="comment">//&quot;</span>
<a name="l00246"></a>00246             <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00247"></a>00247             <span class="keywordflow">break</span>;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5aa9b20651a4c1f90772a7c02eacbf05"></a><!-- doxytag: member="TCPConnection::process_CLOSE" ref="a5aa9b20651a4c1f90772a7c02eacbf05" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_CLOSE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">160</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00161"></a>00161 {
<a name="l00162"></a>00162     <span class="keyword">delete</span> tcpCommand;
<a name="l00163"></a>00163     <span class="keyword">delete</span> msg;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00168"></a>00168             opp_error(<span class="stringliteral">&quot;Error processing command CLOSE: connection not open&quot;</span>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
<a name="l00171"></a>00171             <span class="comment">// Nothing to do here</span>
<a name="l00172"></a>00172             <span class="keywordflow">break</span>;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
<a name="l00175"></a>00175             <span class="comment">// Delete the TCB and return &quot;error:  closing&quot; responses to any</span>
<a name="l00176"></a>00176             <span class="comment">// queued SENDs, or RECEIVEs.</span>
<a name="l00177"></a>00177             <span class="keywordflow">break</span>;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00180"></a>00180         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00181"></a>00181         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00182"></a>00182             <span class="comment">//</span>
<a name="l00183"></a>00183             <span class="comment">// SYN_RCVD processing (ESTABLISHED and CLOSE_WAIT are similar):</span>
<a name="l00184"></a>00184             <span class="comment">//&quot;</span>
<a name="l00185"></a>00185             <span class="comment">// If no SENDs have been issued and there is no pending data to send,</span>
<a name="l00186"></a>00186             <span class="comment">// then form a FIN segment and send it, and enter FIN-WAIT-1 state;</span>
<a name="l00187"></a>00187             <span class="comment">// otherwise queue for processing after entering ESTABLISHED state.</span>
<a name="l00188"></a>00188             <span class="comment">//&quot;</span>
<a name="l00189"></a>00189             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>==<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>())
<a name="l00190"></a>00190             {
<a name="l00191"></a>00191                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;No outstanding SENDs, sending FIN right away, advancing snd_nxt over the FIN\n&quot;</span>;
<a name="l00192"></a>00192                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
<a name="l00193"></a>00193                 <a class="code" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a>();
<a name="l00194"></a>00194                 <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
<a name="l00195"></a>00195                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = ++<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l00196"></a>00196                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198                 <span class="comment">// state transition will automatically take us to FIN_WAIT_1 (or LAST_ACK)</span>
<a name="l00199"></a>00199             }
<a name="l00200"></a>00200             <span class="keywordflow">else</span>
<a name="l00201"></a>00201             {
<a name="l00202"></a>00202                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND of &quot;</span> &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>()-<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>) &lt;&lt;
<a name="l00203"></a>00203                       <span class="stringliteral">&quot; bytes pending, deferring sending of FIN\n&quot;</span>;
<a name="l00204"></a>00204                 <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00205"></a>00205             }
<a name="l00206"></a>00206             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> = <span class="keyword">true</span>;
<a name="l00207"></a>00207             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a> = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>();
<a name="l00208"></a>00208             <span class="keywordflow">break</span>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00211"></a>00211         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00212"></a>00212         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
<a name="l00213"></a>00213         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
<a name="l00214"></a>00214         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00215"></a>00215             <span class="comment">// RFC 793 is not entirely clear on how to handle a duplicate close request.</span>
<a name="l00216"></a>00216             <span class="comment">// Here we treat it as an error.</span>
<a name="l00217"></a>00217             opp_error(<span class="stringliteral">&quot;Duplicate CLOSE command: connection already closing&quot;</span>);
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ef625498d593ac11744aa92a404e06d"></a><!-- doxytag: member="TCPConnection::process_OPEN_ACTIVE" ref="a6ef625498d593ac11744aa92a404e06d" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_ACTIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">33</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00034"></a>00034 {
<a name="l00035"></a>00035     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;<a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&gt;(tcpCommand);
<a name="l00036"></a>00036     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>, <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>;
<a name="l00037"></a>00037     <span class="keywordtype">short</span> <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>, <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00040"></a>00040     {
<a name="l00041"></a>00041         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00042"></a>00042             <a class="code" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044             <span class="comment">// store local/remote socket</span>
<a name="l00045"></a>00045             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">true</span>;
<a name="l00046"></a>00046             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8df2394c15fc7fb872491275d9db03b4">getLocalAddr</a>();
<a name="l00047"></a>00047             remoteAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a9e602467cc21c7c3a2ea9aae64f1319e">getRemoteAddr</a>();
<a name="l00048"></a>00048             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8d1ced9e8f5355c77266673e7a2fc35f">getLocalPort</a>();
<a name="l00049"></a>00049             remotePort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a4d1170bbd04519d8b8f37677ba512f35">getRemotePort</a>();
<a name="l00050"></a>00050 
<a name="l00051"></a>00051             <span class="keywordflow">if</span> (remoteAddr.isUnspecified() || remotePort==-1)
<a name="l00052"></a>00052                 opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: remote address and port must be specified&quot;</span>);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054             <span class="keywordflow">if</span> (localPort==-1)
<a name="l00055"></a>00055             {
<a name="l00056"></a>00056                 localPort = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a78909d5d3786f662c8a5e38c11573e5e">getEphemeralPort</a>();
<a name="l00057"></a>00057                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Assigned ephemeral port &quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00058"></a>00058             }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;OPEN: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062             <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, remoteAddr, localPort, remotePort);
<a name="l00063"></a>00063 
<a name="l00064"></a>00064             <span class="comment">// send initial SYN</span>
<a name="l00065"></a>00065             <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00066"></a>00066             <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
<a name="l00067"></a>00067             <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00068"></a>00068             <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00069"></a>00069             <span class="keywordflow">break</span>;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="keywordflow">default</span>:
<a name="l00072"></a>00072             opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: connection already exists&quot;</span>);
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="keyword">delete</span> openCmd;
<a name="l00076"></a>00076     <span class="keyword">delete</span> msg;
<a name="l00077"></a>00077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26e4a86dfbc1efaf02e99ea14d410ae3"></a><!-- doxytag: member="TCPConnection::process_OPEN_PASSIVE" ref="a26e4a86dfbc1efaf02e99ea14d410ae3" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_PASSIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">79</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;<a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&gt;(tcpCommand);
<a name="l00082"></a>00082     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>;
<a name="l00083"></a>00083     <span class="keywordtype">short</span> <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00086"></a>00086     {
<a name="l00087"></a>00087         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00088"></a>00088             <a class="code" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090             <span class="comment">// store local/remote socket</span>
<a name="l00091"></a>00091             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">false</span>;
<a name="l00092"></a>00092             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a> = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a719c5eb06ab9b7a819285fd2052aac9c">getFork</a>();
<a name="l00093"></a>00093             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8df2394c15fc7fb872491275d9db03b4">getLocalAddr</a>();
<a name="l00094"></a>00094             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a8d1ced9e8f5355c77266673e7a2fc35f">getLocalPort</a>();
<a name="l00095"></a>00095 
<a name="l00096"></a>00096             <span class="keywordflow">if</span> (localPort==-1)
<a name="l00097"></a>00097                 opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: local port must be specified&quot;</span>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Starting to listen on: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101             <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(), localPort, -1);
<a name="l00102"></a>00102             <span class="keywordflow">break</span>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">default</span>:
<a name="l00105"></a>00105             opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: connection already exists&quot;</span>);
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="keyword">delete</span> openCmd;
<a name="l00109"></a>00109     <span class="keyword">delete</span> msg;
<a name="l00110"></a>00110 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46ac1b09624942471db2eb76ef991143"></a><!-- doxytag: member="TCPConnection::process_RCV_SEGMENT" ref="a46ac1b09624942471db2eb76ef991143" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::process_RCV_SEGMENT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Returns a specific event code (e.g. TCP_E_RCV_SYN) which will drive the state machine. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">83</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
<a name="l00086"></a>00086     <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00087"></a>00087     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCB: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a93fbf3558fe0e1dfa27bdbab25c36aff">info</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>) <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>());
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>) <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">//</span>
<a name="l00093"></a>00093     <span class="comment">// Note: this code is organized exactly as RFC 793, section &quot;3.9 Event</span>
<a name="l00094"></a>00094     <span class="comment">// Processing&quot;, subsection &quot;SEGMENT ARRIVES&quot;.</span>
<a name="l00095"></a>00095     <span class="comment">//</span>
<a name="l00096"></a>00096     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099         <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a>(tcpseg, src, dest);
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
<a name="l00102"></a>00102     {
<a name="l00103"></a>00103         <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a>(tcpseg, src, dest);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">else</span>
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107         <span class="comment">// RFC 793 steps &quot;first check sequence number&quot;, &quot;second check the RST bit&quot;, etc</span>
<a name="l00108"></a>00108         <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a>(tcpseg);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110     <span class="keyword">delete</span> tcpseg;
<a name="l00111"></a>00111     <span class="keywordflow">return</span> event;
<a name="l00112"></a>00112 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65fa8d6570761c63cdab5cef7f5df685"></a><!-- doxytag: member="TCPConnection::process_SEND" ref="a65fa8d6570761c63cdab5cef7f5df685" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_SEND </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">112</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <a class="code" href="class_t_c_p_send_command.html">TCPSendCommand</a> *sendCommand = check_and_cast&lt;<a class="code" href="class_t_c_p_send_command.html">TCPSendCommand</a> *&gt;(tcpCommand);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">// FIXME how to support PUSH? One option is to treat each SEND as a unit of data,</span>
<a name="l00117"></a>00117     <span class="comment">// and set PSH at SEND boundaries</span>
<a name="l00118"></a>00118     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00121"></a>00121             opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection not open&quot;</span>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
<a name="l00124"></a>00124             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND command turns passive open into active open, sending initial SYN\n&quot;</span>;
<a name="l00125"></a>00125             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">true</span>;
<a name="l00126"></a>00126             <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00127"></a>00127             <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
<a name="l00128"></a>00128             <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00129"></a>00129             <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00130"></a>00130             <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));  <span class="comment">// queue up for later</span>
<a name="l00131"></a>00131             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
<a name="l00132"></a>00132             <span class="keywordflow">break</span>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00135"></a>00135         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
<a name="l00136"></a>00136             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Queueing up data for sending later.\n&quot;</span>;
<a name="l00137"></a>00137             <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg)); <span class="comment">// queue up for later</span>
<a name="l00138"></a>00138             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
<a name="l00139"></a>00139             <span class="keywordflow">break</span>;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00142"></a>00142         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00143"></a>00143             <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
<a name="l00144"></a>00144             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue, plus &quot;</span>
<a name="l00145"></a>00145                   &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>-<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes unacknowledged\n&quot;</span>;
<a name="l00146"></a>00146             <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a4f091f7203a1813550bcad5738e815cb">sendCommandInvoked</a>();
<a name="l00147"></a>00147             <span class="keywordflow">break</span>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
<a name="l00150"></a>00150         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00151"></a>00151         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00152"></a>00152         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
<a name="l00153"></a>00153         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00154"></a>00154             opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection closing&quot;</span>);
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="keyword">delete</span> sendCommand; <span class="comment">// msg itself has been taken by the sendQueue</span>
<a name="l00158"></a>00158 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a519a2b6612737fbdbd5641dfa33833e8"></a><!-- doxytag: member="TCPConnection::process_STATUS" ref="a519a2b6612737fbdbd5641dfa33833e8" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_STATUS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">252</a> of file <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">processAppCommand()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00253"></a>00253 {
<a name="l00254"></a>00254     <span class="keyword">delete</span> tcpCommand; <span class="comment">// but reuse msg for reply</span>
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>)
<a name="l00257"></a>00257         opp_error(<span class="stringliteral">&quot;Error processing command STATUS: connection not open&quot;</span>);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a> *statusInfo = <span class="keyword">new</span> <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a>();
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a9d53ae33cb699b56e6653f05fbbe39ad">setState</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
<a name="l00262"></a>00262     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a4b75cddbe2115eaee18b201848cf8809">setStateName</a>(<a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aa9b66d12f0fd12fe1d624bf3c3a086c9">setLocalAddr</a>(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>);
<a name="l00265"></a>00265     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#ab724afec9a98a1e8b97aecd215532d09">setRemoteAddr</a>(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>);
<a name="l00266"></a>00266     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a2c331b96b3d2b5985c68acc34e0491b2">setLocalPort</a>(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
<a name="l00267"></a>00267     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a563ff999e1ebd3d676bb9b39ae149dc8">setRemotePort</a>(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a8269ea89d5873e8b621af318edb66e6e">setSnd_mss</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00270"></a>00270     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aaf950a6e099525bd6fda884422b3f946">setSnd_una</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00271"></a>00271     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a87a0e0d0851d4177adb4a36b143f5910">setSnd_nxt</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00272"></a>00272     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a8d7c02804ac7faff3875f25077cc5706">setSnd_max</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
<a name="l00273"></a>00273     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#abf6e868184dd0bb7ede4fe38967249ce">setSnd_wnd</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>);
<a name="l00274"></a>00274     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a147a1dfd66eb3febea9c3b319fee33c3">setSnd_up</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a380d1be36964eb83f3d98d24562b92f3">snd_up</a>);
<a name="l00275"></a>00275     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a7590a55627be6e6d881c879da9ca5c8e">setSnd_wl1</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a>);
<a name="l00276"></a>00276     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a9188adae28c390fba8db3f50518fb476">setSnd_wl2</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a>);
<a name="l00277"></a>00277     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a0634c9ecc358eca78ae06588b1fcf590">setIss</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
<a name="l00278"></a>00278     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a51a3f75bdab906d74e9d40ecf3463fd6">setRcv_nxt</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00279"></a>00279     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#af48c361b81087bce015098c7f1d599a6">setRcv_wnd</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00280"></a>00280     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a5a3fde4159c8c44c6e13e70358241c57">setRcv_up</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae9646df9e0e50b7f04a5898929a78aed">rcv_up</a>);
<a name="l00281"></a>00281     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#aadbf506809640cf65edc754fa1530708">setIrs</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a>);
<a name="l00282"></a>00282     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#ad192278807282716a1a7567856d48605">setFin_ack_rcvd</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     msg-&gt;setControlInfo(statusInfo);
<a name="l00285"></a>00285     <a class="code" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
<a name="l00286"></a>00286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae29072ef963e593c4c3053827ebbec6e"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_2MSL" ref="ae29072ef963e593c4c3053827ebbec6e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_2MSL </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01209">1209</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01210"></a>01210 {
<a name="l01211"></a>01211     <span class="comment">//&quot;</span>
<a name="l01212"></a>01212     <span class="comment">// If the time-wait timeout expires on a connection delete the TCB,</span>
<a name="l01213"></a>01213     <span class="comment">// enter the CLOSED state and return.</span>
<a name="l01214"></a>01214     <span class="comment">//&quot;</span>
<a name="l01215"></a>01215     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l01216"></a>01216     {
<a name="l01217"></a>01217         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l01218"></a>01218             <span class="comment">// Nothing to do here. The TIMEOUT_2MSL event will automatically take</span>
<a name="l01219"></a>01219             <span class="comment">// the connection to CLOSED. We already notified the user</span>
<a name="l01220"></a>01220             <span class="comment">// (TCP_I_CLOSED) when we entered the TIME_WAIT state from CLOSING,</span>
<a name="l01221"></a>01221             <span class="comment">// FIN_WAIT_1 or FIN_WAIT_2.</span>
<a name="l01222"></a>01222             <span class="keywordflow">break</span>;
<a name="l01223"></a>01223         <span class="keywordflow">default</span>:
<a name="l01224"></a>01224             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01225"></a>01225             opp_error(<span class="stringliteral">&quot;Internal error: received time-wait (2MSL) timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
<a name="l01226"></a>01226     }
<a name="l01227"></a>01227 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b47d21fa8a97f13cab52097f3332ea6"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_CONN_ESTAB" ref="a7b47d21fa8a97f13cab52097f3332ea6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_CONN_ESTAB </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01189">1189</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01190"></a>01190 {
<a name="l01191"></a>01191     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l01192"></a>01192     {
<a name="l01193"></a>01193         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l01194"></a>01194         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
<a name="l01195"></a>01195             <span class="comment">// Nothing to do here. TIMEOUT_CONN_ESTAB event will automatically</span>
<a name="l01196"></a>01196             <span class="comment">// take the connection to LISTEN or CLOSED, and cancel SYN-REXMIT timer.</span>
<a name="l01197"></a>01197             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a>)
<a name="l01198"></a>01198             {
<a name="l01199"></a>01199                 <span class="comment">// notify user if we&apos;re on the active side</span>
<a name="l01200"></a>01200                 <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l01201"></a>01201             }
<a name="l01202"></a>01202             <span class="keywordflow">break</span>;
<a name="l01203"></a>01203         <span class="keywordflow">default</span>:
<a name="l01204"></a>01204             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01205"></a>01205             opp_error(<span class="stringliteral">&quot;Internal error: received CONN_ESTAB timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
<a name="l01206"></a>01206     }
<a name="l01207"></a>01207 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53d62d237307ad56bae8d320ff557e48"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_FIN_WAIT_2" ref="a53d62d237307ad56bae8d320ff557e48" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_FIN_WAIT_2 </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01229">1229</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01230"></a>01230 {
<a name="l01231"></a>01231     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l01232"></a>01232     {
<a name="l01233"></a>01233         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l01234"></a>01234             <span class="comment">// Nothing to do here. The TIMEOUT_FIN_WAIT_2 event will automatically take</span>
<a name="l01235"></a>01235             <span class="comment">// the connection to CLOSED.</span>
<a name="l01236"></a>01236             <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l01237"></a>01237             <span class="keywordflow">break</span>;
<a name="l01238"></a>01238         <span class="keywordflow">default</span>:
<a name="l01239"></a>01239             <span class="comment">// We should not receive this timeout in this state.</span>
<a name="l01240"></a>01240             opp_error(<span class="stringliteral">&quot;Internal error: received FIN_WAIT_2 timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33c6fe420de8b7fc6c09761f70118ed0"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_SYN_REXMIT" ref="a33c6fe420de8b7fc6c09761f70118ed0" args="(TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_SYN_REXMIT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">1254</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01255"></a>01255 {
<a name="l01256"></a>01256     <span class="keywordflow">if</span> (++<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;<a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a>)
<a name="l01257"></a>01257     {
<a name="l01258"></a>01258         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission count during connection setup exceeds &quot;</span> &lt;&lt; <a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a> &lt;&lt; <span class="stringliteral">&quot;, giving up\n&quot;</span>;
<a name="l01259"></a>01259         <span class="comment">// Note ABORT will take the connection to closed, and cancel CONN-ESTAB timer as well</span>
<a name="l01260"></a>01260         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>;
<a name="l01261"></a>01261         <span class="keywordflow">return</span>;
<a name="l01262"></a>01262     }
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Performing retransmission #&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <span class="comment">// resend what&apos;s needed</span>
<a name="l01267"></a>01267     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l01268"></a>01268     {
<a name="l01269"></a>01269         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>: <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>(); <span class="keywordflow">break</span>;
<a name="l01270"></a>01270         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>: <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>(); <span class="keywordflow">break</span>;
<a name="l01271"></a>01271         <span class="keywordflow">default</span>:  opp_error(<span class="stringliteral">&quot;Internal error: SYN-REXMIT timer expired while in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
<a name="l01272"></a>01272     }
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="comment">// reschedule timer</span>
<a name="l01275"></a>01275     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> *= 2;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> &gt; <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>)
<a name="l01278"></a>01278         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>;
<a name="l01279"></a>01279     <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a>);
<a name="l01280"></a>01280 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1144f5ca6e960176d6e623998cb7456"></a><!-- doxytag: member="TCPConnection::processAckInEstabEtc" ref="ac1144f5ca6e960176d6e623998cb7456" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAckInEstabEtc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">1058</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01059"></a>01059 {
<a name="l01060"></a>01060     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing ACK in a data transfer state\n&quot;</span>;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <span class="comment">//</span>
<a name="l01063"></a>01063     <span class="comment">//&quot;</span>
<a name="l01064"></a>01064     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
<a name="l01065"></a>01065     <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
<a name="l01066"></a>01066     <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
<a name="l01067"></a>01067     <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
<a name="l01068"></a>01068     <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
<a name="l01069"></a>01069     <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
<a name="l01070"></a>01070     <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
<a name="l01071"></a>01071     <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
<a name="l01072"></a>01072     <span class="comment">//  drop the segment, and return.</span>
<a name="l01073"></a>01073     <span class="comment">//</span>
<a name="l01074"></a>01074     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
<a name="l01075"></a>01075     <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
<a name="l01076"></a>01076     <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
<a name="l01077"></a>01077     <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
<a name="l01078"></a>01078     <span class="comment">//</span>
<a name="l01079"></a>01079     <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
<a name="l01080"></a>01080     <span class="comment">//  records the sequence number of the last segment used to update</span>
<a name="l01081"></a>01081     <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
<a name="l01082"></a>01082     <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
<a name="l01083"></a>01083     <span class="comment">//  prevents using old segments to update the window.</span>
<a name="l01084"></a>01084     <span class="comment">//&quot;</span>
<a name="l01085"></a>01085     <span class="comment">// Note: should use SND.MAX instead of SND.NXT in above checks</span>
<a name="l01086"></a>01086     <span class="comment">//</span>
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()))
<a name="l01088"></a>01088     {
<a name="l01089"></a>01089         <span class="comment">//</span>
<a name="l01090"></a>01090         <span class="comment">// duplicate ACK? A received TCP segment is a duplicate ACK if all of</span>
<a name="l01091"></a>01091         <span class="comment">// the following apply:</span>
<a name="l01092"></a>01092         <span class="comment">//    (1) snd_una==ackNo</span>
<a name="l01093"></a>01093         <span class="comment">//    (2) segment contains no data</span>
<a name="l01094"></a>01094         <span class="comment">//    (3) there&apos;s unacked data (snd_una!=snd_max)</span>
<a name="l01095"></a>01095         <span class="comment">//</span>
<a name="l01096"></a>01096         <span class="comment">// Note: ssfnet uses additional constraint &quot;window is the same as last</span>
<a name="l01097"></a>01097         <span class="comment">// received (not an update)&quot; -- we don&apos;t do that because window updates</span>
<a name="l01098"></a>01098         <span class="comment">// are ignored anyway if neither seqNo nor ackNo has changed.</span>
<a name="l01099"></a>01099         <span class="comment">//</span>
<a name="l01100"></a>01100         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()==0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)
<a name="l01101"></a>01101         {
<a name="l01102"></a>01102             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>++;
<a name="l01103"></a>01103             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
<a name="l01104"></a>01104                 <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106             <span class="comment">// we need to update send window even if the ACK is a dupACK, because rcv win could have been changed if faulty data receiver is not respecting the &quot;do not shrink window&quot; rule</span>
<a name="l01107"></a>01107             <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg);
<a name="l01108"></a>01108 
<a name="l01109"></a>01109             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &gt; <a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
<a name="l01110"></a>01110                 <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112             <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a83a8916731ff5ce73e5d4f05d8ae6d30">receivedDuplicateAck</a>();
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114         <span class="keywordflow">else</span>
<a name="l01115"></a>01115         {
<a name="l01116"></a>01116             <span class="comment">// if doesn&apos;t qualify as duplicate ACK, just ignore it.</span>
<a name="l01117"></a>01117             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()==0)
<a name="l01118"></a>01118             {
<a name="l01119"></a>01119                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>!=tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>())
<a name="l01120"></a>01120                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Old ACK: ackNo&lt;snd_una\n&quot;</span>;
<a name="l01121"></a>01121                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)
<a name="l01122"></a>01122                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK looks duplicate but we have currently no unacked data (snd_una==snd_max)\n&quot;</span>;
<a name="l01123"></a>01123             }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125             <span class="comment">// reset counter</span>
<a name="l01126"></a>01126             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
<a name="l01127"></a>01127             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
<a name="l01128"></a>01128                 <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
<a name="l01132"></a>01132     {
<a name="l01133"></a>01133         <span class="comment">// ack in window.</span>
<a name="l01134"></a>01134         uint32 old_snd_una = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l01135"></a>01135         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l01136"></a>01136         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138         <span class="comment">// after retransmitting a lost segment, we may get an ack well ahead of snd_nxt</span>
<a name="l01139"></a>01139         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>))
<a name="l01140"></a>01140             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         uint32 discardUpToSeq = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l01143"></a>01143 
<a name="l01144"></a>01144         <span class="comment">// our FIN acked?</span>
<a name="l01145"></a>01145         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
<a name="l01146"></a>01146         {
<a name="l01147"></a>01147             <span class="comment">// set flag that our FIN has been acked</span>
<a name="l01148"></a>01148             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK acks our FIN\n&quot;</span>;
<a name="l01149"></a>01149             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a> = <span class="keyword">true</span>;
<a name="l01150"></a>01150             discardUpToSeq--; <span class="comment">// the FIN sequence number is not real data</span>
<a name="l01151"></a>01151         }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="comment">// acked data no longer needed in send queue</span>
<a name="l01154"></a>01154         <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(discardUpToSeq);
<a name="l01155"></a>01155         <span class="comment">// acked data no longer needed in rexmit queue</span>
<a name="l01156"></a>01156         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l01157"></a>01157             <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(discardUpToSeq);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159         <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &gt; <a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
<a name="l01162"></a>01162             <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164         <span class="comment">// notify</span>
<a name="l01165"></a>01165         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#abe5d8e8c02ba34cd5c50eca71824b81e">receivedDataAck</a>(old_snd_una);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167         <span class="comment">// in the receivedDataAck we need the old value</span>
<a name="l01168"></a>01168         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
<a name="l01169"></a>01169         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
<a name="l01170"></a>01170             <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172     <span class="keywordflow">else</span>
<a name="l01173"></a>01173     {
<a name="l01174"></a>01174         ASSERT(<a class="code" href="_t_c_p_connection_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)); <span class="comment">// from if-ladder</span>
<a name="l01175"></a>01175 
<a name="l01176"></a>01176         <span class="comment">// send an ACK, drop the segment, and return.</span>
<a name="l01177"></a>01177         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a113d03b1de3e1b788ae95635d69e064d">receivedAckForDataNotYetSent</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l01178"></a>01178         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
<a name="l01179"></a>01179         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
<a name="l01180"></a>01180             <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
<a name="l01181"></a>01181         <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// means &quot;drop&quot;</span>
<a name="l01182"></a>01182     }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01185"></a>01185 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aebf3e44d104151c83a84a1efbae3f312"></a><!-- doxytag: member="TCPConnection::processAppCommand" ref="aebf3e44d104151c83a84a1efbae3f312" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAppCommand </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process commands from the application. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00326">326</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00083">TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00327"></a>00327 {
<a name="l00328"></a>00328     <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <span class="comment">// first do actions</span>
<a name="l00331"></a>00331     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand = (<a class="code" href="class_t_c_p_command.html">TCPCommand</a> *)(msg-&gt;removeControlInfo());
<a name="l00332"></a>00332     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a>(msg-&gt;getKind());
<a name="l00333"></a>00333     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;App command: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00334"></a>00334     <span class="keywordflow">switch</span> (event)
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: <a class="code" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00337"></a>00337         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>: <a class="code" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00338"></a>00338         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>: <a class="code" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00339"></a>00339         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>: <a class="code" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00340"></a>00340         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>: <a class="code" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00341"></a>00341         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>: <a class="code" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
<a name="l00342"></a>00342         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;wrong event code&quot;</span>);
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="comment">// then state transitions</span>
<a name="l00346"></a>00346     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00347"></a>00347 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a632302213a1f4344d908bdfd1509323d"></a><!-- doxytag: member="TCPConnection::processMSSOption" ref="a632302213a1f4344d908bdfd1509323d" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processMSSOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>option</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00787">787</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00747">readHeaderOptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00788"></a>00788 {
<a name="l00789"></a>00789     <span class="keywordflow">if</span> (option.<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>() != 4)
<a name="l00790"></a>00790     {
<a name="l00791"></a>00791         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
<a name="l00792"></a>00792         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
<a name="l00796"></a>00796     {
<a name="l00797"></a>00797         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option MSS received, but in unexpected state\n&quot;</span>;
<a name="l00798"></a>00798         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <span class="keywordflow">if</span> (option.<a class="code" href="class_t_c_p_option.html#ab6fdfa2cdc260ae8a42818befcf236a5">getValuesArraySize</a>() == 0)
<a name="l00802"></a>00802     {
<a name="l00803"></a>00803         <span class="comment">// since option.getLength() was already checked, this is a programming error not a TCP error</span>
<a name="l00804"></a>00804         <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;TCPOption for MSS does not contain the data its getLength() promises&quot;</span>);
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="comment">// RFC 2581, page 1:</span>
<a name="l00808"></a>00808     <span class="comment">// &quot;The SMSS is the size of the largest segment that the sender can transmit.</span>
<a name="l00809"></a>00809     <span class="comment">// This value can be based on the maximum transmission unit of the network,</span>
<a name="l00810"></a>00810     <span class="comment">// the path MTU discovery [MD90] algorithm, RMSS (see next item), or other</span>
<a name="l00811"></a>00811     <span class="comment">// factors.  The size does not include the TCP/IP headers and options.&quot;</span>
<a name="l00812"></a>00812     <span class="comment">//</span>
<a name="l00813"></a>00813     <span class="comment">// &quot;The RMSS is the size of the largest segment the receiver is willing to accept.</span>
<a name="l00814"></a>00814     <span class="comment">// This is the value specified in the MSS option sent by the receiver during</span>
<a name="l00815"></a>00815     <span class="comment">// connection startup.  Or, if the MSS option is not used, 536 bytes [Bra89].</span>
<a name="l00816"></a>00816     <span class="comment">// The size does not include the TCP/IP headers and options.&quot;</span>
<a name="l00817"></a>00817     <span class="comment">//</span>
<a name="l00818"></a>00818     <span class="comment">//</span>
<a name="l00819"></a>00819     <span class="comment">// The value of snd_mss (SMSS) is set to the minimum of snd_mss (local parameter) and</span>
<a name="l00820"></a>00820     <span class="comment">// the value specified in the MSS option received during connection startup.</span>
<a name="l00821"></a>00821     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>, (uint32) option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(0));
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>==0)
<a name="l00823"></a>00823         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = 536;
<a name="l00824"></a>00824     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option MSS received, SMSS is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00825"></a>00825     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00826"></a>00826 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d240ca8f36aa37a29b8bcc44ec052cd"></a><!-- doxytag: member="TCPConnection::processRstInSynReceived" ref="a4d240ca8f36aa37a29b8bcc44ec052cd" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processRstInSynReceived </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01027">1027</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01028"></a>01028 {
<a name="l01029"></a>01029     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing RST in SYN_RCVD\n&quot;</span>;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031     <span class="comment">//&quot;</span>
<a name="l01032"></a>01032     <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
<a name="l01033"></a>01033     <span class="comment">// came from the LISTEN state), then return this connection to</span>
<a name="l01034"></a>01034     <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
<a name="l01035"></a>01035     <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
<a name="l01036"></a>01036     <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
<a name="l01037"></a>01037     <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
<a name="l01038"></a>01038     <span class="comment">// on the retransmission queue should be removed.  And in the</span>
<a name="l01039"></a>01039     <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
<a name="l01040"></a>01040     <span class="comment">// and return.</span>
<a name="l01041"></a>01041     <span class="comment">//&quot;</span>
<a name="l01042"></a>01042 
<a name="l01043"></a>01043     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>()); <span class="comment">// flush send queue</span>
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l01045"></a>01045         <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#aab51c929cca62ab481aebf24ecaff747">getBufferEndSeq</a>()); <span class="comment">// flush rexmit queue</span>
<a name="l01046"></a>01046 
<a name="l01047"></a>01047     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a>)
<a name="l01048"></a>01048     {
<a name="l01049"></a>01049         <span class="comment">// signal &quot;connection refused&quot;</span>
<a name="l01050"></a>01050         <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba21824d5a95e3b86c41f35775bb5f23ab">TCP_I_CONNECTION_REFUSED</a>);
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <span class="comment">// on RCV_RST, FSM will go either to LISTEN or to CLOSED, depending on state-&gt;active</span>
<a name="l01054"></a>01054     <span class="comment">// FIXME if this was a forked connection, it should rather close than go back to listening (otherwise we&apos;d now have two listening connections with the original one!)</span>
<a name="l01055"></a>01055     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;
<a name="l01056"></a>01056 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33b50078727564bd2c4e7e906e2f1648"></a><!-- doxytag: member="TCPConnection::processSACKOption" ref="a33b50078727564bd2c4e7e906e2f1648" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processSACKOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>option</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00848">848</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00747">readHeaderOptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00849"></a>00849 {
<a name="l00850"></a>00850     <span class="keywordflow">if</span> (option.<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>() % 8 != 2)
<a name="l00851"></a>00851     {
<a name="l00852"></a>00852         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
<a name="l00853"></a>00853         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>) <span class="comment">// not need to check the state here?</span>
<a name="l00857"></a>00857     {
<a name="l00858"></a>00858         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; (option.<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>()/2) &lt;&lt; <span class="stringliteral">&quot;. SACK(s) received, but sack_enabled is set to &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00859"></a>00859         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <span class="keywordtype">int</span> n = option.<a class="code" href="class_t_c_p_option.html#ab6fdfa2cdc260ae8a42818befcf236a5">getValuesArraySize</a>()/2;
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (n &gt; 0) <span class="comment">// sacks present?</span>
<a name="l00864"></a>00864     {
<a name="l00865"></a>00865         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; SACK(s) received:\n&quot;</span>;
<a name="l00866"></a>00866         <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> count=0;
<a name="l00867"></a>00867         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; i++)
<a name="l00868"></a>00868         {
<a name="l00869"></a>00869             <a class="code" href="class_sack.html">Sack</a> tmp;
<a name="l00870"></a>00870             tmp.<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(count));
<a name="l00871"></a>00871             count++;
<a name="l00872"></a>00872             tmp.<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(count));
<a name="l00873"></a>00873             count++;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875             uint32 sack_range = tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() - tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>();
<a name="l00876"></a>00876             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (i+1) &lt;&lt; <span class="stringliteral">&quot;. SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878             <span class="comment">// check for D-SACK</span>
<a name="l00879"></a>00879             <span class="keywordflow">if</span> (i==0 &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()))
<a name="l00880"></a>00880             {
<a name="l00881"></a>00881                 <span class="comment">// RFC 2883, page 8:</span>
<a name="l00882"></a>00882                 <span class="comment">// &quot;In order for the sender to check that the first (D)SACK block of an</span>
<a name="l00883"></a>00883                 <span class="comment">// acknowledgement in fact acknowledges duplicate data, the sender</span>
<a name="l00884"></a>00884                 <span class="comment">// should compare the sequence space in the first SACK block to the</span>
<a name="l00885"></a>00885                 <span class="comment">// cumulative ACK which is carried IN THE SAME PACKET.  If the SACK</span>
<a name="l00886"></a>00886                 <span class="comment">// sequence space is less than this cumulative ACK, it is an indication</span>
<a name="l00887"></a>00887                 <span class="comment">// that the segment identified by the SACK block has been received more</span>
<a name="l00888"></a>00888                 <span class="comment">// than once by the receiver.  An implementation MUST NOT compare the</span>
<a name="l00889"></a>00889                 <span class="comment">// sequence space in the SACK block to the TCP state variable snd.una</span>
<a name="l00890"></a>00890                 <span class="comment">// (which carries the total cumulative ACK), as this may result in the</span>
<a name="l00891"></a>00891                 <span class="comment">// wrong conclusion if ACK packets are reordered.&quot;</span>
<a name="l00892"></a>00892                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received D-SACK below cumulative ACK=&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &lt;&lt; <span class="stringliteral">&quot; D-SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==0 &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()) &amp;&amp; n&gt;1)
<a name="l00895"></a>00895             {
<a name="l00896"></a>00896                 <span class="comment">// RFC 2883, page 8:</span>
<a name="l00897"></a>00897                 <span class="comment">// &quot;If the sequence space in the first SACK block is greater than the</span>
<a name="l00898"></a>00898                 <span class="comment">// cumulative ACK, then the sender next compares the sequence space in</span>
<a name="l00899"></a>00899                 <span class="comment">// the first SACK block with the sequence space in the second SACK</span>
<a name="l00900"></a>00900                 <span class="comment">// block, if there is one.  This comparison can determine if the first</span>
<a name="l00901"></a>00901                 <span class="comment">// SACK block is reporting duplicate data that lies above the cumulative</span>
<a name="l00902"></a>00902                 <span class="comment">// ACK.&quot;</span>
<a name="l00903"></a>00903                 <a class="code" href="class_sack.html">Sack</a> tmp2;
<a name="l00904"></a>00904                 tmp2.<a class="code" href="class_sack.html#a1b55a1f0609ee10fa7c92167756fa591">setStart</a>(option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(2));
<a name="l00905"></a>00905                 tmp2.<a class="code" href="class_sack.html#ae1479a704dcc04eeb0d34a0dddaa6912">setEnd</a>(option.<a class="code" href="class_t_c_p_option.html#a1875afa2640add4375c000c42b6d38d6">getValues</a>(3));
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                 <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>(), tmp2.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>()) &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>(), tmp2.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>()))
<a name="l00908"></a>00908                 {<a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received D-SACK above cumulative ACK=&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>() &lt;&lt; <span class="stringliteral">&quot; D-SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() &lt;&lt; <span class="stringliteral">&quot;) SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp2.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp2.<a class="code" href="class_sack.html#a2f44a62273de5ca6a561ed6caf66e229">getEnd</a>() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;}
<a name="l00909"></a>00909             }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911             <span class="comment">// splitt sack_range to smss_sized pieces</span>
<a name="l00912"></a>00912             uint32 tmp_sack_range = sack_range;
<a name="l00913"></a>00913             uint32 counter = 1; <span class="comment">// at least one piece has been received</span>
<a name="l00914"></a>00914 
<a name="l00915"></a>00915             <span class="keywordflow">while</span> (tmp_sack_range &gt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// to check how many smss_sized pieces are covered by this single sack_range</span>
<a name="l00916"></a>00916             {
<a name="l00917"></a>00917                 tmp_sack_range = tmp_sack_range - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
<a name="l00918"></a>00918                 counter++;
<a name="l00919"></a>00919             }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921             <span class="comment">// find smss_sized_sack in send queue and set &quot;sacked&quot; bit</span>
<a name="l00922"></a>00922             uint32 mss_sized_sack = tmp.<a class="code" href="class_sack.html#af78da6f09ec4b292da4c5231982bc013">getStart</a>();
<a name="l00923"></a>00923             <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> j=0;j&lt;counter;j++)
<a name="l00924"></a>00924             {
<a name="l00925"></a>00925                 <span class="keywordflow">if</span> (j+1==counter) <span class="comment">// the last part does not need to be smss_sized (nagle off)</span>
<a name="l00926"></a>00926                 {
<a name="l00927"></a>00927                     <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(mss_sized_sack,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>))
<a name="l00928"></a>00928                         <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#abd0309b9f592a452399c73174bbd94cf">setSackedBit</a>(mss_sized_sack,mss_sized_sack+tmp_sack_range);
<a name="l00929"></a>00929                     <span class="keywordflow">else</span>
<a name="l00930"></a>00930                         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received old sack. Sacked segment number is below snd_una\n&quot;</span>;
<a name="l00931"></a>00931                 }
<a name="l00932"></a>00932                 <span class="keywordflow">else</span>
<a name="l00933"></a>00933                 {
<a name="l00934"></a>00934                     <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(mss_sized_sack,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>))
<a name="l00935"></a>00935                         <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#abd0309b9f592a452399c73174bbd94cf">setSackedBit</a>(mss_sized_sack,mss_sized_sack+<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00936"></a>00936                     <span class="keywordflow">else</span>
<a name="l00937"></a>00937                         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received old sack. Sacked segment number is below snd_una\n&quot;</span>;
<a name="l00938"></a>00938                 }
<a name="l00939"></a>00939                 mss_sized_sack = mss_sized_sack + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
<a name="l00940"></a>00940             }
<a name="l00941"></a>00941         }
<a name="l00942"></a>00942         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a> + n; <span class="comment">// total counter, no current number</span>
<a name="l00943"></a>00943         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>)
<a name="l00944"></a>00944             <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a>);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="comment">// update scoreboard</span>
<a name="l00947"></a>00947         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#afc44bbf1e92ac47b7ef4ed4158af9a64">sackedBytes_old</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>; <span class="comment">// needed for RFC 3042 to check if last dupAck contained new sack information</span>
<a name="l00948"></a>00948         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a9e3ff65826298ce1b2000bbd0bc04957">getTotalAmountOfSackedBytes</a>();
<a name="l00949"></a>00949         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>)
<a name="l00950"></a>00950             <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>);
<a name="l00951"></a>00951     }
<a name="l00952"></a>00952     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00953"></a>00953 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a009bb98808477c6cbf9b0b82c3ae2ca4"></a><!-- doxytag: member="TCPConnection::processSACKPermittedOption" ref="a009bb98808477c6cbf9b0b82c3ae2ca4" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processSACKPermittedOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_c_p_option.html">TCPOption</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>option</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00828">828</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00747">readHeaderOptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <span class="keywordflow">if</span> (option.<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>() != 2)
<a name="l00831"></a>00831     {
<a name="l00832"></a>00832         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: length incorrect\n&quot;</span>;
<a name="l00833"></a>00833         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
<a name="l00837"></a>00837     {
<a name="l00838"></a>00838         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option SACK_PERMITTED received, but in unexpected state\n&quot;</span>;
<a name="l00839"></a>00839         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a> = <span class="keyword">true</span>;
<a name="l00843"></a>00843     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a>;
<a name="l00844"></a>00844     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option SACK_PERMITTED received, SACK (sack_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00845"></a>00845     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00846"></a>00846 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0758284e5bd6bd162b6ff267add2e2d"></a><!-- doxytag: member="TCPConnection::processSegment1stThru8th" ref="aa0758284e5bd6bd162b6ff267add2e2d" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegment1stThru8th </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">114</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <span class="comment">//</span>
<a name="l00117"></a>00117     <span class="comment">// RFC 793: first check sequence number</span>
<a name="l00118"></a>00118     <span class="comment">//</span>
<a name="l00119"></a>00119     <span class="keywordtype">bool</span> acceptable = <a class="code" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg);
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (!acceptable)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         <span class="comment">//&quot;</span>
<a name="l00123"></a>00123         <span class="comment">// If an incoming segment is not acceptable, an acknowledgment</span>
<a name="l00124"></a>00124         <span class="comment">// should be sent in reply (unless the RST bit is set, if so drop</span>
<a name="l00125"></a>00125         <span class="comment">// the segment and return):</span>
<a name="l00126"></a>00126         <span class="comment">//</span>
<a name="l00127"></a>00127         <span class="comment">//  &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00128"></a>00128         <span class="comment">//&quot;</span>
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST with unacceptable seqNum: dropping\n&quot;</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">else</span>
<a name="l00134"></a>00134         {
<a name="l00135"></a>00135             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00136"></a>00136             {
<a name="l00137"></a>00137                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN with unacceptable seqNum in &quot;</span> &lt;&lt;  <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; state received (SYN duplicat?)\n&quot;</span>;
<a name="l00138"></a>00138             }
<a name="l00139"></a>00139             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>((tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
<a name="l00140"></a>00140             {
<a name="l00141"></a>00141                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00142"></a>00142                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00143"></a>00143                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>;
<a name="l00144"></a>00144                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_D-SACK SET (dupseg rcvd)\n&quot;</span>;
<a name="l00145"></a>00145             }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment seqNum not acceptable, sending ACK with current receive seq\n&quot;</span>;
<a name="l00148"></a>00148             <span class="comment">// RFC 2018, page 4:</span>
<a name="l00149"></a>00149             <span class="comment">// &quot;The receiver SHOULD send an ACK for every valid segment that arrives</span>
<a name="l00150"></a>00150             <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
<a name="l00151"></a>00151             <span class="comment">// SACK option.&quot;</span>
<a name="l00152"></a>00152             <span class="comment">//</span>
<a name="l00153"></a>00153             <span class="comment">// The received segment is not &quot;valid&quot; therefore the ACK will not bear a SACK option, if snd_dsack (D-SACK) is not set.</span>
<a name="l00154"></a>00154             <a class="code" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">//</span>
<a name="l00160"></a>00160     <span class="comment">// RFC 793: second check the RST bit,</span>
<a name="l00161"></a>00161     <span class="comment">//</span>
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164         <span class="comment">// Note: if we come from LISTEN, processSegmentInListen() has already handled RST.</span>
<a name="l00165"></a>00165         <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00168"></a>00168                 <span class="comment">//&quot;</span>
<a name="l00169"></a>00169                 <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
<a name="l00170"></a>00170                 <span class="comment">// came from the LISTEN state), then return this connection to</span>
<a name="l00171"></a>00171                 <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
<a name="l00172"></a>00172                 <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
<a name="l00173"></a>00173                 <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
<a name="l00174"></a>00174                 <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
<a name="l00175"></a>00175                 <span class="comment">// on the retransmission queue should be removed.  And in the</span>
<a name="l00176"></a>00176                 <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
<a name="l00177"></a>00177                 <span class="comment">// and return.</span>
<a name="l00178"></a>00178                 <span class="comment">//&quot;</span>
<a name="l00179"></a>00179                 <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a>(tcpseg);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00182"></a>00182             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00183"></a>00183             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00184"></a>00184             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00185"></a>00185                 <span class="comment">//&quot;</span>
<a name="l00186"></a>00186                 <span class="comment">// If the RST bit is set then, any outstanding RECEIVEs and SEND</span>
<a name="l00187"></a>00187                 <span class="comment">// should receive &quot;reset&quot; responses.  All segment queues should be</span>
<a name="l00188"></a>00188                 <span class="comment">// flushed.  Users should also receive an unsolicited general</span>
<a name="l00189"></a>00189                 <span class="comment">// &quot;connection reset&quot; signal.</span>
<a name="l00190"></a>00190                 <span class="comment">//</span>
<a name="l00191"></a>00191                 <span class="comment">// Enter the CLOSED state, delete the TCB, and return.</span>
<a name="l00192"></a>00192                 <span class="comment">//&quot;</span>
<a name="l00193"></a>00193                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: performing connection reset, closing connection\n&quot;</span>;
<a name="l00194"></a>00194                 <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00195"></a>00195                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;  <span class="comment">// this will trigger state transition</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
<a name="l00198"></a>00198             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
<a name="l00199"></a>00199             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00200"></a>00200                 <span class="comment">//&quot;</span>
<a name="l00201"></a>00201                 <span class="comment">// enter the CLOSED state, delete the TCB, and return.</span>
<a name="l00202"></a>00202                 <span class="comment">//&quot;</span>
<a name="l00203"></a>00203                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: closing connection\n&quot;</span>;
<a name="l00204"></a>00204                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>)
<a name="l00205"></a>00205                     <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>); <span class="comment">// in TIME_WAIT, we&apos;ve already sent it</span>
<a name="l00206"></a>00206                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>; <span class="comment">// this will trigger state transition</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208             <span class="keywordflow">default</span>: ASSERT(0);
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="comment">// RFC 793: third check security and precedence</span>
<a name="l00213"></a>00213     <span class="comment">// This step is ignored.</span>
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">//</span>
<a name="l00216"></a>00216     <span class="comment">// RFC 793: fourth, check the SYN bit,</span>
<a name="l00217"></a>00217     <span class="comment">//</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         <span class="comment">//&quot;</span>
<a name="l00221"></a>00221         <span class="comment">// If the SYN is in the window it is an error, send a reset, any</span>
<a name="l00222"></a>00222         <span class="comment">// outstanding RECEIVEs and SEND should receive &quot;reset&quot; responses,</span>
<a name="l00223"></a>00223         <span class="comment">// all segment queues should be flushed, the user should also</span>
<a name="l00224"></a>00224         <span class="comment">// receive an unsolicited general &quot;connection reset&quot; signal, enter</span>
<a name="l00225"></a>00225         <span class="comment">// the CLOSED state, delete the TCB, and return.</span>
<a name="l00226"></a>00226         <span class="comment">//</span>
<a name="l00227"></a>00227         <span class="comment">// If the SYN is not in the window this step would not be reached</span>
<a name="l00228"></a>00228         <span class="comment">// and an ack would have been sent in the first step (sequence</span>
<a name="l00229"></a>00229         <span class="comment">// number check).</span>
<a name="l00230"></a>00230         <span class="comment">//&quot;</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         ASSERT(<a class="code" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg));  <span class="comment">// assert SYN is in the window</span>
<a name="l00233"></a>00233         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN is in the window: performing connection reset, closing connection\n&quot;</span>;
<a name="l00234"></a>00234         <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00235"></a>00235         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>;
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="comment">//</span>
<a name="l00239"></a>00239     <span class="comment">// RFC 793: fifth check the ACK field,</span>
<a name="l00240"></a>00240     <span class="comment">//</span>
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243         <span class="comment">// if the ACK bit is off drop the segment and return</span>
<a name="l00244"></a>00244         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK not set, dropping segment\n&quot;</span>;
<a name="l00245"></a>00245         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252         <span class="comment">//&quot;</span>
<a name="l00253"></a>00253         <span class="comment">// If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then enter ESTABLISHED state</span>
<a name="l00254"></a>00254         <span class="comment">// and continue processing.</span>
<a name="l00255"></a>00255         <span class="comment">//</span>
<a name="l00256"></a>00256         <span class="comment">// If the segment acknowledgment is not acceptable, form a</span>
<a name="l00257"></a>00257         <span class="comment">// reset segment,</span>
<a name="l00258"></a>00258         <span class="comment">//</span>
<a name="l00259"></a>00259         <span class="comment">//  &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00260"></a>00260         <span class="comment">//</span>
<a name="l00261"></a>00261         <span class="comment">// and send it.</span>
<a name="l00262"></a>00262         <span class="comment">//&quot;</span>
<a name="l00263"></a>00263         <span class="keywordflow">if</span> (!<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()) || !<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>))
<a name="l00264"></a>00264         {
<a name="l00265"></a>00265             <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00266"></a>00266             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="comment">// notify tcpAlgorithm and app layer</span>
<a name="l00270"></a>00270         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a2d051b6a9e2a9fccfa6f8b64bb8c647d">established</a>(<span class="keyword">false</span>);
<a name="l00271"></a>00271         <a class="code" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
<a name="l00274"></a>00274         <span class="comment">// app will be taken care of in stateEntered().</span>
<a name="l00275"></a>00275         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>; <span class="comment">// later we&apos;ll need to see if snd_nxt changed</span>
<a name="l00279"></a>00279     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> ||
<a name="l00280"></a>00280         <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a> ||
<a name="l00281"></a>00281         <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>)
<a name="l00282"></a>00282     {
<a name="l00283"></a>00283         <span class="comment">//</span>
<a name="l00284"></a>00284         <span class="comment">// ESTABLISHED processing:</span>
<a name="l00285"></a>00285         <span class="comment">//&quot;</span>
<a name="l00286"></a>00286         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
<a name="l00287"></a>00287         <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
<a name="l00288"></a>00288         <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
<a name="l00289"></a>00289         <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
<a name="l00290"></a>00290         <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
<a name="l00291"></a>00291         <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
<a name="l00292"></a>00292         <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
<a name="l00293"></a>00293         <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
<a name="l00294"></a>00294         <span class="comment">//  drop the segment, and return.</span>
<a name="l00295"></a>00295         <span class="comment">//</span>
<a name="l00296"></a>00296         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
<a name="l00297"></a>00297         <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
<a name="l00298"></a>00298         <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
<a name="l00299"></a>00299         <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
<a name="l00300"></a>00300         <span class="comment">//</span>
<a name="l00301"></a>00301         <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
<a name="l00302"></a>00302         <span class="comment">//  records the sequence number of the last segment used to update</span>
<a name="l00303"></a>00303         <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
<a name="l00304"></a>00304         <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
<a name="l00305"></a>00305         <span class="comment">//  prevents using old segments to update the window.</span>
<a name="l00306"></a>00306         <span class="comment">//&quot;</span>
<a name="l00307"></a>00307         <span class="keywordtype">bool</span> ok = <a class="code" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a>(tcpseg);
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (!ok)
<a name="l00309"></a>00309             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;  <span class="comment">// if acks something not yet sent, drop it</span>
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="keywordflow">if</span> ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>))
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314         <span class="comment">//&quot;</span>
<a name="l00315"></a>00315         <span class="comment">// FIN-WAIT-1 STATE</span>
<a name="l00316"></a>00316         <span class="comment">//   In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00317"></a>00317         <span class="comment">//   our FIN is now acknowledged then enter FIN-WAIT-2 and continue</span>
<a name="l00318"></a>00318         <span class="comment">//   processing in that state.</span>
<a name="l00319"></a>00319         <span class="comment">//&quot;</span>
<a name="l00320"></a>00320         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to FIN-WAIT-2</span>
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>)
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325         <span class="comment">//&quot;</span>
<a name="l00326"></a>00326         <span class="comment">// FIN-WAIT-2 STATE</span>
<a name="l00327"></a>00327         <span class="comment">//  In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00328"></a>00328         <span class="comment">//  the retransmission queue is empty, the user&apos;s CLOSE can be</span>
<a name="l00329"></a>00329         <span class="comment">//  acknowledged (&quot;ok&quot;) but do not delete the TCB.</span>
<a name="l00330"></a>00330         <span class="comment">//&quot;</span>
<a name="l00331"></a>00331         <span class="comment">// nothing to do here (in our model, used commands don&apos;t need to be</span>
<a name="l00332"></a>00332         <span class="comment">// acknowledged)</span>
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>)
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337         <span class="comment">//&quot;</span>
<a name="l00338"></a>00338         <span class="comment">// In addition to the processing for the ESTABLISHED state, if</span>
<a name="l00339"></a>00339         <span class="comment">// the ACK acknowledges our FIN then enter the TIME-WAIT state,</span>
<a name="l00340"></a>00340         <span class="comment">// otherwise ignore the segment.</span>
<a name="l00341"></a>00341         <span class="comment">//&quot;</span>
<a name="l00342"></a>00342         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
<a name="l00343"></a>00343         {
<a name="l00344"></a>00344             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Our FIN acked -- can go to TIME_WAIT now\n&quot;</span>;
<a name="l00345"></a>00345             <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to TIME-WAIT</span>
<a name="l00346"></a>00346             <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);  <span class="comment">// start timer</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348             <span class="comment">// we&apos;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00349"></a>00349             <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00350"></a>00350             <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>)
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356         <span class="comment">//&quot;</span>
<a name="l00357"></a>00357         <span class="comment">// The only thing that can arrive in this state is an</span>
<a name="l00358"></a>00358         <span class="comment">// acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
<a name="l00359"></a>00359         <span class="comment">// delete the TCB, enter the CLOSED state, and return.</span>
<a name="l00360"></a>00360         <span class="comment">//&quot;</span>
<a name="l00361"></a>00361         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
<a name="l00362"></a>00362         {
<a name="l00363"></a>00363             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Last ACK arrived\n&quot;</span>;
<a name="l00364"></a>00364             <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00365"></a>00365             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>; <span class="comment">// will trigger transition to CLOSED</span>
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         <span class="comment">//&quot;</span>
<a name="l00372"></a>00372         <span class="comment">// The only thing that can arrive in this state is a</span>
<a name="l00373"></a>00373         <span class="comment">// retransmission of the remote FIN.  Acknowledge it, and restart</span>
<a name="l00374"></a>00374         <span class="comment">// the 2 MSL timeout.</span>
<a name="l00375"></a>00375         <span class="comment">//&quot;</span>
<a name="l00376"></a>00376         <span class="comment">// And we are staying in the TIME_WAIT state.</span>
<a name="l00377"></a>00377         <span class="comment">//</span>
<a name="l00378"></a>00378         <a class="code" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
<a name="l00379"></a>00379         <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
<a name="l00380"></a>00380         <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">//</span>
<a name="l00384"></a>00384     <span class="comment">// RFC 793: sixth, check the URG bit,</span>
<a name="l00385"></a>00385     <span class="comment">//</span>
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> ||
<a name="l00387"></a>00387         <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>))
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389         <span class="comment">//&quot;</span>
<a name="l00390"></a>00390         <span class="comment">// If the URG bit is set, RCV.UP &lt;- max(RCV.UP,SEG.UP), and signal</span>
<a name="l00391"></a>00391         <span class="comment">// the user that the remote side has urgent data if the urgent</span>
<a name="l00392"></a>00392         <span class="comment">// pointer (RCV.UP) is in advance of the data consumed.  If the</span>
<a name="l00393"></a>00393         <span class="comment">// user has already been signaled (or is still in the &quot;urgent</span>
<a name="l00394"></a>00394         <span class="comment">// mode&quot;) for this continuous sequence of urgent data, do not</span>
<a name="l00395"></a>00395         <span class="comment">// signal the user again.</span>
<a name="l00396"></a>00396         <span class="comment">//&quot;</span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         <span class="comment">// TBD: URG currently not supported</span>
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">//</span>
<a name="l00402"></a>00402     <span class="comment">// RFC 793: seventh, process the segment text,</span>
<a name="l00403"></a>00403     <span class="comment">//</span>
<a name="l00404"></a>00404     uint32 old_rcv_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>; <span class="comment">// if rcv_nxt changes, we need to send/schedule an ACK</span>
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>)
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407         <span class="comment">//&quot;</span>
<a name="l00408"></a>00408         <span class="comment">// Once in the ESTABLISHED state, it is possible to deliver segment</span>
<a name="l00409"></a>00409         <span class="comment">// text to user RECEIVE buffers.  Text from segments can be moved</span>
<a name="l00410"></a>00410         <span class="comment">// into buffers until either the buffer is full or the segment is</span>
<a name="l00411"></a>00411         <span class="comment">// empty.  If the segment empties and carries an PUSH flag, then</span>
<a name="l00412"></a>00412         <span class="comment">// the user is informed, when the buffer is returned, that a PUSH</span>
<a name="l00413"></a>00413         <span class="comment">// has been received.</span>
<a name="l00414"></a>00414         <span class="comment">//</span>
<a name="l00415"></a>00415         <span class="comment">// When the TCP takes responsibility for delivering the data to the</span>
<a name="l00416"></a>00416         <span class="comment">// user it must also acknowledge the receipt of the data.</span>
<a name="l00417"></a>00417         <span class="comment">//</span>
<a name="l00418"></a>00418         <span class="comment">// Once the TCP takes responsibility for the data it advances</span>
<a name="l00419"></a>00419         <span class="comment">// RCV.NXT over the data accepted, and adjusts RCV.WND as</span>
<a name="l00420"></a>00420         <span class="comment">// apporopriate to the current buffer availability.  The total of</span>
<a name="l00421"></a>00421         <span class="comment">// RCV.NXT and RCV.WND should not be reduced.</span>
<a name="l00422"></a>00422         <span class="comment">//</span>
<a name="l00423"></a>00423         <span class="comment">// Please note the window management suggestions in section 3.7.</span>
<a name="l00424"></a>00424         <span class="comment">//</span>
<a name="l00425"></a>00425         <span class="comment">// Send an acknowledgment of the form:</span>
<a name="l00426"></a>00426         <span class="comment">//</span>
<a name="l00427"></a>00427         <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00428"></a>00428         <span class="comment">//</span>
<a name="l00429"></a>00429         <span class="comment">// This acknowledgment should be piggybacked on a segment being</span>
<a name="l00430"></a>00430         <span class="comment">// transmitted if possible without incurring undue delay.</span>
<a name="l00431"></a>00431         <span class="comment">//&quot;</span>
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434             <span class="comment">// check for full sized segment</span>
<a name="l00435"></a>00435             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
<a name="l00436"></a>00436                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5d47c2c046bb9fe704be153bb0731e9a">full_sized_segment_counter</a>++;
<a name="l00437"></a>00437             <span class="comment">// check for persist probe</span>
<a name="l00438"></a>00438             if (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>() == 1)
<a name="l00439"></a>00439                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;    <span class="comment">// TODO how to check if it is really a persist probe?</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441             <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
<a name="l00442"></a>00442             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
<a name="l00443"></a>00443             {
<a name="l00444"></a>00444                 <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment text in a data transfer state\n&quot;</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                 <span class="comment">// insert into receive buffers. If this segment is contiguous with</span>
<a name="l00447"></a>00447                 <span class="comment">// previously received ones (seqNo==rcv_nxt), rcv_nxt can be increased;</span>
<a name="l00448"></a>00448                 <span class="comment">// otherwise it stays the same but the data must be cached nevertheless</span>
<a name="l00449"></a>00449                 <span class="comment">// (to avoid &quot;Failure to retain above-sequence data&quot; problem, RFC 2525</span>
<a name="l00450"></a>00450                 <span class="comment">// section 2.5).</span>
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                 uint32 old_usedRcvBuffer = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a>;
<a name="l00453"></a>00453                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455                 <span class="comment">// out-of-order segment?</span>
<a name="l00456"></a>00456                 <span class="keywordflow">if</span> (old_rcv_nxt==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
<a name="l00457"></a>00457                 {
<a name="l00458"></a>00458                     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2297a0a5817443e592d2770ec016b0a0">rcv_oooseg</a>++;
<a name="l00459"></a>00459                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>)
<a name="l00460"></a>00460                         <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2297a0a5817443e592d2770ec016b0a0">rcv_oooseg</a>);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462                     <span class="comment">// RFC 2018, page 4:</span>
<a name="l00463"></a>00463                     <span class="comment">// &quot;The receiver SHOULD send an ACK for every valid segment that arrives</span>
<a name="l00464"></a>00464                     <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
<a name="l00465"></a>00465                     <span class="comment">// SACK option.&quot;</span>
<a name="l00466"></a>00466                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00467"></a>00467                     {
<a name="l00468"></a>00468                         <span class="comment">// store start and end sequence numbers of current oooseg in state variables</span>
<a name="l00469"></a>00469                         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00470"></a>00470                         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00471"></a>00471 
<a name="l00472"></a>00472                         <span class="keywordflow">if</span> (old_usedRcvBuffer == <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a46f4aa6d8cd91c25275f3997fc3e2e04">getAmountOfBufferedBytes</a>()) <span class="comment">// D-SACK</span>
<a name="l00473"></a>00473                         {
<a name="l00474"></a>00474                             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>;
<a name="l00475"></a>00475                             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_D-SACK SET (old_rcv_nxt==rcv_nxt duplicated oooseg rcvd)\n&quot;</span>;
<a name="l00476"></a>00476                         }
<a name="l00477"></a>00477                         <span class="keywordflow">else</span> <span class="comment">// SACK</span>
<a name="l00478"></a>00478                         {
<a name="l00479"></a>00479                             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> = <span class="keyword">true</span>;
<a name="l00480"></a>00480                             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_SACK SET (old_rcv_nxt==rcv_nxt oooseg rcvd)\n&quot;</span>;
<a name="l00481"></a>00481                         }
<a name="l00482"></a>00482                     }
<a name="l00483"></a>00483                     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a10903af17a26011a95b6745eb80f65ed">receivedOutOfOrderSegment</a>();
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485                 <span class="keywordflow">else</span>
<a name="l00486"></a>00486                 {
<a name="l00487"></a>00487                     <span class="comment">// forward data to app</span>
<a name="l00488"></a>00488                     <span class="comment">//</span>
<a name="l00489"></a>00489                     <span class="comment">// FIXME observe PSH bit</span>
<a name="l00490"></a>00490                     <span class="comment">//</span>
<a name="l00491"></a>00491                     <span class="comment">// FIXME we should implement socket READ command, and pass up only</span>
<a name="l00492"></a>00492                     <span class="comment">// as many bytes as requested. rcv_wnd should be decreased</span>
<a name="l00493"></a>00493                     <span class="comment">// accordingly!</span>
<a name="l00494"></a>00494                     <span class="comment">//</span>
<a name="l00495"></a>00495                     cPacket *msg;
<a name="l00496"></a>00496                     <span class="keywordflow">while</span> ((msg=<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#abfb833d10d529c1f9fda7d09e3616699">extractBytesUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))!=NULL)
<a name="l00497"></a>00497                     {
<a name="l00498"></a>00498                         msg-&gt;setKind(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba78bce3d41e158816c5212ed2fc959b06">TCP_I_DATA</a>);  <span class="comment">// TBD currently we never send TCP_I_URGENT_DATA</span>
<a name="l00499"></a>00499                         <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *cmd = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
<a name="l00500"></a>00500                         cmd-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
<a name="l00501"></a>00501                         msg-&gt;setControlInfo(cmd);
<a name="l00502"></a>00502                         <a class="code" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
<a name="l00503"></a>00503                     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505                     <span class="comment">// if this segment &quot;filled the gap&quot; until the previously arrived segment</span>
<a name="l00506"></a>00506                     <span class="comment">// that carried a FIN (i.e.rcv_nxt==rcv_fin_seq), we have to advance</span>
<a name="l00507"></a>00507                     <span class="comment">// rcv_nxt over the FIN.</span>
<a name="l00508"></a>00508                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a32121c2fcf9d110150db1588cafa595a">fin_rcvd</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a>)
<a name="l00509"></a>00509                     {
<a name="l00510"></a>00510                         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>; <span class="comment">// although not mentioned in [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 861] seems like we have to set ack_now</span>
<a name="l00511"></a>00511                         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;All segments arrived up to the FIN segment, advancing rcv_nxt over the FIN\n&quot;</span>;
<a name="l00512"></a>00512                         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a>+1;
<a name="l00513"></a>00513                         <span class="comment">// state transitions will be done in the state machine, here we just set</span>
<a name="l00514"></a>00514                         <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
<a name="l00515"></a>00515                         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>;
<a name="l00516"></a>00516                         <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00517"></a>00517                         {
<a name="l00518"></a>00518                             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00519"></a>00519                                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
<a name="l00520"></a>00520                                 {
<a name="l00521"></a>00521                                     <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>;
<a name="l00522"></a>00522                                     <span class="comment">// start the time-wait timer, turn off the other timers</span>
<a name="l00523"></a>00523                                     <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00524"></a>00524                                     <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526                                     <span class="comment">// we&apos;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00527"></a>00527                                     <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00528"></a>00528                                     <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00529"></a>00529                                 }
<a name="l00530"></a>00530                                 <span class="keywordflow">break</span>;
<a name="l00531"></a>00531                             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00532"></a>00532                                 <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
<a name="l00533"></a>00533                                 <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00534"></a>00534                                 <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536                                 <span class="comment">// we&apos;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00537"></a>00537                                 <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00538"></a>00538                                 <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00539"></a>00539                                 <span class="keywordflow">break</span>;
<a name="l00540"></a>00540                             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00541"></a>00541                                 <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
<a name="l00542"></a>00542                                 <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
<a name="l00543"></a>00543                                 <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00544"></a>00544                                 <span class="keywordflow">break</span>;
<a name="l00545"></a>00545                         }
<a name="l00546"></a>00546                         <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00547"></a>00547                     }
<a name="l00548"></a>00548                 }
<a name="l00549"></a>00549             }
<a name="l00550"></a>00550             <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
<a name="l00551"></a>00551             {
<a name="l00552"></a>00552                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
<a name="l00553"></a>00553                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
<a name="l00554"></a>00554                     <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556                 <span class="comment">// if the ACK bit is off drop the segment and return</span>
<a name="l00557"></a>00557                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
<a name="l00558"></a>00558                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00559"></a>00559             }
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="comment">//</span>
<a name="l00564"></a>00564     <span class="comment">// RFC 793: eighth, check the FIN bit,</span>
<a name="l00565"></a>00565     <span class="comment">//</span>
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00567"></a>00567     {
<a name="l00568"></a>00568         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         <span class="comment">//&quot;</span>
<a name="l00571"></a>00571         <span class="comment">// If the FIN bit is set, signal the user &quot;connection closing&quot; and</span>
<a name="l00572"></a>00572         <span class="comment">// return any pending RECEIVEs with same message, advance RCV.NXT</span>
<a name="l00573"></a>00573         <span class="comment">// over the FIN, and send an acknowledgment for the FIN.  Note that</span>
<a name="l00574"></a>00574         <span class="comment">// FIN implies PUSH for any segment text not yet delivered to the</span>
<a name="l00575"></a>00575         <span class="comment">// user.</span>
<a name="l00576"></a>00576         <span class="comment">//&quot;</span>
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <span class="comment">// Note: seems like RFC 793 is not entirely correct here: if the</span>
<a name="l00579"></a>00579         <span class="comment">// segment is &quot;above sequence&quot; (ie. RCV.NXT &lt; SEG.SEQ), we cannot</span>
<a name="l00580"></a>00580         <span class="comment">// advance RCV.NXT over the FIN. Instead we remember this sequence</span>
<a name="l00581"></a>00581         <span class="comment">// number and do it later.</span>
<a name="l00582"></a>00582         uint32 fin_seq = (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00583"></a>00583         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>==fin_seq)
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585             <span class="comment">// advance rcv_nxt over FIN now</span>
<a name="l00586"></a>00586             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN arrived, advancing rcv_nxt over the FIN\n&quot;</span>;
<a name="l00587"></a>00587             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>++;
<a name="l00588"></a>00588             <span class="comment">// state transitions will be done in the state machine, here we just set</span>
<a name="l00589"></a>00589             <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
<a name="l00590"></a>00590             <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>;
<a name="l00591"></a>00591             <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
<a name="l00592"></a>00592             {
<a name="l00593"></a>00593                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00594"></a>00594                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
<a name="l00595"></a>00595                     {
<a name="l00596"></a>00596                         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>;
<a name="l00597"></a>00597                         <span class="comment">// start the time-wait timer, turn off the other timers</span>
<a name="l00598"></a>00598                         <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00599"></a>00599                         <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601                         <span class="comment">// we&apos;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00602"></a>00602                         <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00603"></a>00603                         <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00604"></a>00604                     }
<a name="l00605"></a>00605                     <span class="keywordflow">break</span>;
<a name="l00606"></a>00606                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00607"></a>00607                     <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
<a name="l00608"></a>00608                     <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00609"></a>00609                     <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                     <span class="comment">// we&apos;re entering TIME_WAIT, so we can signal CLOSED the user</span>
<a name="l00612"></a>00612                     <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
<a name="l00613"></a>00613                     <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba994690e6a29c6e7c3eedc8fbb29d7a8c">TCP_I_CLOSED</a>);
<a name="l00614"></a>00614                     <span class="keywordflow">break</span>;
<a name="l00615"></a>00615                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00616"></a>00616                     <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
<a name="l00617"></a>00617                     <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
<a name="l00618"></a>00618                     <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
<a name="l00619"></a>00619                     <span class="keywordflow">break</span>;
<a name="l00620"></a>00620             }
<a name="l00621"></a>00621             <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba98ff9f82c08b1d7ae58049835c47368a">TCP_I_PEER_CLOSED</a>);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623         <span class="keywordflow">else</span>
<a name="l00624"></a>00624         {
<a name="l00625"></a>00625             <span class="comment">// we&apos;ll have to do it later (when an arriving segment &quot;fills the gap&quot;)</span>
<a name="l00626"></a>00626             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN segment above sequence, storing sequence number of FIN\n&quot;</span>;
<a name="l00627"></a>00627             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a32121c2fcf9d110150db1588cafa595a">fin_rcvd</a> = <span class="keyword">true</span>;
<a name="l00628"></a>00628             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a> = fin_seq;
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="comment">// TBD do PUSH stuff</span>
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keywordflow">if</span> (old_rcv_nxt!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
<a name="l00635"></a>00635     {
<a name="l00636"></a>00636         <span class="comment">// if rcv_nxt changed, either because we received segment text or we</span>
<a name="l00637"></a>00637         <span class="comment">// received a FIN that needs to be acked (or both), we need to send or</span>
<a name="l00638"></a>00638         <span class="comment">// schedule an ACK.</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00641"></a>00641         {
<a name="l00642"></a>00642             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a906163ab3363c8f66c60371e61e3fef6">getQueueLength</a>()!=0)
<a name="l00643"></a>00643             {
<a name="l00644"></a>00644                 <span class="comment">// RFC 2018, page 4:</span>
<a name="l00645"></a>00645                 <span class="comment">// &quot;If sent at all, SACK options SHOULD be included in all ACKs which do</span>
<a name="l00646"></a>00646                 <span class="comment">// not ACK the highest sequence number in the data receiver&apos;s queue.&quot;</span>
<a name="l00647"></a>00647                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00648"></a>00648                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00649"></a>00649                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> = <span class="keyword">true</span>;
<a name="l00650"></a>00650                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_SACK SET (rcv_nxt changed, but rexmitQ is not empty)\n&quot;</span>;
<a name="l00651"></a>00651                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>; <span class="comment">// although not mentioned in [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 861] seems like we have to set ack_now</span>
<a name="l00652"></a>00652             }
<a name="l00653"></a>00653         }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="comment">// tcpAlgorithm decides when and how to do ACKs</span>
<a name="l00656"></a>00656         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#abb6b842fa0651f13c99b30adebcc0e03">receiveSeqChanged</a>();
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="keywordflow">if</span> ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>) &amp;&amp;
<a name="l00660"></a>00660         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
<a name="l00661"></a>00661     {
<a name="l00662"></a>00662         <span class="comment">// if the user issued the CLOSE command a long time ago and we&apos;ve just</span>
<a name="l00663"></a>00663         <span class="comment">// managed to send off FIN, we simulate a CLOSE command now (we had to</span>
<a name="l00664"></a>00664         <span class="comment">// defer it at that time because we still had data in the send queue.)</span>
<a name="l00665"></a>00665         <span class="comment">// This CLOSE will take us into the FIN_WAIT_1 state.</span>
<a name="l00666"></a>00666         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
<a name="l00667"></a>00667         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp;
<a name="l00671"></a>00671         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1 &amp;&amp; old_snd_nxt!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>)
<a name="l00672"></a>00672     {
<a name="l00673"></a>00673         <span class="comment">// if we&apos;re in CLOSE_WAIT and we just got to sent our long-pending FIN,</span>
<a name="l00674"></a>00674         <span class="comment">// we simulate a CLOSE command now (we had to defer it at that time because</span>
<a name="l00675"></a>00675         <span class="comment">// we still had data in the send queue.) This CLOSE will take us into the</span>
<a name="l00676"></a>00676         <span class="comment">// LAST_ACK state.</span>
<a name="l00677"></a>00677         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
<a name="l00678"></a>00678         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="keywordflow">return</span> event;
<a name="l00682"></a>00682 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d034577df86997140d627feeda66a1f"></a><!-- doxytag: member="TCPConnection::processSegmentInListen" ref="a4d034577df86997140d627feeda66a1f" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegmentInListen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">686</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00687"></a>00687 {
<a name="l00688"></a>00688     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in LISTEN\n&quot;</span>;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="comment">//&quot;</span>
<a name="l00691"></a>00691     <span class="comment">// first check for an RST</span>
<a name="l00692"></a>00692     <span class="comment">//   An incoming RST should be ignored.  Return.</span>
<a name="l00693"></a>00693     <span class="comment">//&quot;</span>
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
<a name="l00697"></a>00697         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <span class="comment">//&quot;</span>
<a name="l00701"></a>00701     <span class="comment">// second check for an ACK</span>
<a name="l00702"></a>00702     <span class="comment">//    Any acknowledgment is bad if it arrives on a connection still in</span>
<a name="l00703"></a>00703     <span class="comment">//    the LISTEN state.  An acceptable reset segment should be formed</span>
<a name="l00704"></a>00704     <span class="comment">//    for any arriving ACK-bearing segment.  The RST should be</span>
<a name="l00705"></a>00705     <span class="comment">//    formatted as follows:</span>
<a name="l00706"></a>00706     <span class="comment">//</span>
<a name="l00707"></a>00707     <span class="comment">//      &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00708"></a>00708     <span class="comment">//</span>
<a name="l00709"></a>00709     <span class="comment">//    Return.</span>
<a name="l00710"></a>00710     <span class="comment">//&quot;</span>
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00712"></a>00712     {
<a name="l00713"></a>00713         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: dropping segment and sending RST\n&quot;</span>;
<a name="l00714"></a>00714         <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00715"></a>00715         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="comment">//&quot;</span>
<a name="l00719"></a>00719     <span class="comment">// third check for a SYN</span>
<a name="l00720"></a>00720     <span class="comment">//&quot;</span>
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00722"></a>00722     {
<a name="l00723"></a>00723         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00724"></a>00724         {
<a name="l00725"></a>00725             <span class="comment">// Looks like implementations vary on how to react to SYN+FIN.</span>
<a name="l00726"></a>00726             <span class="comment">// Some treat it as plain SYN (and reply with SYN+ACK), some send RST+ACK.</span>
<a name="l00727"></a>00727             <span class="comment">// Let&apos;s just do the former here.</span>
<a name="l00728"></a>00728             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: filling in foreign socket and sending SYN+ACK\n&quot;</span>;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         <span class="comment">//&quot;</span>
<a name="l00734"></a>00734         <span class="comment">// If the listen was not fully specified (i.e., the foreign socket was not</span>
<a name="l00735"></a>00735         <span class="comment">// fully specified), then the unspecified fields should be filled in now.</span>
<a name="l00736"></a>00736         <span class="comment">//&quot;</span>
<a name="l00737"></a>00737         <span class="comment">//</span>
<a name="l00738"></a>00738         <span class="comment">// Also, we may need to fork, in order to leave another connection</span>
<a name="l00739"></a>00739         <span class="comment">// LISTENing on the port. Note: forking will change our connId.</span>
<a name="l00740"></a>00740         <span class="comment">//</span>
<a name="l00741"></a>00741         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a>)
<a name="l00742"></a>00742         {
<a name="l00743"></a>00743             <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <a class="code" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a>(); <span class="comment">// &quot;conn&quot; is the clone which will stay LISTENing, while &quot;this&quot; gets updated with the remote address</span>
<a name="l00744"></a>00744             <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">addForkedConnection</a>(<span class="keyword">this</span>, conn, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00745"></a>00745             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection forked: this connection got new connId=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00746"></a>00746                 <span class="stringliteral">&quot;spinoff keeps LISTENing with connId=&quot;</span> &lt;&lt; conn-&gt;<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748         <span class="keywordflow">else</span>
<a name="l00749"></a>00749         {
<a name="l00750"></a>00750             <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <span class="comment">//&quot;</span>
<a name="l00754"></a>00754         <span class="comment">//  Set RCV.NXT to SEG.SEQ+1, IRS is set to SEG.SEQ and any other</span>
<a name="l00755"></a>00755         <span class="comment">//  control or text should be queued for processing later.  ISS</span>
<a name="l00756"></a>00756         <span class="comment">//  should be selected and a SYN segment sent of the form:</span>
<a name="l00757"></a>00757         <span class="comment">//</span>
<a name="l00758"></a>00758         <span class="comment">//    &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
<a name="l00759"></a>00759         <span class="comment">//</span>
<a name="l00760"></a>00760         <span class="comment">//  SND.NXT is set to ISS+1 and SND.UNA to ISS.  The connection</span>
<a name="l00761"></a>00761         <span class="comment">//  state should be changed to SYN-RECEIVED.</span>
<a name="l00762"></a>00762         <span class="comment">//&quot;</span>
<a name="l00763"></a>00763         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+1;
<a name="l00764"></a>00764         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>;
<a name="l00765"></a>00765         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>) <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
<a name="l00766"></a>00766         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00767"></a>00767         <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#aa830dbb0737de38e3a564aaa806ea99f">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);   <span class="comment">// FIXME may init twice...</span>
<a name="l00768"></a>00768         <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
<a name="l00769"></a>00769 
<a name="l00770"></a>00770         <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
<a name="l00771"></a>00771         <span class="comment">// initial snd_wnd from the segment here.</span>
<a name="l00772"></a>00772         <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg, <span class="keyword">true</span>);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &gt; <a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
<a name="l00775"></a>00775             <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;
<a name="l00778"></a>00778         <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
<a name="l00779"></a>00779         <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00780"></a>00780         <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>-&gt;isScheduled())
<a name="l00781"></a>00781             <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="comment">//&quot;</span>
<a name="l00784"></a>00784         <span class="comment">// Note that any other incoming control or data (combined with SYN)</span>
<a name="l00785"></a>00785         <span class="comment">// will be processed in the SYN-RECEIVED state, but processing of SYN</span>
<a name="l00786"></a>00786         <span class="comment">// and ACK should not be repeated.</span>
<a name="l00787"></a>00787         <span class="comment">//&quot;</span>
<a name="l00788"></a>00788         <span class="comment">// We don&apos;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
<a name="l00789"></a>00789         <span class="comment">// there isn&apos;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
<a name="l00790"></a>00790         <span class="comment">// so there&apos;s only URG and PSH left to handle.</span>
<a name="l00791"></a>00791         <span class="comment">//</span>
<a name="l00792"></a>00792         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00793"></a>00793         {
<a name="l00794"></a>00794             <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
<a name="l00795"></a>00795             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
<a name="l00796"></a>00796             {
<a name="l00797"></a>00797                 <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);
<a name="l00798"></a>00798             }
<a name="l00799"></a>00799             <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
<a name="l00800"></a>00800             {
<a name="l00801"></a>00801                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
<a name="l00802"></a>00802                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
<a name="l00803"></a>00803                     <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
<a name="l00806"></a>00806                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00807"></a>00807             }
<a name="l00808"></a>00808         }
<a name="l00809"></a>00809         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l00810"></a>00810             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>;  <span class="comment">// this will take us to SYN_RCVD</span>
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="comment">//&quot;</span>
<a name="l00816"></a>00816     <span class="comment">//  fourth other text or control</span>
<a name="l00817"></a>00817     <span class="comment">//   So you are unlikely to get here, but if you do, drop the segment, and return.</span>
<a name="l00818"></a>00818     <span class="comment">//&quot;</span>
<a name="l00819"></a>00819     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected segment: dropping it\n&quot;</span>;
<a name="l00820"></a>00820     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a12b903f9e148f5c26f926dcdc8107c86"></a><!-- doxytag: member="TCPConnection::processSegmentInSynSent" ref="a12b903f9e148f5c26f926dcdc8107c86" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegmentInSynSent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">823</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00824"></a>00824 {
<a name="l00825"></a>00825     <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in SYN_SENT\n&quot;</span>;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     <span class="comment">//&quot;</span>
<a name="l00828"></a>00828     <span class="comment">// first check the ACK bit</span>
<a name="l00829"></a>00829     <span class="comment">//</span>
<a name="l00830"></a>00830     <span class="comment">//   If the ACK bit is set</span>
<a name="l00831"></a>00831     <span class="comment">//</span>
<a name="l00832"></a>00832     <span class="comment">//     If SEG.ACK =&lt; ISS, or SEG.ACK &gt; SND.NXT, send a reset (unless</span>
<a name="l00833"></a>00833     <span class="comment">//     the RST bit is set, if so drop the segment and return)</span>
<a name="l00834"></a>00834     <span class="comment">//</span>
<a name="l00835"></a>00835     <span class="comment">//       &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00836"></a>00836     <span class="comment">//</span>
<a name="l00837"></a>00837     <span class="comment">//     and discard the segment.  Return.</span>
<a name="l00838"></a>00838     <span class="comment">//</span>
<a name="l00839"></a>00839     <span class="comment">//     If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then the ACK is acceptable.</span>
<a name="l00840"></a>00840     <span class="comment">//&quot;</span>
<a name="l00841"></a>00841     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00842"></a>00842     {
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>) || <a class="code" href="_t_c_p_connection_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>))
<a name="l00844"></a>00844         {
<a name="l00845"></a>00845             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set but wrong AckNo, sending RST\n&quot;</span>;
<a name="l00846"></a>00846             <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00847"></a>00847             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set, AckNo acceptable\n&quot;</span>;
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     <span class="comment">//&quot;</span>
<a name="l00853"></a>00853     <span class="comment">// second check the RST bit</span>
<a name="l00854"></a>00854     <span class="comment">//</span>
<a name="l00855"></a>00855     <span class="comment">//   If the RST bit is set</span>
<a name="l00856"></a>00856     <span class="comment">//</span>
<a name="l00857"></a>00857     <span class="comment">//     If the ACK was acceptable then signal the user &quot;error:</span>
<a name="l00858"></a>00858     <span class="comment">//     connection reset&quot;, drop the segment, enter CLOSED state,</span>
<a name="l00859"></a>00859     <span class="comment">//     delete TCB, and return.  Otherwise (no ACK) drop the segment</span>
<a name="l00860"></a>00860     <span class="comment">//     and return.</span>
<a name="l00861"></a>00861     <span class="comment">//&quot;</span>
<a name="l00862"></a>00862     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00863"></a>00863     {
<a name="l00864"></a>00864         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00865"></a>00865         {
<a name="l00866"></a>00866             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST+ACK: performing connection reset\n&quot;</span>;
<a name="l00867"></a>00867             <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba4e8f4551a34a27e607201754b36fdbe0">TCP_I_CONNECTION_RESET</a>);
<a name="l00868"></a>00868             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870         <span class="keywordflow">else</span>
<a name="l00871"></a>00871         {
<a name="l00872"></a>00872             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST without ACK: dropping segment\n&quot;</span>;
<a name="l00873"></a>00873             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="comment">//&quot;</span>
<a name="l00878"></a>00878     <span class="comment">// third check the security and precedence -- not done</span>
<a name="l00879"></a>00879     <span class="comment">//</span>
<a name="l00880"></a>00880     <span class="comment">// fourth check the SYN bit</span>
<a name="l00881"></a>00881     <span class="comment">//</span>
<a name="l00882"></a>00882     <span class="comment">//   This step should be reached only if the ACK is ok, or there is</span>
<a name="l00883"></a>00883     <span class="comment">//   no ACK, and it the segment did not contain a RST.</span>
<a name="l00884"></a>00884     <span class="comment">//</span>
<a name="l00885"></a>00885     <span class="comment">//   If the SYN bit is on and the security/compartment and precedence</span>
<a name="l00886"></a>00886     <span class="comment">//   are acceptable then,</span>
<a name="l00887"></a>00887     <span class="comment">//&quot;</span>
<a name="l00888"></a>00888     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>())
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890         <span class="comment">//</span>
<a name="l00891"></a>00891         <span class="comment">//   RCV.NXT is set to SEG.SEQ+1, IRS is set to</span>
<a name="l00892"></a>00892         <span class="comment">//   SEG.SEQ.  SND.UNA should be advanced to equal SEG.ACK (if there</span>
<a name="l00893"></a>00893         <span class="comment">//   is an ACK), and any segments on the retransmission queue which</span>
<a name="l00894"></a>00894         <span class="comment">//   are thereby acknowledged should be removed.</span>
<a name="l00895"></a>00895         <span class="comment">//</span>
<a name="l00896"></a>00896         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()+1;
<a name="l00897"></a>00897         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>;
<a name="l00898"></a>00898         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>) <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
<a name="l00899"></a>00899         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l00900"></a>00900         <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#aa830dbb0737de38e3a564aaa806ea99f">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00901"></a>00901 
<a name="l00902"></a>00902         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00903"></a>00903         {
<a name="l00904"></a>00904             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l00905"></a>00905             <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00906"></a>00906             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00907"></a>00907                 <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00908"></a>00908 
<a name="l00909"></a>00909             <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
<a name="l00910"></a>00910             <span class="comment">// initial snd_wnd from the segment here.</span>
<a name="l00911"></a>00911             <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg, <span class="keyword">true</span>);
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="comment">// this also seems to be a good time to learn our local IP address</span>
<a name="l00915"></a>00915         <span class="comment">// (was probably unspecified at connection open)</span>
<a name="l00916"></a>00916         <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         <span class="comment">//&quot;</span>
<a name="l00919"></a>00919         <span class="comment">//   If SND.UNA &gt; ISS (our SYN has been ACKed), change the connection</span>
<a name="l00920"></a>00920         <span class="comment">//   state to ESTABLISHED, form an ACK segment</span>
<a name="l00921"></a>00921         <span class="comment">//</span>
<a name="l00922"></a>00922         <span class="comment">//     &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
<a name="l00923"></a>00923         <span class="comment">//</span>
<a name="l00924"></a>00924         <span class="comment">//   and send it.  Data or controls which were queued for</span>
<a name="l00925"></a>00925         <span class="comment">//   transmission may be included.  If there are other controls or</span>
<a name="l00926"></a>00926         <span class="comment">//   text in the segment then continue processing at the sixth step</span>
<a name="l00927"></a>00927         <span class="comment">//   below where the URG bit is checked, otherwise return.</span>
<a name="l00928"></a>00928         <span class="comment">//&quot;</span>
<a name="l00929"></a>00929         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>))
<a name="l00930"></a>00930         {
<a name="l00931"></a>00931             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK bits set, connection established.\n&quot;</span>;
<a name="l00932"></a>00932 
<a name="l00933"></a>00933             <span class="comment">// RFC says &quot;continue processing at the sixth step below where</span>
<a name="l00934"></a>00934             <span class="comment">// the URG bit is checked&quot;. Those steps deal with: URG, segment text</span>
<a name="l00935"></a>00935             <span class="comment">// (and PSH), and FIN.</span>
<a name="l00936"></a>00936             <span class="comment">// Now: URG and PSH we don&apos;t support yet; in SYN+FIN we ignore FIN;</span>
<a name="l00937"></a>00937             <span class="comment">// with segment text we just take it easy and put it in the receiveQueue</span>
<a name="l00938"></a>00938             <span class="comment">// -- we&apos;ll forward it to the user when more data arrives.</span>
<a name="l00939"></a>00939             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00940"></a>00940                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00941"></a>00941             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00942"></a>00942             {
<a name="l00943"></a>00943                 <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
<a name="l00944"></a>00944                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
<a name="l00945"></a>00945                 {
<a name="l00946"></a>00946                     <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);  <span class="comment">// TBD forward to app, etc.</span>
<a name="l00947"></a>00947                 }
<a name="l00948"></a>00948                 <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
<a name="l00949"></a>00949                 {
<a name="l00950"></a>00950                     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
<a name="l00951"></a>00951                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
<a name="l00952"></a>00952                         <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
<a name="l00955"></a>00955                     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957             }
<a name="l00958"></a>00958             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l00959"></a>00959                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN+ACK\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l00960"></a>00960 
<a name="l00961"></a>00961             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &gt; <a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
<a name="l00962"></a>00962                 <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);
<a name="l00963"></a>00963 
<a name="l00964"></a>00964             <span class="comment">// notify tcpAlgorithm (it has to send ACK of SYN) and app layer</span>
<a name="l00965"></a>00965             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;
<a name="l00966"></a>00966             <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a2d051b6a9e2a9fccfa6f8b64bb8c647d">established</a>(<span class="keyword">true</span>);
<a name="l00967"></a>00967             <a class="code" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();
<a name="l00968"></a>00968 
<a name="l00969"></a>00969             <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
<a name="l00970"></a>00970             <span class="comment">// app will be taken care of in stateEntered().</span>
<a name="l00971"></a>00971             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>;
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974         <span class="comment">//&quot;</span>
<a name="l00975"></a>00975         <span class="comment">//   Otherwise enter SYN-RECEIVED, form a SYN,ACK segment</span>
<a name="l00976"></a>00976         <span class="comment">//</span>
<a name="l00977"></a>00977         <span class="comment">//     &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
<a name="l00978"></a>00978         <span class="comment">//</span>
<a name="l00979"></a>00979         <span class="comment">//   and send it.  If there are other controls or text in the</span>
<a name="l00980"></a>00980         <span class="comment">//   segment, queue them for processing after the ESTABLISHED state</span>
<a name="l00981"></a>00981         <span class="comment">//   has been reached, return.</span>
<a name="l00982"></a>00982         <span class="comment">//&quot;</span>
<a name="l00983"></a>00983         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: sending SYN+ACK\n&quot;</span>;
<a name="l00984"></a>00984         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>;
<a name="l00985"></a>00985         <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
<a name="l00986"></a>00986         <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
<a name="l00987"></a>00987 
<a name="l00988"></a>00988         <span class="comment">// Note: code below is similar to processing SYN in LISTEN.</span>
<a name="l00989"></a>00989 
<a name="l00990"></a>00990         <span class="comment">// For consistency with that code, we ignore SYN+FIN here</span>
<a name="l00991"></a>00991         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aa7615b353254cbd11ea14f03e80c55f6">getFinBit</a>())
<a name="l00992"></a>00992             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         <span class="comment">// We don&apos;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
<a name="l00995"></a>00995         <span class="comment">// there isn&apos;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
<a name="l00996"></a>00996         <span class="comment">// so there&apos;s only URG and PSH left to handle.</span>
<a name="l00997"></a>00997         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()&gt;0)
<a name="l00998"></a>00998         {
<a name="l00999"></a>00999             <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
<a name="l01000"></a>01000             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
<a name="l01001"></a>01001             {
<a name="l01002"></a>01002                 <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);  <span class="comment">// TBD forward to app, etc.</span>
<a name="l01003"></a>01003             }
<a name="l01004"></a>01004             <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
<a name="l01005"></a>01005             {
<a name="l01006"></a>01006                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
<a name="l01007"></a>01007                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
<a name="l01008"></a>01008                     <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
<a name="l01011"></a>01011                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l01012"></a>01012             }
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a31028187ac8cf1f844d389b0e56baf8b">getUrgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a951517b397bea146bb642976521469d7">getPshBit</a>())
<a name="l01015"></a>01015             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>
<a name="l01016"></a>01016 
<a name="l01017"></a>01017         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>;
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019 
<a name="l01020"></a>01020     <span class="comment">//&quot;</span>
<a name="l01021"></a>01021     <span class="comment">// fifth, if neither of the SYN or RST bits is set then drop the</span>
<a name="l01022"></a>01022     <span class="comment">// segment and return.</span>
<a name="l01023"></a>01023     <span class="comment">//&quot;</span>
<a name="l01024"></a>01024     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l01025"></a>01025 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7f5f8ddb99114615c77fe0ccf16424e7"></a><!-- doxytag: member="TCPConnection::processTCPSegment" ref="a7f5f8ddb99114615c77fe0ccf16424e7" args="(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTCPSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpSeg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>destAddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">302</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00083">TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00303"></a>00303 {
<a name="l00304"></a>00304     <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00305"></a>00305     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00306"></a>00306     {
<a name="l00307"></a>00307         ASSERT(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>==segDestAddr);
<a name="l00308"></a>00308         ASSERT(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>==tcpseg-&gt;getDestPort());
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312         ASSERT(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>==segSrcAddr);
<a name="l00313"></a>00313         ASSERT(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>==tcpseg-&gt;getSrcPort());
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a>(tcpseg))
<a name="l00317"></a>00317         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// first do actions</span>
<a name="l00320"></a>00320     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a>(tcpseg, segSrcAddr, segDestAddr);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">// then state transitions</span>
<a name="l00323"></a>00323     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00324"></a>00324 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f9e1e7a0cabaf710f2d37a19eea0caf"></a><!-- doxytag: member="TCPConnection::processTimer" ref="a6f9e1e7a0cabaf710f2d37a19eea0caf" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTimer </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process self-messages (timers). Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">265</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00083">TCP::handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
<a name="l00268"></a>00268     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; timer expired\n&quot;</span>;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <span class="comment">// first do actions</span>
<a name="l00271"></a>00271     <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)
<a name="l00273"></a>00273     {
<a name="l00274"></a>00274         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>;
<a name="l00275"></a>00275         <a class="code" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a>();
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>)
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>;
<a name="l00280"></a>00280         <a class="code" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a>();
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>;
<a name="l00285"></a>00285         <a class="code" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a>();
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>)
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00290"></a>00290         <a class="code" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a>(event);
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292     <span class="keywordflow">else</span>
<a name="l00293"></a>00293     {
<a name="l00294"></a>00294         <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
<a name="l00295"></a>00295         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#afa586de40374ffd9830981fff79cf96c">processTimer</a>(msg, event);
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="comment">// then state transitions</span>
<a name="l00299"></a>00299     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a8bf987d5f32ecff2b85ba0f635f019"></a><!-- doxytag: member="TCPConnection::readHeaderOptions" ref="a9a8bf987d5f32ecff2b85ba0f635f019" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::readHeaderOptions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: readHeaderOptions (Currently only EOL, NOP, MSS, SACK_PERMITTED and SACK are implemented) </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00747">747</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00748"></a>00748 {
<a name="l00749"></a>00749     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option(s) received:\n&quot;</span>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>(); i++)
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753         <span class="keyword">const</span> <a class="code" href="class_t_c_p_option.html">TCPOption</a>&amp; option = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2358acbf0a5fdc1b7b27fd972087dca0">getOptions</a>(i);
<a name="l00754"></a>00754         <span class="keywordtype">short</span> kind = option.<a class="code" href="class_t_c_p_option.html#a6238dc83030805e805f4bf1408ea07c9">getKind</a>();
<a name="l00755"></a>00755         <span class="keywordtype">short</span> length = option.<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>();
<a name="l00756"></a>00756         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Option type &quot;</span> &lt;&lt; kind &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ad7429706bcb29990ebfc65ff24970faa">optionName</a>(kind) &lt;&lt; <span class="stringliteral">&quot;), length &quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00757"></a>00757         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00758"></a>00758         <span class="keywordflow">switch</span>(kind)
<a name="l00759"></a>00759         {
<a name="l00760"></a>00760             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a4ae49568e5542f0b26db05424e61bd37">TCPOPTION_END_OF_OPTION_LIST</a>: <span class="comment">// EOL=0</span>
<a name="l00761"></a>00761             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a3815105fc6965c050aceeac9863abbcb">TCPOPTION_NO_OPERATION</a>: <span class="comment">// NOP=1</span>
<a name="l00762"></a>00762                 <span class="keywordflow">if</span> (length != 1)
<a name="l00763"></a>00763                 {
<a name="l00764"></a>00764                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
<a name="l00765"></a>00765                     ok = <span class="keyword">false</span>;
<a name="l00766"></a>00766                 }
<a name="l00767"></a>00767                 <span class="keywordflow">break</span>;
<a name="l00768"></a>00768             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a2284ab19f96a9994ca8082801c427119">TCPOPTION_MAXIMUM_SEGMENT_SIZE</a>: <span class="comment">// MSS=2</span>
<a name="l00769"></a>00769                 ok = <a class="code" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption</a>(tcpseg, option);
<a name="l00770"></a>00770                 <span class="keywordflow">break</span>;
<a name="l00771"></a>00771             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0ab2a60921ef5e80121ed52f6603897d91">TCPOPTION_SACK_PERMITTED</a>: <span class="comment">// SACK_PERMITTED=4</span>
<a name="l00772"></a>00772                 ok = <a class="code" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption</a>(tcpseg, option);
<a name="l00773"></a>00773                 <span class="keywordflow">break</span>;
<a name="l00774"></a>00774             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a9c8c6796fa51976bab9885c5744fa49c">TCPOPTION_SACK</a>: <span class="comment">// SACK=5</span>
<a name="l00775"></a>00775                 ok = <a class="code" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption</a>(tcpseg, option);
<a name="l00776"></a>00776                 <span class="keywordflow">break</span>;
<a name="l00777"></a>00777             <span class="comment">// TODO add new TCPOptions here once they are implemented</span>
<a name="l00778"></a>00778             <span class="comment">// TODO delegate to TCPAlgorithm as well -- it may want to recognized additional options</span>
<a name="l00779"></a>00779             <span class="keywordflow">default</span>:
<a name="l00780"></a>00780                 <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Unsupported TCP option kind &quot;</span> &lt;&lt; kind &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00781"></a>00781                 <span class="keywordflow">break</span>;
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783         (void)ok; <span class="comment">// unused</span>
<a name="l00784"></a>00784     }
<a name="l00785"></a>00785 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2c57b0ff79eb111ca6840b8d7003b04"></a><!-- doxytag: member="TCPConnection::retransmitData" ref="ab2c57b0ff79eb111ca6840b8d7003b04" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitData </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit all from snd_una to snd_max </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00725">725</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00064">DumbTCP::processTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00726"></a>00726 {
<a name="l00727"></a>00727     <span class="comment">// retransmit everything from snd_una</span>
<a name="l00728"></a>00728     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytesToSend = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l00731"></a>00731     ASSERT(bytesToSend!=0);
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="comment">// TBD - avoid to send more than allowed - check cwnd and rwnd before retransmitting data!</span>
<a name="l00734"></a>00734     <span class="keywordflow">while</span> (bytesToSend&gt;0)
<a name="l00735"></a>00735     {
<a name="l00736"></a>00736         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, (<a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>)<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00737"></a>00737         bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytes, <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>));
<a name="l00738"></a>00738         <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00739"></a>00739         <span class="comment">// Do not send packets after the FIN.</span>
<a name="l00740"></a>00740         <span class="comment">// fixes bug that occurs in examples/inet/bulktransfer at event #64043  T=13.861159213744</span>
<a name="l00741"></a>00741         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
<a name="l00742"></a>00742             <span class="keywordflow">break</span>;
<a name="l00743"></a>00743         bytesToSend -= bytes;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a15eda66a013f23ebc129adcea81a68b4"></a><!-- doxytag: member="TCPConnection::retransmitOneSegment" ref="a15eda66a013f23ebc129adcea81a68b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitOneSegment </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit one segment from snd_una </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00702">702</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_tahoe_8cc_source.html#l00041">TCPTahoe::processRexmitTimer()</a>, <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00052">TCPReno::processRexmitTimer()</a>, <a class="el" href="flavours_2_t_c_p_no_congestion_control_8cc_source.html#l00036">TCPNoCongestionControl::processRexmitTimer()</a>, <a class="el" href="_t_c_p_new_reno_8cc_source.html#l00051">TCPNewReno::processRexmitTimer()</a>, <a class="el" href="_t_c_p_new_reno_8cc_source.html#l00093">TCPNewReno::receivedDataAck()</a>, <a class="el" href="flavours_2_t_c_p_tahoe_8cc_source.html#l00111">TCPTahoe::receivedDuplicateAck()</a>, <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00195">TCPReno::receivedDuplicateAck()</a>, and <a class="el" href="_t_c_p_new_reno_8cc_source.html#l00257">TCPNewReno::receivedDuplicateAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00703"></a>00703 {
<a name="l00704"></a>00704     <span class="comment">// retransmit one segment at snd_una, and set snd_nxt accordingly</span>
<a name="l00705"></a>00705     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00708"></a>00708     ASSERT(bytes!=0);
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="comment">// notify</span>
<a name="l00713"></a>00713     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00716"></a>00716     {
<a name="l00717"></a>00717         <span class="comment">// RFC 3517, page 7: &quot;(3) Retransmit the first data segment presumed dropped -- the segment</span>
<a name="l00718"></a>00718         <span class="comment">// starting with sequence number HighACK + 1.  To prevent repeated</span>
<a name="l00719"></a>00719         <span class="comment">// retransmission of the same data, set HighRxt to the highest</span>
<a name="l00720"></a>00720         <span class="comment">// sequence number in the retransmitted segment.&quot;</span>
<a name="l00721"></a>00721         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60c9fb67af21fc9c1cee62369a8a1486"></a><!-- doxytag: member="TCPConnection::scheduleTimeout" ref="a60c9fb67af21fc9c1cee62369a8a1486" args="(cMessage *msg, simtime_t timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::scheduleTimeout </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start a timer </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00489">489</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00115">DumbTCP::dataSent()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00304">TCPBaseAlg::processPersistTimer()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00227">TCPBaseAlg::processRexmitTimer()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00064">DumbTCP::processTimer()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00474">TCPBaseAlg::receivedDataAck()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00436">TCPBaseAlg::receiveSeqChanged()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00351">TCPBaseAlg::startRexmitTimer()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01244">startSynRexmitTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00490"></a>00490         {<a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;scheduleAt(simTime()+timeout, msg);}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82f6b7680530f0f784e9d8efa78fa5a5"></a><!-- doxytag: member="TCPConnection::segmentArrivalWhileClosed" ref="a82f6b7680530f0f784e9d8efa78fa5a5" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::segmentArrivalWhileClosed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This method gets invoked from <a class="el" href="class_t_c_p.html">TCP</a> when a segment arrives which doesn't belong to an existing connection. <a class="el" href="class_t_c_p.html">TCP</a> creates a temporary connection object so that it can call this method, then immediately deletes it. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00037">37</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00174">TCP::segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
<a name="l00040"></a>00040     <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="comment">// This segment doesn&apos;t belong to any connection, so this object</span>
<a name="l00043"></a>00043     <span class="comment">// must be a temp object created solely for the purpose of calling us</span>
<a name="l00044"></a>00044     ASSERT(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>==NULL);
<a name="l00045"></a>00045     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment doesn&apos;t belong to any existing connection\n&quot;</span>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="comment">// RFC 793:</span>
<a name="l00048"></a>00048     <span class="comment">//&quot;</span>
<a name="l00049"></a>00049     <span class="comment">// all data in the incoming segment is discarded.  An incoming</span>
<a name="l00050"></a>00050     <span class="comment">// segment containing a RST is discarded.  An incoming segment not</span>
<a name="l00051"></a>00051     <span class="comment">// containing a RST causes a RST to be sent in response.  The</span>
<a name="l00052"></a>00052     <span class="comment">// acknowledgment and sequence field values are selected to make the</span>
<a name="l00053"></a>00053     <span class="comment">// reset sequence acceptable to the TCP that sent the offending</span>
<a name="l00054"></a>00054     <span class="comment">// segment.</span>
<a name="l00055"></a>00055     <span class="comment">//</span>
<a name="l00056"></a>00056     <span class="comment">// If the ACK bit is off, sequence number zero is used,</span>
<a name="l00057"></a>00057     <span class="comment">//</span>
<a name="l00058"></a>00058     <span class="comment">//    &lt;SEQ=0&gt;&lt;ACK=SEG.SEQ+SEG.LEN&gt;&lt;CTL=RST,ACK&gt;</span>
<a name="l00059"></a>00059     <span class="comment">//</span>
<a name="l00060"></a>00060     <span class="comment">// If the ACK bit is on,</span>
<a name="l00061"></a>00061     <span class="comment">//</span>
<a name="l00062"></a>00062     <span class="comment">//    &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
<a name="l00063"></a>00063     <span class="comment">//&quot;</span>
<a name="l00064"></a>00064     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a606da99a84d95c74bb1626436b6e5e12">getRstBit</a>())
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
<a name="l00067"></a>00067         <span class="keywordflow">return</span>;
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>())
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit not set: sending RST+ACK\n&quot;</span>;
<a name="l00073"></a>00073         uint32 ackNo = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>() + (uint32)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>();
<a name="l00074"></a>00074         <a class="code" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a>(0,ackNo,destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordflow">else</span>
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: sending RST\n&quot;</span>;
<a name="l00079"></a>00079         <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9120715e275fdb4745fa15b300236d9a">getDestPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aca825ab6ff9fc98f52315c36254a66be">getSrcPort</a>());
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a585bbcdd70565eb01b6bfe17a1487c78"></a><!-- doxytag: member="TCPConnection::selectInitialSeqNum" ref="a585bbcdd70565eb01b6bfe17a1487c78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::selectInitialSeqNum </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: generates ISS and initializes corresponding state variables </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00363">363</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00364"></a>00364 {
<a name="l00365"></a>00365     <span class="comment">// set the initial send sequence number</span>
<a name="l00366"></a>00366     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a> = (<span class="keywordtype">unsigned</span> long)fmod(SIMTIME_DBL(simTime())*250000.0, 1.0+(double)(<span class="keywordtype">unsigned</span>)0xffffffffUL) &amp; 0xffffffffUL;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3a426364a7ced17955eb6cc3b3cfac2d">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1); <span class="comment">// +1 is for SYN</span>
<a name="l00371"></a>00371     <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a342033845eaaf7a565c82fb70718ca0e">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a> + 1); <span class="comment">// +1 is for SYN</span>
<a name="l00372"></a>00372 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a60ee5bc5b391d621e7e684857e195151"></a><!-- doxytag: member="TCPConnection::sendAck" ref="a60ee5bc5b391d621e7e684857e195151" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendAck </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send ACK </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">482</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00148">TCPBaseAlg::established()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00048">DumbTCP::established()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00329">TCPBaseAlg::processDelayedAckTimer()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00583">TCPBaseAlg::receivedAckForDataNotYetSent()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00105">DumbTCP::receivedAckForDataNotYetSent()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00429">TCPBaseAlg::receivedOutOfOrderSegment()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00079">DumbTCP::receivedOutOfOrderSegment()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00436">TCPBaseAlg::receiveSeqChanged()</a>, and <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00085">DumbTCP::receiveSeqChanged()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00483"></a>00483 {
<a name="l00484"></a>00484     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;ACK&quot;</span>);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00487"></a>00487     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00488"></a>00488     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00489"></a>00489     <a class="code" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a>();
<a name="l00490"></a>00490     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00491"></a>00491     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
<a name="l00492"></a>00492         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="comment">// write header options</span>
<a name="l00495"></a>00495     <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">// send it</span>
<a name="l00498"></a>00498     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">// notify</span>
<a name="l00501"></a>00501     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l00502"></a>00502 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0238c323366884c6598d7d92d21f69ab"></a><!-- doxytag: member="TCPConnection::sendData" ref="a0238c323366884c6598d7d92d21f69ab" args="(bool fullSegmentsOnly, uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendData </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>congestionWindow</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: Send data from sendQueue, at most congestionWindow. If fullSegmentsOnly is set, don't send segments smaller than SMSS (needed for Nagle). Returns true if some data was actually sent. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">572</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00048">DumbTCP::established()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00093">DumbTCP::receivedDataAck()</a>, <a class="el" href="flavours_2_dumb_t_c_p_8cc_source.html#l00073">DumbTCP::sendCommandInvoked()</a>, and <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00400">TCPBaseAlg::sendData()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00573"></a>00573 {
<a name="l00574"></a>00574     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
<a name="l00575"></a>00575         {
<a name="l00576"></a>00576         <span class="comment">// we&apos;ll start sending from snd_max</span>
<a name="l00577"></a>00577         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     uint32 old_highRxt = 0;
<a name="l00581"></a>00581     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00582"></a>00582         old_highRxt = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     <span class="comment">// check how many bytes we have</span>
<a name="l00585"></a>00585     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00586"></a>00586     <span class="keywordflow">if</span> (buffered==0)
<a name="l00587"></a>00587         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">// maxWindow is minimum of snd_wnd and congestionWindow (snd_cwnd)</span>
<a name="l00590"></a>00590     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> maxWindow = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>, congestionWindow);
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="comment">// effectiveWindow: number of bytes we&apos;re allowed to send now</span>
<a name="l00593"></a>00593     <span class="keywordtype">long</span> effectiveWin = maxWindow - (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00594"></a>00594     <span class="keywordflow">if</span> (effectiveWin &lt;= 0)
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Effective window is zero (advertised window &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> &lt;&lt;
<a name="l00597"></a>00597             <span class="stringliteral">&quot;, congestion window &quot;</span> &lt;&lt; congestionWindow &lt;&lt; <span class="stringliteral">&quot;), cannot send.\n&quot;</span>;
<a name="l00598"></a>00598         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytesToSend = effectiveWin;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (bytesToSend &gt; buffered)
<a name="l00604"></a>00604         bytesToSend = buffered;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (fullSegmentsOnly &amp;&amp; bytesToSend &lt; state-&gt;snd_mss &amp;&amp; buffered &gt; (<a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) effectiveWin) <span class="comment">// last segment could be less then state-&gt;snd_mss</span>
<a name="l00607"></a>00607     {
<a name="l00608"></a>00608         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send, not enough data for a full segment (SMSS=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>
<a name="l00609"></a>00609             &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00610"></a>00610         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="comment">// start sending &apos;bytesToSend&apos; bytes</span>
<a name="l00614"></a>00614     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Will send &quot;</span> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes (effectiveWindow &quot;</span> &lt;&lt; effectiveWin
<a name="l00615"></a>00615         &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot; bytes)\n&quot;</span>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l00618"></a>00618     ASSERT(bytesToSend&gt;0);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 <span class="preprocessor">#ifdef TCP_SENDFRAGMENTS  </span><span class="comment">/* normally undefined */</span>
<a name="l00621"></a>00621     <span class="comment">// make agressive use of the window until the last byte</span>
<a name="l00622"></a>00622     <span class="keywordflow">while</span> (bytesToSend&gt;0)
<a name="l00623"></a>00623     {
<a name="l00624"></a>00624         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00625"></a>00625         <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l00626"></a>00626         bytesToSend -= bytes;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 <span class="preprocessor">#else</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>    <span class="comment">// send &lt;MSS segments only if it&apos;s the only segment we can send now</span>
<a name="l00630"></a>00630     <span class="comment">// FIXME this should probably obey Nagle&apos;s alg -- to be checked</span>
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (bytesToSend &lt;= state-&gt;snd_mss)
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633         <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     <span class="keywordflow">else</span>
<a name="l00636"></a>00636     {
<a name="l00637"></a>00637         <span class="comment">// send whole segments only (nagle_enabled)</span>
<a name="l00638"></a>00638         <span class="keywordflow">while</span> (bytesToSend&gt;=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
<a name="l00639"></a>00639         {
<a name="l00640"></a>00640             <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00641"></a>00641             bytesToSend -= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643         <span class="comment">// check how many bytes we have - last segment could be less then state-&gt;snd_mss</span>
<a name="l00644"></a>00644         buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00645"></a>00645         <span class="keywordflow">if</span> (bytesToSend==buffered &amp;&amp; buffered!=0) <span class="comment">// last segment?</span>
<a name="l00646"></a>00646             <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
<a name="l00647"></a>00647         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesToSend&gt;0)
<a name="l00648"></a>00648             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes of space left in effectiveWindow\n&quot;</span>;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 <span class="preprocessor">#endif</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>
<a name="l00652"></a>00652     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
<a name="l00653"></a>00653     <span class="comment">// but we&apos;ll need snd_max to check validity of ACKs -- they must ack</span>
<a name="l00654"></a>00654     <span class="comment">// something we really sent)</span>
<a name="l00655"></a>00655     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="_s_c_t_p_association_8h.html#afdb84bd44c7cbd3fc9cbe1e3bf07d948">std::max</a> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
<a name="l00656"></a>00656     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="comment">// notify (once is enough)</span>
<a name="l00659"></a>00659     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a> &amp;&amp; old_highRxt != <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>)
<a name="l00661"></a>00661     {
<a name="l00662"></a>00662         <span class="comment">// Note: Restart of REXMIT timer on retransmission is not part of RFC 2581, however optional in RFC 3517 if sent during recovery.</span>
<a name="l00663"></a>00663         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission sent during recovery, restarting REXMIT timer.\n&quot;</span>;
<a name="l00664"></a>00664         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666     <span class="keywordflow">else</span> <span class="comment">// don&apos;t measure RTT for retransmitted packets</span>
<a name="l00667"></a>00667         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00670"></a>00670 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4fb6aaf244a5da2eaa02af271099a06b"></a><!-- doxytag: member="TCPConnection::sendDataDuringLossRecoveryPhase" ref="a4fb6aaf244a5da2eaa02af271099a06b" args="(uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendDataDuringLossRecoveryPhase </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>congestionWindow</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send data during Loss Recovery phase (if SACK is enabled). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01569">1569</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00083">TCPReno::receivedDataAck()</a>, and <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00195">TCPReno::receivedDuplicateAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01570"></a>01570 {
<a name="l01571"></a>01571     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a>);
<a name="l01572"></a>01572     <span class="comment">// RFC 3517 pages 7 and 8: &quot;(5) In order to take advantage of potential additional available</span>
<a name="l01573"></a>01573     <span class="comment">// cwnd, proceed to step (C) below.</span>
<a name="l01574"></a>01574     <span class="comment">// (...)</span>
<a name="l01575"></a>01575     <span class="comment">// (C) If cwnd - pipe &gt;= 1 SMSS the sender SHOULD transmit one or more</span>
<a name="l01576"></a>01576     <span class="comment">// segments as follows:</span>
<a name="l01577"></a>01577     <span class="comment">// (...)</span>
<a name="l01578"></a>01578     <span class="comment">// (C.5) If cwnd - pipe &gt;= 1 SMSS, return to (C.1)&quot;</span>
<a name="l01579"></a>01579     <span class="keywordflow">while</span> (((<span class="keywordtype">int</span>)congestionWindow - (<span class="keywordtype">int</span>)<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>) &gt;= (<span class="keywordtype">int</span>)<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// Note: Typecast needed to avoid prohibited transmissions</span>
<a name="l01580"></a>01580     {
<a name="l01581"></a>01581         <span class="comment">// RFC 3517 pages 7 and 8: &quot;(C.1) The scoreboard MUST be queried via NextSeg () for the</span>
<a name="l01582"></a>01582         <span class="comment">// sequence number range of the next segment to transmit (if any),</span>
<a name="l01583"></a>01583         <span class="comment">// and the given segment sent.  If NextSeg () returns failure (no</span>
<a name="l01584"></a>01584         <span class="comment">// data to send) return without sending anything (i.e., terminate</span>
<a name="l01585"></a>01585         <span class="comment">// steps C.1 -- C.5).&quot;</span>
<a name="l01586"></a>01586         uint32 seqNum = <a class="code" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg</a>(); <span class="comment">// if nextSeg() returns 0 (=failure): terminate steps C.1 -- C.5</span>
<a name="l01587"></a>01587         <span class="keywordflow">if</span> (seqNum != 0)
<a name="l01588"></a>01588         {
<a name="l01589"></a>01589             <a class="code" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase</a>(seqNum);
<a name="l01590"></a>01590             <span class="comment">// RFC 3517 page 8: &quot;(C.4) The estimate of the amount of data outstanding in the</span>
<a name="l01591"></a>01591             <span class="comment">// network must be updated by incrementing pipe by the number of</span>
<a name="l01592"></a>01592             <span class="comment">// octets transmitted in (C.1).&quot;</span>
<a name="l01593"></a>01593             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
<a name="l01594"></a>01594         }
<a name="l01595"></a>01595         <span class="keywordflow">else</span> <span class="comment">// nextSeg () returns failure: terminate steps C.1 -- C.5</span>
<a name="l01596"></a>01596             <span class="keywordflow">break</span>;
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab04a91abde05d21293c30a78ab968eef"></a><!-- doxytag: member="TCPConnection::sendEstabIndicationToApp" ref="ab04a91abde05d21293c30a78ab968eef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendEstabIndicationToApp </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends TCP_I_ESTABLISHED indication with <a class="el" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> to application </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">281</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00284"></a>00284     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>));
<a name="l00285"></a>00285     msg-&gt;setKind(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba778d635f284e560631e2b6ce594e3323">TCP_I_ESTABLISHED</a>);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a>();
<a name="l00288"></a>00288     ind-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
<a name="l00289"></a>00289     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#acc0fe754ff51cf7adb6987197ce84113">setLocalAddr</a>(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>);
<a name="l00290"></a>00290     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a520c2434de5accebe56bb77c8aadd100">setRemoteAddr</a>(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>);
<a name="l00291"></a>00291     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#aae1dc0aaa74c6cd2ff8519c65713b6c1">setLocalPort</a>(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
<a name="l00292"></a>00292     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a14416c97565e1f500549bce0d64f3563">setRemotePort</a>(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     msg-&gt;setControlInfo(ind);
<a name="l00295"></a>00295     <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
<a name="l00296"></a>00296 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70acf513d8461c73bfd06037036b1682"></a><!-- doxytag: member="TCPConnection::sendFin" ref="a70acf513d8461c73bfd06037036b1682" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendFin </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends FIN </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">504</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00505"></a>00505 {
<a name="l00506"></a>00506     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;FIN&quot;</span>);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="comment">// Note: ACK bit *must* be set for both FIN and FIN+ACK. What makes</span>
<a name="l00509"></a>00509     <span class="comment">// the difference for FIN+ACK is that its ackNo acks the remote TCP&apos;s FIN.</span>
<a name="l00510"></a>00510     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a626c808550da11fa9ea1bdce32409784">setFinBit</a>(<span class="keyword">true</span>);
<a name="l00511"></a>00511     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00512"></a>00512     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00513"></a>00513     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00514"></a>00514     <a class="code" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a>();
<a name="l00515"></a>00515     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
<a name="l00517"></a>00517         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="comment">// send it</span>
<a name="l00520"></a>00520     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <span class="comment">// notify</span>
<a name="l00523"></a>00523     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l00524"></a>00524 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65a8dc93c08a685f145248d0fb327428"></a><!-- doxytag: member="TCPConnection::sendIndicationToApp" ref="a65a8dc93c08a685f145248d0fb327428" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendIndicationToApp </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>code</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends status indication (TCP_I_xxx) to application </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00270">270</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01189">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01229">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01027">processRstInSynReceived()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00265">signalConnectionTimeout()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00273"></a>00273     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code));
<a name="l00274"></a>00274     msg-&gt;setKind(code);
<a name="l00275"></a>00275     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
<a name="l00276"></a>00276     ind-&gt;<a class="code" href="class_t_c_p_command.html#a2688defdcadd3de43faae9c27748be24">setConnId</a>(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
<a name="l00277"></a>00277     msg-&gt;setControlInfo(ind);
<a name="l00278"></a>00278     <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
<a name="l00279"></a>00279 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a35768c6517e5f25424a13d1e80892b32"></a><!-- doxytag: member="TCPConnection::sendOneNewSegment" ref="a35768c6517e5f25424a13d1e80892b32" args="(bool fullSegmentsOnly, uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendOneNewSegment </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>congestionWindow</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send one new segment from snd_max if allowed (RFC 3042). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">1664</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00566">TCPBaseAlg::receivedDuplicateAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01665"></a>01665 {
<a name="l01666"></a>01666     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a406b24dd2a997eae7618c762dfe2e48d">limited_transmit_enabled</a>);
<a name="l01667"></a>01667     <span class="comment">// RFC 3042, page 3:</span>
<a name="l01668"></a>01668     <span class="comment">// &quot;When a TCP sender has previously unsent data queued for transmission</span>
<a name="l01669"></a>01669     <span class="comment">// it SHOULD use the Limited Transmit algorithm, which calls for a TCP</span>
<a name="l01670"></a>01670     <span class="comment">// sender to transmit new data upon the arrival of the first two</span>
<a name="l01671"></a>01671     <span class="comment">// consecutive duplicate ACKs when the following conditions are</span>
<a name="l01672"></a>01672     <span class="comment">// satisfied:</span>
<a name="l01673"></a>01673     <span class="comment">//</span>
<a name="l01674"></a>01674     <span class="comment">//  * The receiver&apos;s advertised window allows the transmission of the</span>
<a name="l01675"></a>01675     <span class="comment">//  segment.</span>
<a name="l01676"></a>01676     <span class="comment">//</span>
<a name="l01677"></a>01677     <span class="comment">//  * The amount of outstanding data would remain less than or equal</span>
<a name="l01678"></a>01678     <span class="comment">//  to the congestion window plus 2 segments.  In other words, the</span>
<a name="l01679"></a>01679     <span class="comment">//  sender can only send two segments beyond the congestion window</span>
<a name="l01680"></a>01680     <span class="comment">//  (cwnd).</span>
<a name="l01681"></a>01681     <span class="comment">//</span>
<a name="l01682"></a>01682     <span class="comment">// The congestion window (cwnd) MUST NOT be changed when these new</span>
<a name="l01683"></a>01683     <span class="comment">// segments are transmitted.  Assuming that these new segments and the</span>
<a name="l01684"></a>01684     <span class="comment">// corresponding ACKs are not dropped, this procedure allows the sender</span>
<a name="l01685"></a>01685     <span class="comment">// to infer loss using the standard Fast Retransmit threshold of three</span>
<a name="l01686"></a>01686     <span class="comment">// duplicate ACKs [RFC2581].  This is more robust to reordered packets</span>
<a name="l01687"></a>01687     <span class="comment">// than if an old packet were retransmitted on the first or second</span>
<a name="l01688"></a>01688     <span class="comment">// duplicate ACK.</span>
<a name="l01689"></a>01689     <span class="comment">//</span>
<a name="l01690"></a>01690     <span class="comment">// Note: If the connection is using selective acknowledgments [RFC2018],</span>
<a name="l01691"></a>01691     <span class="comment">// the data sender MUST NOT send new segments in response to duplicate</span>
<a name="l01692"></a>01692     <span class="comment">// ACKs that contain no new SACK information, as a misbehaving receiver</span>
<a name="l01693"></a>01693     <span class="comment">// can generate such ACKs to trigger inappropriate transmission of data</span>
<a name="l01694"></a>01694     <span class="comment">// segments.  See [SCWA99] for a discussion of attacks by misbehaving</span>
<a name="l01695"></a>01695     <span class="comment">// receivers.&quot;</span>
<a name="l01696"></a>01696     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> || (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#afc44bbf1e92ac47b7ef4ed4158af9a64">sackedBytes_old</a>!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>))
<a name="l01697"></a>01697     {
<a name="l01698"></a>01698         <span class="comment">// check how many bytes we have</span>
<a name="l01699"></a>01699         <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
<a name="l01700"></a>01700 
<a name="l01701"></a>01701         <span class="keywordflow">if</span> (buffered &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> || (!fullSegmentsOnly &amp;&amp; buffered &gt; 0))
<a name="l01702"></a>01702         {
<a name="l01703"></a>01703             <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> outstandingData = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
<a name="l01704"></a>01704             <span class="comment">// check conditions from RFC 3042</span>
<a name="l01705"></a>01705             <span class="keywordflow">if</span> (outstandingData + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> &amp;&amp;
<a name="l01706"></a>01706                 outstandingData + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;= congestionWindow + 2*<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
<a name="l01707"></a>01707             {
<a name="l01708"></a>01708                 uint32 effectiveWin = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>, congestionWindow) - outstandingData + 2*<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>; <span class="comment">// RFC 3042, page 3: &quot;(...)the sender can only send two segments beyond the congestion window (cwnd).&quot;</span>
<a name="l01709"></a>01709                 <span class="comment">// bytes: number of bytes we&apos;re allowed to send now</span>
<a name="l01710"></a>01710                 uint32 bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(effectiveWin, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l01711"></a>01711                 <span class="keywordflow">if</span> (bytes &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> || (!fullSegmentsOnly &amp;&amp; bytes &gt; 0))
<a name="l01712"></a>01712                 {
<a name="l01713"></a>01713                     uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l01714"></a>01714                     <span class="comment">// we&apos;ll start sending from snd_max</span>
<a name="l01715"></a>01715                     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
<a name="l01716"></a>01716 
<a name="l01717"></a>01717                     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Limited Transmit algorithm enabled. Sending one new segment.\n&quot;</span>;
<a name="l01718"></a>01718                     <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
<a name="l01719"></a>01719 
<a name="l01720"></a>01720                     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="_s_c_t_p_association_8h.html#afdb84bd44c7cbd3fc9cbe1e3bf07d948">std::max</a> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
<a name="l01721"></a>01721 
<a name="l01722"></a>01722                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>)
<a name="l01723"></a>01723                         <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l01724"></a>01724 
<a name="l01725"></a>01725                     <span class="comment">// reset snd_nxt if needed</span>
<a name="l01726"></a>01726                     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
<a name="l01727"></a>01727                         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = old_snd_nxt + bytes;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729                     <span class="comment">// notify</span>
<a name="l01730"></a>01730                     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l01731"></a>01731                     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);
<a name="l01732"></a>01732                 }
<a name="l01733"></a>01733             }
<a name="l01734"></a>01734         }
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab07a8b0ce79c80e9baf75c3e82f56937"></a><!-- doxytag: member="TCPConnection::sendProbe" ref="ab07a8b0ce79c80e9baf75c3e82f56937" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendProbe </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends 1 bytes as "probe", called by the "persist" mechanism </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">672</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00304">TCPBaseAlg::processPersistTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <span class="comment">// we&apos;ll start sending from snd_max</span>
<a name="l00675"></a>00675     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="comment">// check we have 1 byte to send</span>
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>)==0)
<a name="l00679"></a>00679     {
<a name="l00680"></a>00680         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send probe because send buffer is empty\n&quot;</span>;
<a name="l00681"></a>00681         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending 1 byte as probe, with seq=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00687"></a>00687     <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(1);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
<a name="l00690"></a>00690     <span class="comment">// but we&apos;ll need snd_max to check validity of ACKs -- they must ack</span>
<a name="l00691"></a>00691     <span class="comment">// something we really sent)</span>
<a name="l00692"></a>00692     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="comment">// notify</span>
<a name="l00696"></a>00696     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l00697"></a>00697     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00700"></a>00700 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3dc25263bb2f0b1013ee398c1587b128"></a><!-- doxytag: member="TCPConnection::sendRst" ref="a3dc25263bb2f0b1013ee398c1587b128" args="(uint32 seq, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>destPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST; does not use connection state </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00452">452</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST&quot;</span>);
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(srcPort);
<a name="l00457"></a>00457     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(destPort);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a04290a07e85bde263cc224726089cee5">setRstBit</a>(<span class="keyword">true</span>);
<a name="l00460"></a>00460     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(seq);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="comment">// send it</span>
<a name="l00463"></a>00463     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);
<a name="l00464"></a>00464 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afa03f88fc4589249aefe6f828eed9dd6"></a><!-- doxytag: member="TCPConnection::sendRst" ref="afa03f88fc4589249aefe6f828eed9dd6" args="(uint32 seqNo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seqNo</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00447">447</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00221">process_ABORT()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00448"></a>00448 {
<a name="l00449"></a>00449     <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>, <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>, <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>, <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
<a name="l00450"></a>00450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade3c9c38be0aa758b4eb448d5c1169b9"></a><!-- doxytag: member="TCPConnection::sendRstAck" ref="ade3c9c38be0aa758b4eb448d5c1169b9" args="(uint32 seq, uint32 ack, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRstAck </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>ack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>destPort</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST+ACK; does not use connection state </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00466">466</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00467"></a>00467 {
<a name="l00468"></a>00468     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST+ACK&quot;</span>);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(srcPort);
<a name="l00471"></a>00471     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(destPort);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a04290a07e85bde263cc224726089cee5">setRstBit</a>(<span class="keyword">true</span>);
<a name="l00474"></a>00474     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00475"></a>00475     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(seq);
<a name="l00476"></a>00476     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(ack);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="comment">// send it</span>
<a name="l00479"></a>00479     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);
<a name="l00480"></a>00480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af71155c4fad49ea52907d840463a06d5"></a><!-- doxytag: member="TCPConnection::sendSegment" ref="af71155c4fad49ea52907d840463a06d5" args="(uint32 bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSegment </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>bytes</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends one segment of 'bytes' bytes from snd_nxt, and advances snd_nxt. <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a> and <a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a> internally all rely on this one. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">526</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00725">retransmitData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00702">retransmitOneSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">sendOneNewSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">sendProbe()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">sendSegmentDuringLossRecoveryPhase()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00527"></a>00527 {
<a name="l00528"></a>00528     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530         <span class="comment">// check rexmitQ and try to forward snd_nxt before sending new data</span>
<a name="l00531"></a>00531         uint32 forward = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a8c83d42828fe0c5477981025d6d105fb">checkRexmitQueueForSackedOrRexmittedSegments</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00532"></a>00532         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> + forward;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (bytes &gt; buffered) <span class="comment">// last segment?</span>
<a name="l00537"></a>00537         bytes = buffered;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="comment">// send one segment of &apos;bytes&apos; bytes from snd_nxt, and advance snd_nxt</span>
<a name="l00540"></a>00540     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a46bb6f0e35b67b91e2d3da32ccf07b00">createSegmentWithBytes</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, bytes);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="comment">// if sack_enabled copy region of tcpseg to rexmitQueue</span>
<a name="l00543"></a>00543     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
<a name="l00544"></a>00544         <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a6eb4b2c4417dfff97a1734c9a43fca76">enqueueSentData</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>+bytes);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00547"></a>00547     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00548"></a>00548     <a class="code" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a>();
<a name="l00549"></a>00549     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
<a name="l00551"></a>00551         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00552"></a>00552     <span class="comment">// TBD when to set PSH bit?</span>
<a name="l00553"></a>00553     <span class="comment">// TBD set URG bit if needed</span>
<a name="l00554"></a>00554     ASSERT(bytes==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>());
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> += bytes;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="comment">// check if afterRto bit can be reset</span>
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a> &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
<a name="l00560"></a>00560         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a> = <span class="keyword">false</span>;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     if (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>)
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Setting FIN on segment\n&quot;</span>;
<a name="l00565"></a>00565         tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a626c808550da11fa9ea1bdce32409784">setFinBit</a>(<span class="keyword">true</span>);
<a name="l00566"></a>00566         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1;
<a name="l00567"></a>00567     }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00570"></a>00570 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac922b39992f510ef7803067e675d80f1"></a><!-- doxytag: member="TCPConnection::sendSegmentDuringLossRecoveryPhase" ref="ac922b39992f510ef7803067e675d80f1" args="(uint32 seqNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSegmentDuringLossRecoveryPhase </td>
          <td>(</td>
          <td class="paramtype">uint32&nbsp;</td>
          <td class="paramname"> <em>seqNum</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send segment during Loss Recovery phase (if SACK is enabled). </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">1600</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01569">sendDataDuringLossRecoveryPhase()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01601"></a>01601 {
<a name="l01602"></a>01602     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a>);
<a name="l01603"></a>01603     <span class="comment">// start sending from seqNum</span>
<a name="l01604"></a>01604     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = seqNum;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606     uint32 old_highRxt = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l01607"></a>01607 
<a name="l01608"></a>01608     <span class="comment">// no need to check cwnd and rwnd - has already be done before</span>
<a name="l01609"></a>01609     <span class="comment">// no need to check nagle - sending mss bytes</span>
<a name="l01610"></a>01610     <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     uint32 sentSeqNum = seqNum + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614     <span class="comment">// RFC 3517 page 8: &quot;(C.2) If any of the data octets sent in (C.1) are below HighData,</span>
<a name="l01615"></a>01615     <span class="comment">// HighRxt MUST be set to the highest sequence number of the</span>
<a name="l01616"></a>01616     <span class="comment">// retransmitted segment.&quot;</span>
<a name="l01617"></a>01617     <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(sentSeqNum, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)) <span class="comment">// HighData = snd_max</span>
<a name="l01618"></a>01618     {
<a name="l01619"></a>01619         ASSERT (sentSeqNum==<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>());
<a name="l01620"></a>01620         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l01621"></a>01621     }
<a name="l01622"></a>01622     <span class="comment">// RFC 3517 page 8: &quot;(C.3) If any of the data octets sent in (C.1) are above HighData,</span>
<a name="l01623"></a>01623     <span class="comment">// HighData must be updated to reflect the transmission of</span>
<a name="l01624"></a>01624     <span class="comment">// previously unsent data.&quot;</span>
<a name="l01625"></a>01625     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(sentSeqNum, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)) <span class="comment">// HighData = snd_max</span>
<a name="l01626"></a>01626         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = sentSeqNum;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>)
<a name="l01629"></a>01629         <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
<a name="l01630"></a>01630 
<a name="l01631"></a>01631     <span class="comment">// RFC 3517, page 9: &quot;6   Managing the RTO Timer</span>
<a name="l01632"></a>01632     <span class="comment">//</span>
<a name="l01633"></a>01633     <span class="comment">// The standard TCP RTO estimator is defined in [RFC2988].  Due to the</span>
<a name="l01634"></a>01634     <span class="comment">// fact that the SACK algorithm in this document can have an impact on</span>
<a name="l01635"></a>01635     <span class="comment">// the behavior of the estimator, implementers may wish to consider how</span>
<a name="l01636"></a>01636     <span class="comment">// the timer is managed.  [RFC2988] calls for the RTO timer to be</span>
<a name="l01637"></a>01637     <span class="comment">// re-armed each time an ACK arrives that advances the cumulative ACK</span>
<a name="l01638"></a>01638     <span class="comment">// point.  Because the algorithm presented in this document can keep the</span>
<a name="l01639"></a>01639     <span class="comment">// ACK clock going through a fairly significant loss event,</span>
<a name="l01640"></a>01640     <span class="comment">// (comparatively longer than the algorithm described in [RFC2581]), on</span>
<a name="l01641"></a>01641     <span class="comment">// some networks the loss event could last longer than the RTO.  In this</span>
<a name="l01642"></a>01642     <span class="comment">// case the RTO timer would expire prematurely and a segment that need</span>
<a name="l01643"></a>01643     <span class="comment">// not be retransmitted would be resent.</span>
<a name="l01644"></a>01644     <span class="comment">//</span>
<a name="l01645"></a>01645     <span class="comment">// Therefore we give implementers the latitude to use the standard</span>
<a name="l01646"></a>01646     <span class="comment">// [RFC2988] style RTO management or, optionally, a more careful variant</span>
<a name="l01647"></a>01647     <span class="comment">// that re-arms the RTO timer on each retransmission that is sent during</span>
<a name="l01648"></a>01648     <span class="comment">// recovery MAY be used.  This provides a more conservative timer than</span>
<a name="l01649"></a>01649     <span class="comment">// specified in [RFC2988], and so may not always be an attractive</span>
<a name="l01650"></a>01650     <span class="comment">// alternative.  However, in some cases it may prevent needless</span>
<a name="l01651"></a>01651     <span class="comment">// retransmissions, go-back-N transmission and further reduction of the</span>
<a name="l01652"></a>01652     <span class="comment">// congestion window.&quot;</span>
<a name="l01653"></a>01653     <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
<a name="l01654"></a>01654     <span class="keywordflow">if</span> (old_highRxt != <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>)
<a name="l01655"></a>01655     {
<a name="l01656"></a>01656         <span class="comment">// Note: Restart of REXMIT timer on retransmission is not part of RFC 2581, however optional in RFC 3517 if sent during recovery.</span>
<a name="l01657"></a>01657         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission sent during recovery, restarting REXMIT timer.\n&quot;</span>;
<a name="l01658"></a>01658         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
<a name="l01659"></a>01659     }
<a name="l01660"></a>01660     <span class="keywordflow">else</span> <span class="comment">// don&apos;t measure RTT for retransmitted packets</span>
<a name="l01661"></a>01661         <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(seqNum); <span class="comment">// seqNum = old_snd_nxt</span>
<a name="l01662"></a>01662 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abcd8f7efecc7c0077050184d3384b493"></a><!-- doxytag: member="TCPConnection::sendSyn" ref="abcd8f7efecc7c0077050184d3384b493" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSyn </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">400</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00401"></a>00401 {
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>() || <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>==-1)
<a name="l00403"></a>00403         opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: foreign socket unspecified&quot;</span>);
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>==-1)
<a name="l00405"></a>00405         opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: local port unspecified&quot;</span>);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">// create segment</span>
<a name="l00408"></a>00408     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN&quot;</span>);
<a name="l00409"></a>00409     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
<a name="l00410"></a>00410     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#ae6ab03cf0b027aa91c0dfae3e92f4099">setSynBit</a>(<span class="keyword">true</span>);
<a name="l00411"></a>00411     <a class="code" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a>();
<a name="l00412"></a>00412     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00413"></a>00413     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
<a name="l00414"></a>00414         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="comment">// write header options</span>
<a name="l00419"></a>00419     <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="comment">// send it</span>
<a name="l00422"></a>00422     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00423"></a>00423 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a675b131a43de7429552a574cabcc12dd"></a><!-- doxytag: member="TCPConnection::sendSynAck" ref="a675b131a43de7429552a574cabcc12dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSynAck </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN+ACK </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">425</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00426"></a>00426 {
<a name="l00427"></a>00427     <span class="comment">// create segment</span>
<a name="l00428"></a>00428     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN+ACK&quot;</span>);
<a name="l00429"></a>00429     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aaacb6a24b814593e3235b54f851867e3">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
<a name="l00430"></a>00430     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6df293ef2d9c30d459c4ae908e652b2d">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
<a name="l00431"></a>00431     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#ae6ab03cf0b027aa91c0dfae3e92f4099">setSynBit</a>(<span class="keyword">true</span>);
<a name="l00432"></a>00432     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#af9be0f84f76f501b7848c76836017eb7">setAckBit</a>(<span class="keyword">true</span>);
<a name="l00433"></a>00433     <a class="code" href="class_t_c_p_connection.html#a2d22abd919e73d898f20a4ad2ad84657">updateRcvWnd</a>();
<a name="l00434"></a>00434     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0d07df02626c37974daa8169746bea1d">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
<a name="l00436"></a>00436         <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="comment">// write header options</span>
<a name="l00441"></a>00441     <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <span class="comment">// send it</span>
<a name="l00444"></a>00444     <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
<a name="l00445"></a>00445 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6aa48826843116a0f5c4e0fa37a69cfc"></a><!-- doxytag: member="TCPConnection::sendToApp" ref="a6aa48826843116a0f5c4e0fa37a69cfc" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToApp </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends packet to application </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00298">298</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00299"></a>00299 {
<a name="l00300"></a>00300     <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
<a name="l00301"></a>00301 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8763146770969da7d0a1196efe23615c"></a><!-- doxytag: member="TCPConnection::sendToIP" ref="a8763146770969da7d0a1196efe23615c" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send <a class="el" href="class_i_p.html">IP</a> packet </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00231">231</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
<a name="l00234"></a>00234     <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="keywordflow">if</span> (!dest.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00237"></a>00237     {
<a name="l00238"></a>00238         <span class="comment">// send over IPv4</span>
<a name="l00239"></a>00239         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00240"></a>00240         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00241"></a>00241         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00242"></a>00242         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00243"></a>00243         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         check_and_cast&lt;<a class="code" href="class_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <span class="keywordflow">else</span>
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249         <span class="comment">// send over IPv6</span>
<a name="l00250"></a>00250         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00251"></a>00251         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00252"></a>00252         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00253"></a>00253         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00254"></a>00254         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         check_and_cast&lt;<a class="code" href="class_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a86143cf35f957006c5fe17c506be21c7"></a><!-- doxytag: member="TCPConnection::sendToIP" ref="a86143cf35f957006c5fe17c506be21c7" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: adds control info to segment and sends it to <a class="el" href="class_i_p.html">IP</a> </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">186</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00452">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00466">sendRstAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00187"></a>00187 {
<a name="l00188"></a>00188     <span class="comment">// record seq (only if we do send data) and ackno</span>
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>()!=0)
<a name="l00190"></a>00190         <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>());
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>)
<a name="l00192"></a>00192         <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>());
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">// final touches on the segment before sending</span>
<a name="l00195"></a>00195     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#aecde52ccc2594bb4820fab0ad6638e7b">setSrcPort</a>(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
<a name="l00196"></a>00196     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4f39849c340ca1247b69f1c5cddd08b0">setDestPort</a>(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
<a name="l00197"></a>00197     ASSERT(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &gt;= <a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>);     <span class="comment">// TCP_HEADER_OCTETS = 20 (without options)</span>
<a name="l00198"></a>00198     ASSERT(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() &lt;= <a class="code" href="_t_c_p_segment__m_8h.html#aa7e1ca46d75d9c43837b18ac7d0f7a9e">TCP_MAX_HEADER_OCTETS</a>); <span class="comment">// TCP_MAX_HEADER_OCTETS = 60</span>
<a name="l00199"></a>00199     tcpseg-&gt;setByteLength(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a86df3be69e394a9e805013810c4df1ba">getHeaderLength</a>() + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7d9f010b71e3bfa267873ab21195fb73">getPayloadLength</a>());
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
<a name="l00203"></a>00203     <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="comment">// TBD reuse next function for sending</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209         <span class="comment">// send over IPv4</span>
<a name="l00210"></a>00210         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00211"></a>00211         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00212"></a>00212         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00213"></a>00213         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00214"></a>00214         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218     <span class="keywordflow">else</span>
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         <span class="comment">// send over IPv6</span>
<a name="l00221"></a>00221         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00222"></a>00222         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_protocol_id__m_8h.html#a4297c2f400ba53cf6866e6d45bc81b70a69fd8777dfd279b247a88b6eec793bd7">IP_PROT_TCP</a>);
<a name="l00223"></a>00223         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00224"></a>00224         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00225"></a>00225         tcpseg-&gt;setControlInfo(controlInfo);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a728bea28fa24566bb22935f0de7c4655"></a><!-- doxytag: member="TCPConnection::setPipe" ref="a728bea28fa24566bb22935f0de7c4655" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::setPipe </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: "This routine traverses the sequence
 space from HighACK to HighData and MUST set the "pipe variable to an estimate of the number of octets that are currently in transit between the <a class="el" href="class_t_c_p.html">TCP</a> sender and the <a class="el" href="class_t_c_p.html">TCP</a> receiver. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01392">1392</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00083">TCPReno::receivedDataAck()</a>, and <a class="el" href="flavours_2_t_c_p_reno_8cc_source.html#l00195">TCPReno::receivedDuplicateAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01393"></a>01393 {
<a name="l01394"></a>01394     ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
<a name="l01395"></a>01395     <span class="comment">// RFC 3517, pages 1 and 2: &quot;</span>
<a name="l01396"></a>01396     <span class="comment">// &quot;HighACK&quot; is the sequence number of the highest byte of data that</span>
<a name="l01397"></a>01397     <span class="comment">// has been cumulatively ACKed at a given point.</span>
<a name="l01398"></a>01398     <span class="comment">//</span>
<a name="l01399"></a>01399     <span class="comment">// &quot;HighData&quot; is the highest sequence number transmitted at a given</span>
<a name="l01400"></a>01400     <span class="comment">// point.</span>
<a name="l01401"></a>01401     <span class="comment">//</span>
<a name="l01402"></a>01402     <span class="comment">// &quot;HighRxt&quot; is the highest sequence number which has been</span>
<a name="l01403"></a>01403     <span class="comment">// retransmitted during the current loss recovery phase.</span>
<a name="l01404"></a>01404     <span class="comment">//</span>
<a name="l01405"></a>01405     <span class="comment">// &quot;Pipe&quot; is a sender&apos;s estimate of the number of bytes outstanding</span>
<a name="l01406"></a>01406     <span class="comment">// in the network.  This is used during recovery for limiting the</span>
<a name="l01407"></a>01407     <span class="comment">// sender&apos;s sending rate.  The pipe variable allows TCP to use a</span>
<a name="l01408"></a>01408     <span class="comment">// fundamentally different congestion control than specified in</span>
<a name="l01409"></a>01409     <span class="comment">// [RFC2581].  The algorithm is often referred to as the &quot;pipe</span>
<a name="l01410"></a>01410     <span class="comment">// algorithm&quot;.&quot;</span>
<a name="l01411"></a>01411     <span class="comment">// HighAck = snd_una</span>
<a name="l01412"></a>01412     <span class="comment">// HighData = snd_max</span>
<a name="l01413"></a>01413 
<a name="l01414"></a>01414     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
<a name="l01415"></a>01415     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> = 0;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417     <span class="comment">// RFC 3517, page 3: &quot;This routine traverses the sequence space from HighACK to HighData</span>
<a name="l01418"></a>01418     <span class="comment">// and MUST set the &quot;pipe&quot; variable to an estimate of the number of</span>
<a name="l01419"></a>01419     <span class="comment">// octets that are currently in transit between the TCP sender and</span>
<a name="l01420"></a>01420     <span class="comment">// the TCP receiver.  After initializing pipe to zero the following</span>
<a name="l01421"></a>01421     <span class="comment">// steps are taken for each octet &apos;S1&apos; in the sequence space between</span>
<a name="l01422"></a>01422     <span class="comment">// HighACK and HighData that has not been SACKed:&quot;</span>
<a name="l01423"></a>01423     <span class="keywordflow">for</span> (uint32 s1=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s1&lt;state-&gt;snd_max; s1=s1+<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// Note: Would be better use byte ranges</span>
<a name="l01424"></a>01424     {
<a name="l01425"></a>01425         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s1)==<span class="keyword">false</span>)
<a name="l01426"></a>01426         {
<a name="l01427"></a>01427             <span class="comment">// RFC 3517, page 3: &quot;(a) If IsLost (S1) returns false:</span>
<a name="l01428"></a>01428             <span class="comment">//</span>
<a name="l01429"></a>01429             <span class="comment">//     Pipe is incremented by 1 octet.</span>
<a name="l01430"></a>01430             <span class="comment">//</span>
<a name="l01431"></a>01431             <span class="comment">//     The effect of this condition is that pipe is incremented for</span>
<a name="l01432"></a>01432             <span class="comment">//     packets that have not been SACKed and have not been determined</span>
<a name="l01433"></a>01433             <span class="comment">//     to have been lost (i.e., those segments that are still assumed</span>
<a name="l01434"></a>01434             <span class="comment">//     to be in the network).&quot;</span>
<a name="l01435"></a>01435             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a>(s1)==<span class="keyword">false</span>)
<a name="l01436"></a>01436                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>++;
<a name="l01437"></a>01437 
<a name="l01438"></a>01438             <span class="comment">// RFC 3517, pages 3 and 4: &quot;(b) If S1 &lt;= HighRxt:</span>
<a name="l01439"></a>01439             <span class="comment">//</span>
<a name="l01440"></a>01440             <span class="comment">//     Pipe is incremented by 1 octet.</span>
<a name="l01441"></a>01441             <span class="comment">//</span>
<a name="l01442"></a>01442             <span class="comment">//     The effect of this condition is that pipe is incremented for</span>
<a name="l01443"></a>01443             <span class="comment">//     the retransmission of the octet.</span>
<a name="l01444"></a>01444             <span class="comment">//</span>
<a name="l01445"></a>01445             <span class="comment">//  Note that octets retransmitted without being considered lost are</span>
<a name="l01446"></a>01446             <span class="comment">//  counted twice by the above mechanism.&quot;</span>
<a name="l01447"></a>01447             if (<a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s1,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>))
<a name="l01448"></a>01448                 <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>++;
<a name="l01449"></a>01449         }
<a name="l01450"></a>01450     }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> * <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>; <span class="comment">// TODO - remove this line if using byte ranges</span>
<a name="l01453"></a>01453     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>)
<a name="l01454"></a>01454         <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>);
<a name="l01455"></a>01455 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a264eb196b44591ed68422a9e70dab680"></a><!-- doxytag: member="TCPConnection::signalConnectionTimeout" ref="a264eb196b44591ed68422a9e70dab680" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::signalConnectionTimeout </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: signal to user that connection timed out </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00265">265</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00227">TCPBaseAlg::processRexmitTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(<a class="code" href="_t_c_p_command__m_8h.html#a68611fc79dbc74e8744d74b746cd956ba06629e44a0aef5201b4cd424596127bf">TCP_I_TIMED_OUT</a>);
<a name="l00268"></a>00268 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa58f44bc38ec0af46aca654f9403771f"></a><!-- doxytag: member="TCPConnection::startSynRexmitTimer" ref="aa58f44bc38ec0af46aca654f9403771f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::startSynRexmitTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start SYN-REXMIT timer </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01244">1244</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01245"></a>01245 {
<a name="l01246"></a>01246     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a> = 0;
<a name="l01247"></a>01247     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a89ce38305130a5021e21134602a88f79">TCP_TIMEOUT_SYN_REXMIT</a>;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>-&gt;isScheduled())
<a name="l01250"></a>01250         <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l01251"></a>01251     <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a>);
<a name="l01252"></a>01252 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1be68d20f98e68b01ef9267a8dd2088a"></a><!-- doxytag: member="TCPConnection::stateEntered" ref="a1be68d20f98e68b01ef9267a8dd2088a" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::stateEntered </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Perform cleanup necessary when entering a new state, e.g. cancelling timers </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">530</a> of file <a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00531"></a>00531 {
<a name="l00532"></a>00532     <span class="comment">// cancel timers</span>
<a name="l00533"></a>00533     <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)
<a name="l00534"></a>00534     {
<a name="l00535"></a>00535         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
<a name="l00536"></a>00536             <span class="comment">// we&apos;ll never get back to INIT</span>
<a name="l00537"></a>00537             <span class="keywordflow">break</span>;
<a name="l00538"></a>00538         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
<a name="l00539"></a>00539             <span class="comment">// we may get back to LISTEN from SYN_RCVD</span>
<a name="l00540"></a>00540             ASSERT(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00541"></a>00541             <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
<a name="l00542"></a>00542             <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00543"></a>00543             <span class="keywordflow">break</span>;
<a name="l00544"></a>00544         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
<a name="l00545"></a>00545         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
<a name="l00546"></a>00546             <span class="keywordflow">break</span>;
<a name="l00547"></a>00547         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
<a name="l00548"></a>00548             <span class="comment">// we&apos;re in ESTABLISHED, these timers are no longer needed</span>
<a name="l00549"></a>00549             <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
<a name="l00550"></a>00550             <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00551"></a>00551             <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = NULL;
<a name="l00552"></a>00552             <span class="comment">// TCP_I_ESTAB notification moved inside event processing</span>
<a name="l00553"></a>00553             <span class="keywordflow">break</span>;
<a name="l00554"></a>00554         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
<a name="l00555"></a>00555         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
<a name="l00556"></a>00556         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
<a name="l00557"></a>00557         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
<a name="l00558"></a>00558         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
<a name="l00559"></a>00559         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
<a name="l00560"></a>00560             <span class="comment">// whether connection setup succeeded (ESTABLISHED) or not (others),</span>
<a name="l00561"></a>00561             <span class="comment">// cancel these timers</span>
<a name="l00562"></a>00562             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
<a name="l00563"></a>00563             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00564"></a>00564             <span class="keywordflow">break</span>;
<a name="l00565"></a>00565         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>:
<a name="l00566"></a>00566             <span class="comment">// all timers need to be cancelled</span>
<a name="l00567"></a>00567             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)   <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
<a name="l00568"></a>00568             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
<a name="l00569"></a>00569             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)  <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
<a name="l00570"></a>00570             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
<a name="l00571"></a>00571             <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a8f85fd7e065ed30ddaa1e741781130ae">connectionClosed</a>();
<a name="l00572"></a>00572             <span class="keywordflow">break</span>;
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab991cf2680a63832310a4a56ac17972e"></a><!-- doxytag: member="TCPConnection::stateName" ref="ab991cf2680a63832310a4a56ac17972e" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::stateName </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_S_xxx constants </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00037">37</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01209">process_TIMEOUT_2MSL()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01189">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01229">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00041"></a>00041     <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)
<a name="l00042"></a>00042     {
<a name="l00043"></a>00043         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>);
<a name="l00044"></a>00044         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>);
<a name="l00045"></a>00045         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>);
<a name="l00046"></a>00046         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>);
<a name="l00047"></a>00047         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>);
<a name="l00048"></a>00048         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>);
<a name="l00049"></a>00049         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>);
<a name="l00050"></a>00050         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>);
<a name="l00051"></a>00051         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>);
<a name="l00052"></a>00052         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>);
<a name="l00053"></a>00053         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>);
<a name="l00054"></a>00054         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>);
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056     <span class="keywordflow">return</span> s;
<a name="l00057"></a>00057 <span class="preprocessor">#undef CASE</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b7d3f811eab0367d3826dfb20c8d931"></a><!-- doxytag: member="TCPConnection::tryFastRoute" ref="a9b7d3f811eab0367d3826dfb20c8d931" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::tryFastRoute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Shortcut to process most common case as fast as possible. Returns false if segment requires normal (slow) route. </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00030">30</a> of file <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032     <span class="comment">// fast route processing not yet implemented</span>
<a name="l00033"></a>00033     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00034"></a>00034 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae25d720620d8fe927087e1af0692ed90"></a><!-- doxytag: member="TCPConnection::updateRcvQueueVars" ref="ae25d720620d8fe927087e1af0692ed90" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::updateRcvQueueVars </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update receiver queue related variables and statistics - called before setting rcv_wnd </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01304">1304</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01317">updateRcvWnd()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01305"></a>01305 {
<a name="l01306"></a>01306     <span class="comment">// update receive queue related state variables</span>
<a name="l01307"></a>01307     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ad40894bf45a33d6e849d0317765bbaa5">getAmountOfFreeBytes</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a>);
<a name="l01308"></a>01308     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a>;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310     <span class="comment">// update receive queue related statistics</span>
<a name="l01311"></a>01311     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>)
<a name="l01312"></a>01312         <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a>);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;receiveQ: receiveQLength=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a906163ab3363c8f66c60371e61e3fef6">getQueueLength</a>() &lt;&lt; <span class="stringliteral">&quot; maxRcvBuffer=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> &lt;&lt; <span class="stringliteral">&quot; usedRcvBuffer=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a> &lt;&lt; <span class="stringliteral">&quot; freeRcvBuffer=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01315"></a>01315 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2d22abd919e73d898f20a4ad2ad84657"></a><!-- doxytag: member="TCPConnection::updateRcvWnd" ref="a2d22abd919e73d898f20a4ad2ad84657" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::updateRcvWnd </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update receive window (rcv_wnd) </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01317">1317</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01318"></a>01318 {
<a name="l01319"></a>01319     uint32 win = 0;
<a name="l01320"></a>01320 
<a name="l01321"></a>01321     <span class="comment">// update receive queue related state variables and statistics</span>
<a name="l01322"></a>01322     <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
<a name="l01323"></a>01323     win = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a>;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     <span class="comment">// Following lines are based on [Stevens, W.R.: TCP/IP Illustrated, Volume 2, pages 878-879]:</span>
<a name="l01326"></a>01326     <span class="comment">// Don&apos;t advertise less than one full-sized segment to avoid SWS</span>
<a name="l01327"></a>01327     <span class="keywordflow">if</span> (win &lt; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> / 4) &amp;&amp; win &lt; state-&gt;snd_mss)
<a name="l01328"></a>01328         win = 0;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     <span class="comment">// Do not shrink window</span>
<a name="l01331"></a>01331     <span class="comment">// (rcv_adv minus rcv_nxt) is the amount of space still available to the sender that was previously advertised</span>
<a name="l01332"></a>01332     <span class="keywordflow">if</span> (win &lt; state-&gt;rcv_adv - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
<a name="l01333"></a>01333         win = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335     <span class="comment">// Observe upper limit for advertised window on this connection</span>
<a name="l01336"></a>01336     <span class="keywordflow">if</span> (win &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>) <span class="comment">// TCP_MAX_WIN = 65535 (16 bit)</span>
<a name="l01337"></a>01337         win = <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>; <span class="comment">// Note: The window size is limited to a 16 bit value in the TCP header.</span>
<a name="l01338"></a>01338     <span class="comment">// Note: The order of the &quot;Do not shrink window&quot; and &quot;Observe upper limit&quot; parts has been changed to the order used in FreeBSD Release 7.1</span>
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="comment">// update rcv_adv if needed</span>
<a name="l01341"></a>01341     <span class="keywordflow">if</span> (win &gt; 0 &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + win, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>))
<a name="l01342"></a>01342     {
<a name="l01343"></a>01343         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + win;
<a name="l01344"></a>01344         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>)
<a name="l01345"></a>01345             <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348     <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> = win;
<a name="l01349"></a>01349 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af1daa72bce81fcdc2cb7ccb03c134b7b"></a><!-- doxytag: member="TCPConnection::updateWndInfo" ref="af1daa72bce81fcdc2cb7ccb03c134b7b" args="(TCPSegment *tcpseg, bool doAlways=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::updateWndInfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>doAlways</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update window information (snd_wnd, snd_wl1, snd_wl2) </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01351">1351</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, and <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01352"></a>01352 {
<a name="l01353"></a>01353     <span class="comment">// Following lines are based on [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 982]:</span>
<a name="l01354"></a>01354     <span class="keywordflow">if</span> (doAlways || (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8415708f568387985da223286a9e5bfa">getAckBit</a>()
<a name="l01355"></a>01355         &amp;&amp; (<a class="code" href="_t_c_p_connection_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()) ||
<a name="l01356"></a>01356         (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a> == tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>()&amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>())) ||
<a name="l01357"></a>01357         (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a> == tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>()&amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>() &gt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>)))
<a name="l01358"></a>01358         )
<a name="l01359"></a>01359     {
<a name="l01360"></a>01360         <span class="comment">// send window should be updated</span>
<a name="l01361"></a>01361         <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Updating send window from segment: new wnd=&quot;</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01362"></a>01362         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8ef1b3d7dceadd931a331c121e55c556">getWindow</a>();
<a name="l01363"></a>01363         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a0dafe41ef5a4306a4106fdb1e22b19e8">getSequenceNo</a>();
<a name="l01364"></a>01364         <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a853ab8ce8acfb5da053fa9ca24592ce8">getAckNo</a>();
<a name="l01365"></a>01365         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>)
<a name="l01366"></a>01366             <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>);
<a name="l01367"></a>01367     }
<a name="l01368"></a>01368 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a617d790b0cf1905e60c226dff8174a23"></a><!-- doxytag: member="TCPConnection::writeHeaderOptions" ref="a617d790b0cf1905e60c226dff8174a23" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> TCPConnection::writeHeaderOptions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="paramname"> <em>tcpseg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: writeHeaderOptions (Currently only EOL, NOP, MSS, SACK_PERMITTED and SACK are implemented) </p>

<p>Definition at line <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00955">955</a> of file <a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00956"></a>00956 {
<a name="l00957"></a>00957     <a class="code" href="class_t_c_p_option.html">TCPOption</a> option;
<a name="l00958"></a>00958     <span class="keywordtype">int</span> t = 0;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#affebf261c9d4fc303151a484d61d8bb7">getSynBit</a>() &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> || ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>) &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;0))) <span class="comment">// SYN flag set and connetion in INIT or LISTEN state (or after synRexmit timeout)</span>
<a name="l00961"></a>00961     {
<a name="l00962"></a>00962         <span class="comment">// MSS header option</span>
<a name="l00963"></a>00963         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &gt; 0)
<a name="l00964"></a>00964         {
<a name="l00965"></a>00965             option.<a class="code" href="class_t_c_p_option.html#a83b39a10e62a284f6ccea47ecd70fdf6">setKind</a>(<a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a2284ab19f96a9994ca8082801c427119">TCPOPTION_MAXIMUM_SEGMENT_SIZE</a>); <span class="comment">// MSS</span>
<a name="l00966"></a>00966             option.<a class="code" href="class_t_c_p_option.html#a789b9b31949bedfd5a60f47901b65561">setLength</a>(4);
<a name="l00967"></a>00967             option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(1);
<a name="l00968"></a>00968 
<a name="l00969"></a>00969             <span class="comment">// Update MSS</span>
<a name="l00970"></a>00970             option.<a class="code" href="class_t_c_p_option.html#ae3f3c11eeb6511721f6530f081ea6cd1">setValues</a>(0,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
<a name="l00971"></a>00971             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option MSS(=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;&lt; <span class="stringliteral">&quot;) sent\n&quot;</span>;
<a name="l00972"></a>00972             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()+1);
<a name="l00973"></a>00973             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l00974"></a>00974             t++;
<a name="l00975"></a>00975         }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977         <span class="comment">// SACK_PERMITTED header option</span>
<a name="l00978"></a>00978         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a>) <span class="comment">// Is SACK supported by host?</span>
<a name="l00979"></a>00979         {
<a name="l00980"></a>00980             <span class="comment">// 2 padding bytes</span>
<a name="l00981"></a>00981             option.<a class="code" href="class_t_c_p_option.html#a83b39a10e62a284f6ccea47ecd70fdf6">setKind</a>(<a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a3815105fc6965c050aceeac9863abbcb">TCPOPTION_NO_OPERATION</a>); <span class="comment">// NOP</span>
<a name="l00982"></a>00982             option.<a class="code" href="class_t_c_p_option.html#a789b9b31949bedfd5a60f47901b65561">setLength</a>(1);
<a name="l00983"></a>00983             option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(0);
<a name="l00984"></a>00984             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()+2);
<a name="l00985"></a>00985             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l00986"></a>00986             t++;
<a name="l00987"></a>00987             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l00988"></a>00988             t++;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990             option.<a class="code" href="class_t_c_p_option.html#a83b39a10e62a284f6ccea47ecd70fdf6">setKind</a>(<a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0ab2a60921ef5e80121ed52f6603897d91">TCPOPTION_SACK_PERMITTED</a>);
<a name="l00991"></a>00991             option.<a class="code" href="class_t_c_p_option.html#a789b9b31949bedfd5a60f47901b65561">setLength</a>(2);
<a name="l00992"></a>00992             option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(0);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994             <span class="comment">// Update SACK variable</span>
<a name="l00995"></a>00995             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> = <span class="keyword">true</span>;
<a name="l00996"></a>00996             <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a>;
<a name="l00997"></a>00997             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option SACK_PERMITTED sent, SACK (sack_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00998"></a>00998             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()+1);
<a name="l00999"></a>00999             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l01000"></a>01000             t++;
<a name="l01001"></a>01001         }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003         <span class="comment">// TODO add new TCPOptions here once they are implemented</span>
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>) <span class="comment">// connetion is not in INIT or LISTEN state</span>
<a name="l01006"></a>01006     {
<a name="l01007"></a>01007         <span class="comment">// SACK header option</span>
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <span class="comment">// RFC 2018, page 4:</span>
<a name="l01010"></a>01010         <span class="comment">// &quot;If sent at all, SACK options SHOULD be included in all ACKs which do</span>
<a name="l01011"></a>01011         <span class="comment">// not ACK the highest sequence number in the data receiver&apos;s queue.  In</span>
<a name="l01012"></a>01012         <span class="comment">// this situation the network has lost or mis-ordered data, such that</span>
<a name="l01013"></a>01013         <span class="comment">// the receiver holds non-contiguous data in its queue.  RFC 1122,</span>
<a name="l01014"></a>01014         <span class="comment">// Section 4.2.2.21, discusses the reasons for the receiver to send ACKs</span>
<a name="l01015"></a>01015         <span class="comment">// in response to additional segments received in this state.  The</span>
<a name="l01016"></a>01016         <span class="comment">// receiver SHOULD send an ACK for every valid segment that arrives</span>
<a name="l01017"></a>01017         <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
<a name="l01018"></a>01018         <span class="comment">// SACK option.&quot;</span>
<a name="l01019"></a>01019         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> || <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>))
<a name="l01020"></a>01020         {
<a name="l01021"></a>01021             <span class="comment">// 2 padding bytes</span>
<a name="l01022"></a>01022             option.<a class="code" href="class_t_c_p_option.html#a83b39a10e62a284f6ccea47ecd70fdf6">setKind</a>(<a class="code" href="_t_c_p_segment__m_8h.html#aad5daaa0da17557e7745d86d2bf140a0a3815105fc6965c050aceeac9863abbcb">TCPOPTION_NO_OPERATION</a>); <span class="comment">// NOP</span>
<a name="l01023"></a>01023             option.<a class="code" href="class_t_c_p_option.html#a789b9b31949bedfd5a60f47901b65561">setLength</a>(1);
<a name="l01024"></a>01024             option.<a class="code" href="class_t_c_p_option.html#a21c94907a742e476fa203af4e1d4b6aa">setValuesArraySize</a>(0);
<a name="l01025"></a>01025             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>()+2);
<a name="l01026"></a>01026             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l01027"></a>01027             t++;
<a name="l01028"></a>01028             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22be8028757ef2577cbda4a51062d042">setOptions</a>(t,option);
<a name="l01029"></a>01029             t++;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031             <a class="code" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks</a>(tcpseg);
<a name="l01032"></a>01032             t++;
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035         <span class="comment">// TODO add new TCPOptions here once they are implemented</span>
<a name="l01036"></a>01036 
<a name="l01037"></a>01037         <span class="comment">// TODO delegate to TCPAlgorithm as well -- it may want to append additional options</span>
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>() != 0)
<a name="l01041"></a>01041     {
<a name="l01042"></a>01042         <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> options_len = 0;
<a name="l01043"></a>01043         <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2db62f2752a3f6a99678227cc5fba74c">getOptionsArraySize</a>(); i++)
<a name="l01044"></a>01044             options_len = options_len + tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a2358acbf0a5fdc1b7b27fd972087dca0">getOptions</a>(i).<a class="code" href="class_t_c_p_option.html#aa74ae1e636ad1868f3b00b07c53aeb6e">getLength</a>();
<a name="l01045"></a>01045 
<a name="l01046"></a>01046         <span class="keywordflow">if</span> (options_len &lt;= 40) <span class="comment">// Options length allowed? - maximum: 40 Bytes</span>
<a name="l01047"></a>01047             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a93282054b05417ede1e3ef8cb6e5d6e8">setHeaderLength</a>(<a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>+options_len); <span class="comment">// TCP_HEADER_OCTETS = 20</span>
<a name="l01048"></a>01048         <span class="keywordflow">else</span>
<a name="l01049"></a>01049         {
<a name="l01050"></a>01050             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a93282054b05417ede1e3ef8cb6e5d6e8">setHeaderLength</a>(<a class="code" href="_t_c_p_segment__m_8h.html#a77315d68700647283fc64814a5862090">TCP_HEADER_OCTETS</a>); <span class="comment">// TCP_HEADER_OCTETS = 20</span>
<a name="l01051"></a>01051             tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#accc49a5b6de2480b9efa55f2e889b993">setOptionsArraySize</a>(0); <span class="comment">// drop all options</span>
<a name="l01052"></a>01052             <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Options length exceeded! Segment will be sent without options&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01053"></a>01053         }
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056     <span class="keywordflow">return</span> *tcpseg;
<a name="l01057"></a>01057 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ac07531e9f1e23e1da9d4263f0da58cd9"></a><!-- doxytag: member="TCPConnection::appGateIndex" ref="ac07531e9f1e23e1da9d4263f0da58cd9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">TCPConnection::appGateIndex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00298">298</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00270">sendIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00298">sendToApp()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a93b66fc68b48870a93479aa0bf4ac773"></a><!-- doxytag: member="TCPConnection::connEstabTimer" ref="a93b66fc68b48870a93479aa0bf4ac773" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">TCPConnection::connEstabTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00328">328</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fee1d63c934294942e34b17a92d2fd5"></a><!-- doxytag: member="TCPConnection::connId" ref="a6fee1d63c934294942e34b17a92d2fd5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">TCPConnection::connId</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00299">299</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00270">sendIndicationToApp()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="abceb1f0559f6e8c9f0e8d906b3e124e7"></a><!-- doxytag: member="TCPConnection::dupAcksVector" ref="abceb1f0559f6e8c9f0e8d906b3e124e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">TCPConnection::dupAcksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00342">342</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5a1fb22c64b7f9edd700721bdec1d20"></a><!-- doxytag: member="TCPConnection::finWait2Timer" ref="ab5a1fb22c64b7f9edd700721bdec1d20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">TCPConnection::finWait2Timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00329">329</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="af7032e0a7991f87167efce40df32535e"></a><!-- doxytag: member="TCPConnection::fsm" ref="af7032e0a7991f87167efce40df32535e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cFSM <a class="el" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">TCPConnection::fsm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00311">311</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00221">process_ABORT()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01209">process_TIMEOUT_2MSL()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01189">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01229">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00787">processMSSOption()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00828">processSACKPermittedOption()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00955">writeHeaderOptions()</a>.</p>

</div>
</div>
<a class="anchor" id="a08c53cabdcc750399f2af42d7c04d8e7"></a><!-- doxytag: member="TCPConnection::localAddr" ref="a08c53cabdcc750399f2af42d7c04d8e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">TCPConnection::localAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00302">302</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00305">TCP::addSockPair()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00447">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, and <a class="el" href="_t_c_p_8cc_source.html#l00335">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a248676b3def3f1af2dd46b9520ba4e96"></a><!-- doxytag: member="TCPConnection::localPort" ref="a248676b3def3f1af2dd46b9520ba4e96" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">TCPConnection::localPort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00304">304</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00305">TCP::addSockPair()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00447">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>, and <a class="el" href="_t_c_p_8cc_source.html#l00335">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="af4bd1681a62ef1ce6ac4237ed64bf468"></a><!-- doxytag: member="TCPConnection::pipeVector" ref="af4bd1681a62ef1ce6ac4237ed64bf468" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">TCPConnection::pipeVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00343">343</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01392">setPipe()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="abe4b8c8de0df4555c93fc23dcb099893"></a><!-- doxytag: member="TCPConnection::rcvAckVector" ref="abe4b8c8de0df4555c93fc23dcb099893" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">TCPConnection::rcvAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00339">339</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a985637bb70c925f74fa6ad8bb53af0d0"></a><!-- doxytag: member="TCPConnection::rcvAdvVector" ref="a985637bb70c925f74fa6ad8bb53af0d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">TCPConnection::rcvAdvVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00335">335</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01317">updateRcvWnd()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a6ae35f9e338201b6f1f36e1c0aaf9acb"></a><!-- doxytag: member="TCPConnection::rcvOooSegVector" ref="a6ae35f9e338201b6f1f36e1c0aaf9acb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">TCPConnection::rcvOooSegVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00346">346</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a88d83f671702d2b86f59942b94165daa"></a><!-- doxytag: member="TCPConnection::rcvSacksVector" ref="a88d83f671702d2b86f59942b94165daa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">TCPConnection::rcvSacksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00345">345</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00848">processSACKOption()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a02c1500cf2719ebc20fe5e44ca9c663f"></a><!-- doxytag: member="TCPConnection::rcvSeqVector" ref="a02c1500cf2719ebc20fe5e44ca9c663f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">TCPConnection::rcvSeqVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00338">338</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae5a0350b06c4be2dd4285230e08717cd"></a><!-- doxytag: member="TCPConnection::rcvWndVector" ref="ae5a0350b06c4be2dd4285230e08717cd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">TCPConnection::rcvWndVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00334">334</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a1f9a74ed0fae5b105a1a1cfb2bab9006"></a><!-- doxytag: member="TCPConnection::receiveQueue" ref="a1f9a74ed0fae5b105a1a1cfb2bab9006" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* <a class="el" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">TCPConnection::receiveQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00318">318</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01059">addSacks()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01304">updateRcvQueueVars()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="aee1b7ed1b1412bf36a125fcbab3e9e34"></a><!-- doxytag: member="TCPConnection::remoteAddr" ref="aee1b7ed1b1412bf36a125fcbab3e9e34" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">TCPConnection::remoteAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00303">303</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00305">TCP::addSockPair()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00447">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, and <a class="el" href="_t_c_p_8cc_source.html#l00335">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="aab271d97998bcfc7477fc1d99af2df08"></a><!-- doxytag: member="TCPConnection::remotePort" ref="aab271d97998bcfc7477fc1d99af2df08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">TCPConnection::remotePort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00305">305</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_8cc_source.html#l00359">TCP::addForkedConnection()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00305">TCP::addSockPair()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00122">printConnBrief()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00302">processTCPSegment()</a>, <a class="el" href="_t_c_p_8cc_source.html#l00379">TCP::removeConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00447">sendRst()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>, and <a class="el" href="_t_c_p_8cc_source.html#l00335">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a7de9df6b234a7dabb5b5e7eb7520734d"></a><!-- doxytag: member="TCPConnection::rexmitQueue" ref="a7de9df6b234a7dabb5b5e7eb7520734d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>* <a class="el" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">TCPConnection::rexmitQueue</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00320">320</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01370">isLost()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01457">nextSeg()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="flavours_2_t_c_p_base_alg_8cc_source.html#l00227">TCPBaseAlg::processRexmitTimer()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01027">processRstInSynReceived()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00848">processSACKOption()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00702">retransmitOneSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00363">selectInitialSeqNum()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01392">setPipe()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a7c229fb19da75c880c60a41280721d0e"></a><!-- doxytag: member="TCPConnection::sackedBytesVector" ref="a7c229fb19da75c880c60a41280721d0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">TCPConnection::sackedBytesVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00348">348</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00848">processSACKOption()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a0dec48343ab1df2cc4157a3da114f54e"></a><!-- doxytag: member="TCPConnection::sendQueue" ref="a0dec48343ab1df2cc4157a3da114f54e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* <a class="el" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">TCPConnection::sendQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00317">317</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01457">nextSeg()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01027">processRstInSynReceived()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00725">retransmitData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00363">selectInitialSeqNum()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">sendOneNewSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">sendProbe()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="af597155e6e0a1417ca5fd8cab178fcce"></a><!-- doxytag: member="TCPConnection::sndAckVector" ref="af597155e6e0a1417ca5fd8cab178fcce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">TCPConnection::sndAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00337">337</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a67990b92349ae122edcf1d0a1a6b004c"></a><!-- doxytag: member="TCPConnection::sndNxtVector" ref="a67990b92349ae122edcf1d0a1a6b004c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">TCPConnection::sndNxtVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00336">336</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a19d5bebef3053d95b66713e1e78e4200"></a><!-- doxytag: member="TCPConnection::sndSacksVector" ref="a19d5bebef3053d95b66713e1e78e4200" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">TCPConnection::sndSacksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00344">344</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01059">addSacks()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a21c55311a3c27fe7808c962a5faffdf5"></a><!-- doxytag: member="TCPConnection::sndWndVector" ref="a21c55311a3c27fe7808c962a5faffdf5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">TCPConnection::sndWndVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00333">333</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01351">updateWndInfo()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a4780b0038982452cef8139e04f84b4c8"></a><!-- doxytag: member="TCPConnection::state" ref="a4780b0038982452cef8139e04f84b4c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">TCPConnection::state</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00314">314</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01059">addSacks()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00336">configureStateVariables()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01370">isLost()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00374">isSegmentAcceptable()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01457">nextSeg()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00221">process_ABORT()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00083">process_RCV_SEGMENT()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00252">process_STATUS()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01189">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00787">processMSSOption()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01027">processRstInSynReceived()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00848">processSACKOption()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00828">processSACKPermittedOption()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00725">retransmitData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00702">retransmitOneSegment()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00037">segmentArrivalWhileClosed()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00363">selectInitialSeqNum()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01569">sendDataDuringLossRecoveryPhase()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">sendOneNewSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">sendProbe()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00526">sendSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00400">sendSyn()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00425">sendSynAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01392">setPipe()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01244">startSynRexmitTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01304">updateRcvQueueVars()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01317">updateRcvWnd()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01351">updateWndInfo()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00955">writeHeaderOptions()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad2e24541092cf4c58f67845e6621f3cb"></a><!-- doxytag: member="TCPConnection::synRexmitTimer" ref="ad2e24541092cf4c58f67845e6621f3cb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">TCPConnection::synRexmitTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00330">330</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01254">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01244">startSynRexmitTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a305b76fec9de3d8524f7ae5cf1dd55f0"></a><!-- doxytag: member="TCPConnection::tcpAlgorithm" ref="a305b76fec9de3d8524f7ae5cf1dd55f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* <a class="el" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">TCPConnection::tcpAlgorithm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00324">324</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00112">process_SEND()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00702">retransmitOneSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00482">sendAck()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00504">sendFin()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">sendOneNewSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">sendProbe()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae74f100a2d121edee4b0e167596b8ac5"></a><!-- doxytag: member="TCPConnection::tcpMain" ref="ae74f100a2d121edee4b0e167596b8ac5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p.html">TCP</a>* <a class="el" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">TCPConnection::tcpMain</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00308">308</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00151">cloneListeningConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00336">configureStateVariables()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00303">initConnection()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00365">performStateTransition()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00033">process_OPEN_ACTIVE()</a>, <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00079">process_OPEN_PASSIVE()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00281">sendEstabIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00270">sendIndicationToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00298">sendToApp()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00186">sendToIP()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00162">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d09993cf4b38b48fd5d4d51b7842607"></a><!-- doxytag: member="TCPConnection::tcpRcvQueueBytesVector" ref="a3d09993cf4b38b48fd5d4d51b7842607" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">TCPConnection::tcpRcvQueueBytesVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00349">349</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01304">updateRcvQueueVars()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad24c6dbc6d3b7e143ca4fc180092aa6b"></a><!-- doxytag: member="TCPConnection::tcpRcvQueueDropsVector" ref="ad24c6dbc6d3b7e143ca4fc180092aa6b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">TCPConnection::tcpRcvQueueDropsVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00350">350</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00686">processSegmentInListen()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00823">processSegmentInSynSent()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ea0361f0b40f10bc9a3ce397b2c0e2f"></a><!-- doxytag: member="TCPConnection::the2MSLTimer" ref="a0ea0361f0b40f10bc9a3ce397b2c0e2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">TCPConnection::the2MSLTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00327">327</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l00114">processSegment1stThru8th()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00265">processTimer()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00530">stateEntered()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a7cc325d99a5b02944a46c6a425fd01fc"></a><!-- doxytag: member="TCPConnection::unackedVector" ref="a7cc325d99a5b02944a46c6a425fd01fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">TCPConnection::unackedVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_t_c_p_connection_8h_source.html#l00340">340</a> of file <a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a>.</p>

<p>Referenced by <a class="el" href="_t_c_p_connection_event_proc_8cc_source.html#l00160">process_CLOSE()</a>, <a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html#l01058">processAckInEstabEtc()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00572">sendData()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01664">sendOneNewSegment()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l00672">sendProbe()</a>, <a class="el" href="_t_c_p_connection_util_8cc_source.html#l01600">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00143">TCPConnection()</a>, and <a class="el" href="_t_c_p_connection_base_8cc_source.html#l00233">~TCPConnection()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_t_c_p_connection_8h_source.html">TCPConnection.h</a></li>
<li><a class="el" href="_t_c_p_connection_base_8cc_source.html">TCPConnectionBase.cc</a></li>
<li><a class="el" href="_t_c_p_connection_event_proc_8cc_source.html">TCPConnectionEventProc.cc</a></li>
<li><a class="el" href="_t_c_p_connection_rcv_segment_8cc_source.html">TCPConnectionRcvSegment.cc</a></li>
<li><a class="el" href="_t_c_p_connection_util_8cc_source.html">TCPConnectionUtil.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:38 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
