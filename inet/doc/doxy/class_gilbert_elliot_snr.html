<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: GilbertElliotSnr Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>GilbertElliotSnr Class Reference</h1><!-- doxytag: class="GilbertElliotSnr" --><!-- doxytag: inherits="SnrEval" -->
<p>Keeps track of the different snir levels when receiving a packet and switches between states GOOD and BAD (Gilbert-Elliot-Model).  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for GilbertElliotSnr:</div>
<div class="dynsection">
 <div class="center">
  <img src="class_gilbert_elliot_snr.gif" usemap="#GilbertElliotSnr_map" alt=""/>
  <map id="GilbertElliotSnr_map" name="GilbertElliotSnr_map">
<area href="class_snr_eval.html" alt="SnrEval" shape="rect" coords="0,224,101,248"/>
<area href="class_basic_snr_eval.html" alt="BasicSnrEval" shape="rect" coords="0,168,101,192"/>
<area href="class_channel_access.html" alt="ChannelAccess" shape="rect" coords="0,112,101,136"/>
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="0,56,101,80"/>
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="0,0,101,24"/>
</map>
 </div>
</div>

<p><a href="class_gilbert_elliot_snr-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#ae02eec1a4a054235a125a2d5c19407d8">GilbertElliotSnr</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#ac008a6b8f104c68f6b5afa36c2acc1a6">~GilbertElliotSnr</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6">State</a> { <a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3">GOOD</a>, 
<a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Gilbert-Elliot state types. </p>
 <a href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a0886205c3ab74194fb14ccd7495498df">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize variables and publish the radio status.  <a href="#a0886205c3ab74194fb14ccd7495498df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a16deedca42913461c667c319487eb4a4">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle timers.  <a href="#a16deedca42913461c667c319487eb4a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a7e5d2fb286b5a2a78834a6d5a7ccd392">handleLowerMsgStart</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffer the frame and update noise levels and snr information...  <a href="#a7e5d2fb286b5a2a78834a6d5a7ccd392"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a8cce1850da492f871c08ddcb3647b2ed">handleLowerMsgEnd</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unbuffer the frame and update noise levels and snr information.  <a href="#a8cce1850da492f871c08ddcb3647b2ed"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6">State</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524">state</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">System state.  <a href="#a68b860e38ce5be9a94cd9f96ffe01524"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a0ccd32cd10b6ff40e867dc405f7bc478">meanGood</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mean value to compute the time the xystem stays in the GOOD state  <a href="#a0ccd32cd10b6ff40e867dc405f7bc478"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a0d11343b892fad29a3286331e91771cf">meanBad</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mean value to compute the time the xystem stays in the BAD state  <a href="#a0d11343b892fad29a3286331e91771cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d">stateChange</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">timer to indicate a change of state  <a href="#ad753c14038c286afef497bcb288f850d"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Keeps track of the different snir levels when receiving a packet and switches between states GOOD and BAD (Gilbert-Elliot-Model). </p>
<p>This module has exactly the same functionality as the <a class="el" href="class_snr_eval.html" title="Keeps track of the different snir levels when receiving a packet.">SnrEval</a> module, but furthermore it puts a Gilbert-Elliot model on top of the SNIR level computation. This means that it changes between the states GOOD and BAD. If it is in state BAD a received frame will be marked as corrupted.</p>
<p>The Gilbert Elliot model is used to simulate outer system disturbances.</p>
<p>This module should be used in combination with the GilbertElliotDecider moulde which evaluates the snr levels as well as the marked frames.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Marc Loebbers </dd></dl>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00046">46</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a56daf6d1ebc4d15acda53702f9ac57d6"></a><!-- doxytag: member="GilbertElliotSnr::State" ref="a56daf6d1ebc4d15acda53702f9ac57d6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6">GilbertElliotSnr::State</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gilbert-Elliot state types. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3"></a><!-- doxytag: member="GOOD" ref="a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3" args="" -->GOOD</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a"></a><!-- doxytag: member="BAD" ref="a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a" args="" -->BAD</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00067">67</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00067"></a>00067               {
<a name="l00068"></a>00068       <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3">GOOD</a>,
<a name="l00069"></a>00069       <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>
<a name="l00070"></a>00070     };
</pre></div></p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae02eec1a4a054235a125a2d5c19407d8"></a><!-- doxytag: member="GilbertElliotSnr::GilbertElliotSnr" ref="ae02eec1a4a054235a125a2d5c19407d8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GilbertElliotSnr::GilbertElliotSnr </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00026">26</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00027"></a>00027 {
<a name="l00028"></a>00028     <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a> = NULL;
<a name="l00029"></a>00029 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac008a6b8f104c68f6b5afa36c2acc1a6"></a><!-- doxytag: member="GilbertElliotSnr::~GilbertElliotSnr" ref="ac008a6b8f104c68f6b5afa36c2acc1a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GilbertElliotSnr::~GilbertElliotSnr </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00031">31</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00032"></a>00032 {
<a name="l00033"></a>00033     cancelAndDelete(<a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>);
<a name="l00034"></a>00034 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8cce1850da492f871c08ddcb3647b2ed"></a><!-- doxytag: member="GilbertElliotSnr::handleLowerMsgEnd" ref="a8cce1850da492f871c08ddcb3647b2ed" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GilbertElliotSnr::handleLowerMsgEnd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unbuffer the frame and update noise levels and snr information. </p>
<p>This function is called right after the transmission is over, i.e. right after unbuffering. The noise level of the channel and the snr information of the buffered messages have to be updated.</p>
<p>Additionally the <a class="el" href="class_radio_state.html">RadioState</a> has to be updated.</p>
<p>If the corresponding <a class="el" href="class_air_frame.html">AirFrame</a> was not only noise the corresponding SnrList and the <a class="el" href="class_air_frame.html">AirFrame</a> are sent to the decider. </p>

<p>Reimplemented from <a class="el" href="class_snr_eval.html#ae4c093f6dc4dc649070947da6051f3b2">SnrEval</a>.</p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00215">215</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00216"></a>00216 {
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="comment">//check state again:</span>
<a name="l00219"></a>00219     <span class="keywordflow">if</span> (<a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> == <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>)
<a name="l00220"></a>00220         frame-&gt;setBitError(<span class="keyword">true</span>);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="comment">// check if message has to be send to the decider</span>
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == frame)
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of frame over, preparing to send packet to upper layer\n&quot;</span>;
<a name="l00226"></a>00226         <span class="comment">// get Packet and list out of the receive buffer:</span>
<a name="l00227"></a>00227         <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> list;
<a name="l00228"></a>00228         list = <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="comment">// delete the pointer to indicate that no message is currently</span>
<a name="l00231"></a>00231         <span class="comment">// being received and clear the list</span>
<a name="l00232"></a>00232         <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = NULL;
<a name="l00233"></a>00233         <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a>.clear();
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="comment">// delete the frame from the recvBuff</span>
<a name="l00236"></a>00236         <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.erase(frame);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="comment">//Don&apos;t forget to send:</span>
<a name="l00239"></a>00239         <a class="code" href="class_basic_snr_eval.html#a94a474e2deb6ce756900b1b64ba779df" title="Sends a message to the upper layer.">sendUp</a>(frame, list);
<a name="l00240"></a>00240         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;packet sent to the decider\n&quot;</span>;
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242     <span class="comment">// all other messages are noise</span>
<a name="l00243"></a>00243     <span class="keywordflow">else</span>
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;reception of noise message over, removing recvdPower from noiseLevel....\n&quot;</span>;
<a name="l00246"></a>00246         <span class="comment">// get the rcvdPower and subtract it from the noiseLevel</span>
<a name="l00247"></a>00247         <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> -= <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>[frame];
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         <span class="comment">// delete message from the recvBuff</span>
<a name="l00250"></a>00250         <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.erase(frame);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="comment">// update snr info for message currently being received if any</span>
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> != NULL)
<a name="l00254"></a>00254         {
<a name="l00255"></a>00255             <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="comment">// message should be deleted</span>
<a name="l00259"></a>00259         <span class="keyword">delete</span> frame;
<a name="l00260"></a>00260         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;message deleted\n&quot;</span>;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">// check the RadioState and update if necessary</span>
<a name="l00264"></a>00264     <span class="comment">// change to idle if noiseLevel smaller than threshold and state was</span>
<a name="l00265"></a>00265     <span class="comment">// not idle before</span>
<a name="l00266"></a>00266     <span class="comment">// do not change state if currently sending or receiving a message!!!</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &lt; <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood...">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == NULL)
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269         <span class="comment">// publish the new RadioState:</span>
<a name="l00270"></a>00270         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;new RadioState is IDLE\n&quot;</span>;
<a name="l00271"></a>00271         <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
<a name="l00272"></a>00272         <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e5d2fb286b5a2a78834a6d5a7ccd392"></a><!-- doxytag: member="GilbertElliotSnr::handleLowerMsgStart" ref="a7e5d2fb286b5a2a78834a6d5a7ccd392" args="(AirFrame *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GilbertElliotSnr::handleLowerMsgStart </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffer the frame and update noise levels and snr information... </p>
<p>This function is called right after a packet arrived, i.e. right before it is buffered for 'transmission time'.</p>
<p>First the receive power of the packet has to be calculated and is stored in the recvBuff. Afterwards it has to be decided whether the packet is just noise or a "real" packet that needs to be received.</p>
<p>The message is not treated as noise if all of the follwoing conditions apply:</p>
<ol type="1">
<li>the power of the received signal is higher than the sensitivity.</li>
<li>the host is currently not sending a message</li>
<li>no other packet is already being received</li>
</ol>
<p>If all conditions apply a new SnrList is created and the <a class="el" href="class_radio_state.html">RadioState</a> is changed to RECV. If the Gilbert Elliot model is in state BAD, the frame is marked as corrupted. The cMessage's bitError flag is used for it. If the packet is just noise the receive power is added to the noise Level of the channel. Additionally the snr information of the currently received message (if any) has to be updated as well as the <a class="el" href="class_radio_state.html">RadioState</a>. </p>

<p>Reimplemented from <a class="el" href="class_snr_eval.html#aa4128b029feeaa5427ad6522fabce2eb">SnrEval</a>.</p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00135">135</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137     <span class="comment">// Calculate the receive power of the message</span>
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">// calculate distance</span>
<a name="l00140"></a>00140     <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; myPos = <a class="code" href="class_channel_access.html#a9e51969a624ff64101cf808514d50d4f" title="Returns the host&amp;#39;s position.">getMyPosition</a>();
<a name="l00141"></a>00141     <span class="keyword">const</span> <a class="code" href="class_coord.html" title="Class for storing host positions.">Coord</a>&amp; framePos = frame-&gt;<a class="code" href="class_air_frame.html#a6330e718269d5471a1beaeba7b505a60">getSenderPos</a>();
<a name="l00142"></a>00142     <span class="keywordtype">double</span> distance = myPos.<a class="code" href="class_coord.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626">distance</a>(framePos);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// receive power</span>
<a name="l00145"></a>00145     <span class="keywordtype">double</span> rcvdPower = <a class="code" href="class_snr_eval.html#abe78b8bf8a3b41fd8019e2a70109c201" title="Calculates the power with which a packet is received.">calcRcvdPower</a>(frame-&gt;<a class="code" href="class_air_frame.html#a8b0e2eb1d14e0a5d9cab5c5a6f66c044">getPSend</a>(), distance);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (<a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> == <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>)
<a name="l00148"></a>00148         frame-&gt;setBitError(<span class="keyword">true</span>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">// store the receive power in the recvBuff</span>
<a name="l00151"></a>00151     <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>[frame] = rcvdPower;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">// if receive power is bigger than sensitivity and if not sending</span>
<a name="l00154"></a>00154     <span class="comment">// and currently not receiving another message</span>
<a name="l00155"></a>00155     <span class="keywordflow">if</span> (rcvdPower &gt;= <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood...">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aedb2522a6da55abd014a306192411a11">RadioState::TRANSMIT</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> == NULL)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;receiving frame\n&quot;</span>;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="comment">// Put frame and related SnrList in receive buffer</span>
<a name="l00160"></a>00160         <a class="code" href="_snr_list_8h.html#a241b5e7c9575e932988a55f7a5012a61" title="List to store SNR information for a message.">SnrList</a> snrList;        <span class="comment">//defined in SnrList.h!!</span>
<a name="l00161"></a>00161         <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> = frame;
<a name="l00162"></a>00162         <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a4b048226b385794353721848560f1a29" title="Received power of the message.">rcvdPower</a> = rcvdPower;
<a name="l00163"></a>00163         <a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#aabbbbeed5ce64d9ecf216db3f79ba206" title="Snr list to store the SNR values.">sList</a> = snrList;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="comment">// add initial snr value</span>
<a name="l00166"></a>00166         <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() != <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>)
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170             <span class="comment">// publish new RadioState</span>
<a name="l00171"></a>00171             <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
<a name="l00172"></a>00172             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;publish new RadioState:RECV\n&quot;</span>;
<a name="l00173"></a>00173             <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <span class="comment">// receive power is to low or another message is being send or received</span>
<a name="l00177"></a>00177     <span class="keywordflow">else</span>
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;frame is just noise\n&quot;</span>;
<a name="l00180"></a>00180         <span class="comment">//add receive power to the noise level</span>
<a name="l00181"></a>00181         <a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> += rcvdPower;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="comment">// if a message is being received add a new snr value</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#a73fab3747cf312107fed650c2dbd7f4d" title="State: SnrInfo stores the snrList and the the recvdPower for the message currently...">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#a0ea8b1159dc83d461d15822534fb59d8" title="Pointer to the message this information belongs to.">ptr</a> != NULL)
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             <span class="comment">// update snr info for currently being received message</span>
<a name="l00187"></a>00187             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;add new snr value to snr list of message being received\n&quot;</span>;
<a name="l00188"></a>00188             <a class="code" href="class_snr_eval.html#abcb6a07d2956a4505c36843af15ff8f1" title="updates the snr information of the relevant AirFrames">addNewSnr</a>();
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">// update the RadioState if the noiseLevel exceeded the threshold</span>
<a name="l00192"></a>00192         <span class="comment">// and the radio is currently not in receive or in send mode</span>
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &gt;= <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood...">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ab714f16be9aaf5b6789801854f859883">getState</a>() == <a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>)
<a name="l00194"></a>00194         {
<a name="l00195"></a>00195             <span class="comment">// publish new RadioState</span>
<a name="l00196"></a>00196             <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
<a name="l00197"></a>00197             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;publish new RadioState:RECV\n&quot;</span>;
<a name="l00198"></a>00198             <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a16deedca42913461c667c319487eb4a4"></a><!-- doxytag: member="GilbertElliotSnr::handleSelfMsg" ref="a16deedca42913461c667c319487eb4a4" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GilbertElliotSnr::handleSelfMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle timers. </p>
<p>If the selfMsg is the time to indicate a transmission is over, the <a class="el" href="class_radio_state.html">RadioState</a> has to be changed based on the noise level on the channel. If the noise level is bigger than the sensitivity switch to receive mode otherwise to idle mode.</p>
<p>If the timer indicates a change of state in the Gilbert-Elliot model, the state variable has to be changed. </p>

<p>Reimplemented from <a class="el" href="class_snr_eval.html#ad2d58ffa8f07856cfb6b6a7afc788e51">SnrEval</a>.</p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00066">66</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (msg-&gt;getKind() == <a class="code" href="class_snr_eval.html#a2ad9ae884cbace04cc0352681bcf0aa7a797073dbf98fa5a93132abb0138983f0" title="timer to indicate that a message is completely sent now">TRANSM_OVER</a>)
<a name="l00069"></a>00069     {
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#aa3d5506d0e48b864bbb1089d5ff0f938" title="State: the current noise level of the channel.">noiseLevel</a> &lt; <a class="code" href="class_snr_eval.html#a5fa6897f988f66115b1217db51eb379d" title="Configuration: Defines up to what Power level (in dBm) a message can be understood...">sensitivity</a>)
<a name="l00072"></a>00072         {
<a name="l00073"></a>00073             <span class="comment">// set the RadioState to IDLE</span>
<a name="l00074"></a>00074             <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449aeb600ab2fbbbbc2d12d874edb9320ec0">RadioState::IDLE</a>);
<a name="l00075"></a>00075             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over, switch to idle mode (state:IDLE)\n&quot;</span>;
<a name="l00076"></a>00076             <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078         <span class="keywordflow">else</span>
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080             <span class="comment">// set the RadioState to RECV</span>
<a name="l00081"></a>00081             <a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>.<a class="code" href="class_radio_state.html#ae524aa6442043b5cdecb052a84ca57aa">setState</a>(<a class="code" href="class_radio_state.html#a9b2ff8c4d3f1cdb73af0a9fcea0d5449ab9ff1508b0f4aac00ec13bd9e9335c4b">RadioState::RECV</a>);
<a name="l00082"></a>00082             <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;transmission over but noise level to high, switch to recv mode (state:RECV)\n&quot;</span>;
<a name="l00083"></a>00083             <a class="code" href="class_basic_module.html#addff3486601f037d673200507e1fbf12" title="Cached pointer to the NotificationBoard module.">nb</a>-&gt;<a class="code" href="class_notification_board.html#a2bb0a5aa0cb272a9b15cb5a58a253fcc">fireChangeNotification</a>(<a class="code" href="_notifier_consts_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa6e69ccdaad903262ac00b89b6208a69">NF_RADIOSTATE_CHANGED</a>, &amp;<a class="code" href="class_snr_eval.html#a5cb463a0967ec147b4747f1ddf3c5255" title="State: the current RadioState of the NIC; includes channel number.">rs</a>);
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="comment">// delete the timer</span>
<a name="l00087"></a>00087         <span class="keyword">delete</span> msg;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>)
<a name="l00090"></a>00090     {
<a name="l00091"></a>00091         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;GilbertElliot state changed!\n&quot;</span>;
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (<a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> == <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3">GOOD</a>)
<a name="l00093"></a>00093         {
<a name="l00094"></a>00094             <a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>;
<a name="l00095"></a>00095             <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.begin(); it != <a class="code" href="class_snr_eval.html#a4348a6ef7a0ca5ff22d56b16394b0522" title="State: A buffer to store a pointer to a message and the related receive power.">recvBuff</a>.end(); it++)
<a name="l00096"></a>00096                 (it-&gt;first)-&gt;setBitError(<span class="keyword">true</span>);
<a name="l00097"></a>00097             scheduleAt(simTime() + exponential(<a class="code" href="class_gilbert_elliot_snr.html#a0d11343b892fad29a3286331e91771cf" title="mean value to compute the time the xystem stays in the BAD state">meanBad</a>, 0), <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>);
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> == <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6aad228caa67311c37b0eeeb5204b6f66a">BAD</a>)
<a name="l00100"></a>00100         {
<a name="l00101"></a>00101             <a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3">GOOD</a>;
<a name="l00102"></a>00102             scheduleAt(simTime() + exponential(<a class="code" href="class_gilbert_elliot_snr.html#a0ccd32cd10b6ff40e867dc405f7bc478" title="mean value to compute the time the xystem stays in the GOOD state">meanGood</a>, 0), <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>);
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">else</span>
<a name="l00106"></a>00106         error(<span class="stringliteral">&quot;Internal error: unknown self-message `%s&apos;&quot;</span>, msg-&gt;getName());
<a name="l00107"></a>00107 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0886205c3ab74194fb14ccd7495498df"></a><!-- doxytag: member="GilbertElliotSnr::initialize" ref="a0886205c3ab74194fb14ccd7495498df" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GilbertElliotSnr::initialize </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize variables and publish the radio status. </p>
<p>All values not present in the ned file will be read from the <a class="el" href="class_channel_control.html" title="Monitors which hosts are &quot;in range&quot;. Supports multiple channels.">ChannelControl</a> module or assigned default values. </p>

<p>Reimplemented from <a class="el" href="class_snr_eval.html#a10f81696b873c5acf9b65f04592c9918">SnrEval</a>.</p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00040">40</a> of file <a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00041"></a>00041 {
<a name="l00042"></a>00042     <a class="code" href="class_gilbert_elliot_snr.html#a0886205c3ab74194fb14ccd7495498df" title="Initialize variables and publish the radio status.">SnrEval::initialize</a>(stage);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044     <span class="keywordflow">if</span> (stage == 0)
<a name="l00045"></a>00045     {
<a name="l00046"></a>00046         <a class="code" href="class_gilbert_elliot_snr.html#a0ccd32cd10b6ff40e867dc405f7bc478" title="mean value to compute the time the xystem stays in the GOOD state">meanGood</a> = par(<span class="stringliteral">&quot;meanGood&quot;</span>);
<a name="l00047"></a>00047         <a class="code" href="class_gilbert_elliot_snr.html#a0d11343b892fad29a3286331e91771cf" title="mean value to compute the time the xystem stays in the BAD state">meanBad</a> = par(<span class="stringliteral">&quot;meanBad&quot;</span>);
<a name="l00048"></a>00048         <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a> = <span class="keyword">new</span> cMessage();
<a name="l00049"></a>00049         <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>-&gt;setKind(38);
<a name="l00050"></a>00050         <a class="code" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524" title="System state.">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6a654c2902c8fd3d09aa36ab5cdf09fed3">GOOD</a>;
<a name="l00051"></a>00051         scheduleAt(simTime() + exponential(<a class="code" href="class_gilbert_elliot_snr.html#a0ccd32cd10b6ff40e867dc405f7bc478" title="mean value to compute the time the xystem stays in the GOOD state">meanGood</a>, 0), <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>);
<a name="l00052"></a>00052         <a class="code" href="_basic_module_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;GE state will change at: &quot;</span> &lt;&lt; <a class="code" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d" title="timer to indicate a change of state">stateChange</a>-&gt;getArrivalTime() &lt;&lt; endl;
<a name="l00053"></a>00053     }
<a name="l00054"></a>00054 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a0d11343b892fad29a3286331e91771cf"></a><!-- doxytag: member="GilbertElliotSnr::meanBad" ref="a0d11343b892fad29a3286331e91771cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_gilbert_elliot_snr.html#a0d11343b892fad29a3286331e91771cf">GilbertElliotSnr::meanBad</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mean value to compute the time the xystem stays in the BAD state </p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00079">79</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>

<p>Referenced by <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00066">handleSelfMsg()</a>, and <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00040">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ccd32cd10b6ff40e867dc405f7bc478"></a><!-- doxytag: member="GilbertElliotSnr::meanGood" ref="a0ccd32cd10b6ff40e867dc405f7bc478" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="class_gilbert_elliot_snr.html#a0ccd32cd10b6ff40e867dc405f7bc478">GilbertElliotSnr::meanGood</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mean value to compute the time the xystem stays in the GOOD state </p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00076">76</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>

<p>Referenced by <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00066">handleSelfMsg()</a>, and <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00040">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a68b860e38ce5be9a94cd9f96ffe01524"></a><!-- doxytag: member="GilbertElliotSnr::state" ref="a68b860e38ce5be9a94cd9f96ffe01524" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_gilbert_elliot_snr.html#a56daf6d1ebc4d15acda53702f9ac57d6">State</a> <a class="el" href="class_gilbert_elliot_snr.html#a68b860e38ce5be9a94cd9f96ffe01524">GilbertElliotSnr::state</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>System state. </p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00073">73</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>

<p>Referenced by <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00215">handleLowerMsgEnd()</a>, <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00135">handleLowerMsgStart()</a>, <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00066">handleSelfMsg()</a>, and <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00040">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="ad753c14038c286afef497bcb288f850d"></a><!-- doxytag: member="GilbertElliotSnr::stateChange" ref="ad753c14038c286afef497bcb288f850d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_gilbert_elliot_snr.html#ad753c14038c286afef497bcb288f850d">GilbertElliotSnr::stateChange</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>timer to indicate a change of state </p>

<p>Definition at line <a class="el" href="_gilbert_elliot_snr_8h_source.html#l00082">82</a> of file <a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a>.</p>

<p>Referenced by <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00026">GilbertElliotSnr()</a>, <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00066">handleSelfMsg()</a>, <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00040">initialize()</a>, and <a class="el" href="_gilbert_elliot_snr_8cc_source.html#l00031">~GilbertElliotSnr()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_gilbert_elliot_snr_8h_source.html">GilbertElliotSnr.h</a></li>
<li><a class="el" href="_gilbert_elliot_snr_8cc_source.html">GilbertElliotSnr.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:33 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
