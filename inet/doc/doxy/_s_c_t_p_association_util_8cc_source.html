<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: SCTPAssociationUtil.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_493eba74639f722aa88bd3d010f621b5.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_34a6fbd47227bd78d46d19b24c6937db.html">transport</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e67923df1ecdd2b80c0adc9653e0b0d1.html">sctp</a>
  </div>
</div>
<div class="contents">
<h1>SCTPAssociationUtil.cc</h1><a href="_s_c_t_p_association_util_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// Copyright (C) 2005-2010 Irene Ruengeler</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2009-2010 Thomas Dreibholz</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This program is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">// modify it under the terms of the GNU General Public License</span>
<a name="l00007"></a>00007 <span class="comment">// as published by the Free Software Foundation; either version 2</span>
<a name="l00008"></a>00008 <span class="comment">// of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00013"></a>00013 <span class="comment">// GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment">// along with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_s_c_t_p_8h.html">SCTP.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_s_c_t_p_association_8h.html">SCTPAssociation.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_s_c_t_p_command__m_8h.html">SCTPCommand_m.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_i_pv6_control_info_8h.html">IPv6ControlInfo.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_s_c_t_p_queue_8h.html">SCTPQueue.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="_s_c_t_p_algorithm_8h.html">SCTPAlgorithm.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="_routing_table_8h.html">RoutingTable.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="_routing_table_access_8h.html">RoutingTableAccess.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="_interface_table_8h.html">InterfaceTable.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="_interface_table_access_8h.html">InterfaceTableAccess.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="_i_pv4_interface_data_8h.html">IPv4InterfaceData.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="_i_pv6_interface_data_8h.html">IPv6InterfaceData.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="_i_pv6_address_8h.html">IPv6Address.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="_u_d_p_control_info__m_8h.html">UDPControlInfo_m.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="class_s_c_t_p_association.html#a120c72df6657d2ef5038d61881ff11c4">00041</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a120c72df6657d2ef5038d61881ff11c4">SCTPAssociation::printSctpPathMap</a>()<span class="keyword"> const</span>
<a name="l00042"></a>00042 <span class="keyword"></span>{
<a name="l00043"></a>00043     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt;<span class="stringliteral">&quot;SCTP PathMap:&quot;</span> &lt;&lt; endl;
<a name="l00044"></a>00044     <span class="keywordflow">for</span> (SCTPPathMap::const_iterator iterator = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.begin();
<a name="l00045"></a>00045           iterator != <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end(); ++iterator) {
<a name="l00046"></a>00046         <span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path = iterator-&gt;second;
<a name="l00047"></a>00047         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a> &lt;&lt; <span class="stringliteral">&quot;:  osb=&quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a39d7029c5e70ee8e6ff6c169aaa7a240">outstandingBytes</a>
<a name="l00048"></a>00048                   &lt;&lt; <span class="stringliteral">&quot; cwnd=&quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a39293535329703b9c354939233d1b3db">cwnd</a> &lt;&lt; endl;
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="class_s_c_t_p_association.html#a2ef7cd11f293a67b65d0c9cf0eee90a2">00052</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="class_s_c_t_p_association.html#a2ef7cd11f293a67b65d0c9cf0eee90a2">SCTPAssociation::stateName</a>(<span class="keyword">const</span> int32 state)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054 <span class="preprocessor">#define CASE(x) case x: s=#x+7; break</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00056"></a>00056     <span class="keywordflow">switch</span> (state) {
<a name="l00057"></a>00057         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a7fefd7c6e51ba43b6c9d834b372da21e">SCTP_S_CLOSED</a>);
<a name="l00058"></a>00058         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8af21d78f3ce1dc469572320cb1e192cc3">SCTP_S_COOKIE_WAIT</a>);
<a name="l00059"></a>00059         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a71d88e86b49412eed493b7307f064944">SCTP_S_COOKIE_ECHOED</a>);
<a name="l00060"></a>00060         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8ae173fa0c2b8fc03ea459ade55b5d669a">SCTP_S_ESTABLISHED</a>);
<a name="l00061"></a>00061         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a606ae3dac26b5e28d7f5060705e273c6">SCTP_S_SHUTDOWN_PENDING</a>);
<a name="l00062"></a>00062         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a0ec4d7400f71ce88a8bbce0e66c97f55">SCTP_S_SHUTDOWN_SENT</a>);
<a name="l00063"></a>00063         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8aa6449dfb17a17605bdd3aea435d53159">SCTP_S_SHUTDOWN_RECEIVED</a>);
<a name="l00064"></a>00064         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8afed5af0cf4b3fce20325548b0b75961f">SCTP_S_SHUTDOWN_ACK_SENT</a>);
<a name="l00065"></a>00065     }
<a name="l00066"></a>00066     <span class="keywordflow">return</span> s;
<a name="l00067"></a>00067 <span class="preprocessor">#undef CASE</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>}
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="class_s_c_t_p_association.html#a63a1d0b48db0d4d129635336591f37fc">00070</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="class_s_c_t_p_association.html#a63a1d0b48db0d4d129635336591f37fc">SCTPAssociation::eventName</a>(<span class="keyword">const</span> int32 event)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072 <span class="preprocessor">#define CASE(x) case x: s=#x+7; break</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00074"></a>00074     <span class="keywordflow">switch</span> (event) {
<a name="l00075"></a>00075         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda9f1fd7fc777cc9fcb87a49cd64412c70">SCTP_E_OPEN_PASSIVE</a>);
<a name="l00076"></a>00076         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddab1a4ad21616e72e2d7c4bef4b392d674">SCTP_E_ASSOCIATE</a>);
<a name="l00077"></a>00077         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda2c57d6cd31d0e760c9562ab7d2d24532">SCTP_E_SHUTDOWN</a>);
<a name="l00078"></a>00078         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddaf772922ac461dd670204bcd480536cec">SCTP_E_CLOSE</a>);
<a name="l00079"></a>00079         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddaf572b3caeca60173cd35ff6438fc30f8">SCTP_E_ABORT</a>);
<a name="l00080"></a>00080         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda8ec7f7bcc1dae63ce49ba1c29227bebe">SCTP_E_SEND</a>);
<a name="l00081"></a>00081         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddab8aa9b5c31869bf157aa993cea077747">SCTP_E_RCV_INIT</a>);
<a name="l00082"></a>00082         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddaa70358352df351a6de85965ba69a2323">SCTP_E_RCV_ABORT</a>);
<a name="l00083"></a>00083         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddab8c4ae7bdc1d15fd08dbe454cdbf0fcb">SCTP_E_RCV_VALID_COOKIE_ECHO</a>);
<a name="l00084"></a>00084         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddabad36afdf7219f94be14abb8fe080640">SCTP_E_RCV_INIT_ACK</a>);
<a name="l00085"></a>00085         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda2f2d1da65ad0c265e5733999458898fb">SCTP_E_RCV_COOKIE_ACK</a>);
<a name="l00086"></a>00086         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda7712aa29c30d8415b4a4f8bcf27036dd">SCTP_E_RCV_SHUTDOWN</a>);
<a name="l00087"></a>00087         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda1ba625b5ddb58a87dc16748b4eef0282">SCTP_E_RCV_SHUTDOWN_ACK</a>);
<a name="l00088"></a>00088         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda57e8e0f4353663385300b7746ec16d6a">SCTP_E_RCV_SHUTDOWN_COMPLETE</a>);
<a name="l00089"></a>00089         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda1397882140b1aae3cf3cb56ff2c6c9ff">SCTP_E_TIMEOUT_INIT_TIMER</a>);
<a name="l00090"></a>00090         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda9e719b2a4959d6ef63faee85c6470e31">SCTP_E_TIMEOUT_SHUTDOWN_TIMER</a>);
<a name="l00091"></a>00091         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda189e654159bcd1d6e97d07e2c2eca5d9">SCTP_E_TIMEOUT_RTX_TIMER</a>);
<a name="l00092"></a>00092         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddaff2b88a373201fe023541b0e00a48749">SCTP_E_TIMEOUT_HEARTBEAT_TIMER</a>);
<a name="l00093"></a>00093         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda914409a350944272bbd72083b6b5281b">SCTP_E_RECEIVE</a>);
<a name="l00094"></a>00094         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda365f70144611ac4229ac712c9fde06f0">SCTP_E_DUP_RECEIVED</a>);
<a name="l00095"></a>00095         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda1ab4fe49257ab6212a8dd336e4d07991">SCTP_E_PRIMARY</a>);
<a name="l00096"></a>00096         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda982447e78039f557e892297768866518">SCTP_E_QUEUE_MSGS_LIMIT</a>);
<a name="l00097"></a>00097         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda3d83eea39de6b7b191caae724ae5146e">SCTP_E_QUEUE_BYTES_LIMIT</a>);
<a name="l00098"></a>00098         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda861e58ca6562ffbfe4884eec2e704431">SCTP_E_NO_MORE_OUTSTANDING</a>);
<a name="l00099"></a>00099         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddab4914b4201fb0cd1643109f690a59782">SCTP_E_IGNORE</a>);
<a name="l00100"></a>00100         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda6ad094e0a90c2dc8a41628f621d27ca0">SCTP_E_DELIVERED</a>);
<a name="l00101"></a>00101         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda65d6eeb62214f93d929739b4f81cd01c">SCTP_E_SEND_SHUTDOWN_ACK</a>);
<a name="l00102"></a>00102         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda309375f495c30e879128bda85711a6b9">SCTP_E_STOP_SENDING</a>);
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <span class="keywordflow">return</span> s;
<a name="l00105"></a>00105 <span class="preprocessor">#undef CASE</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>}
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">00108</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">SCTPAssociation::indicationName</a>(<span class="keyword">const</span> int32 code)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110 <span class="preprocessor">#define CASE(x) case x: s=#x+7; break</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* s = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00112"></a>00112     <span class="keywordflow">switch</span> (code) {
<a name="l00113"></a>00113         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a1eb9f18f68a700c545427ba5231a9dc4">SCTP_I_DATA</a>);
<a name="l00114"></a>00114         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a723241390fabc3b46cb79e9f5541b01b">SCTP_I_DATA_NOTIFICATION</a>);
<a name="l00115"></a>00115         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a6b85de91f4bd3609fc7bcd7994101a3d">SCTP_I_ESTABLISHED</a>);
<a name="l00116"></a>00116         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3adcb0d50416fbeb73876eba7d7b8ee930">SCTP_I_PEER_CLOSED</a>);
<a name="l00117"></a>00117         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3ace58e516838fe8c15ac9ce67f4f4409c">SCTP_I_CLOSED</a>);
<a name="l00118"></a>00118         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a16f2119f34b440b981e5f1e6386ac018">SCTP_I_CONNECTION_REFUSED</a>);
<a name="l00119"></a>00119         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3aee8733c691e3dbeea6dc2f701bcf027b">SCTP_I_CONNECTION_RESET</a>);
<a name="l00120"></a>00120         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3ab114530461e728f84d5db50dd5670620">SCTP_I_TIMED_OUT</a>);
<a name="l00121"></a>00121         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3abbf25758d570841736d12727b53ff2be">SCTP_I_STATUS</a>);
<a name="l00122"></a>00122         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a72ee49d265f6c75166038f085a52a1bf">SCTP_I_ABORT</a>);
<a name="l00123"></a>00123         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a21bb0580e0fb02c3a89d63062a14b88b">SCTP_I_SHUTDOWN_RECEIVED</a>);
<a name="l00124"></a>00124         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a781cc2063dc1656c84a04fde2991e2d2">SCTP_I_SEND_MSG</a>);
<a name="l00125"></a>00125         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a75904bee9e03f629a2657337857f4e52">SCTP_I_SENDQUEUE_FULL</a>);
<a name="l00126"></a>00126         <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a4ed59ad366001ebd94844599c3ed76ec">SCTP_I_SENDQUEUE_ABATED</a>);
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128     <span class="keywordflow">return</span> s;
<a name="l00129"></a>00129 <span class="preprocessor">#undef CASE</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>}
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="class_s_c_t_p_association.html#ac82674b30b7b244de6a54e79d967a1d8">00133</a> uint32 <a class="code" href="class_s_c_t_p_association.html#ac82674b30b7b244de6a54e79d967a1d8">SCTPAssociation::chunkToInt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* type)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;DATA&quot;</span>)==0) <span class="keywordflow">return</span> 0;
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;INIT&quot;</span>)==0) <span class="keywordflow">return</span> 1;
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;INIT_ACK&quot;</span>)==0) <span class="keywordflow">return</span> 2;
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;SACK&quot;</span>)==0) <span class="keywordflow">return</span> 3;
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;HEARTBEAT&quot;</span>)==0) <span class="keywordflow">return</span> 4;
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;HEARTBEAT_ACK&quot;</span>)==0) <span class="keywordflow">return</span> 5;
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;ABORT&quot;</span>)==0) <span class="keywordflow">return</span> 6;
<a name="l00142"></a>00142     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;SHUTDOWN&quot;</span>)==0) <span class="keywordflow">return</span> 7;
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;SHUTDOWN_ACK&quot;</span>)==0) <span class="keywordflow">return</span> 8;
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;ERRORTYPE&quot;</span>)==0) <span class="keywordflow">return</span> 9;
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;COOKIE_ECHO&quot;</span>)==0) <span class="keywordflow">return</span> 10;
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;COOKIE_ACK&quot;</span>)==0) <span class="keywordflow">return</span> 11;
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;SHUTDOWN_COMPLETE&quot;</span>)==0) <span class="keywordflow">return</span> 14;
<a name="l00148"></a>00148     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;ChunkConversion not successful\n&quot;</span>;
<a name="l00149"></a>00149     <span class="keywordflow">return</span> 0;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="class_s_c_t_p_association.html#a372875420182ac696a9cf72971ab5eab">00152</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a372875420182ac696a9cf72971ab5eab">SCTPAssociation::printConnBrief</a>()
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Connection &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00155"></a>00155     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>;
<a name="l00156"></a>00156     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;  on app[&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a> &lt;&lt; <span class="stringliteral">&quot;],assocId=&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>;
<a name="l00157"></a>00157     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;  in &quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a2ef7cd11f293a67b65d0c9cf0eee90a2">stateName</a>(<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="class_s_c_t_p_association.html#a0a8dc40e502998018163df5cbe68d837">00160</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a0a8dc40e502998018163df5cbe68d837">SCTPAssociation::printSegmentBrief</a>(<a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpmsg)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a558f8691efac42febdfd422ce52a762c">getSrcPort</a>() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span>;
<a name="l00163"></a>00163     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a813a5ab9db3e1c4ae354bf44de934a5b">getDestPort</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;
<a name="l00164"></a>00164     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;initTag &quot;</span>&lt;&lt; sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#acdebc18b6064656d372b86198736dd67">getTag</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="class_s_c_t_p_association.html#ae6315c7df4b1537e0b8374583492a0be">00167</a> <a class="code" href="class_s_c_t_p_association.html">SCTPAssociation</a>* <a class="code" href="class_s_c_t_p_association.html#ae6315c7df4b1537e0b8374583492a0be">SCTPAssociation::cloneAssociation</a>()
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169     <a class="code" href="class_s_c_t_p_association.html">SCTPAssociation</a>* assoc = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_association.html#ad1984a2e17a73629a51334904745086f">SCTPAssociation</a>(<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>,<a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a>,<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l00170"></a>00170     <span class="keyword">const</span> <span class="keywordtype">char</span>* queueClass = <a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a>-&gt;getClassName();
<a name="l00171"></a>00171     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_queue.html">SCTPQueue</a> *&gt;(createOne(queueClass));
<a name="l00172"></a>00172     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#aafd80d965e20c11d49b38f7001d774b2">retransmissionQ</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_queue.html">SCTPQueue</a> *&gt;(createOne(queueClass));
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="keyword">const</span> <span class="keywordtype">char</span>* sctpAlgorithmClass = <a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;getClassName();
<a name="l00175"></a>00175     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_algorithm.html">SCTPAlgorithm</a> *&gt;(createOne(sctpAlgorithmClass));
<a name="l00176"></a>00176     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#aaef644b59f18aa40cea754616c8f9f61">setAssociation</a>(assoc);
<a name="l00177"></a>00177     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#a2061a42140d0acd50454a93799f58974">initialize</a>();
<a name="l00178"></a>00178     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a> = assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#aaca16656400d64a60d3f29e838c08ca1">createStateVariables</a>();
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a9f45fb5b9a76bdf0ada04c3ed9920215">active</a> = <span class="keyword">false</span>;
<a name="l00181"></a>00181     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ab5bac08be4a3710fe623e93aa65e74ff">fork</a> = <span class="keyword">true</span>;
<a name="l00182"></a>00182     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a> = <a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>;
<a name="l00183"></a>00183     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a> = <a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>;
<a name="l00184"></a>00184     assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#af44c3fdaaff9c48fdbb45aac6d6ad082">localAddressList</a> = <a class="code" href="class_s_c_t_p_association.html#af44c3fdaaff9c48fdbb45aac6d6ad082">localAddressList</a>;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     FSM_Goto((*assoc-&gt;<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>), <a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a7fefd7c6e51ba43b6c9d834b372da21e">SCTP_S_CLOSED</a>);
<a name="l00187"></a>00187     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#a84f317375ec11a83b15062a0d77694d3">printInfoConnMap</a>();
<a name="l00188"></a>00188     <span class="keywordflow">return</span> assoc;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">00192</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">SCTPAssociation::sendToIP</a>(<a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>*       sctpmsg,
<a name="l00193"></a>00193                                          <span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp; dest,
<a name="l00194"></a>00194                                          <span class="keyword">const</span> <span class="keywordtype">bool</span>           qs)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="comment">// Final touches on the segment before sending</span>
<a name="l00197"></a>00197     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00198"></a>00198     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00199"></a>00199     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a26c061cd614d7e818c3f727e0f41bdd8">setChecksumOk</a>(<span class="keyword">true</span>);
<a name="l00200"></a>00200     <span class="keyword">const</span> <a class="code" href="class_s_c_t_p_chunk.html">SCTPChunk</a>* <a class="code" href="structchunk.html">chunk</a> = (<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_chunk.html">SCTPChunk</a>*)(sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#adad5aaf65a07de9798d70b7c5f5d00e6">peekFirstChunk</a>());
<a name="l00201"></a>00201     <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a752caf91430fcd3157a12e7e91361471">getChunkType</a>() == <a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a781ad2788df9e25c59a70894c7832096">ABORT</a>) {
<a name="l00202"></a>00202         <span class="keyword">const</span> <a class="code" href="class_s_c_t_p_abort_chunk.html">SCTPAbortChunk</a>* abortChunk = check_and_cast&lt;<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_abort_chunk.html">SCTPAbortChunk</a> *&gt;(chunk);
<a name="l00203"></a>00203         <span class="keywordflow">if</span> (abortChunk-&gt;<a class="code" href="class_s_c_t_p_abort_chunk.html#adc385c709185844a9d2104026c41f835">getT_Bit</a>() == 1) {
<a name="l00204"></a>00204             sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206         <span class="keywordflow">else</span> {
<a name="l00207"></a>00207             sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>);
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#acdebc18b6064656d372b86198736dd67">getTag</a>() == 0) {
<a name="l00211"></a>00211         sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;udpEncapsEnabled&quot;</span>)) {
<a name="l00215"></a>00215         sctpmsg-&gt;setKind(<a class="code" href="_u_d_p_control_info__m_8h.html#a33f565d232e66cb696ba21aa616c2a87a33e7476202418b695b319318e70c894e">UDP_C_DATA</a>);
<a name="l00216"></a>00216         <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>* controlInfo = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
<a name="l00217"></a>00217         controlInfo-&gt;<a class="code" href="class_u_d_p_control_info.html#aa7ab223982d1c05cedac68348ff065c6">setSrcPort</a>(9899);
<a name="l00218"></a>00218         controlInfo-&gt;<a class="code" href="class_u_d_p_control_info.html#a3deaa1c1ccc124db8104cb6ea710c3a9">setDestAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00219"></a>00219         controlInfo-&gt;<a class="code" href="class_u_d_p_control_info.html#ae2dc723a3ade849c1eb21b3bc849b5da">setDestPort</a>(9899);
<a name="l00220"></a>00220         sctpmsg-&gt;setControlInfo(controlInfo);
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222     <span class="keywordflow">else</span> {
<a name="l00223"></a>00223         <span class="keywordflow">if</span> (dest.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>()) {
<a name="l00224"></a>00224             <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>* controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
<a name="l00225"></a>00225             controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a1d7bdca688829aec49c5ba5bcbbad43a">setProtocol</a>(<a class="code" href="_i_p_serializer_8cc.html#a6ef95db1429c11d64f48e6f984044589">IP_PROT_SCTP</a>);
<a name="l00226"></a>00226             controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#ae038bde950f03730e1765a4f037c9c17">setSrcAddr</a>(<a class="code" href="class_i_pv6_address.html">IPv6Address</a>());
<a name="l00227"></a>00227             controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a33ad14801b514f598753f68ece7ccc27">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
<a name="l00228"></a>00228             sctpmsg-&gt;setControlInfo(controlInfo);
<a name="l00229"></a>00229             <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;send(sctpmsg, <span class="stringliteral">&quot;to_ipv6&quot;</span>);
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="keywordflow">else</span> {
<a name="l00232"></a>00232             <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>* controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
<a name="l00233"></a>00233             controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#ac2a2013d2125ebfcbdd6ea9943eabd41">setProtocol</a>(<a class="code" href="_i_p_serializer_8cc.html#a6ef95db1429c11d64f48e6f984044589">IP_PROT_SCTP</a>);
<a name="l00234"></a>00234             controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8e6ca2ce04f482ba99ac4064f83a414d">setSrcAddr</a>(<a class="code" href="class_i_p_address.html">IPAddress</a>(<span class="stringliteral">&quot;0.0.0.0&quot;</span>));
<a name="l00235"></a>00235             controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a135b0ce268713460864e7291dbe6eb5c">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l00236"></a>00236             sctpmsg-&gt;setControlInfo(controlInfo);
<a name="l00237"></a>00237             <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;send(sctpmsg, <span class="stringliteral">&quot;to_ip&quot;</span>);
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Sent to &quot;</span> &lt;&lt; dest &lt;&lt; endl;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="class_s_c_t_p_association.html#aed61141642771b6e3c6cc759f2e1f513">00244</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#aed61141642771b6e3c6cc759f2e1f513">SCTPAssociation::signalConnectionTimeout</a>()
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <a class="code" href="class_s_c_t_p_association.html#a010084d1e3717e6600b532f3b3804151">sendIndicationToApp</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3ab114530461e728f84d5db50dd5670620">SCTP_I_TIMED_OUT</a>);
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="class_s_c_t_p_association.html#a010084d1e3717e6600b532f3b3804151">00249</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a010084d1e3717e6600b532f3b3804151">SCTPAssociation::sendIndicationToApp</a>(<span class="keyword">const</span> int32 code, <span class="keyword">const</span> int32 value)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;sendIndicationToApp: &quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">indicationName</a>(code) &lt;&lt; endl;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     cPacket* msg = <span class="keyword">new</span> cPacket(<a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">indicationName</a>(code));
<a name="l00254"></a>00254     msg-&gt;setKind(code);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <a class="code" href="class_s_c_t_p_command.html">SCTPCommand</a>* indication = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_command.html">SCTPCommand</a>(<a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">indicationName</a>(code));
<a name="l00257"></a>00257     indication-&gt;<a class="code" href="class_s_c_t_p_command.html#aba989bb5fd07d31faf68d42bd90cbd02">setAssocId</a>(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l00258"></a>00258     indication-&gt;<a class="code" href="class_s_c_t_p_command.html#ad00fba7f2376f9e105ec3b7232a1fe11">setLocalAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>);
<a name="l00259"></a>00259     indication-&gt;<a class="code" href="class_s_c_t_p_command.html#a6d3dbedcd109903ced179bd3f56f9deb">setRemoteAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (code == <a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a4ed59ad366001ebd94844599c3ed76ec">SCTP_I_SENDQUEUE_ABATED</a>) {
<a name="l00261"></a>00261         indication-&gt;<a class="code" href="class_s_c_t_p_command.html#a37523301d495d32f6e84defd8efe6c26">setNumMsgs</a>(value);
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     msg-&gt;setControlInfo(indication);
<a name="l00264"></a>00264     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;to_appl&quot;</span>, <a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a>);
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="class_s_c_t_p_association.html#af039e9e17af5bd8f871e1bf6fa2ac871">00267</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#af039e9e17af5bd8f871e1bf6fa2ac871">SCTPAssociation::sendEstabIndicationToApp</a>()
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;sendEstabIndicationToApp: localPort=&quot;</span>
<a name="l00270"></a>00270               &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a> &lt;&lt; <span class="stringliteral">&quot; remotePort=&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a> &lt;&lt; endl;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     cPacket* msg = <span class="keyword">new</span> cPacket(<a class="code" href="class_s_c_t_p_association.html#a681a359c388e9b7f38250ceb3626515e">indicationName</a>(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a6b85de91f4bd3609fc7bcd7994101a3d">SCTP_I_ESTABLISHED</a>));
<a name="l00273"></a>00273     msg-&gt;setKind(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a6b85de91f4bd3609fc7bcd7994101a3d">SCTP_I_ESTABLISHED</a>);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <a class="code" href="class_s_c_t_p_connect_info.html">SCTPConnectInfo</a>* establishIndication = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_connect_info.html">SCTPConnectInfo</a>(<span class="stringliteral">&quot;CI&quot;</span>);
<a name="l00276"></a>00276     establishIndication-&gt;<a class="code" href="class_s_c_t_p_command.html#aba989bb5fd07d31faf68d42bd90cbd02">setAssocId</a>(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l00277"></a>00277     establishIndication-&gt;<a class="code" href="class_s_c_t_p_command.html#ad00fba7f2376f9e105ec3b7232a1fe11">setLocalAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>);
<a name="l00278"></a>00278     establishIndication-&gt;<a class="code" href="class_s_c_t_p_command.html#a6d3dbedcd109903ced179bd3f56f9deb">setRemoteAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l00279"></a>00279     establishIndication-&gt;<a class="code" href="class_s_c_t_p_connect_info.html#af5790cd26c4f9a5b38ab12a0486f1ba0">setLocalPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00280"></a>00280     establishIndication-&gt;<a class="code" href="class_s_c_t_p_connect_info.html#aa457e28ebfa7505dd63cd0f303d1beb6">setRemotePort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00281"></a>00281     establishIndication-&gt;<a class="code" href="class_s_c_t_p_connect_info.html#a388e5f4b4eea024fdae9fedadf6d4cad">setRemoteAddresses</a>(<a class="code" href="class_s_c_t_p_association.html#a746e4867059fcd11838ab601a6f5fea1">remoteAddressList</a>);
<a name="l00282"></a>00282     establishIndication-&gt;<a class="code" href="class_s_c_t_p_connect_info.html#a915066438f943362be06cb860e532858">setInboundStreams</a>(<a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a>);
<a name="l00283"></a>00283     establishIndication-&gt;<a class="code" href="class_s_c_t_p_connect_info.html#a75af494956b02c9c4f27aec31bd69937">setOutboundStreams</a>(<a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a>);
<a name="l00284"></a>00284     establishIndication-&gt;<a class="code" href="class_s_c_t_p_command.html#a37523301d495d32f6e84defd8efe6c26">setNumMsgs</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4a45a11cb5d50f9d7cb1799fa105dedb">sendQueueLimit</a>);
<a name="l00285"></a>00285     msg-&gt;setControlInfo(establishIndication);
<a name="l00286"></a>00286     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;to_appl&quot;</span>, <a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a>);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="class_s_c_t_p_association.html#a35a8d95a64b2977c79bf24b1353c0c8e">00290</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a35a8d95a64b2977c79bf24b1353c0c8e">SCTPAssociation::sendToApp</a>(cPacket *msg)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;to_appl&quot;</span>, <a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a>);
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="class_s_c_t_p_association.html#a460894500fa0ffbff9cd62ef59db7475">00295</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a460894500fa0ffbff9cd62ef59db7475">SCTPAssociation::initAssociation</a>(<a class="code" href="class_s_c_t_p_open_command.html">SCTPOpenCommand</a> *openCmd)
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:initAssociation\n&quot;</span>;
<a name="l00298"></a>00298     <span class="comment">// create send/receive queues</span>
<a name="l00299"></a>00299     <span class="keyword">const</span> <span class="keywordtype">char</span> *queueClass = openCmd-&gt;<a class="code" href="class_s_c_t_p_open_command.html#aeaafa47d932f57c0020971007e535d39">getQueueClass</a>();
<a name="l00300"></a>00300     <a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_queue.html">SCTPQueue</a> *&gt;(createOne(queueClass));
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <a class="code" href="class_s_c_t_p_association.html#aafd80d965e20c11d49b38f7001d774b2">retransmissionQ</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_queue.html">SCTPQueue</a> *&gt;(createOne(queueClass));
<a name="l00303"></a>00303     <a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a> = openCmd-&gt;<a class="code" href="class_s_c_t_p_open_command.html#a9758cae51dd15634709d63b5cf82343e">getOutboundStreams</a>();
<a name="l00304"></a>00304     <span class="comment">// create algorithm</span>
<a name="l00305"></a>00305     <span class="keyword">const</span> <span class="keywordtype">char</span> *sctpAlgorithmClass = openCmd-&gt;<a class="code" href="class_s_c_t_p_open_command.html#a4265d331624f0d855e591db8c0249f0d">getSctpAlgorithmClass</a>();
<a name="l00306"></a>00306     <span class="keywordflow">if</span> (!sctpAlgorithmClass || !sctpAlgorithmClass[0])
<a name="l00307"></a>00307         sctpAlgorithmClass = <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;sctpAlgorithmClass&quot;</span>);
<a name="l00308"></a>00308     <a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_s_c_t_p_algorithm.html">SCTPAlgorithm</a> *&gt;(createOne(sctpAlgorithmClass));
<a name="l00309"></a>00309     <a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#aaef644b59f18aa40cea754616c8f9f61">setAssociation</a>(<span class="keyword">this</span>);
<a name="l00310"></a>00310     <a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#a2061a42140d0acd50454a93799f58974">initialize</a>();
<a name="l00311"></a>00311     <span class="comment">// create state block</span>
<a name="l00312"></a>00312     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a> = <a class="code" href="class_s_c_t_p_association.html#ac26892b7e975616f6c9fa87e012e7232">sctpAlgorithm</a>-&gt;<a class="code" href="class_s_c_t_p_algorithm.html#aaca16656400d64a60d3f29e838c08ca1">createStateVariables</a>();
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="class_s_c_t_p_association.html#afc1d3dc0cb62842b7d83998facfbfd06">00316</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#afc1d3dc0cb62842b7d83998facfbfd06">SCTPAssociation::sendInit</a>()
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318     <span class="comment">//RoutingTableAccess routingTableAccess;</span>
<a name="l00319"></a>00319     <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a> interfaceTableAccess;
<a name="l00320"></a>00320     <a class="code" href="_s_c_t_p_association_8h.html#a83ecc618606af11f87a228a6ab74049b">AddressVector</a> adv;
<a name="l00321"></a>00321     uint32 length = <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>() || <a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>==0)
<a name="l00324"></a>00324         opp_error(<span class="stringliteral">&quot;Error processing command ASSOCIATE: foreign socket unspecified&quot;</span>);
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>==0)
<a name="l00326"></a>00326         opp_error(<span class="stringliteral">&quot;Error processing command ASSOCIATE: local port unspecified&quot;</span>);
<a name="l00327"></a>00327     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a5b32a3dfde58166c98ee2c0d074d28b0">setPrimaryPath</a>(<a class="code" href="class_s_c_t_p_association.html#abf49f9153557168b42e7b63eba81d849">getPath</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>));
<a name="l00328"></a>00328     <span class="comment">// create message consisting of INIT chunk</span>
<a name="l00329"></a>00329     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00330"></a>00330     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00331"></a>00331     <a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a> *initChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a>(<span class="stringliteral">&quot;INIT&quot;</span>);
<a name="l00332"></a>00332     initChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>);
<a name="l00333"></a>00333     initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ad413c763401283e0242464a9fa86c0ac">setInitTag</a>((uint32)(fmod(intrand(INT32_MAX), 1.0+(<span class="keywordtype">double</span>)(<span class="keywordtype">unsigned</span>)0xffffffffUL)) &amp; 0xffffffffUL);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a> = initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#afa1021475befe8c6a1c6916c71409458">getInitTag</a>();
<a name="l00336"></a>00336     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;INIT from &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;:InitTag=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00337"></a>00337     initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a896799a07b82f91211161a5b75c6ef85">setA_rwnd</a>(<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;arwnd&quot;</span>));
<a name="l00338"></a>00338     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> = (long)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;arwnd&quot;</span>);
<a name="l00339"></a>00339     initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#aa4436dd2441ff6906064de5cc084d3a8">setNoOutStreams</a>(<a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a>);
<a name="l00340"></a>00340     initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#aac06e82e38763b50c4e681a1f1ec60d3">setNoInStreams</a>(<a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a>);
<a name="l00341"></a>00341     initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#af322f2b11a006a292f845ad6c8acdbbe">setInitTSN</a>(1000);
<a name="l00342"></a>00342     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae8ae55483bf42be31814339345133587">nextTSN</a>=initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ae4065b9263e0e1fb023fa04cfbdf25d3">getInitTSN</a>();
<a name="l00343"></a>00343     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a66dc15b846de9c6aaa9516479481cdaf">lastTSN</a> = initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ae4065b9263e0e1fb023fa04cfbdf25d3">getInitTSN</a>() + <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#adcb6627c45d909e52eba1e3ff4e05b29">numRequests</a> - 1;
<a name="l00344"></a>00344     <a class="code" href="class_s_c_t_p_association.html#adf21f02ef10ae8d3d032337332b5f50f">initTsn</a>=initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ae4065b9263e0e1fb023fa04cfbdf25d3">getInitTSN</a>();
<a name="l00345"></a>00345     <a class="code" href="class_i_interface_table.html">IInterfaceTable</a> *ift = interfaceTableAccess.<a class="code" href="class_module_access.html#a44956ddb52973612afbba0eeecf8bb66">get</a>();
<a name="l00346"></a>00346     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;add local address\n&quot;</span>;
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#af44c3fdaaff9c48fdbb45aac6d6ad082">localAddressList</a>.front() == <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(<span class="stringliteral">&quot;0.0.0.0&quot;</span>))
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349         <span class="keywordflow">for</span> (int32 i=0; i&lt;ift-&gt;<a class="code" href="class_i_interface_table.html#a2b0ce46cd92da6f64fc363410dc71904">getNumInterfaces</a>(); ++i)
<a name="l00350"></a>00350         {
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#ad47857e772397cc2d00de3a8cf464993">ipv4Data</a>()!=NULL)
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353                 adv.push_back(ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#ad47857e772397cc2d00de3a8cf464993">ipv4Data</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#aec8ebefd03acad479ac89d31d7228331">getIPAddress</a>());
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#aed2588713b620093ada1ebfeb85fdbfc">ipv6Data</a>()!=NULL)
<a name="l00356"></a>00356             {
<a name="l00357"></a>00357                 <span class="keywordflow">for</span> (int32 j=0; j&lt;ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#aed2588713b620093ada1ebfeb85fdbfc">ipv6Data</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#ae4fe7ab839b3c7f08226eed79f224103">getNumAddresses</a>(); j++)
<a name="l00358"></a>00358                 {
<a name="l00359"></a>00359                     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;add address &quot;</span>&lt;&lt;ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#aed2588713b620093ada1ebfeb85fdbfc">ipv6Data</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#a908a45071d8685ebbb01f73bb086525b">getAddress</a>(j)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00360"></a>00360                     adv.push_back(ift-&gt;<a class="code" href="class_i_interface_table.html#a19ce4ca3b47b52b8e2b67c25806c4b49">getInterface</a>(i)-&gt;<a class="code" href="class_interface_entry.html#aed2588713b620093ada1ebfeb85fdbfc">ipv6Data</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#a908a45071d8685ebbb01f73bb086525b">getAddress</a>(j));
<a name="l00361"></a>00361                 }
<a name="l00362"></a>00362             }
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365     <span class="keywordflow">else</span>
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367         adv = <a class="code" href="class_s_c_t_p_association.html#af44c3fdaaff9c48fdbb45aac6d6ad082">localAddressList</a>;
<a name="l00368"></a>00368         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;gebundene Adresse &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot; wird hinzugefuegt\n&quot;</span>;
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370     uint32 addrNum=0;
<a name="l00371"></a>00371     <span class="keywordtype">bool</span> friendly = <span class="keyword">false</span>;
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
<a name="l00373"></a>00373     {
<a name="l00374"></a>00374         <span class="keywordflow">for</span> (AddressVector::iterator i=adv.begin(); i!=adv.end(); ++i)
<a name="l00375"></a>00375         {
<a name="l00376"></a>00376             <span class="keywordflow">if</span> (!friendly)
<a name="l00377"></a>00377             {
<a name="l00378"></a>00378                 initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a3ac368b37dbf105ed1c996a3e61011c1">setAddressesArraySize</a>(addrNum+1);
<a name="l00379"></a>00379                 initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a707d281ddcd2d9ad1cf9c83e507fedc9">setAddresses</a>(addrNum++,(*i));
<a name="l00380"></a>00380                 length+=20;
<a name="l00381"></a>00381             }
<a name="l00382"></a>00382             <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#aeb3f468f36416f953ab7e647540f75e4">addLocalAddress</a>(<span class="keyword">this</span>, (*i));
<a name="l00383"></a>00383             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.push_back((*i));
<a name="l00384"></a>00384             <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
<a name="l00385"></a>00385                 <a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>=(*i);
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <span class="keywordflow">else</span>
<a name="l00389"></a>00389     {
<a name="l00390"></a>00390         uint32 rlevel = <a class="code" href="common_8cc.html#a6f8b246051a225410fd4eba9aa2a9f54">getLevel</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l00391"></a>00391         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;level of remote address=&quot;</span>&lt;&lt;rlevel&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00392"></a>00392         <span class="keywordflow">for</span> (AddressVector::iterator i=adv.begin(); i!=adv.end(); ++i)
<a name="l00393"></a>00393         {
<a name="l00394"></a>00394             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;level of address &quot;</span>&lt;&lt;(*i)&lt;&lt;<span class="stringliteral">&quot; = &quot;</span>&lt;&lt;<a class="code" href="common_8cc.html#a6f8b246051a225410fd4eba9aa2a9f54">getLevel</a>((*i))&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00395"></a>00395             <span class="keywordflow">if</span> (<a class="code" href="common_8cc.html#a6f8b246051a225410fd4eba9aa2a9f54">getLevel</a>((*i))&gt;=rlevel)
<a name="l00396"></a>00396             {
<a name="l00397"></a>00397                 initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a3ac368b37dbf105ed1c996a3e61011c1">setAddressesArraySize</a>(addrNum+1);
<a name="l00398"></a>00398                 initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a707d281ddcd2d9ad1cf9c83e507fedc9">setAddresses</a>(addrNum++,(*i));
<a name="l00399"></a>00399                 length+=8;
<a name="l00400"></a>00400                 <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#aeb3f468f36416f953ab7e647540f75e4">addLocalAddress</a>(<span class="keyword">this</span>, (*i));
<a name="l00401"></a>00401                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.push_back((*i));
<a name="l00402"></a>00402                 <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>()==0)
<a name="l00403"></a>00403                     <a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>=(*i);
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rlevel==4 &amp;&amp; <a class="code" href="common_8cc.html#a6f8b246051a225410fd4eba9aa2a9f54">getLevel</a>((*i))==3 &amp;&amp; friendly)
<a name="l00406"></a>00406             {
<a name="l00407"></a>00407                 <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#aeb3f468f36416f953ab7e647540f75e4">addLocalAddress</a>(<span class="keyword">this</span>, (*i));
<a name="l00408"></a>00408                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.push_back((*i));
<a name="l00409"></a>00409                 <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>()==0)
<a name="l00410"></a>00410                     <a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>=(*i);
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#a84f317375ec11a83b15062a0d77694d3">printInfoConnMap</a>();
<a name="l00415"></a>00415     initChunk-&gt;setBitLength(length*8);
<a name="l00416"></a>00416     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(initChunk);
<a name="l00417"></a>00417     <span class="comment">// set path variables</span>
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a746e4867059fcd11838ab601a6f5fea1">remoteAddressList</a>.size()&gt;0)
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420         <span class="keywordflow">for</span> (AddressVector::iterator it=<a class="code" href="class_s_c_t_p_association.html#a746e4867059fcd11838ab601a6f5fea1">remoteAddressList</a>.begin(); it!=<a class="code" href="class_s_c_t_p_association.html#a746e4867059fcd11838ab601a6f5fea1">remoteAddressList</a>.end(); it++)
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;__LINE__&lt;&lt;<span class="stringliteral">&quot; get new path for &quot;</span>&lt;&lt;(*it)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00423"></a>00423             <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_association.html#a940cc2bde58bd842d11b28b3d09130dc">SCTPPathVariables</a>((*it), <span class="keyword">this</span>);
<a name="l00424"></a>00424             <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>[(*it)] = path;
<a name="l00425"></a>00425             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac3aa579f1b930a68ef83ba1404448cc2">roomTransQ</a>[(*it)]    = 0;
<a name="l00426"></a>00426             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a5d59aa98ddb5096586f4a9f85cc4ac16">bookedTransQ</a>[(*it)] = 0;
<a name="l00427"></a>00427             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a767e2849d053dd45d294d8678b8daed9">roomRetransQ</a>[(*it)] = 0;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430     <span class="keywordflow">else</span>
<a name="l00431"></a>00431     {
<a name="l00432"></a>00432         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;__LINE__&lt;&lt;<span class="stringliteral">&quot; get new path for &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00433"></a>00433         <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_association.html#a940cc2bde58bd842d11b28b3d09130dc">SCTPPathVariables</a>(remoteAddr, <span class="keyword">this</span>);
<a name="l00434"></a>00434         <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>[remoteAddr] = path;
<a name="l00435"></a>00435         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac3aa579f1b930a68ef83ba1404448cc2">roomTransQ</a>[remoteAddr]  = 0;
<a name="l00436"></a>00436         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a5d59aa98ddb5096586f4a9f85cc4ac16">bookedTransQ</a>[remoteAddr] = 0;
<a name="l00437"></a>00437         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a767e2849d053dd45d294d8678b8daed9">roomRetransQ</a>[remoteAddr] = 0;
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439     <span class="comment">// send it</span>
<a name="l00440"></a>00440     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af687fe1d41e0f02e4f393ce45a83dd19">initChunk</a>=check_and_cast&lt;<a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a> *&gt;(initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a7d1fa52d2df1abf55584e1468f14c75b">dup</a>());
<a name="l00441"></a>00441     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af687fe1d41e0f02e4f393ce45a83dd19">initChunk</a>-&gt;setName(<span class="stringliteral">&quot;StateInitChunk&quot;</span>);
<a name="l00442"></a>00442     <a class="code" href="class_s_c_t_p_association.html#a120c72df6657d2ef5038d61881ff11c4">printSctpPathMap</a>();
<a name="l00443"></a>00443     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;getFullPath()&lt;&lt;<span class="stringliteral">&quot; sendInit: localVTag=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>&lt;&lt;<span class="stringliteral">&quot; peerVTag=&quot;</span>&lt;&lt;peerVTag&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00444"></a>00444     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg);
<a name="l00445"></a>00445     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#affa2f26db6bbbf00938fa27e35b8f567">assocList</a>.push_back(<span class="keyword">this</span>);
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="class_s_c_t_p_association.html#aec407e9c2c1b4d0c604d8d65e78706e8">00448</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#aec407e9c2c1b4d0c604d8d65e78706e8">SCTPAssociation::retransmitInit</a>()
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00451"></a>00451     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00452"></a>00452     <a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a> *sctpinit;<span class="comment">// = new SCTPInitChunk(&quot;INIT&quot;);</span>
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Retransmit InitChunk=&quot;</span>&lt;&lt;&amp;sctpinit&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     sctpinit=check_and_cast&lt;<a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a> *&gt;(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af687fe1d41e0f02e4f393ce45a83dd19">initChunk</a>-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a7d1fa52d2df1abf55584e1468f14c75b">dup</a>());
<a name="l00457"></a>00457     sctpinit-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>);
<a name="l00458"></a>00458     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(sctpinit);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg);
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="class_s_c_t_p_association.html#ac40f2aff108134cbfcea6cb06e25fdb1">00464</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#ac40f2aff108134cbfcea6cb06e25fdb1">SCTPAssociation::sendInitAck</a>(<a class="code" href="class_s_c_t_p_init_chunk.html">SCTPInitChunk</a>* initChunk)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     uint32 length = <a class="code" href="_s_c_t_p_association_8h.html#a685f1682f68294dbb12e7953e02748a0">SCTP_INIT_CHUNK_LENGTH</a>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a5b32a3dfde58166c98ee2c0d074d28b0">setPrimaryPath</a>(<a class="code" href="class_s_c_t_p_association.html#abf49f9153557168b42e7b63eba81d849">getPath</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>));
<a name="l00469"></a>00469     <span class="comment">// create segment</span>
<a name="l00470"></a>00470     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpinitack = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00471"></a>00471     sctpinitack-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00474"></a>00474     sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00475"></a>00475     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;sendInitAck at &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;. Provided InitTag=&quot;</span>&lt;&lt;initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#afa1021475befe8c6a1c6916c71409458">getInitTag</a>()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00476"></a>00476     <a class="code" href="class_s_c_t_p_init_ack_chunk.html">SCTPInitAckChunk</a> *initAckChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_init_ack_chunk.html">SCTPInitAckChunk</a>(<span class="stringliteral">&quot;INIT_ACK&quot;</span>);
<a name="l00477"></a>00477     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12abb473557985d30fdf16d2525388e3a22">INIT_ACK</a>);
<a name="l00478"></a>00478     <a class="code" href="class_s_c_t_p_cookie.html">SCTPCookie</a> *cookie = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_cookie.html">SCTPCookie</a>(<span class="stringliteral">&quot;CookieUtil&quot;</span>);
<a name="l00479"></a>00479     cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#a95882bf91ab2e066c92cc826d144fee5">setCreationTime</a>(simTime());
<a name="l00480"></a>00480     cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#a418651ad52ef5a5e436689a21eee0575">setLocalTieTagArraySize</a>(32);
<a name="l00481"></a>00481     cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#a0cab05bbec5ce9ad0f62107a871e3bdd">setPeerTieTagArraySize</a>(32);
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()==<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a7fefd7c6e51ba43b6c9d834b372da21e">SCTP_S_CLOSED</a>)
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484         <span class="keywordflow">while</span> (<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>==0)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486             <a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a> = (uint32)intrand(INT32_MAX);
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a2ef9485a254b97e0306b3f638cb18dfa">setInitTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00489"></a>00489         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a24cf153a309a88d3c6fdb6ea11256ff9">setInitTSN</a>(2000);
<a name="l00490"></a>00490         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae8ae55483bf42be31814339345133587">nextTSN</a>=initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ab0621aa5ef96b63f7a2660c421149179">getInitTSN</a>();
<a name="l00491"></a>00491         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a66dc15b846de9c6aaa9516479481cdaf">lastTSN</a> = initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ab0621aa5ef96b63f7a2660c421149179">getInitTSN</a>() + <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#adcb6627c45d909e52eba1e3ff4e05b29">numRequests</a> - 1;
<a name="l00492"></a>00492         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ad68609537bab5a4073a9eb70f173d9bf">setLocalTag</a>(<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>);
<a name="l00493"></a>00493         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa9e44596bb0c1f16569b0efe6f52ced8">setPeerTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00494"></a>00494         <span class="keywordflow">for</span> (int32 i=0; i&lt;32; i++)
<a name="l00495"></a>00495         {
<a name="l00496"></a>00496             cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ae6f7653d65d8a5380b96fce7e2a8d757">setLocalTieTag</a>(i,0);
<a name="l00497"></a>00497             cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa296384e951b7eb7c17ab4807fb31e56">setPeerTieTag</a>(i,0);
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499         sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>);
<a name="l00500"></a>00500         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;state=closed: localVTag=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>&lt;&lt;<span class="stringliteral">&quot; peerVTag=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()==<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8af21d78f3ce1dc469572320cb1e192cc3">SCTP_S_COOKIE_WAIT</a> || <a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()==<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a71d88e86b49412eed493b7307f064944">SCTP_S_COOKIE_ECHOED</a>)
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a2ef9485a254b97e0306b3f638cb18dfa">setInitTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00505"></a>00505         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;different state:set InitTag in InitAck: &quot;</span>&lt;&lt;initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a067000126a6938965bc9deaeed4f33d2">getInitTag</a>()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00506"></a>00506         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a24cf153a309a88d3c6fdb6ea11256ff9">setInitTSN</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae8ae55483bf42be31814339345133587">nextTSN</a>);
<a name="l00507"></a>00507         <a class="code" href="class_s_c_t_p_association.html#a5ca011cb3142dfcd423f4083855a7460">initPeerTsn</a>=initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ae4065b9263e0e1fb023fa04cfbdf25d3">getInitTSN</a>();
<a name="l00508"></a>00508         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> = <a class="code" href="class_s_c_t_p_association.html#a5ca011cb3142dfcd423f4083855a7460">initPeerTsn</a> - 1;
<a name="l00509"></a>00509         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ad68609537bab5a4073a9eb70f173d9bf">setLocalTag</a>(initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#afa1021475befe8c6a1c6916c71409458">getInitTag</a>());
<a name="l00510"></a>00510         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa9e44596bb0c1f16569b0efe6f52ced8">setPeerTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00511"></a>00511         <span class="keywordflow">for</span> (int32 i=0; i&lt;32; i++)
<a name="l00512"></a>00512         {
<a name="l00513"></a>00513             cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa296384e951b7eb7c17ab4807fb31e56">setPeerTieTag</a>(i,(uint8)(intrand(256)));
<a name="l00514"></a>00514             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a524b3dbfe700d9d54e23186893490422">peerTieTag</a>[i] = cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ae49d49fe8c5bb9734f8b2fc2ba9f40c4">getPeerTieTag</a>(i);
<a name="l00515"></a>00515             <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()==<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a71d88e86b49412eed493b7307f064944">SCTP_S_COOKIE_ECHOED</a>)
<a name="l00516"></a>00516             {
<a name="l00517"></a>00517                 cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ae6f7653d65d8a5380b96fce7e2a8d757">setLocalTieTag</a>(i,(uint8)(intrand(256)));
<a name="l00518"></a>00518                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae69a3b5689a645e53211833683509972">localTieTag</a>[i] = cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#a8e219a869570afe5d5bc7dd6c89b38c8">getLocalTieTag</a>(i);
<a name="l00519"></a>00519             }
<a name="l00520"></a>00520             <span class="keywordflow">else</span>
<a name="l00521"></a>00521                 cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ae6f7653d65d8a5380b96fce7e2a8d757">setLocalTieTag</a>(i,0);
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523         sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#afa1021475befe8c6a1c6916c71409458">getInitTag</a>());
<a name="l00524"></a>00524         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;VTag in InitAck: &quot;</span>&lt;&lt;sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#acdebc18b6064656d372b86198736dd67">getTag</a>()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526     <span class="keywordflow">else</span>
<a name="l00527"></a>00527     {
<a name="l00528"></a>00528         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;other state\n&quot;</span>;
<a name="l00529"></a>00529         uint32 tag=0;
<a name="l00530"></a>00530         <span class="keywordflow">while</span> (tag==0)
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532             tag = (uint32)(fmod(intrand(INT32_MAX), 1.0+(<span class="keywordtype">double</span>)(<span class="keywordtype">unsigned</span>)0xffffffffUL)) &amp; 0xffffffffUL;
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a2ef9485a254b97e0306b3f638cb18dfa">setInitTag</a>(tag);
<a name="l00535"></a>00535         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a24cf153a309a88d3c6fdb6ea11256ff9">setInitTSN</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae8ae55483bf42be31814339345133587">nextTSN</a>);
<a name="l00536"></a>00536         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ad68609537bab5a4073a9eb70f173d9bf">setLocalTag</a>(<a class="code" href="class_s_c_t_p_association.html#ada797c4d0c058044396199946575173b">localVTag</a>);
<a name="l00537"></a>00537         cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa9e44596bb0c1f16569b0efe6f52ced8">setPeerTag</a>(<a class="code" href="class_s_c_t_p_association.html#acb96c9464cb79b841406fe7fcecff941">peerVTag</a>);
<a name="l00538"></a>00538         <span class="keywordflow">for</span> (int32 i=0; i&lt;32; i++)
<a name="l00539"></a>00539         {
<a name="l00540"></a>00540             cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#aa296384e951b7eb7c17ab4807fb31e56">setPeerTieTag</a>(i,<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a524b3dbfe700d9d54e23186893490422">peerTieTag</a>[i]);
<a name="l00541"></a>00541             cookie-&gt;<a class="code" href="class_s_c_t_p_cookie.html#ae6f7653d65d8a5380b96fce7e2a8d757">setLocalTieTag</a>(i,<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ae69a3b5689a645e53211833683509972">localTieTag</a>[i]);
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543         sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#aab816f025dd8a85ce2603e161a5afced">setTag</a>(initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#afa1021475befe8c6a1c6916c71409458">getInitTag</a>());
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     cookie-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a3aeb03eaba88c9681ecb920f24c689d2">SCTP_COOKIE_LENGTH</a>*8);
<a name="l00546"></a>00546     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a38090c2aa5d119bb287fc7f153511824">setStateCookie</a>(cookie);
<a name="l00547"></a>00547     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#aacea71bb3621de42025d61f5b7db987d">setCookieArraySize</a>(0);
<a name="l00548"></a>00548     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#aca89e11d23aba5c9ea06e7bce8e3b652">setA_rwnd</a>(<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;arwnd&quot;</span>));
<a name="l00549"></a>00549     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> = (long)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;arwnd&quot;</span>);
<a name="l00550"></a>00550     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a45f3f8ab1fae8c1bbc9879ed5b13db1f">setNoOutStreams</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(<a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a>,initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a7d5b4ee8a00cd330a724936d3ad0403d">getNoInStreams</a>()));
<a name="l00551"></a>00551     initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ace45ebfc454e4ac5867e7febaee16a22">setNoInStreams</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(<a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a>,initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a9216f42a96bd384ccd5fc7efbe429646">getNoOutStreams</a>()));
<a name="l00552"></a>00552     <a class="code" href="class_s_c_t_p_association.html#adf21f02ef10ae8d3d032337332b5f50f">initTsn</a>=initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ab0621aa5ef96b63f7a2660c421149179">getInitTSN</a>();
<a name="l00553"></a>00553     uint32 addrNum=0;
<a name="l00554"></a>00554     <span class="keywordtype">bool</span> friendly = <span class="keyword">false</span>;
<a name="l00555"></a>00555     <span class="keywordflow">if</span> (!friendly)
<a name="l00556"></a>00556     <span class="keywordflow">for</span> (AddressVector::iterator k=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.begin(); k!=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.end(); ++k)
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ad70d5abe980530ad3acbf9cbcf419a8a">setAddressesArraySize</a>(addrNum+1);
<a name="l00559"></a>00559         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#abac0eafe21562f7220b308e952763cf4">setAddresses</a>(addrNum++,(*k));
<a name="l00560"></a>00560         length+=8;
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562     uint32 unknownLen = initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a823a5de4117c53aae7d59244b02c6e63">getUnrecognizedParametersArraySize</a>();
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (unknownLen&gt;0)
<a name="l00564"></a>00564     {
<a name="l00565"></a>00565         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Found unrecognized Parameters in INIT chunk with a length of &quot;</span>&lt;&lt;unknownLen&lt;&lt;<span class="stringliteral">&quot; bytes.\n&quot;</span>;
<a name="l00566"></a>00566         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ae7750b4f43ce1ba6d61af64d3ff27501">setUnrecognizedParametersArraySize</a>(unknownLen);
<a name="l00567"></a>00567         <span class="keywordflow">for</span> (uint32 i=0; i&lt;unknownLen; i++)
<a name="l00568"></a>00568             initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a68185c5126d620ce5aa51c015fb3ff53">setUnrecognizedParameters</a>(i,initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#ad020eb452f23dcb7a358db5aba72c8fe">getUnrecognizedParameters</a>(i));
<a name="l00569"></a>00569         length+=unknownLen;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     <span class="keywordflow">else</span>
<a name="l00572"></a>00572         initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ae7750b4f43ce1ba6d61af64d3ff27501">setUnrecognizedParametersArraySize</a>(0);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     initAckChunk-&gt;setBitLength((length+initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a24e8f6d8289e0f9df13cb0b009591865">getCookieArraySize</a>())*8 + cookie-&gt;getBitLength());
<a name="l00575"></a>00575     <a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a> = ((initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a9216f42a96bd384ccd5fc7efbe429646">getNoOutStreams</a>()&lt;initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ad5c6481930be3268165af4939b911bd3">getNoInStreams</a>())?initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a9216f42a96bd384ccd5fc7efbe429646">getNoOutStreams</a>():initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#ad5c6481930be3268165af4939b911bd3">getNoInStreams</a>());
<a name="l00576"></a>00576     <a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a> = ((initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a7d5b4ee8a00cd330a724936d3ad0403d">getNoInStreams</a>()&lt;initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a64b761b71a09ea953f5bce83fd97ffdd">getNoOutStreams</a>())?initChunk-&gt;<a class="code" href="class_s_c_t_p_init_chunk.html#a7d5b4ee8a00cd330a724936d3ad0403d">getNoInStreams</a>():initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a64b761b71a09ea953f5bce83fd97ffdd">getNoOutStreams</a>());
<a name="l00577"></a>00577     (this-&gt;*<a class="code" href="class_s_c_t_p_association.html#a9988effc78d17db9b32a8d6a976c2288">ssFunctions</a>.<a class="code" href="struct_s_c_t_p_association_1_1stream_scheduling_functions.html#a5796699025095f8e6c57aaff4b5d3538">ssInitStreams</a>)(<a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a>, <a class="code" href="class_s_c_t_p_association.html#a3dc6e025463c8749b1239268d91b2b60">outboundStreams</a>);
<a name="l00578"></a>00578     sctpinitack-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(initAckChunk);
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState()==<a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8a7fefd7c6e51ba43b6c9d834b372da21e">SCTP_S_CLOSED</a>)
<a name="l00580"></a>00580     {
<a name="l00581"></a>00581         <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpinitack, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a6270b0edb7777931a33ff8662288bf25">initialPrimaryPath</a>);
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583     <span class="keywordflow">else</span>
<a name="l00584"></a>00584     {
<a name="l00585"></a>00585         <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpinitack);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588     <a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#affa2f26db6bbbf00938fa27e35b8f567">assocList</a>.push_back(<span class="keyword">this</span>);
<a name="l00589"></a>00589     <a class="code" href="class_s_c_t_p_association.html#a120c72df6657d2ef5038d61881ff11c4">printSctpPathMap</a>();
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a><a class="code" href="class_s_c_t_p_association.html#a3ef5a4494cd7b59c44f44d6ed385e9de">00592</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a3ef5a4494cd7b59c44f44d6ed385e9de">SCTPAssociation::sendCookieEcho</a>(<a class="code" href="class_s_c_t_p_init_ack_chunk.html">SCTPInitAckChunk</a>* initAckChunk)
<a name="l00593"></a>00593 {
<a name="l00594"></a>00594     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpcookieecho = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00595"></a>00595     sctpcookieecho-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:sendCookieEcho\n&quot;</span>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     sctpcookieecho-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00600"></a>00600     sctpcookieecho-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00601"></a>00601     <a class="code" href="class_s_c_t_p_cookie_echo_chunk.html">SCTPCookieEchoChunk</a>* cookieEchoChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_cookie_echo_chunk.html">SCTPCookieEchoChunk</a>(<span class="stringliteral">&quot;COOKIE_ECHO&quot;</span>);
<a name="l00602"></a>00602     cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12ac6c3901afa866152be0e645c2c38f471">COOKIE_ECHO</a>);
<a name="l00603"></a>00603     int32 len = initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a24e8f6d8289e0f9df13cb0b009591865">getCookieArraySize</a>();
<a name="l00604"></a>00604     cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#afb53154625a64f9292410c0aa07f6a7b">setCookieArraySize</a>(len);
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (len&gt;0)
<a name="l00606"></a>00606     {
<a name="l00607"></a>00607         <span class="keywordflow">for</span> (int32 i=0; i&lt;len; i++)
<a name="l00608"></a>00608             cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#aae468ff42821c1bd2b2d06979bb4bfa1">setCookie</a>(i, initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a8d62a78b87a356c3effaf9f90e3bf86a">getCookie</a>(i));
<a name="l00609"></a>00609         cookieEchoChunk-&gt;setBitLength((<a class="code" href="_s_c_t_p_association_8h.html#aee9e5129c64e3a5dfbda76dd06c62a23">SCTP_COOKIE_ACK_LENGTH</a>+len)*8);
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611     <span class="keywordflow">else</span>
<a name="l00612"></a>00612     {
<a name="l00613"></a>00613         <a class="code" href="class_s_c_t_p_cookie.html">SCTPCookie</a>* cookie = check_and_cast &lt;<a class="code" href="class_s_c_t_p_cookie.html">SCTPCookie</a>*&gt; (initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a18e03b3bbea7b90f09d94bc1c24c97bc">getStateCookie</a>());
<a name="l00614"></a>00614         cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a992073a4d09627ba9cc9bceb7fae4a18">setStateCookie</a>(cookie);
<a name="l00615"></a>00615         cookieEchoChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aee9e5129c64e3a5dfbda76dd06c62a23">SCTP_COOKIE_ACK_LENGTH</a>*8 + cookie-&gt;getBitLength());
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617     uint32 unknownLen = initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a782f1937ded9a07b427f13c9a6a22330">getUnrecognizedParametersArraySize</a>();
<a name="l00618"></a>00618     <span class="keywordflow">if</span> (unknownLen&gt;0)
<a name="l00619"></a>00619     {
<a name="l00620"></a>00620         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Found unrecognized Parameters in INIT-ACK chunk with a length of &quot;</span>&lt;&lt;unknownLen&lt;&lt;<span class="stringliteral">&quot; bytes.\n&quot;</span>;
<a name="l00621"></a>00621         cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#aa0a06a918e71a02577655e8b09213d0a">setUnrecognizedParametersArraySize</a>(unknownLen);
<a name="l00622"></a>00622         <span class="keywordflow">for</span> (uint32 i=0; i&lt;unknownLen; i++)
<a name="l00623"></a>00623             cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a05c6d75a6d3061e80f122de74b082cfe">setUnrecognizedParameters</a>(i,initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a5e151d257e5adafe3ca326f57e7df6e9">getUnrecognizedParameters</a>(i));
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625     <span class="keywordflow">else</span>
<a name="l00626"></a>00626         cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#aa0a06a918e71a02577655e8b09213d0a">setUnrecognizedParametersArraySize</a>(0);
<a name="l00627"></a>00627     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a977478bfadd7d0296a7a805ec9e56a95">cookieChunk</a>=check_and_cast&lt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html">SCTPCookieEchoChunk</a>*&gt;(cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#aea7eb41153f202007e1476f1da9d3242">dup</a>());
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (len==0)
<a name="l00629"></a>00629     {
<a name="l00630"></a>00630         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a977478bfadd7d0296a7a805ec9e56a95">cookieChunk</a>-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a992073a4d09627ba9cc9bceb7fae4a18">setStateCookie</a>(initAckChunk-&gt;<a class="code" href="class_s_c_t_p_init_ack_chunk.html#a18e03b3bbea7b90f09d94bc1c24c97bc">getStateCookie</a>()-&gt;dup());
<a name="l00631"></a>00631             }
<a name="l00632"></a>00632     sctpcookieecho-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(cookieEchoChunk);
<a name="l00633"></a>00633         <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpcookieecho);
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="class_s_c_t_p_association.html#ae9ffc855fcb6cfd50fb34a03beaa2d39">00637</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#ae9ffc855fcb6cfd50fb34a03beaa2d39">SCTPAssociation::retransmitCookieEcho</a>()
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>*                 sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00640"></a>00640     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00641"></a>00641     <a class="code" href="class_s_c_t_p_cookie_echo_chunk.html">SCTPCookieEchoChunk</a>* cookieEchoChunk=check_and_cast&lt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html">SCTPCookieEchoChunk</a>*&gt;(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a977478bfadd7d0296a7a805ec9e56a95">cookieChunk</a>-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#aea7eb41153f202007e1476f1da9d3242">dup</a>());
<a name="l00642"></a>00642     <span class="keywordflow">if</span> (cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a25f09010d055ab8d1eff2dcbfed08611">getCookieArraySize</a>()==0)
<a name="l00643"></a>00643     {
<a name="l00644"></a>00644         cookieEchoChunk-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a992073a4d09627ba9cc9bceb7fae4a18">setStateCookie</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a977478bfadd7d0296a7a805ec9e56a95">cookieChunk</a>-&gt;<a class="code" href="class_s_c_t_p_cookie_echo_chunk.html#a08fee47c7a7d7f89a49949156069e267">getStateCookie</a>()-&gt;dup());
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(cookieEchoChunk);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;retransmitCookieEcho localAddr=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;     remoteAddr&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg);
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a><a class="code" href="class_s_c_t_p_association.html#afc5f06d167b937c0d1267047960bc354">00653</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#afc5f06d167b937c0d1267047960bc354">SCTPAssociation::sendHeartbeat</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>* sctpHeartbeatbeat = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00656"></a>00656     sctpHeartbeatbeat-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     sctpHeartbeatbeat-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00659"></a>00659     sctpHeartbeatbeat-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00660"></a>00660     <a class="code" href="class_s_c_t_p_heartbeat_chunk.html">SCTPHeartbeatChunk</a>* heartbeatChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_heartbeat_chunk.html">SCTPHeartbeatChunk</a>(<span class="stringliteral">&quot;HEARTBEAT&quot;</span>);
<a name="l00661"></a>00661     heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a0f286b0bbc1ee4f20be5136a55cf8923">HEARTBEAT</a>);
<a name="l00662"></a>00662     heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a3cf69330567c13da3708bb108f9eb00b">setRemoteAddr</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>);
<a name="l00663"></a>00663     heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a665e3ae6f0e08d390890b174bfd275be">setTimeField</a>(simTime());
<a name="l00664"></a>00664     heartbeatChunk-&gt;setBitLength((<a class="code" href="_s_c_t_p_association_8h.html#adf7452edbaf15112920d12e92d14dfd9">SCTP_HEARTBEAT_CHUNK_LENGTH</a>+12)*8);
<a name="l00665"></a>00665     sctpHeartbeatbeat-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(heartbeatChunk);
<a name="l00666"></a>00666     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;sendHeartbeat: sendToIP to &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a> &lt;&lt; endl;
<a name="l00667"></a>00667     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpHeartbeatbeat, path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>);
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a><a class="code" href="class_s_c_t_p_association.html#a4693aa8d9ce24d9bf798cb7feefd1085">00670</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a4693aa8d9ce24d9bf798cb7feefd1085">SCTPAssociation::sendHeartbeatAck</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_heartbeat_chunk.html">SCTPHeartbeatChunk</a>* heartbeatChunk,
<a name="l00671"></a>00671                                                     <span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp;        src,
<a name="l00672"></a>00672                                                     <span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp;        dest)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>*                 sctpHeartbeatAck = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00675"></a>00675     sctpHeartbeatAck-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00676"></a>00676     sctpHeartbeatAck-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00677"></a>00677     sctpHeartbeatAck-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00678"></a>00678     <a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html">SCTPHeartbeatAckChunk</a>* heartbeatAckChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html">SCTPHeartbeatAckChunk</a>(<span class="stringliteral">&quot;HEARTBEAT_ACK&quot;</span>);
<a name="l00679"></a>00679     heartbeatAckChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a5621dd83f6f32ee90c0d505867c67b71">HEARTBEAT_ACK</a>);
<a name="l00680"></a>00680     heartbeatAckChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html#a22ba7bcdf20e1b65cb8a312dcf20a87d">setRemoteAddr</a>(heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a671948890fb3346480996dfcd2b16e9c">getRemoteAddr</a>());
<a name="l00681"></a>00681     heartbeatAckChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html#ac40c3fc4bf7d2c57ecd7ac7add556915">setTimeField</a>(heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a9c0553f66439a5818d86e84e8704feb1">getTimeField</a>());
<a name="l00682"></a>00682     <span class="keyword">const</span> int32 len = heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a3f724f66dfb7dc7e7030e83ad932e8d7">getInfoArraySize</a>();
<a name="l00683"></a>00683     <span class="keywordflow">if</span> (len &gt; 0){
<a name="l00684"></a>00684         heartbeatAckChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html#a4f2aee5f64fb0c662e682429ec939cd8">setInfoArraySize</a>(len);
<a name="l00685"></a>00685         <span class="keywordflow">for</span> (int32 i=0; i&lt;len; i++)
<a name="l00686"></a>00686             heartbeatAckChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_ack_chunk.html#ab708e9a084ecb0e4cf9fafa0037fca6b">setInfo</a>(i,heartbeatChunk-&gt;<a class="code" href="class_s_c_t_p_heartbeat_chunk.html#a9c2f2e4e1dab48f25fe92da7af38478c">getInfo</a>(i));
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     heartbeatAckChunk-&gt;setBitLength(heartbeatChunk-&gt;getBitLength());
<a name="l00690"></a>00690     sctpHeartbeatAck-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(heartbeatAckChunk);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;sendHeartbeatAck: sendToIP from &quot;</span> &lt;&lt; src &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; dest &lt;&lt; endl;
<a name="l00693"></a>00693     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpHeartbeatAck, dest);
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="class_s_c_t_p_association.html#ad277c3986a8173ffe41289f72765ceba">00696</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#ad277c3986a8173ffe41289f72765ceba">SCTPAssociation::sendCookieAck</a>(<span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp; dest)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpcookieack = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00699"></a>00699     sctpcookieack-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:sendCookieACK\n&quot;</span>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     sctpcookieack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00704"></a>00704     sctpcookieack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00705"></a>00705     <a class="code" href="class_s_c_t_p_cookie_ack_chunk.html">SCTPCookieAckChunk</a>* cookieAckChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_cookie_ack_chunk.html">SCTPCookieAckChunk</a>(<span class="stringliteral">&quot;COOKIE_ACK&quot;</span>);
<a name="l00706"></a>00706     cookieAckChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a8cb5544ff09ee0b2ae1f1171de9597bd">COOKIE_ACK</a>);
<a name="l00707"></a>00707     cookieAckChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aee9e5129c64e3a5dfbda76dd06c62a23">SCTP_COOKIE_ACK_LENGTH</a>*8);
<a name="l00708"></a>00708     sctpcookieack-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(cookieAckChunk);
<a name="l00709"></a>00709     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpcookieack, dest);
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="class_s_c_t_p_association.html#a588cedb27c104ca159fce93dfd53e4c7">00712</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a588cedb27c104ca159fce93dfd53e4c7">SCTPAssociation::sendShutdownAck</a>(<span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp; dest)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714     <a class="code" href="class_s_c_t_p_association.html#ab0faa9ccd46630cfab7a2bc75fb1d52d">sendOnAllPaths</a>(<a class="code" href="class_s_c_t_p_association.html#abf49f9153557168b42e7b63eba81d849">getPath</a>(dest));
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a8270ebaccc92eb00ffae041a8406b094">getOutstandingBytes</a>() == 0) {
<a name="l00716"></a>00716         <a class="code" href="class_s_c_t_p_association.html#a7471310ea5aa0cca813d1452f70bf218">performStateTransition</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda861e58ca6562ffbfe4884eec2e704431">SCTP_E_NO_MORE_OUTSTANDING</a>);
<a name="l00717"></a>00717         <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpshutdownack = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00718"></a>00718         sctpshutdownack-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;SCTPAssociationUtil:sendShutdownACK&quot;</span> &lt;&lt; endl;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722         sctpshutdownack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00723"></a>00723         sctpshutdownack-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00724"></a>00724         <a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html">SCTPShutdownAckChunk</a>* shutdownAckChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html">SCTPShutdownAckChunk</a>(<span class="stringliteral">&quot;SHUTDOWN_ACK&quot;</span>);
<a name="l00725"></a>00725         shutdownAckChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7f11b152058ba8f4656266d735a50c4b">SHUTDOWN_ACK</a>);
<a name="l00726"></a>00726         shutdownAckChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aee9e5129c64e3a5dfbda76dd06c62a23">SCTP_COOKIE_ACK_LENGTH</a>*8);
<a name="l00727"></a>00727         sctpshutdownack-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(shutdownAckChunk);
<a name="l00728"></a>00728         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7a94234b046495e7c2e4d60df00b74c4">initRexmitTimeout</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad0253f70ce80e86b5da3240da37f4334">SCTP_TIMEOUT_INIT_REXMIT</a>;
<a name="l00729"></a>00729         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4b4a00ea47be687ea159b82507339cdb">initRetransCounter</a> = 0;
<a name="l00730"></a>00730         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ab57c64d047b0645a215f7e0bc2d903fb">T2_ShutdownTimer</a>);
<a name="l00731"></a>00731         <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ab57c64d047b0645a215f7e0bc2d903fb">T2_ShutdownTimer</a>,<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7a94234b046495e7c2e4d60df00b74c4">initRexmitTimeout</a>);
<a name="l00732"></a>00732         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ac418d05be502a677a2f22b375f7e7a7b">T5_ShutdownGuardTimer</a>);
<a name="l00733"></a>00733         <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ac418d05be502a677a2f22b375f7e7a7b">T5_ShutdownGuardTimer</a>,<a class="code" href="_s_c_t_p_association_8h.html#a45e10ab1204a49d216a4c2f4a8826848">SHUTDOWN_GUARD_TIMEOUT</a>);
<a name="l00734"></a>00734         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c69e50746d1c61b284521df08bfeeff">shutdownAckChunk</a>=check_and_cast&lt;<a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html">SCTPShutdownAckChunk</a>*&gt;(shutdownAckChunk-&gt;<a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html#a0b486ad2354ae9edf08e16657fdcb387">dup</a>());
<a name="l00735"></a>00735         <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpshutdownack, dest);
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="class_s_c_t_p_association.html#a30c6da407b37844471cbd5c69918ae52">00739</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a30c6da407b37844471cbd5c69918ae52">SCTPAssociation::sendShutdownComplete</a>()
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpshutdowncomplete = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00742"></a>00742     sctpshutdowncomplete-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:sendShutdownComplete\n&quot;</span>;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     sctpshutdowncomplete-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00747"></a>00747     sctpshutdowncomplete-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>);
<a name="l00748"></a>00748     <a class="code" href="class_s_c_t_p_shutdown_complete_chunk.html">SCTPShutdownCompleteChunk</a>* shutdownCompleteChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_shutdown_complete_chunk.html">SCTPShutdownCompleteChunk</a>(<span class="stringliteral">&quot;SHUTDOWN_COMPLETE&quot;</span>);
<a name="l00749"></a>00749     shutdownCompleteChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a1ac9ae29771c5095efe16ce822d561d7">SHUTDOWN_COMPLETE</a>);
<a name="l00750"></a>00750     shutdownCompleteChunk-&gt;<a class="code" href="class_s_c_t_p_shutdown_complete_chunk.html#a497d1fc142ae36f49efa1529db6b65ac">setTBit</a>(0);
<a name="l00751"></a>00751     shutdownCompleteChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#ad1963dfab19884e93c14d1527c1e0535">SCTP_SHUTDOWN_ACK_LENGTH</a>*8);
<a name="l00752"></a>00752     sctpshutdowncomplete-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(shutdownCompleteChunk);
<a name="l00753"></a>00753     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpshutdowncomplete);
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 
<a name="l00757"></a><a class="code" href="class_s_c_t_p_association.html#a0c2b31f00e428a2c8c5fe8aa5f3430fe">00757</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a0c2b31f00e428a2c8c5fe8aa5f3430fe">SCTPAssociation::sendAbort</a>()
<a name="l00758"></a>00758 {
<a name="l00759"></a>00759     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *msg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00760"></a>00760     msg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:sendABORT localPort=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>&lt;&lt;<span class="stringliteral">&quot;    remotePort=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     msg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00765"></a>00765     msg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(remotePort);
<a name="l00766"></a>00766     <a class="code" href="class_s_c_t_p_abort_chunk.html">SCTPAbortChunk</a>* abortChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_abort_chunk.html">SCTPAbortChunk</a>(<span class="stringliteral">&quot;ABORT&quot;</span>);
<a name="l00767"></a>00767     abortChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a781ad2788df9e25c59a70894c7832096">ABORT</a>);
<a name="l00768"></a>00768     abortChunk-&gt;<a class="code" href="class_s_c_t_p_abort_chunk.html#a992f6e445630f0cb902d00dba0ba1ffe">setT_Bit</a>(0);
<a name="l00769"></a>00769     abortChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a2383950ff71160db077c713351a3baff">SCTP_ABORT_CHUNK_LENGTH</a>*8);
<a name="l00770"></a>00770     msg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(abortChunk);
<a name="l00771"></a>00771     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(msg, <a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00774"></a><a class="code" href="class_s_c_t_p_association.html#a76fce22241a52542859d1dcddac4651a">00774</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a76fce22241a52542859d1dcddac4651a">SCTPAssociation::sendShutdown</a>()
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *msg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00777"></a>00777     msg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:sendShutdown localPort=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>&lt;&lt;<span class="stringliteral">&quot;     remotePort=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a62e2c58ac9cc4e804800c05bae9da71f">remotePort</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     msg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a1fc28c5f3b3ff6c808d254b1db9e46f8">setSrcPort</a>(<a class="code" href="class_s_c_t_p_association.html#acb21c9ce886b796d5134b1c0daa3227b">localPort</a>);
<a name="l00782"></a>00782     msg-&gt;<a class="code" href="class_s_c_t_p_message___base.html#a6944d6ac97e5afa1960a682638881a1b">setDestPort</a>(remotePort);
<a name="l00783"></a>00783     <a class="code" href="class_s_c_t_p_shutdown_chunk.html">SCTPShutdownChunk</a>* shutdownChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_shutdown_chunk.html">SCTPShutdownChunk</a>(<span class="stringliteral">&quot;SHUTDOWN&quot;</span>);
<a name="l00784"></a>00784     shutdownChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a7690b021f467450541d8d89123429d40">SHUTDOWN</a>);
<a name="l00785"></a>00785     <span class="comment">//shutdownChunk-&gt;setCumTsnAck(state-&gt;lastTsnAck);</span>
<a name="l00786"></a>00786     shutdownChunk-&gt;<a class="code" href="class_s_c_t_p_shutdown_chunk.html#ac17da447c6cada03dcb8ad7accb72c30">setCumTsnAck</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>);
<a name="l00787"></a>00787     shutdownChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a096ad48a9dc5dcbd73658c5cadbf3636">SCTP_SHUTDOWN_CHUNK_LENGTH</a>*8);
<a name="l00788"></a>00788     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7a94234b046495e7c2e4d60df00b74c4">initRexmitTimeout</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad0253f70ce80e86b5da3240da37f4334">SCTP_TIMEOUT_INIT_REXMIT</a>;
<a name="l00789"></a>00789     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4b4a00ea47be687ea159b82507339cdb">initRetransCounter</a> = 0;
<a name="l00790"></a>00790     <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ac418d05be502a677a2f22b375f7e7a7b">T5_ShutdownGuardTimer</a>);
<a name="l00791"></a>00791     <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ac418d05be502a677a2f22b375f7e7a7b">T5_ShutdownGuardTimer</a>,<a class="code" href="_s_c_t_p_association_8h.html#a45e10ab1204a49d216a4c2f4a8826848">SHUTDOWN_GUARD_TIMEOUT</a>);
<a name="l00792"></a>00792     <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ab57c64d047b0645a215f7e0bc2d903fb">T2_ShutdownTimer</a>);
<a name="l00793"></a>00793     <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(<a class="code" href="class_s_c_t_p_association.html#ab57c64d047b0645a215f7e0bc2d903fb">T2_ShutdownTimer</a>,<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7a94234b046495e7c2e4d60df00b74c4">initRexmitTimeout</a>);
<a name="l00794"></a>00794     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ab71f05d4300e0fd95bd5e371c3615979">shutdownChunk</a>=check_and_cast&lt;<a class="code" href="class_s_c_t_p_shutdown_chunk.html">SCTPShutdownChunk</a>*&gt;(shutdownChunk-&gt;<a class="code" href="class_s_c_t_p_shutdown_chunk.html#aa2a59eee4b74f78491e4172fb557556b">dup</a>());
<a name="l00795"></a>00795     msg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(shutdownChunk);
<a name="l00796"></a>00796     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(msg, <a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l00797"></a>00797     <a class="code" href="class_s_c_t_p_association.html#a7471310ea5aa0cca813d1452f70bf218">performStateTransition</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7dda861e58ca6562ffbfe4884eec2e704431">SCTP_E_NO_MORE_OUTSTANDING</a>);
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 
<a name="l00801"></a><a class="code" href="class_s_c_t_p_association.html#aa28d6c19ab622ed5564596c7f300aea4">00801</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#aa28d6c19ab622ed5564596c7f300aea4">SCTPAssociation::retransmitShutdown</a>()
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00804"></a>00804     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00805"></a>00805     <a class="code" href="class_s_c_t_p_shutdown_chunk.html">SCTPShutdownChunk</a>* shutdownChunk;
<a name="l00806"></a>00806     shutdownChunk=check_and_cast&lt;<a class="code" href="class_s_c_t_p_shutdown_chunk.html">SCTPShutdownChunk</a>*&gt;(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ab71f05d4300e0fd95bd5e371c3615979">shutdownChunk</a>-&gt;<a class="code" href="class_s_c_t_p_shutdown_chunk.html#aa2a59eee4b74f78491e4172fb557556b">dup</a>());
<a name="l00807"></a>00807     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(shutdownChunk);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;retransmitShutdown localAddr=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;  remoteAddr&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg);
<a name="l00812"></a>00812 }
<a name="l00813"></a>00813 
<a name="l00814"></a><a class="code" href="class_s_c_t_p_association.html#a0c70dd4b41af917ecbaebd2850a808e0">00814</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a0c70dd4b41af917ecbaebd2850a808e0">SCTPAssociation::retransmitShutdownAck</a>()
<a name="l00815"></a>00815 {
<a name="l00816"></a>00816     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a> *sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00817"></a>00817     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00818"></a>00818     <a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html">SCTPShutdownAckChunk</a>* shutdownAckChunk;
<a name="l00819"></a>00819     shutdownAckChunk=check_and_cast&lt;<a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html">SCTPShutdownAckChunk</a>*&gt;(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c69e50746d1c61b284521df08bfeeff">shutdownAckChunk</a>-&gt;<a class="code" href="class_s_c_t_p_shutdown_ack_chunk.html#a0b486ad2354ae9edf08e16657fdcb387">dup</a>());
<a name="l00820"></a>00820     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(shutdownAckChunk);
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;retransmitShutdownAck localAddr=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;  remoteAddr&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg);
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a><a class="code" href="class_s_c_t_p_association.html#ad26d83ea266011e34ebfbc56f7ee1e75">00828</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#ad26d83ea266011e34ebfbc56f7ee1e75">SCTPAssociation::scheduleSack</a>()
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <span class="comment">/* increase SACK counter, we received another data PACKET */</span>
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ab44c46d79f8a2504941b5903322b0448">firstChunkReceived</a>)
<a name="l00832"></a>00832         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acd712e40d2abba82caa4acb46a16fc8b">ackState</a>++;
<a name="l00833"></a>00833     <span class="keywordflow">else</span>
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acd712e40d2abba82caa4acb46a16fc8b">ackState</a> = <a class="code" href="class_s_c_t_p_association.html#ac5b54b2f8fbba401964d30c71e25118f">sackFrequency</a>;
<a name="l00836"></a>00836         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ab44c46d79f8a2504941b5903322b0448">firstChunkReceived</a> = <span class="keyword">true</span>;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;scheduleSack() : ackState is now: &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acd712e40d2abba82caa4acb46a16fc8b">ackState</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acd712e40d2abba82caa4acb46a16fc8b">ackState</a> &lt;= <a class="code" href="class_s_c_t_p_association.html#ac5b54b2f8fbba401964d30c71e25118f">sackFrequency</a> - 1)
<a name="l00842"></a>00842     {
<a name="l00843"></a>00843         <span class="comment">/* start a SACK timer if none is running, to expire 200 ms (or parameter) from now */</span>
<a name="l00844"></a>00844         <span class="keywordflow">if</span> (!<a class="code" href="class_s_c_t_p_association.html#a1fae2ceab572718540c51768e3c1c452">SackTimer</a>-&gt;isScheduled())
<a name="l00845"></a>00845         {
<a name="l00846"></a>00846              <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(<a class="code" href="class_s_c_t_p_association.html#a1fae2ceab572718540c51768e3c1c452">SackTimer</a>, <a class="code" href="class_s_c_t_p_association.html#a29f900c7ca380c1671bb957109fc338b">sackPeriod</a>);
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848         <span class="comment">/* else: leave timer running, and do nothing... */</span> <span class="keywordflow">else</span> {
<a name="l00849"></a>00849             <span class="comment">/* is this possible at all ? Check this... */</span>
<a name="l00850"></a>00850 
<a name="l00851"></a>00851             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SACK timer running, but scheduleSack() called\n&quot;</span>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 
<a name="l00858"></a><a class="code" href="class_s_c_t_p_association.html#a0054d12cb552f7417b97c7e671231905">00858</a> <a class="code" href="class_s_c_t_p_sack_chunk.html">SCTPSackChunk</a>* <a class="code" href="class_s_c_t_p_association.html#a0054d12cb552f7417b97c7e671231905">SCTPAssociation::createSack</a>()
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     uint32 key=0, arwnd=0;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SCTPAssociationUtil:createSACK localAddress=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot;  remoteAddress=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot; localRwnd=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a>&lt;&lt;<span class="stringliteral">&quot; queuedBytes=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00865"></a>00865     <span class="keywordflow">if</span> ((int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>) &lt;= 0)
<a name="l00866"></a>00866     {
<a name="l00867"></a>00867         arwnd = 0;
<a name="l00868"></a>00868         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a> &gt; 0)
<a name="l00869"></a>00869             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20b24275e45b18df329a7254563e306d">swsAvoidanceInvoked</a> = <span class="keyword">true</span>;
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> &lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a> || <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20b24275e45b18df329a7254563e306d">swsAvoidanceInvoked</a> == <span class="keyword">true</span>)
<a name="l00872"></a>00872     {
<a name="l00873"></a>00873         arwnd = 1;
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a> &gt; 0)
<a name="l00875"></a>00875             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20b24275e45b18df329a7254563e306d">swsAvoidanceInvoked</a> = <span class="keyword">true</span>;
<a name="l00876"></a>00876         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;arwnd=1; createSack : SWS Avoidance ACTIVE !!!\n&quot;</span>;
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878     <span class="keywordflow">else</span>
<a name="l00879"></a>00879     {
<a name="l00880"></a>00880         arwnd = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>;
<a name="l00881"></a>00881         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;simTime()&lt;&lt;<span class="stringliteral">&quot; arwnd = &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a>&lt;&lt;<span class="stringliteral">&quot; - &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>&lt;&lt;<span class="stringliteral">&quot; = &quot;</span>&lt;&lt;arwnd&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883     <a class="code" href="class_s_c_t_p_association.html#a28d421b793ab5db3b09737c0f9f4b905">advRwnd</a>-&gt;record(arwnd);
<a name="l00884"></a>00884     <a class="code" href="class_s_c_t_p_sack_chunk.html">SCTPSackChunk</a>* sackChunk=<span class="keyword">new</span> <a class="code" href="class_s_c_t_p_sack_chunk.html">SCTPSackChunk</a>(<span class="stringliteral">&quot;SACK&quot;</span>);
<a name="l00885"></a>00885     sackChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_s_c_t_p_association_8h.html#a8886377ab3f4b4ef217558f2b83b7b12a689bf9c7470080fd0180eb7f5c293bd4">SACK</a>);
<a name="l00886"></a>00886     sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a661bfb2fc7e65577d5e0ea4d4024fc0c">setCumTsnAck</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>);
<a name="l00887"></a>00887     sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a085f19b284ea983d325e5a7faa11f76d">setA_rwnd</a>(arwnd);
<a name="l00888"></a>00888     uint32 numGaps=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>;
<a name="l00889"></a>00889     uint32 numDups=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.size();
<a name="l00890"></a>00890     uint16 sackLength=<a class="code" href="_s_c_t_p_association_8h.html#ad4c0ed05112e2eae28cc210916cd3fdd">SCTP_SACK_CHUNK_LENGTH</a> + numGaps*4 + numDups*4;
<a name="l00891"></a>00891     uint32 mtu = <a class="code" href="class_s_c_t_p_association.html#abf49f9153557168b42e7b63eba81d849">getPath</a>(remoteAddr)-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ad6dd717bdac741be310d027f5b663525">pmtu</a>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (sackLength &gt; mtu-32) <span class="comment">// FIXME</span>
<a name="l00894"></a>00894     {
<a name="l00895"></a>00895         <span class="keywordflow">if</span> (<a class="code" href="_s_c_t_p_association_8h.html#ad4c0ed05112e2eae28cc210916cd3fdd">SCTP_SACK_CHUNK_LENGTH</a> + numGaps*4 &gt; mtu-32)
<a name="l00896"></a>00896         {
<a name="l00897"></a>00897             numDups = 0;
<a name="l00898"></a>00898             numGaps = (uint32)((mtu-32-<a class="code" href="_s_c_t_p_association_8h.html#ad4c0ed05112e2eae28cc210916cd3fdd">SCTP_SACK_CHUNK_LENGTH</a>)/4);
<a name="l00899"></a>00899         }
<a name="l00900"></a>00900         <span class="keywordflow">else</span>
<a name="l00901"></a>00901         {
<a name="l00902"></a>00902             numDups = (uint32)((mtu-32-<a class="code" href="_s_c_t_p_association_8h.html#ad4c0ed05112e2eae28cc210916cd3fdd">SCTP_SACK_CHUNK_LENGTH</a> - numGaps*4)/4);
<a name="l00903"></a>00903         }
<a name="l00904"></a>00904         sackLength=<a class="code" href="_s_c_t_p_association_8h.html#ad4c0ed05112e2eae28cc210916cd3fdd">SCTP_SACK_CHUNK_LENGTH</a> + numGaps*4 + numDups*4;
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906     sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#adc2388671bfa383ace94cd5808655d20">setNumGaps</a>(numGaps);
<a name="l00907"></a>00907     sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#ac5fde6fc9369911804fcf31c3e56bb9d">setNumDupTsns</a>(numDups);
<a name="l00908"></a>00908     sackChunk-&gt;setBitLength(sackLength*8);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Sack arwnd=&quot;</span>&lt;&lt;sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a0029266b1d7d234f37e26e9d9ff40be8">getA_rwnd</a>()&lt;&lt;<span class="stringliteral">&quot; ctsnAck=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>&lt;&lt;<span class="stringliteral">&quot; numGaps=&quot;</span>&lt;&lt;numGaps&lt;&lt;<span class="stringliteral">&quot; numDups=&quot;</span>&lt;&lt;numDups&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (numGaps &gt; 0)
<a name="l00913"></a>00913     {
<a name="l00914"></a>00914         sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#aa22cbec49f7fc2ff0aadaabd28e4c6b1">setGapStartArraySize</a>(numGaps);
<a name="l00915"></a>00915         sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a0d448534ac6ccbc9b4f8b57a8d522d43">setGapStopArraySize</a>(numGaps);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         uint32 last = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>;
<a name="l00918"></a>00918         <span class="keywordflow">for</span> (key=0; key&lt;numGaps; key++)
<a name="l00919"></a>00919         {
<a name="l00920"></a>00920             <span class="comment">// ====== Validity check ===========================================</span>
<a name="l00921"></a>00921             assert(<a class="code" href="class_s_c_t_p_association.html#a2aee269f079e6749ddc839137c157043">tsnGt</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[key], last + 1));
<a name="l00922"></a>00922             assert(<a class="code" href="class_s_c_t_p_association.html#a7bb25b61e8c968e460210fd7794037b3">tsnGe</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[key], <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[key]));
<a name="l00923"></a>00923             last = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[key];
<a name="l00924"></a>00924 
<a name="l00925"></a>00925             sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a3bcf99f5bb06d8af50dd839129bbbba3">setGapStart</a>(key, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[key]);
<a name="l00926"></a>00926             sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#acd6f0a88517c2a66b1f70b3bacd39e4c">setGapStop</a>(key, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[key]);
<a name="l00927"></a>00927         }
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="keywordflow">if</span> (numDups &gt; 0)
<a name="l00930"></a>00930     {
<a name="l00931"></a>00931         sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a31719ebfeea4149c98eec8da38013b0a">setDupTsnsArraySize</a>(numDups);
<a name="l00932"></a>00932         key=0;
<a name="l00933"></a>00933         <span class="keywordflow">for</span>(std::list&lt;uint32&gt;::iterator iter=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.begin(); iter!=<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.end(); iter++)
<a name="l00934"></a>00934         {
<a name="l00935"></a>00935             sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#a201a3b224021e5b1d01be8b067a9d039">setDupTsns</a>(key, (*iter));
<a name="l00936"></a>00936             key++;
<a name="l00937"></a>00937             <span class="keywordflow">if</span> (key == numDups)
<a name="l00938"></a>00938                 <span class="keywordflow">break</span>;
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.clear();
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;endl;
<a name="l00943"></a>00943     <span class="keywordflow">for</span> (uint32 i=0; i&lt;numGaps; i++)
<a name="l00944"></a>00944         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#ae4b982717b7ea8c7274eeeed36ebc893">getGapStart</a>(i)&lt;&lt;<span class="stringliteral">&quot; - &quot;</span>&lt;&lt;sackChunk-&gt;<a class="code" href="class_s_c_t_p_sack_chunk.html#aaef7b2cb13cfc88decd207a37d3be7f7">getGapStop</a>(i)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;send &quot;</span>&lt;&lt;sackChunk-&gt;getName()&lt;&lt;<span class="stringliteral">&quot; from &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a9f057ad775e7e3187bc6f522820b0ac2">lastDataSourceAddress</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00947"></a>00947     <span class="keywordflow">return</span> sackChunk;
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00950"></a><a class="code" href="class_s_c_t_p_association.html#a8ceae356355ca537907cabf469c813af">00950</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a8ceae356355ca537907cabf469c813af">SCTPAssociation::sendSack</a>()
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952     <a class="code" href="class_s_c_t_p_sack_chunk.html">SCTPSackChunk</a>*               sackChunk;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Sending SACK&quot;</span> &lt;&lt; endl;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <span class="comment">/* sack timer has expired, reset flag, and send SACK */</span>
<a name="l00957"></a>00957     <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(<a class="code" href="class_s_c_t_p_association.html#a1fae2ceab572718540c51768e3c1c452">SackTimer</a>);
<a name="l00958"></a>00958     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acd712e40d2abba82caa4acb46a16fc8b">ackState</a> = 0;
<a name="l00959"></a>00959     sackChunk = <a class="code" href="class_s_c_t_p_association.html#a0054d12cb552f7417b97c7e671231905">createSack</a>();
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>* sctpmsg = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>();
<a name="l00962"></a>00962     sctpmsg-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>*8);
<a name="l00963"></a>00963     sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a46c6cc49994da66b04d2ab9eadc564b7">addChunk</a>(sackChunk);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="comment">// Return the SACK to the address where we last got a data chunk from</span>
<a name="l00966"></a>00966     <a class="code" href="class_s_c_t_p_association.html#afa42a76b3cc9ac339b1657e48972b2b2">sendToIP</a>(sctpmsg, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a9f057ad775e7e3187bc6f522820b0ac2">lastDataSourceAddress</a>);
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a><a class="code" href="class_s_c_t_p_association.html#a155c31414d0e2115eccd2fbb0a966dab">00969</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a155c31414d0e2115eccd2fbb0a966dab">SCTPAssociation::sendDataArrivedNotification</a>(uint16 sid)
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;SendDataArrivedNotification\n&quot;</span>;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     cPacket* cmsg = <span class="keyword">new</span> cPacket(<span class="stringliteral">&quot;DataArrivedNotification&quot;</span>);
<a name="l00975"></a>00975     cmsg-&gt;setKind(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a723241390fabc3b46cb79e9f5541b01b">SCTP_I_DATA_NOTIFICATION</a>);
<a name="l00976"></a>00976     <a class="code" href="class_s_c_t_p_command.html">SCTPCommand</a> *cmd = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_command.html">SCTPCommand</a>(<span class="stringliteral">&quot;notification&quot;</span>);
<a name="l00977"></a>00977     cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#aba989bb5fd07d31faf68d42bd90cbd02">setAssocId</a>(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l00978"></a>00978     cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a5e425cdf9ecc6360e1dcea80b055162d">setSid</a>(sid);
<a name="l00979"></a>00979     cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a37523301d495d32f6e84defd8efe6c26">setNumMsgs</a>(1);
<a name="l00980"></a>00980     cmsg-&gt;setControlInfo(cmd);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <a class="code" href="class_s_c_t_p_association.html#a35a8d95a64b2977c79bf24b1353c0c8e">sendToApp</a>(cmsg);
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 
<a name="l00986"></a><a class="code" href="class_s_c_t_p_association.html#a64c5bcff1fa7a6f01d7e969d21b70dd5">00986</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a64c5bcff1fa7a6f01d7e969d21b70dd5">SCTPAssociation::putInDeliveryQ</a>(uint16 sid)
<a name="l00987"></a>00987 {
<a name="l00988"></a>00988     SCTPReceiveStreamMap::iterator iter=<a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.find(sid);
<a name="l00989"></a>00989     <a class="code" href="class_s_c_t_p_receive_stream.html">SCTPReceiveStream</a>* rStream = iter-&gt;second;
<a name="l00990"></a>00990     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;putInDeliveryQ: SSN=&quot;</span> &lt;&lt; rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#aefb6dae19d1033707ae380fc091dcef9">getExpectedStreamSeqNum</a>()
<a name="l00991"></a>00991               &lt;&lt; <span class="stringliteral">&quot; SID=&quot;</span> &lt;&lt; sid
<a name="l00992"></a>00992               &lt;&lt; <span class="stringliteral">&quot; QueueSize=&quot;</span>&lt;&lt; rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a0267d48f180687fc25bff88baf20319b">getOrderedQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#af665b72b717ec39ba1a01364769e2db0">getQueueSize</a>() &lt;&lt; endl;
<a name="l00993"></a>00993     <span class="keywordflow">while</span> (rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a0267d48f180687fc25bff88baf20319b">getOrderedQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#af665b72b717ec39ba1a01364769e2db0">getQueueSize</a>()&gt;0)
<a name="l00994"></a>00994     {
<a name="l00995"></a>00995         <span class="comment">/* dequeue first from reassembly Q */</span>
<a name="l00996"></a>00996         <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> =
<a name="l00997"></a>00997             rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a0267d48f180687fc25bff88baf20319b">getOrderedQ</a>()-&gt; dequeueChunkBySSN(rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#aefb6dae19d1033707ae380fc091dcef9">getExpectedStreamSeqNum</a>());
<a name="l00998"></a>00998         <span class="keywordflow">if</span> (chunk) {
<a name="l00999"></a>00999             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;putInDeliveryQ::chunk &quot;</span> &lt;&lt;chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>
<a name="l01000"></a>01000                       &lt;&lt;<span class="stringliteral">&quot;, sid &quot;</span> &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa3c89c48c0c3ab5cc9b73d7ff525f67e">sid</a> &lt;&lt;<span class="stringliteral">&quot; and ssn &quot;</span> &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>
<a name="l01001"></a>01001                       &lt;&lt;<span class="stringliteral">&quot; dequeued from ordered queue. queuedReceivedBytes=&quot;</span>
<a name="l01002"></a>01002                       &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> &lt;&lt; <span class="stringliteral">&quot; will be reduced by &quot;</span>
<a name="l01003"></a>01003                       &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8 &lt;&lt; endl;
<a name="l01004"></a>01004             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>-=chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8;
<a name="l01005"></a>01005 
<a name="l01006"></a>01006 
<a name="l01007"></a>01007             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aa860967a47451b6ea090f0c3b81156de">roomSumRcvStreams</a> -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8 + <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01008"></a>01008             <span class="keywordflow">if</span> (rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a95ba93a1c4712fe6acad491b2337848a">getDeliveryQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#a198854d52d738bb77bb031ffe863b5be">checkAndInsertChunk</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>, chunk)) {
<a name="l01009"></a>01009                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> += chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8;
<a name="l01010"></a>01010 
<a name="l01011"></a>01011                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;data put in deliveryQ; queuedBytes now &quot;</span>
<a name="l01012"></a>01012                           &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> &lt;&lt; endl;
<a name="l01013"></a>01013                 <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aa860967a47451b6ea090f0c3b81156de">roomSumRcvStreams</a> += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8 + <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01014"></a>01014                 int32 seqnum=rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#aefb6dae19d1033707ae380fc091dcef9">getExpectedStreamSeqNum</a>();
<a name="l01015"></a>01015                 rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#acae396b1692c1045602a37446b129fbb">setExpectedStreamSeqNum</a>(++seqnum);
<a name="l01016"></a>01016                 <span class="keywordflow">if</span> (rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#aefb6dae19d1033707ae380fc091dcef9">getExpectedStreamSeqNum</a>() &gt; 65535) {
<a name="l01017"></a>01017                     rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#acae396b1692c1045602a37446b129fbb">setExpectedStreamSeqNum</a>(0);
<a name="l01018"></a>01018                 }
<a name="l01019"></a>01019                 <a class="code" href="class_s_c_t_p_association.html#a155c31414d0e2115eccd2fbb0a966dab">sendDataArrivedNotification</a>(sid);
<a name="l01020"></a>01020             }
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022         <span class="keywordflow">else</span> {
<a name="l01023"></a>01023             <span class="keywordflow">break</span>;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a><a class="code" href="class_s_c_t_p_association.html#a34812ad20b498c0275019ef3e97cec71">01028</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a34812ad20b498c0275019ef3e97cec71">SCTPAssociation::pushUlp</a>()
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030     int32                    count = 0;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_s_c_t_p_association.html#a7bdc4b456ecebfdd19a23b23cc927ecd">inboundStreams</a>; i++) { <span class="comment">//12.06.08</span>
<a name="l01033"></a>01033         <a class="code" href="class_s_c_t_p_association.html#a64c5bcff1fa7a6f01d7e969d21b70dd5">putInDeliveryQ</a>(i);
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a> &lt;= 0) {
<a name="l01036"></a>01036         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac841a6063c1f2d092f82c64cd67534b6">messagesToPush</a>;
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038     <span class="keywordtype">bool</span> restrict = <span class="keyword">false</span>;
<a name="l01039"></a>01039     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a> &gt; 0) {
<a name="l01040"></a>01040         restrict = <span class="keyword">true</span>;
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; Calling pushUlp(&quot;</span> &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>
<a name="l01045"></a>01045               &lt;&lt; <span class="stringliteral">&quot; bytes queued) ...&quot;</span> &lt;&lt; endl;
<a name="l01046"></a>01046     uint32 i = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a75ecf4e5a99369bb4bcae9a184afb22d">nextRSid</a>;
<a name="l01047"></a>01047     <span class="keywordflow">do</span> {
<a name="l01048"></a>01048         SCTPReceiveStreamMap::iterator iter = <a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.find(i);
<a name="l01049"></a>01049         <a class="code" href="class_s_c_t_p_receive_stream.html">SCTPReceiveStream</a>* rStream = iter-&gt;second;
<a name="l01050"></a>01050         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Size of stream &quot;</span> &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>
<a name="l01051"></a>01051                   &lt;&lt; rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a95ba93a1c4712fe6acad491b2337848a">getDeliveryQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#af665b72b717ec39ba1a01364769e2db0">getQueueSize</a>() &lt;&lt; endl;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053         <span class="keywordflow">while</span> ( (!rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a95ba93a1c4712fe6acad491b2337848a">getDeliveryQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.empty()) &amp;&amp;
<a name="l01054"></a>01054                   (!restrict || (restrict &amp;&amp; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a>&gt;0)) ) {
<a name="l01055"></a>01055             <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> = rStream-&gt;<a class="code" href="class_s_c_t_p_receive_stream.html#a95ba93a1c4712fe6acad491b2337848a">getDeliveryQ</a>()-&gt;<a class="code" href="class_s_c_t_p_queue.html#a96e2d6e957e7a573e808ad02df2abdf2">extractMessage</a>();
<a name="l01056"></a>01056             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aa860967a47451b6ea090f0c3b81156de">roomSumRcvStreams</a> -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8 + <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058             <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a> &gt;0)
<a name="l01059"></a>01059                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#acc81bc8fb8290aa91b916ebb83be9114">pushMessagesLeft</a>--;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>-=chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8;
<a name="l01062"></a>01062             <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20b24275e45b18df329a7254563e306d">swsAvoidanceInvoked</a>) {
<a name="l01063"></a>01063                 <span class="keywordflow">if</span> ((int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>) &gt;= (int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a>) &amp;&amp;
<a name="l01064"></a>01064                      (int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a> - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>) &lt;= (int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a>+<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a>)) {
<a name="l01065"></a>01065                     <span class="comment">/* only if the window has opened up more than one MTU we will send a SACK */</span>
<a name="l01066"></a>01066                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20b24275e45b18df329a7254563e306d">swsAvoidanceInvoked</a> = <span class="keyword">false</span>;
<a name="l01067"></a>01067                     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;pushUlp: Window opens up to &quot;</span>&lt;&lt;(int32)<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a>-<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>&lt;&lt;<span class="stringliteral">&quot; bytes: sending a SACK. SWS Avoidance INACTIVE\n&quot;</span>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069                     <a class="code" href="class_s_c_t_p_association.html#a8ceae356355ca537907cabf469c813af">sendSack</a>();
<a name="l01070"></a>01070                 }
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aba85e5f43e22032f2f883effbd7a8f92">swsLimit</a>) == 0) {
<a name="l01073"></a>01073                 <a class="code" href="class_s_c_t_p_association.html#a8ceae356355ca537907cabf469c813af">sendSack</a>();
<a name="l01074"></a>01074             }
<a name="l01075"></a>01075             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Push TSN &quot;</span> &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>
<a name="l01076"></a>01076                       &lt;&lt; <span class="stringliteral">&quot;: sid=&quot;</span>     &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa3c89c48c0c3ab5cc9b73d7ff525f67e">sid</a> &lt;&lt; <span class="stringliteral">&quot; ssn=&quot;</span> &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a> &lt;&lt; endl;
<a name="l01077"></a>01077             cPacket* msg= (cPacket *)chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aaafb0500520fdd9936987be73f6a27ae">userData</a>;
<a name="l01078"></a>01078             msg-&gt;setKind(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3a1eb9f18f68a700c545427ba5231a9dc4">SCTP_I_DATA</a>);
<a name="l01079"></a>01079             <a class="code" href="class_s_c_t_p_rcv_command.html">SCTPRcvCommand</a> *cmd = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_rcv_command.html">SCTPRcvCommand</a>(<span class="stringliteral">&quot;push&quot;</span>);
<a name="l01080"></a>01080             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#aba989bb5fd07d31faf68d42bd90cbd02">setAssocId</a>(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l01081"></a>01081             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a29c81cea1aacc930b5e0d3f922d9dc7d">setGate</a>(<a class="code" href="class_s_c_t_p_association.html#aba709e2f773752366d1c291c4fb360c8">appGateIndex</a>);
<a name="l01082"></a>01082             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a5e425cdf9ecc6360e1dcea80b055162d">setSid</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa3c89c48c0c3ab5cc9b73d7ff525f67e">sid</a>);
<a name="l01083"></a>01083             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a7e30f8086b994aa98f22e2adb3ed5192">setSsn</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>);
<a name="l01084"></a>01084             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#aff4b63211a335d3580c32293a0cc72eb">setSendUnordered</a>(!chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a8a53863ea46d99a486027459aed60c49">ordered</a>);
<a name="l01085"></a>01085             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#ad00fba7f2376f9e105ec3b7232a1fe11">setLocalAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a3e8d3c43ea031c35ab782b91f628563c">localAddr</a>);
<a name="l01086"></a>01086             cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#a6d3dbedcd109903ced179bd3f56f9deb">setRemoteAddr</a>(<a class="code" href="class_s_c_t_p_association.html#a694133846dd4defebbd87493888d7c2e">remoteAddr</a>);
<a name="l01087"></a>01087             cmd-&gt;<a class="code" href="class_s_c_t_p_rcv_command.html#a414e594933bf31a6001700e38f31d115">setPpid</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a960213e567faeed87d9ce98e993177a4">ppid</a>);
<a name="l01088"></a>01088             cmd-&gt;<a class="code" href="class_s_c_t_p_rcv_command.html#affabb2289c7f78b5a6ba48009ea25e8b">setTsn</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>);
<a name="l01089"></a>01089             cmd-&gt;<a class="code" href="class_s_c_t_p_rcv_command.html#adc34a24d3ed187c9c4defe7a62eed6a6">setCumTsn</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c4c403bd391f0be75e1b71254828274">lastTsnAck</a>);
<a name="l01090"></a>01090             msg-&gt;setControlInfo(cmd);
<a name="l01091"></a>01091             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aaf9ea2f913888ba783ae161088669ea6">numMsgsReq</a>[count]--;
<a name="l01092"></a>01092             <span class="keyword">delete</span> chunk;
<a name="l01093"></a>01093             <a class="code" href="class_s_c_t_p_association.html#a35a8d95a64b2977c79bf24b1353c0c8e">sendToApp</a>(msg);
<a name="l01094"></a>01094         }
<a name="l01095"></a>01095         i = (i + 1) % inboundStreams;
<a name="l01096"></a>01096         count++;
<a name="l01097"></a>01097     } <span class="keywordflow">while</span> (i != <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a75ecf4e5a99369bb4bcae9a184afb22d">nextRSid</a>);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a75ecf4e5a99369bb4bcae9a184afb22d">nextRSid</a> = (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a75ecf4e5a99369bb4bcae9a184afb22d">nextRSid</a> + 1) % inboundStreams;
<a name="l01100"></a>01100     <span class="keywordflow">if</span> ( (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> == 0) &amp;&amp; (<a class="code" href="class_s_c_t_p_association.html#adb42cf7d446c57ab5d1054fd9693ee54">fsm</a>-&gt;getState() == <a class="code" href="_s_c_t_p_association_8h.html#a2b3e573af74940c5a6c008b1cd0e3be8afed5af0cf4b3fce20325548b0b75961f">SCTP_S_SHUTDOWN_ACK_SENT</a>)) {
<a name="l01101"></a>01101         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;SCTP_E_CLOSE&quot;</span> &lt;&lt; endl;
<a name="l01102"></a>01102         <a class="code" href="class_s_c_t_p_association.html#a7471310ea5aa0cca813d1452f70bf218">performStateTransition</a>(<a class="code" href="_s_c_t_p_association_8h.html#a78805c92dea64dcc0102898a18b6a7ddaf772922ac461dd670204bcd480536cec">SCTP_E_CLOSE</a>);
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a><a class="code" href="class_s_c_t_p_association.html#a30445facc61cdf6ef4362b02a244eb2c">01106</a> <a class="code" href="class_s_c_t_p_data_chunk.html">SCTPDataChunk</a>* <a class="code" href="class_s_c_t_p_association.html#a30445facc61cdf6ef4362b02a244eb2c">SCTPAssociation::transformDataChunk</a>(<a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a>)
<a name="l01107"></a>01107 {
<a name="l01108"></a>01108     <a class="code" href="class_s_c_t_p_data_chunk.html">SCTPDataChunk</a>*       dataChunk = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_data_chunk.html">SCTPDataChunk</a>(<span class="stringliteral">&quot;DATA&quot;</span>);
<a name="l01109"></a>01109     <a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>* msg        = check_and_cast&lt;<a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>*&gt;(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aaafb0500520fdd9936987be73f6a27ae">userData</a>-&gt;dup());
<a name="l01110"></a>01110     dataChunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a34fe3ee4c5fc3000b097b959d757b875">setChunkType</a>(<a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ea9d7d6f31868d66330397c967c4afd2d2">DATA</a>);
<a name="l01111"></a>01111     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a724fc911f9474506e538493de69b5b44">setBBit</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a686aefff3b5cfc16ce1bfb7ed19d63de">bbit</a>);
<a name="l01112"></a>01112     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#ad08b849c2f66737004073fcf9489ea9f">setEBit</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ad6905d87d02a21b9716f87c002d8297b">ebit</a>);
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a8a53863ea46d99a486027459aed60c49">ordered</a>) {
<a name="l01114"></a>01114         dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a4a2128891da44ca9bbc49f528e6d6a64">setUBit</a>(0);
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116     <span class="keywordflow">else</span> {
<a name="l01117"></a>01117         dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a4a2128891da44ca9bbc49f528e6d6a64">setUBit</a>(1);
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#ac09fbff350bda6bb9ce90e542ca5f0f6">setTsn</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>);
<a name="l01120"></a>01120     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a5bd268fa40efdc716554009a846cde54">setSid</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa3c89c48c0c3ab5cc9b73d7ff525f67e">sid</a>);
<a name="l01121"></a>01121     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#ad1875b29fb9b29fafe0b7e0c8e00e16d">setSsn</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>);
<a name="l01122"></a>01122     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#ae2f2910e3d5d92db00b1e83f48075830">setPpid</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a960213e567faeed87d9ce98e993177a4">ppid</a>);
<a name="l01123"></a>01123     dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#afb04f882d3f3fbf41b3765e6b71fe4d7">setEnqueuingTime</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa381bd2154d7b6846ae8fe7694b96a27">enqueuingTime</a>);
<a name="l01124"></a>01124     dataChunk-&gt;setBitLength(<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>*8);
<a name="l01125"></a>01125     msg-&gt;setBitLength(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>);
<a name="l01126"></a>01126     dataChunk-&gt;encapsulate(msg);
<a name="l01127"></a>01127     <span class="keywordflow">return</span> dataChunk;
<a name="l01128"></a>01128 }
<a name="l01129"></a>01129 
<a name="l01130"></a><a class="code" href="class_s_c_t_p_association.html#a1780a25bb9890ee2c0510735299b1bf1">01130</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a1780a25bb9890ee2c0510735299b1bf1">SCTPAssociation::addPath</a>(<span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp; addr)
<a name="l01131"></a>01131 {
<a name="l01132"></a>01132     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Add Path remote address: &quot;</span>&lt;&lt;addr&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01133"></a>01133 
<a name="l01134"></a>01134     SCTPPathMap::iterator i = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.find(addr);
<a name="l01135"></a>01135     <span class="keywordflow">if</span> (i==<a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end())
<a name="l01136"></a>01136     {
<a name="l01137"></a>01137         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;__LINE__&lt;&lt;<span class="stringliteral">&quot; get new path for &quot;</span>&lt;&lt;addr&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01138"></a>01138         <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_association.html#a940cc2bde58bd842d11b28b3d09130dc">SCTPPathVariables</a>(addr, <span class="keyword">this</span>);
<a name="l01139"></a>01139         <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>[addr] = path;
<a name="l01140"></a>01140         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac3aa579f1b930a68ef83ba1404448cc2">roomTransQ</a>[addr]    = 0;
<a name="l01141"></a>01141         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a5d59aa98ddb5096586f4a9f85cc4ac16">bookedTransQ</a>[addr] = 0;
<a name="l01142"></a>01142         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a767e2849d053dd45d294d8678b8daed9">roomRetransQ</a>[addr] = 0;
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;path added\n&quot;</span>;
<a name="l01145"></a>01145 }
<a name="l01146"></a>01146 
<a name="l01147"></a><a class="code" href="class_s_c_t_p_association.html#a2f3fe366971313c0f290ded66a233059">01147</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a48840034dca5052abf481f6a5753f923">SCTPAssociation::removePath</a>(<span class="keyword">const</span> <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>&amp; addr)
<a name="l01148"></a>01148 {
<a name="l01149"></a>01149     SCTPPathMap::iterator pathIterator = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.find(addr);
<a name="l01150"></a>01150     <span class="keywordflow">if</span> (pathIterator != <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end())
<a name="l01151"></a>01151     {
<a name="l01152"></a>01152         <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path = pathIterator-&gt;second;
<a name="l01153"></a>01153         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a39293535329703b9c354939233d1b3db">cwnd</a>      = 0;
<a name="l01154"></a>01154         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8c6de61426b8f5a2ecb3aa529fac1326">ssthresh</a> = 0;
<a name="l01155"></a>01155         <a class="code" href="class_s_c_t_p_association.html#a753567499c04f5e4b55cb92790e4c96a">recordCwndUpdate</a>(path);
<a name="l01156"></a>01156 
<a name="l01157"></a>01157         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>);
<a name="l01158"></a>01158         <span class="keyword">delete</span> path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>;
<a name="l01159"></a>01159         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a2172a6ce9db9b2108ebe84d98ca52d36">HeartbeatIntervalTimer</a>);
<a name="l01160"></a>01160         <span class="keyword">delete</span> path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a2172a6ce9db9b2108ebe84d98ca52d36">HeartbeatIntervalTimer</a>;
<a name="l01161"></a>01161         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac772c4fa18747d878152f13413be0098">T3_RtxTimer</a>);
<a name="l01162"></a>01162         <span class="keyword">delete</span> path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac772c4fa18747d878152f13413be0098">T3_RtxTimer</a>;
<a name="l01163"></a>01163         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7696cc66ad659fbd0259cdc91808117a">CwndTimer</a>);
<a name="l01164"></a>01164         <span class="keyword">delete</span> path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7696cc66ad659fbd0259cdc91808117a">CwndTimer</a>;
<a name="l01165"></a>01165         <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.erase(pathIterator);
<a name="l01166"></a>01166         <span class="keyword">delete</span> path;
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168 }
<a name="l01169"></a>01169 
<a name="l01170"></a><a class="code" href="class_s_c_t_p_association.html#aea681826347f6fc208c91c5c0f5227bc">01170</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#aea681826347f6fc208c91c5c0f5227bc">SCTPAssociation::deleteStreams</a>()
<a name="l01171"></a>01171 {
<a name="l01172"></a>01172     <span class="keywordflow">for</span> (SCTPSendStreamMap::iterator it=<a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.begin(); it != <a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.end(); it++)
<a name="l01173"></a>01173     {
<a name="l01174"></a>01174         it-&gt;second-&gt;deleteQueue();
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176     <span class="keywordflow">for</span> (SCTPReceiveStreamMap::iterator it=<a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.begin(); it != <a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.end(); it++)
<a name="l01177"></a>01177     {
<a name="l01178"></a>01178         <span class="keyword">delete</span> it-&gt;second;
<a name="l01179"></a>01179     }
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01182"></a><a class="code" href="class_s_c_t_p_association.html#a45de5f3a74bba48af92b248edd9c9312">01182</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#a45de5f3a74bba48af92b248edd9c9312">SCTPAssociation::makeRoomForTsn</a>(<span class="keyword">const</span> uint32 tsn, <span class="keyword">const</span> uint32 length, <span class="keyword">const</span> <span class="keywordtype">bool</span> uBit)
<a name="l01183"></a>01183 {
<a name="l01184"></a>01184     <a class="code" href="class_s_c_t_p_queue.html">SCTPQueue</a>* stream, dStream;
<a name="l01185"></a>01185     uint32 sum  = 0;
<a name="l01186"></a>01186     uint32 comp = 0;
<a name="l01187"></a>01187     <span class="keywordtype">bool</span>     delQ = <span class="keyword">false</span>;
<a name="l01188"></a>01188     uint32 high = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af02f163ebe6c28c874d7734bbc2a31bf">highestTsnStored</a>;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;makeRoomForTsn: tsn=&quot;</span> &lt;&lt; tsn
<a name="l01191"></a>01191               &lt;&lt; <span class="stringliteral">&quot;, length=&quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot; high=&quot;</span> &lt;&lt; high &lt;&lt; endl;
<a name="l01192"></a>01192     <span class="keywordflow">while</span> ((sum &lt; length) &amp;&amp; (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a>&gt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c4c403bd391f0be75e1b71254828274">lastTsnAck</a>)) {
<a name="l01193"></a>01193         comp = sum;
<a name="l01194"></a>01194         <span class="keywordflow">for</span> (SCTPReceiveStreamMap::iterator iter = <a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.begin();
<a name="l01195"></a>01195               iter!=<a class="code" href="class_s_c_t_p_association.html#a80374427a755802cd7687c7a77b26e9c">receiveStreams</a>.end(); iter++) {
<a name="l01196"></a>01196             <span class="keywordflow">if</span> (tsn &gt; high) {
<a name="l01197"></a>01197                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01198"></a>01198             }
<a name="l01199"></a>01199             <span class="keywordflow">if</span> (uBit) {
<a name="l01200"></a>01200                 stream = iter-&gt;second-&gt;getUnorderedQ();
<a name="l01201"></a>01201             }
<a name="l01202"></a>01202             <span class="keywordflow">else</span> {
<a name="l01203"></a>01203                 stream = iter-&gt;second-&gt;getOrderedQ();
<a name="l01204"></a>01204             }
<a name="l01205"></a>01205             <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> = stream-&gt;<a class="code" href="class_s_c_t_p_queue.html#a2834802fcd42c759e97cd1e450ad1d06">getChunk</a>(high);
<a name="l01206"></a>01206             <span class="keywordflow">if</span> (chunk == NULL) {      <span class="comment">//12.06.08</span>
<a name="l01207"></a>01207                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; high &lt;&lt; <span class="stringliteral">&quot; not found in orderedQ. Try deliveryQ&quot;</span> &lt;&lt; endl;
<a name="l01208"></a>01208                 stream = iter-&gt;second-&gt;getDeliveryQ();
<a name="l01209"></a>01209                 chunk = stream-&gt;<a class="code" href="class_s_c_t_p_queue.html#a2834802fcd42c759e97cd1e450ad1d06">getChunk</a>(high);
<a name="l01210"></a>01210                 delQ = <span class="keyword">true</span>;
<a name="l01211"></a>01211             }
<a name="l01212"></a>01212             <span class="keywordflow">if</span> (chunk != NULL) {
<a name="l01213"></a>01213                 sum+=chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>;
<a name="l01214"></a>01214                 <span class="keywordflow">if</span> (stream-&gt;<a class="code" href="class_s_c_t_p_queue.html#ad3cf7f62b5553eb2b2a9b8417d756568">deleteMsg</a>(high)) {
<a name="l01215"></a>01215                     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; high &lt;&lt; <span class="stringliteral">&quot; found and deleted&quot;</span> &lt;&lt; endl;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>-=chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8; <span class="comment">//12.06.08</span>
<a name="l01218"></a>01218                     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a04381d198b1e78fb563d5e460c40c6a5">ssnGt</a>(iter-&gt;second-&gt;getExpectedStreamSeqNum(),chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>)) {
<a name="l01219"></a>01219                         iter-&gt;second-&gt;setExpectedStreamSeqNum(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>);
<a name="l01220"></a>01220                     }
<a name="l01221"></a>01221                 }
<a name="l01222"></a>01222                 <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aa860967a47451b6ea090f0c3b81156de">roomSumRcvStreams</a> -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8 + <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01223"></a>01223                 <span class="keywordflow">if</span> (high == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a>) {
<a name="l01224"></a>01224                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a>--;
<a name="l01225"></a>01225                 }
<a name="l01226"></a>01226                 <a class="code" href="class_s_c_t_p_association.html#a6d86b97308eef3f43f93ca939a3d1a52">removeFromGapList</a>(high);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228                 <span class="keywordflow">if</span> (tsn &gt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a>) {
<a name="l01229"></a>01229                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a> = tsn;
<a name="l01230"></a>01230                 }
<a name="l01231"></a>01231                 high--;
<a name="l01232"></a>01232                 <span class="keywordflow">break</span>;
<a name="l01233"></a>01233             }
<a name="l01234"></a>01234             <span class="keywordflow">else</span> {
<a name="l01235"></a>01235                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;TSN &quot;</span> &lt;&lt; high &lt;&lt; <span class="stringliteral">&quot; not found in stream &quot;</span>
<a name="l01236"></a>01236                           &lt;&lt; iter-&gt;second-&gt;getStreamId() &lt;&lt; endl;
<a name="l01237"></a>01237             }
<a name="l01238"></a>01238         }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240         <span class="keywordflow">if</span> (comp == sum) {
<a name="l01241"></a>01241             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; high &lt;&lt; <span class="stringliteral">&quot; not found in any stream&quot;</span> &lt;&lt; endl;
<a name="l01242"></a>01242             high--;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af02f163ebe6c28c874d7734bbc2a31bf">highestTsnStored</a> = high;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246         <span class="keywordflow">if</span> (tsn &gt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a>) {
<a name="l01247"></a>01247             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01248"></a>01248         }
<a name="l01249"></a>01249     }
<a name="l01250"></a>01250     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01253"></a><a class="code" href="class_s_c_t_p_association.html#a41c4711e6ff504c121e879d6295d33f9">01253</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#a41c4711e6ff504c121e879d6295d33f9">SCTPAssociation::tsnIsDuplicate</a>(<span class="keyword">const</span> uint32 tsn)<span class="keyword"> const</span>
<a name="l01254"></a>01254 <span class="keyword"></span>{
<a name="l01255"></a>01255     <span class="keywordflow">for</span> (std::list&lt;uint32&gt;::const_iterator iterator = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.begin();
<a name="l01256"></a>01256           iterator != <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a04e8711ebb60bf950f99a98e6eb5cbc9">dupList</a>.end(); iterator++)
<a name="l01257"></a>01257     {
<a name="l01258"></a>01258         <span class="keywordflow">if</span> ((*iterator) == tsn)
<a name="l01259"></a>01259             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261     <span class="keywordflow">for</span> (uint32 i=0; i &lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>; i++) {
<a name="l01262"></a>01262         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a5d5d64e51be4d13ccb13286b5a6ab7a4">tsnBetween</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i], tsn, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i])) {
<a name="l01263"></a>01263             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01264"></a>01264         }
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a><a class="code" href="class_s_c_t_p_association.html#a6d86b97308eef3f43f93ca939a3d1a52">01269</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a6d86b97308eef3f43f93ca939a3d1a52">SCTPAssociation::removeFromGapList</a>(uint32 removedTsn)
<a name="l01270"></a>01270 {
<a name="l01271"></a>01271     int32 gapsize, numgaps;
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     numgaps = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>;
<a name="l01274"></a>01274     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;remove TSN &quot;</span>&lt;&lt;removedTsn&lt;&lt;<span class="stringliteral">&quot; from GapList. &quot;</span>&lt;&lt;numgaps&lt;&lt;<span class="stringliteral">&quot; gaps present, cumTsnAck=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01275"></a>01275     <span class="keywordflow">for</span> (int32 j=0; j&lt;numgaps; j++)
<a name="l01276"></a>01276         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j]&lt;&lt;<span class="stringliteral">&quot; - &quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j]&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01277"></a>01277     for (int32 i=numgaps-1; i&gt;=0; i--)
<a name="l01278"></a>01278     {
<a name="l01279"></a>01279         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;gapStartList[&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;]=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i]&lt;&lt;<span class="stringliteral">&quot;, state-&gt;gapStopList[&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;]=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i]&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a5d5d64e51be4d13ccb13286b5a6ab7a4">tsnBetween</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i], removedTsn, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i]))
<a name="l01281"></a>01281         {
<a name="l01282"></a>01282             gapsize = (int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i] - <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i]+1);
<a name="l01283"></a>01283             <span class="keywordflow">if</span> (gapsize&gt;1)
<a name="l01284"></a>01284             {
<a name="l01285"></a>01285                 <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i]==removedTsn)
<a name="l01286"></a>01286                 {
<a name="l01287"></a>01287                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i]--;
<a name="l01288"></a>01288                 }
<a name="l01289"></a>01289                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i]==removedTsn)
<a name="l01290"></a>01290                 {
<a name="l01291"></a>01291                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i]++;
<a name="l01292"></a>01292                 }
<a name="l01293"></a>01293                 <span class="keywordflow">else</span> <span class="comment">//gap is split in two</span>
<a name="l01294"></a>01294                 {
<a name="l01295"></a>01295                     <span class="keywordflow">for</span> (int32 j=numgaps-1; j&gt;=i; j--)
<a name="l01296"></a>01296                     {
<a name="l01297"></a>01297                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j+1] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j];
<a name="l01298"></a>01298                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j+1] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j];
<a name="l01299"></a>01299                     }
<a name="l01300"></a>01300                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i] = removedTsn-1;
<a name="l01301"></a>01301                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i+1] = removedTsn+1;
<a name="l01302"></a>01302                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> + 1, <a class="code" href="_s_c_t_p_association_8h.html#a6334da21c08d8d9b4c63879c8cce9633">MAX_GAP_COUNT</a>);      <span class="comment">// T.D. 18.12.09: Enforce upper limit!</span>
<a name="l01303"></a>01303                 }
<a name="l01304"></a>01304             }
<a name="l01305"></a>01305             <span class="keywordflow">else</span>
<a name="l01306"></a>01306             {
<a name="l01307"></a>01307                 <span class="keywordflow">for</span> (int32 j=i; j&lt;=numgaps-1; j++)
<a name="l01308"></a>01308                 {
<a name="l01309"></a>01309                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j+1];
<a name="l01310"></a>01310                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j+1];
<a name="l01311"></a>01311                 }
<a name="l01312"></a>01312                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[numgaps-1]=0;
<a name="l01313"></a>01313                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[numgaps-1]=0;
<a name="l01314"></a>01314                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>--;
<a name="l01315"></a>01315                 <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> == 0)
<a name="l01316"></a>01316                 {
<a name="l01317"></a>01317                     <span class="keywordflow">if</span> (removedTsn == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c4c403bd391f0be75e1b71254828274">lastTsnAck</a>+1)
<a name="l01318"></a>01318                     {
<a name="l01319"></a>01319                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a4c4c403bd391f0be75e1b71254828274">lastTsnAck</a> = removedTsn;
<a name="l01320"></a>01320                     }
<a name="l01321"></a>01321                 }
<a name="l01322"></a>01322             }
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>&gt;0)
<a name="l01326"></a>01326         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>-1];
<a name="l01327"></a>01327     <span class="keywordflow">else</span>
<a name="l01328"></a>01328         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a0a5cdd7069f2909804ecf1ebe227b338">highestTsnReceived</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>;
<a name="l01329"></a>01329 }
<a name="l01330"></a>01330 
<a name="l01331"></a><a class="code" href="class_s_c_t_p_association.html#a99fbda3fe957b452899203d4e0f151a0">01331</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#a99fbda3fe957b452899203d4e0f151a0">SCTPAssociation::updateGapList</a>(<span class="keyword">const</span> uint32 receivedTsn)
<a name="l01332"></a>01332 {
<a name="l01333"></a>01333     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Entering updateGapList (tsn=&quot;</span> &lt;&lt; receivedTsn
<a name="l01334"></a>01334               &lt;&lt; <span class="stringliteral">&quot; cTsnAck=&quot;</span> &lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> &lt;&lt; <span class="stringliteral">&quot; Number of Gaps=&quot;</span>
<a name="l01335"></a>01335               &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> &lt;&lt; endl;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337     uint32 lo = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> + 1;
<a name="l01338"></a>01338     <span class="keywordflow">if</span> ((int32)(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a>-<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a>) &lt;= 0)
<a name="l01339"></a>01339     {
<a name="l01340"></a>01340         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Window full&quot;</span> &lt;&lt; endl;
<a name="l01341"></a>01341         <span class="comment">// Only check if cumTsnAck can be advanced</span>
<a name="l01342"></a>01342         <span class="keywordflow">if</span> (receivedTsn == lo) {
<a name="l01343"></a>01343             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Window full, but cumTsnAck can be advanced:&quot;</span> &lt;&lt; lo &lt;&lt; endl;
<a name="l01344"></a>01344         }
<a name="l01345"></a>01345         <span class="keywordflow">else</span>
<a name="l01346"></a>01346             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01347"></a>01347     }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a2aee269f079e6749ddc839137c157043">tsnGt</a>(receivedTsn, <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af02f163ebe6c28c874d7734bbc2a31bf">highestTsnStored</a>)) {    <span class="comment">// 17.06.08</span>
<a name="l01350"></a>01350         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#af02f163ebe6c28c874d7734bbc2a31bf">highestTsnStored</a> = receivedTsn;
<a name="l01351"></a>01351     }
<a name="l01352"></a>01352 
<a name="l01353"></a>01353     <span class="keywordflow">for</span> (uint32 i = 0; i&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>; i++) {
<a name="l01354"></a>01354         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i] &gt; 0) {
<a name="l01355"></a>01355             <span class="keyword">const</span> uint32 hi = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i] - 1;
<a name="l01356"></a>01356             <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a5d5d64e51be4d13ccb13286b5a6ab7a4">tsnBetween</a>(lo, receivedTsn, hi)) {
<a name="l01357"></a>01357                 <span class="keyword">const</span> uint32 gapsize = hi - lo + 1;
<a name="l01358"></a>01358                 <span class="keywordflow">if</span> (gapsize &gt; 1) {
<a name="l01363"></a>01363                     <span class="keywordflow">if</span> (receivedTsn == hi) {
<a name="l01364"></a>01364                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i] = receivedTsn;
<a name="l01365"></a>01365                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01366"></a>01366                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01367"></a>01367                     }
<a name="l01368"></a>01368                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (receivedTsn == lo) {
<a name="l01369"></a>01369                         <span class="keywordflow">if</span> (receivedTsn == (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> + 1)) {
<a name="l01370"></a>01370                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>++;
<a name="l01371"></a>01371                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01372"></a>01372                             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01373"></a>01373                         }
<a name="l01374"></a>01374                         <span class="comment">/* some gap must increase its upper bound */</span>
<a name="l01375"></a>01375                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i-1] = receivedTsn;
<a name="l01376"></a>01376                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01377"></a>01377                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01378"></a>01378                     }
<a name="l01379"></a>01379                     <span class="keywordflow">else</span> {  <span class="comment">/* a gap in between */</span>
<a name="l01380"></a>01380                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> + 1, <a class="code" href="_s_c_t_p_association_8h.html#a6334da21c08d8d9b4c63879c8cce9633">MAX_GAP_COUNT</a>);      <span class="comment">// T.D. 18.12.09: Enforce upper limit!</span>
<a name="l01381"></a>01381 
<a name="l01382"></a>01382                         <span class="keywordflow">for</span> (uint32 j = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> - 1; j &gt; i; j--) {    <span class="comment">// T.D. 18.12.09: Fixed invalid start value.</span>
<a name="l01383"></a>01383                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j-1];
<a name="l01384"></a>01384                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j-1];
<a name="l01385"></a>01385                         }
<a name="l01386"></a>01386                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i]=receivedTsn;
<a name="l01387"></a>01387                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i]=receivedTsn;
<a name="l01388"></a>01388                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01389"></a>01389                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01390"></a>01390                     }
<a name="l01391"></a>01391                 }
<a name="l01392"></a>01392                 <span class="keywordflow">else</span> {  <span class="comment">/* alright: gapsize is 1: our received tsn may close gap between fragments */</span>
<a name="l01393"></a>01393                     <span class="keywordflow">if</span> (lo == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> + 1) {
<a name="l01394"></a>01394                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i];
<a name="l01395"></a>01395                         <span class="keywordflow">if</span> (i == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>-1) {
<a name="l01396"></a>01396                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i] = 0;
<a name="l01397"></a>01397                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i] = 0;
<a name="l01398"></a>01398                         }
<a name="l01399"></a>01399                         <span class="keywordflow">else</span> {
<a name="l01400"></a>01400                             <span class="keywordflow">for</span> (uint32 j = i; j &lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> - 1; j++) {        <span class="comment">// T.D. 18.12.09: Fixed invalid end value.</span>
<a name="l01401"></a>01401                                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j + 1];
<a name="l01402"></a>01402                                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j]  = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j + 1];
<a name="l01403"></a>01403                             }
<a name="l01404"></a>01404                         }
<a name="l01405"></a>01405                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>--;
<a name="l01406"></a>01406                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01407"></a>01407                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01408"></a>01408                     }
<a name="l01409"></a>01409                     <span class="keywordflow">else</span> {
<a name="l01410"></a>01410                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i-1] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i];
<a name="l01411"></a>01411                         <span class="keywordflow">if</span> (i == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>-1) {
<a name="l01412"></a>01412                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i] = 0;
<a name="l01413"></a>01413                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i] = 0;
<a name="l01414"></a>01414                         }
<a name="l01415"></a>01415                         <span class="keywordflow">else</span> {
<a name="l01416"></a>01416                             <span class="keywordflow">for</span> (uint32 j = i; j &lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> - 1; j++) {        <span class="comment">// T.D. 18.12.09: Fixed invalid end value.</span>
<a name="l01417"></a>01417                                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[j + 1];
<a name="l01418"></a>01418                                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j]  = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[j + 1];
<a name="l01419"></a>01419                             }
<a name="l01420"></a>01420                         }
<a name="l01421"></a>01421                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>--;
<a name="l01422"></a>01422                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01423"></a>01423                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01424"></a>01424                     }
<a name="l01425"></a>01425                 }
<a name="l01426"></a>01426             }
<a name="l01427"></a>01427             <span class="keywordflow">else</span> {  <span class="comment">/* receivedTsn is not in the gap between these fragments... */</span>
<a name="l01428"></a>01428                 lo = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i] + 1;
<a name="l01429"></a>01429             }
<a name="l01430"></a>01430         } <span class="comment">/* end: for */</span>
<a name="l01431"></a>01431     }<span class="comment">/* end: for */</span>
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     <span class="comment">/* (NULL LIST)   OR  (End of Gap List passed) */</span>
<a name="l01434"></a>01434     <span class="keywordflow">if</span> (receivedTsn == lo) {    <span class="comment">// just increase ctsna, handle further update of ctsna later</span>
<a name="l01435"></a>01435         <span class="keywordflow">if</span> (receivedTsn == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> + 1) {
<a name="l01436"></a>01436             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>              = receivedTsn;
<a name="l01437"></a>01437             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01438"></a>01438             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01439"></a>01439         }
<a name="l01440"></a>01440         <span class="comment">/* Update last fragment....increase stop_tsn by one */</span>
<a name="l01441"></a>01441         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>-1]++;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01444"></a>01444         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446     }
<a name="l01447"></a>01447     <span class="keywordflow">else</span> {  <span class="comment">// A new fragment altogether, past the end of the list</span>
<a name="l01448"></a>01448         <span class="keywordflow">if</span>(<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a> + 1 &lt;= <a class="code" href="_s_c_t_p_association_8h.html#a6334da21c08d8d9b4c63879c8cce9633">MAX_GAP_COUNT</a>) {     <span class="comment">// T.D. 18.12.09: Enforce upper limit!</span>
<a name="l01449"></a>01449             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>] = receivedTsn;
<a name="l01450"></a>01450             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>]  = receivedTsn;
<a name="l01451"></a>01451             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>++;
<a name="l01452"></a>01452             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a06450a51ef019da0038809f452844e63">newChunkReceived</a> = <span class="keyword">true</span>;
<a name="l01453"></a>01453         }
<a name="l01454"></a>01454         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456 
<a name="l01457"></a>01457     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01458"></a>01458 }
<a name="l01459"></a>01459 
<a name="l01460"></a><a class="code" href="class_s_c_t_p_association.html#a4d95d83c20353ab76d47d04a240ef61a">01460</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#a4d95d83c20353ab76d47d04a240ef61a">SCTPAssociation::advanceCtsna</a>()
<a name="l01461"></a>01461 {
<a name="l01462"></a>01462     int32 listLength, <a class="code" href="struct_s_c_t_p_association_1_1counter.html">counter</a>;
<a name="l01463"></a>01463 
<a name="l01464"></a>01464     ev&lt;&lt;<span class="stringliteral">&quot;Entering advanceCtsna(ctsna now ==&quot;</span>&lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     listLength = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>;
<a name="l01467"></a>01467 
<a name="l01468"></a>01468     <span class="comment">/* if there are no fragments, we cannot advance the ctsna */</span>
<a name="l01469"></a>01469     <span class="keywordflow">if</span> (listLength == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01470"></a>01470     counter = 0;
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="keywordflow">while</span>(counter &lt; listLength)
<a name="l01473"></a>01473     {
<a name="l01474"></a>01474         <span class="comment">/* if we take out a fragment here, we need to modify either counter or list_length */</span>
<a name="l01475"></a>01475 
<a name="l01476"></a>01476         <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> + 1 == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[0])
<a name="l01477"></a>01477         {
<a name="l01478"></a>01478             <span class="comment">/* BINGO ! */</span>
<a name="l01479"></a>01479             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[0];
<a name="l01480"></a>01480             <span class="comment">/* we can take out a maximum of list_length fragments */</span>
<a name="l01481"></a>01481             counter++;
<a name="l01482"></a>01482             <span class="keywordflow">for</span> (uint32 i=1; i&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a8d12842797c5376fa3b22a1a506fddaf">numGaps</a>; i++)
<a name="l01483"></a>01483             {
<a name="l01484"></a>01484                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i-1] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ad7d3a3a95f236b66e40e0825a8cd8fc3">gapStartList</a>[i];
<a name="l01485"></a>01485                 <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i-1] = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a3050fcc98f6ceba8036ae36446125b8e">gapStopList</a>[i];
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487 
<a name="l01488"></a>01488         }
<a name="l01489"></a>01489         <span class="keywordflow">else</span>
<a name="l01490"></a>01490         {
<a name="l01491"></a>01491             ev&lt;&lt;<span class="stringliteral">&quot;Entering advanceCtsna(when leaving: ctsna==&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01492"></a>01492             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01493"></a>01493         }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     }    <span class="comment">/* end while */</span>
<a name="l01496"></a>01496 
<a name="l01497"></a>01497     ev&lt;&lt;<span class="stringliteral">&quot;Entering advanceCtsna(when leaving: ctsna==&quot;</span>&lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a37b617b9caf66e8bb37d3eed48bcb76c">cTsnAck</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01498"></a>01498     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01499"></a>01499 }
<a name="l01500"></a>01500 
<a name="l01501"></a><a class="code" href="class_s_c_t_p_association.html#ae6298a23676ec2a10036aa66ed6af7b3">01501</a> <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="class_s_c_t_p_association.html#ae6298a23676ec2a10036aa66ed6af7b3">SCTPAssociation::makeVarFromMsg</a>(<a class="code" href="class_s_c_t_p_data_chunk.html">SCTPDataChunk</a>* dataChunk)
<a name="l01502"></a>01502 {
<a name="l01503"></a>01503     <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>();
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a686aefff3b5cfc16ce1bfb7ed19d63de">bbit</a> = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a09be0795444196f77657d82cfc0a1e8e">getBBit</a>();
<a name="l01506"></a>01506     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ad6905d87d02a21b9716f87c002d8297b">ebit</a> = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a53ca18ab3a98a501cdc5800c1037afe2">getEBit</a>();
<a name="l01507"></a>01507     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aa3c89c48c0c3ab5cc9b73d7ff525f67e">sid</a>  = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a8e381b0653e3fc6a34ae896e040b30bf">getSid</a>();
<a name="l01508"></a>01508     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a518f7b638f4184fc01c4bdd20d641601">ssn</a>  = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a1473a86a339c6d1821a42ee85da6b792">getSsn</a>();
<a name="l01509"></a>01509     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a960213e567faeed87d9ce98e993177a4">ppid</a> = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#af0daf8b4cbb2620106d449c065ac4a4d">getPpid</a>();
<a name="l01510"></a>01510     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>  = dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a3b70fe8e5afc376f25caa199b117c9f2">getTsn</a>();
<a name="l01511"></a>01511     <span class="keywordflow">if</span> (!dataChunk-&gt;<a class="code" href="class_s_c_t_p_data_chunk.html#a7e5d0159206e00474d6d19ca7d67c871">getUBit</a>()) {
<a name="l01512"></a>01512         chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a8a53863ea46d99a486027459aed60c49">ordered</a> = <span class="keyword">true</span>;
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514     <span class="keywordflow">else</span> {
<a name="l01515"></a>01515         chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a8a53863ea46d99a486027459aed60c49">ordered</a> = <span class="keyword">false</span>;
<a name="l01516"></a>01516     }
<a name="l01517"></a>01517     <a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>* smsg=check_and_cast&lt;<a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>*&gt;(dataChunk-&gt;decapsulate());
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aaafb0500520fdd9936987be73f6a27ae">userData</a> = smsg;
<a name="l01520"></a>01520     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a> = smsg-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a4838827e65f3ed85291583a6b629852f">getDataLen</a>()*8;
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;makeVarFromMsg: queuedBytes has been increased to &quot;</span>
<a name="l01523"></a>01523               &lt;&lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#ac4dd73467c637f000a01b44b13799abf">queuedReceivedBytes</a> &lt;&lt; endl;
<a name="l01524"></a>01524     <span class="keywordflow">return</span> chunk;
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527 
<a name="l01528"></a>01528 
<a name="l01529"></a><a class="code" href="class_s_c_t_p_association.html#a52141caf8994688922c957e8ddee864f">01529</a> <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="class_s_c_t_p_association.html#a52141caf8994688922c957e8ddee864f">SCTPAssociation::getOutboundDataChunk</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path,
<a name="l01530"></a>01530                                                                             <span class="keyword">const</span> int32                  availableSpace,
<a name="l01531"></a>01531                                                                             <span class="keyword">const</span> int32                  availableCwnd)
<a name="l01532"></a>01532 {
<a name="l01533"></a>01533     <span class="comment">/* are there chunks in the transmission queue ? If Yes -&gt; dequeue and return it */</span>
<a name="l01534"></a>01534     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;getOutboundDataChunk(&quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a> &lt;&lt; <span class="stringliteral">&quot;):&quot;</span>
<a name="l01535"></a>01535               &lt;&lt; <span class="stringliteral">&quot; availableSpace=&quot;</span> &lt;&lt; availableSpace
<a name="l01536"></a>01536               &lt;&lt; <span class="stringliteral">&quot; availableCwnd=&quot;</span>  &lt;&lt; availableCwnd
<a name="l01537"></a>01537               &lt;&lt; endl;
<a name="l01538"></a>01538     <span class="keywordflow">if</span> (!<a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.empty()) {
<a name="l01539"></a>01539         <span class="keywordflow">for</span>(SCTPQueue::PayloadQueue::iterator it = <a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.begin();
<a name="l01540"></a>01540              it != <a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.end(); it++) {
<a name="l01541"></a>01541             <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> = it-&gt;second;
<a name="l01542"></a>01542             <span class="keywordflow">if</span>( (<a class="code" href="class_s_c_t_p_association.html#abab3867be074dea5acf98169c67efc78">chunkHasBeenAcked</a>(chunk) == <span class="keyword">false</span>) &amp;&amp;
<a name="l01543"></a>01543                  (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ac7fecde61de64ef7a37e20a6a95c5d33">getNextDestinationPath</a>() == path) ) {
<a name="l01544"></a>01544                 <span class="keyword">const</span> int32 len = <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01545"></a>01545                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;getOutboundDataChunk() found chunk &quot;</span> &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>
<a name="l01546"></a>01546                           &lt;&lt;<span class="stringliteral">&quot; in the transmission queue, length=&quot;</span> &lt;&lt; len &lt;&lt; endl;
<a name="l01547"></a>01547                 <span class="keywordflow">if</span> ((len &lt;= availableSpace) &amp;&amp;
<a name="l01548"></a>01548                      ((int32)chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a94e84b32d87ee8a38b88f0e8644e5876">booksize</a> &lt;= availableCwnd)) {
<a name="l01549"></a>01549                     <span class="comment">// T.D. 05.01.2010: The bookkeeping counters may only be decreased when</span>
<a name="l01550"></a>01550                     <span class="comment">//                        this chunk is actually dequeued. Therefore, the check</span>
<a name="l01551"></a>01551                     <span class="comment">//                        for &quot;chunkHasBeenAcked==false&quot; has been moved into the</span>
<a name="l01552"></a>01552                     <span class="comment">//                        &quot;if&quot; statement above!</span>
<a name="l01553"></a>01553                     <a class="code" href="class_s_c_t_p_association.html#a186aec4da8fb8e5008429c58a2cede3f">transmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.erase(it);
<a name="l01554"></a>01554                     chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a29289f62fc4878819b3b5ba132bf2c80">enqueuedInTransmissionQ</a> = <span class="keyword">false</span>;
<a name="l01555"></a>01555                     CounterMap::iterator i = <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac3aa579f1b930a68ef83ba1404448cc2">roomTransQ</a>.find(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>);
<a name="l01556"></a>01556                     i-&gt;second -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#adbda4b920dcea6965b2341fb11fd0d32">len</a>/8+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>);
<a name="l01557"></a>01557                     CounterMap::iterator ib = <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#a5d59aa98ddb5096586f4a9f85cc4ac16">bookedTransQ</a>.find(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>);
<a name="l01558"></a>01558                     ib-&gt;second -= chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a94e84b32d87ee8a38b88f0e8644e5876">booksize</a>;
<a name="l01559"></a>01559                     <span class="keywordflow">return</span> chunk;
<a name="l01560"></a>01560                 }
<a name="l01561"></a>01561             }
<a name="l01562"></a>01562         }
<a name="l01563"></a>01563     }
<a name="l01564"></a>01564     <span class="keywordflow">return</span> NULL;
<a name="l01565"></a>01565 }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 
<a name="l01568"></a><a class="code" href="class_s_c_t_p_association.html#adca537bdf50592f25eff5a09e730bec3">01568</a> <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="class_s_c_t_p_association.html#adca537bdf50592f25eff5a09e730bec3">SCTPAssociation::peekAbandonedChunk</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path)
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570     <span class="comment">// Are there chunks in the retransmission queue? If Yes -&gt; dequeue and return it.</span>
<a name="l01571"></a>01571     <span class="keywordflow">if</span> (!<a class="code" href="class_s_c_t_p_association.html#aafd80d965e20c11d49b38f7001d774b2">retransmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.empty())
<a name="l01572"></a>01572     {
<a name="l01573"></a>01573         <span class="keywordflow">for</span>(SCTPQueue::PayloadQueue::iterator it = <a class="code" href="class_s_c_t_p_association.html#aafd80d965e20c11d49b38f7001d774b2">retransmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.begin();
<a name="l01574"></a>01574              it != <a class="code" href="class_s_c_t_p_association.html#aafd80d965e20c11d49b38f7001d774b2">retransmissionQ</a>-&gt;<a class="code" href="class_s_c_t_p_queue.html#af2706820443707e574cc9618cdd0ba8c">payloadQueue</a>.end(); it++) {
<a name="l01575"></a>01575             <a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a> = it-&gt;second;
<a name="l01576"></a>01576             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;peek Chunk &quot;</span>&lt;&lt;chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ae52f66189071d5807283ee00e589e2eb">tsn</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01577"></a>01577             <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ad2160ca859be158877f7259d0e3d8ff8">getLastDestinationPath</a>() == path &amp;&amp; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aaa76f0b0c8c7a31a466f08b1c1f917eb">hasBeenAbandoned</a>) {
<a name="l01578"></a>01578                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;peekAbandonedChunk() found chunk in the retransmission queue\n&quot;</span>;
<a name="l01579"></a>01579                 <span class="keywordflow">return</span> chunk;
<a name="l01580"></a>01580             }
<a name="l01581"></a>01581         }
<a name="l01582"></a>01582     }
<a name="l01583"></a>01583     <span class="keywordflow">return</span> NULL;
<a name="l01584"></a>01584 }
<a name="l01585"></a>01585 
<a name="l01586"></a>01586 
<a name="l01587"></a><a class="code" href="class_s_c_t_p_association.html#a2e74a9f71f01b08567f70511f6172ac7">01587</a> <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* <a class="code" href="class_s_c_t_p_association.html#a2e74a9f71f01b08567f70511f6172ac7">SCTPAssociation::peekOutboundDataMsg</a>()
<a name="l01588"></a>01588 {
<a name="l01589"></a>01589     <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* datMsg=NULL;
<a name="l01590"></a>01590     int32 nextStream = -1;
<a name="l01591"></a>01591     nextStream = (this-&gt;*<a class="code" href="class_s_c_t_p_association.html#a9988effc78d17db9b32a8d6a976c2288">ssFunctions</a>.<a class="code" href="struct_s_c_t_p_association_1_1stream_scheduling_functions.html#ad1b6db0c49758dcf9cb642afec4ea4a7">ssGetNextSid</a>)(<span class="keyword">true</span>);
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     <span class="keywordflow">if</span> (nextStream == -1)
<a name="l01594"></a>01594     {
<a name="l01595"></a>01595 
<a name="l01596"></a>01596         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;peekOutboundDataMsg(): no valid stream found -&gt; returning NULL !\n&quot;</span>;
<a name="l01597"></a>01597 
<a name="l01598"></a>01598         <span class="keywordflow">return</span> NULL;
<a name="l01599"></a>01599     }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     <span class="keywordflow">for</span> (SCTPSendStreamMap::iterator iter=<a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.begin(); iter!=<a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.end(); ++iter)
<a name="l01603"></a>01603     {
<a name="l01604"></a>01604         <span class="keywordflow">if</span> ((int32)iter-&gt;first==nextStream)
<a name="l01605"></a>01605         {
<a name="l01606"></a>01606             <a class="code" href="class_s_c_t_p_send_stream.html">SCTPSendStream</a>* stream=iter-&gt;second;
<a name="l01607"></a>01607             <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>()-&gt;empty())
<a name="l01608"></a>01608             {
<a name="l01609"></a>01609                     <span class="keywordflow">return</span> (datMsg);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611             }
<a name="l01612"></a>01612             <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>()-&gt;empty())
<a name="l01613"></a>01613             {
<a name="l01614"></a>01614                     <span class="keywordflow">return</span> (datMsg);
<a name="l01615"></a>01615 
<a name="l01616"></a>01616             }
<a name="l01617"></a>01617         }
<a name="l01618"></a>01618     }
<a name="l01619"></a>01619     <span class="keywordflow">return</span> NULL;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621 }
<a name="l01622"></a>01622 
<a name="l01623"></a><a class="code" href="class_s_c_t_p_association.html#a5bccfb8217d1cbb22a629856f96755ad">01623</a> <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* <a class="code" href="class_s_c_t_p_association.html#a5bccfb8217d1cbb22a629856f96755ad">SCTPAssociation::dequeueOutboundDataMsg</a>(<span class="keyword">const</span> int32 availableSpace,
<a name="l01624"></a>01624                                                                       <span class="keyword">const</span> int32 availableCwnd)
<a name="l01625"></a>01625 {
<a name="l01626"></a>01626     <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* datMsg=NULL;
<a name="l01627"></a>01627     int32 nextStream = -1;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;dequeueOutboundDataMsg: &quot;</span> &lt;&lt; availableSpace &lt;&lt;<span class="stringliteral">&quot; bytes left to be sent&quot;</span> &lt;&lt; endl;
<a name="l01630"></a>01630     <span class="comment">/* Only change stream if we don&apos;t have to finish a fragmented message */</span>
<a name="l01631"></a>01631     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a>)
<a name="l01632"></a>01632         nextStream = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a65115dee13a7bb06bf17e24ac33ff4c4">lastStreamScheduled</a>;
<a name="l01633"></a>01633     <span class="keywordflow">else</span>
<a name="l01634"></a>01634         nextStream = (this-&gt;*<a class="code" href="class_s_c_t_p_association.html#a9988effc78d17db9b32a8d6a976c2288">ssFunctions</a>.<a class="code" href="struct_s_c_t_p_association_1_1stream_scheduling_functions.html#ad1b6db0c49758dcf9cb642afec4ea4a7">ssGetNextSid</a>)(<span class="keyword">false</span>);
<a name="l01635"></a>01635 
<a name="l01636"></a>01636     <span class="keywordflow">if</span> (nextStream == -1)
<a name="l01637"></a>01637         <span class="keywordflow">return</span> NULL;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;dequeueOutboundDataMsg: now stream &quot;</span>&lt;&lt; nextStream &lt;&lt; endl;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641     <span class="keywordflow">for</span> (SCTPSendStreamMap::iterator iter=<a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.begin(); iter!=<a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.end(); ++iter)
<a name="l01642"></a>01642     {
<a name="l01643"></a>01643         <span class="keywordflow">if</span> ((int32)iter-&gt;first==nextStream)
<a name="l01644"></a>01644         {
<a name="l01645"></a>01645             <a class="code" href="class_s_c_t_p_send_stream.html">SCTPSendStream</a>* stream=iter-&gt;second;
<a name="l01646"></a>01646             cQueue* streamQ = NULL;
<a name="l01647"></a>01647 
<a name="l01648"></a>01648             <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>()-&gt;empty())
<a name="l01649"></a>01649             {
<a name="l01650"></a>01650                 streamQ = stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>();
<a name="l01651"></a>01651                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;DequeueOutboundDataMsg() found chunks in stream &quot;</span>&lt;&lt;iter-&gt;first&lt;&lt;<span class="stringliteral">&quot; unordered queue, queue size=&quot;</span>&lt;&lt;stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>()-&gt;getLength()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01652"></a>01652             }
<a name="l01653"></a>01653             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>()-&gt;empty())
<a name="l01654"></a>01654             {
<a name="l01655"></a>01655                 streamQ = stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>();
<a name="l01656"></a>01656                 <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;DequeueOutboundDataMsg() found chunks in stream &quot;</span>&lt;&lt;iter-&gt;first&lt;&lt;<span class="stringliteral">&quot; ordered queue, queue size=&quot;</span>&lt;&lt;stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>()-&gt;getLength()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01657"></a>01657             }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659             <span class="keywordflow">if</span> (streamQ)
<a name="l01660"></a>01660             {
<a name="l01661"></a>01661                 int32 b=<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>( (check_and_cast&lt;SCTPSimpleMessage*&gt;(((<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;front())-&gt;getEncapsulatedMsg())-&gt;getByteLength()+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>));
<a name="l01662"></a>01662 
<a name="l01663"></a>01663                 <span class="comment">/* check if chunk found in queue has to be fragmented */</span>
<a name="l01664"></a>01664                 <span class="keywordflow">if</span> (b &gt; (int32)<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> - <a class="code" href="_s_c_t_p_association_8h.html#a294612afcb62d33531f390a08f0c3209">IP_HEADER_LENGTH</a> - <a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>)
<a name="l01665"></a>01665                 {
<a name="l01666"></a>01666                     <span class="comment">/* START FRAGMENTATION */</span>
<a name="l01667"></a>01667                     <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* datMsgQueued = (<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;pop();
<a name="l01668"></a>01668                     <a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a> *datMsgQueuedSimple = check_and_cast&lt;<a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>*&gt;(datMsgQueued-&gt;getEncapsulatedMsg());
<a name="l01669"></a>01669 
<a name="l01670"></a>01670                     <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* datMsgLastFragment = NULL;
<a name="l01671"></a>01671                     uint32 offset = 0;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673                     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Fragmentation: chunk &quot;</span> &lt;&lt; &amp;datMsgQueued &lt;&lt; <span class="stringliteral">&quot;, size = &quot;</span> &lt;&lt; datMsgQueued-&gt;getByteLength() &lt;&lt; endl;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675                     <span class="keywordflow">while</span> (datMsgQueued)
<a name="l01676"></a>01676                     {
<a name="l01677"></a>01677                         <span class="comment">/* detemine size of fragment, either max payload or what&apos;s left */</span>
<a name="l01678"></a>01678                         uint32 msgbytes = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> - <a class="code" href="_s_c_t_p_association_8h.html#a294612afcb62d33531f390a08f0c3209">IP_HEADER_LENGTH</a> - <a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a> - <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>;
<a name="l01679"></a>01679                         <span class="keywordflow">if</span> (msgbytes &gt; datMsgQueuedSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a4838827e65f3ed85291583a6b629852f">getDataLen</a>() - offset)
<a name="l01680"></a>01680                             msgbytes = datMsgQueuedSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a4838827e65f3ed85291583a6b629852f">getDataLen</a>() - offset;
<a name="l01681"></a>01681 
<a name="l01682"></a>01682                         <span class="comment">/* new DATA msg */</span>
<a name="l01683"></a>01683                         <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>* datMsgFragment = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>();
<a name="l01684"></a>01684                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#af41c65da0f37b1c6e5776295ab884a42">setSid</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a9d26613920f031e216c37939488240f6">getSid</a>());
<a name="l01685"></a>01685                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a088f44dcde7f36b7965651783d7718e8">setPpid</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a7348d49fbc484324790370df2c0b0e5f">getPpid</a>());
<a name="l01686"></a>01686                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a20341fb2db9b9748f7e6085dec0f62ac">setInitialDestination</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#adf278107a50be270fc1be3ace1c33c8c">getInitialDestination</a>());
<a name="l01687"></a>01687                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a1163d7814373fd146e0c986a2b4719d0">setEnqueuingTime</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a68fe7122a327084a7b26e145034b11ff">getEnqueuingTime</a>());
<a name="l01688"></a>01688                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#abb518c974103c5e7e3ca8356a85d983c">setMsgNum</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a09eae655e461e8d96257c0f744d2e41d">getMsgNum</a>());
<a name="l01689"></a>01689                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#ab651f3ad9931ab048fcf5c8283b3f8d5">setOrdered</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a7cdc8d3f1e15ff0b2372461d456755c3">getOrdered</a>());
<a name="l01690"></a>01690                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#af0b5889b9ff8af536a6737d28d097232">setExpiryTime</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#aeeff03647da83c58071347b3ed8c07e9">getExpiryTime</a>());
<a name="l01691"></a>01691                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a4cc1ec28382a85d277a5b53859ed7ff2">setRtx</a>(datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a3493c4b982c065713dee133566fdfceb">getRtx</a>());
<a name="l01692"></a>01692                         datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a4e20c71bdc8707d6267cfb7d706368e1">setFragment</a>(<span class="keyword">true</span>);
<a name="l01693"></a>01693                             datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a006aea3ed0f0248439f279b53f3bee66">setBooksize</a>(msgbytes + <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a5cdefe133e1a8c71203aa26631ed09c7">header</a>);
<a name="l01694"></a>01694 
<a name="l01695"></a>01695                         <span class="comment">/* is this the first fragment? */</span>
<a name="l01696"></a>01696                         <span class="keywordflow">if</span> (offset == 0)
<a name="l01697"></a>01697                             datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#aa80e1d94a0473c57af83a904832c8501">setBBit</a>(<span class="keyword">true</span>);
<a name="l01698"></a>01698 
<a name="l01699"></a>01699                         <span class="comment">/* new msg */</span>
<a name="l01700"></a>01700                         <a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a> *datMsgFragmentSimple = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>();
<a name="l01701"></a>01701 
<a name="l01702"></a>01702                         datMsgFragmentSimple-&gt;setName(datMsgQueuedSimple-&gt;getName());
<a name="l01703"></a>01703                         datMsgFragmentSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a0cfe3080dd3f6126adbc6d2b62cf88a8">setCreationTime</a>(datMsgQueuedSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a7f4c607bc10f75748daf2626a775c7a7">getCreationTime</a>());
<a name="l01704"></a>01704 
<a name="l01705"></a>01705                         datMsgFragmentSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a19267ba50e2bce996b9290544b436477">setDataArraySize</a>(msgbytes);
<a name="l01706"></a>01706                         datMsgFragmentSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a630c1edca53781533d0f8a04a39ab0e1">setDataLen</a>(msgbytes);
<a name="l01707"></a>01707                         datMsgFragmentSimple-&gt;setByteLength(msgbytes);
<a name="l01708"></a>01708 
<a name="l01709"></a>01709                         <span class="comment">/* copy data */</span>
<a name="l01710"></a>01710                         <span class="keywordflow">for</span> (uint32 i = offset; i &lt; offset + msgbytes; i++)
<a name="l01711"></a>01711                             datMsgFragmentSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#aac4ab53c4235fd4ee9df1ae47769382d">setData</a>(i - offset, datMsgQueuedSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a0a498c322e58707458a0ab5b33b80ff8">getData</a>(i));
<a name="l01712"></a>01712 
<a name="l01713"></a>01713                         offset += msgbytes;
<a name="l01714"></a>01714                         datMsgFragment-&gt;encapsulate(datMsgFragmentSimple);
<a name="l01715"></a>01715 
<a name="l01716"></a>01716                         <span class="comment">/* insert fragment into queue */</span>
<a name="l01717"></a>01717                         <span class="keywordflow">if</span> (!streamQ-&gt;empty())
<a name="l01718"></a>01718                         {
<a name="l01719"></a>01719                             <span class="keywordflow">if</span> (!datMsgLastFragment)
<a name="l01720"></a>01720                             {
<a name="l01721"></a>01721                                 <span class="comment">/* insert first fragment at the begining of the queue*/</span>
<a name="l01722"></a>01722                                 streamQ-&gt;insertBefore((<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;front(), datMsgFragment);
<a name="l01723"></a>01723                             }
<a name="l01724"></a>01724                             <span class="keywordflow">else</span>
<a name="l01725"></a>01725                             {
<a name="l01726"></a>01726                                 <span class="comment">/* insert fragment after last inserted   */</span>
<a name="l01727"></a>01727                                 streamQ-&gt;insertAfter(datMsgLastFragment, datMsgFragment);
<a name="l01728"></a>01728                             }
<a name="l01729"></a>01729                         }
<a name="l01730"></a>01730                         <span class="keywordflow">else</span>
<a name="l01731"></a>01731                             streamQ-&gt;insert(datMsgFragment);
<a name="l01732"></a>01732 
<a name="l01733"></a>01733                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aee5ec4417497e5bba3cf95f79f902da6">queuedMessages</a>++;
<a name="l01734"></a>01734                         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac6621d7d6e88ca8e038fe040adcc5beb">roomSumSendStreams</a> += <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(datMsgFragment-&gt;getByteLength() + SCTP_DATA_CHUNK_LENGTH);
<a name="l01735"></a>01735                         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aab189302bf40c67f2eec631bcd7de51f">bookedSumSendStreams</a> += datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a03a901a81d7a4ac6b1074870ac9ea099">getBooksize</a>();
<a name="l01736"></a>01736                         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Fragmentation: fragment &quot;</span> &lt;&lt; &amp;datMsgFragment &lt;&lt; <span class="stringliteral">&quot; created, length = &quot;</span> &lt;&lt; datMsgFragmentSimple-&gt;getByteLength() &lt;&lt; <span class="stringliteral">&quot;, queue size = &quot;</span> &lt;&lt; streamQ-&gt;getLength() &lt;&lt; endl;
<a name="l01737"></a>01737 
<a name="l01738"></a>01738                         datMsgLastFragment = datMsgFragment;
<a name="l01739"></a>01739 
<a name="l01740"></a>01740                         <span class="comment">/* all fragments done? */</span>
<a name="l01741"></a>01741                         <span class="keywordflow">if</span> (datMsgQueuedSimple-&gt;<a class="code" href="class_s_c_t_p_simple_message.html#a4838827e65f3ed85291583a6b629852f">getDataLen</a>() == offset)
<a name="l01742"></a>01742                         {
<a name="l01743"></a>01743                             datMsgFragment-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a42b0bb93b07aea3eab53679bf25108ea">setEBit</a>(<span class="keyword">true</span>);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745                             <span class="comment">/* remove original element */</span>
<a name="l01746"></a>01746                             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;Fragmentation: delete &quot;</span> &lt;&lt; &amp;datMsgQueued &lt;&lt; endl;
<a name="l01747"></a>01747                             <span class="comment">//streamQ-&gt;pop();</span>
<a name="l01748"></a>01748                             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac6621d7d6e88ca8e038fe040adcc5beb">roomSumSendStreams</a> -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>(datMsgQueued-&gt;getByteLength() + SCTP_DATA_CHUNK_LENGTH);
<a name="l01749"></a>01749                             <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aab189302bf40c67f2eec631bcd7de51f">bookedSumSendStreams</a> -= datMsgQueued-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a03a901a81d7a4ac6b1074870ac9ea099">getBooksize</a>();
<a name="l01750"></a>01750                             <span class="keyword">delete</span> datMsgQueued;
<a name="l01751"></a>01751                             datMsgQueued = NULL;
<a name="l01752"></a>01752                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#aee5ec4417497e5bba3cf95f79f902da6">queuedMessages</a>--;
<a name="l01753"></a>01753                         }
<a name="l01754"></a>01754                     }
<a name="l01755"></a>01755 
<a name="l01756"></a>01756                     <span class="comment">/* the next chunk returned will always be a fragment */</span>
<a name="l01757"></a>01757                     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a> = <span class="keyword">true</span>;
<a name="l01758"></a>01758 
<a name="l01759"></a>01759                     b=<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>( (check_and_cast&lt;SCTPSimpleMessage*&gt;(((<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;front())-&gt;getEncapsulatedMsg())-&gt;getBitLength()/8+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>));
<a name="l01760"></a>01760                     <span class="comment">/* FRAGMENTATION DONE */</span>
<a name="l01761"></a>01761                 }
<a name="l01762"></a>01762 
<a name="l01763"></a>01763                 <span class="keywordflow">if</span> ((b &lt;= availableSpace) &amp;&amp;
<a name="l01764"></a>01764                      ( (int32)((<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;front())-&gt;getBooksize() &lt;= availableCwnd)) {
<a name="l01765"></a>01765                     datMsg = (<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;pop();
<a name="l01766"></a>01766                     <span class="comment">/*if (!state-&gt;appSendAllowed &amp;&amp; streamQ-&gt;getLength()&lt;=state-&gt;sendQueueLimit)</span>
<a name="l01767"></a>01767 <span class="comment">                    {</span>
<a name="l01768"></a>01768 <span class="comment">                        state-&gt;appSendAllowed = true;</span>
<a name="l01769"></a>01769 <span class="comment">                        sendIndicationToApp(SCTP_I_SENDQUEUE_ABATED);</span>
<a name="l01770"></a>01770 <span class="comment">                    }*/</span>
<a name="l01771"></a>01771                     <a class="code" href="class_s_c_t_p_association.html#a1f249bde274ec0e4949023a2a3a3e4e7">sendQueue</a>-&gt;record(streamQ-&gt;getLength());
<a name="l01772"></a>01772 
<a name="l01773"></a>01773                     <span class="keywordflow">if</span> (!datMsg-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a96f3bbbc646cd841a14f28fcf547a8ca">getFragment</a>())
<a name="l01774"></a>01774                     {
<a name="l01775"></a>01775                         datMsg-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#aa80e1d94a0473c57af83a904832c8501">setBBit</a>(<span class="keyword">true</span>);
<a name="l01776"></a>01776                         datMsg-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a42b0bb93b07aea3eab53679bf25108ea">setEBit</a>(<span class="keyword">true</span>);
<a name="l01777"></a>01777                         <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a> = <span class="keyword">false</span>;
<a name="l01778"></a>01778                     }
<a name="l01779"></a>01779                     <span class="keywordflow">else</span>
<a name="l01780"></a>01780                     {
<a name="l01781"></a>01781                         <span class="keywordflow">if</span> (datMsg-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a16ca77ed5220f946269c2838b205238d">getEBit</a>())
<a name="l01782"></a>01782                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a> = <span class="keyword">false</span>;
<a name="l01783"></a>01783                         <span class="keywordflow">else</span>
<a name="l01784"></a>01784                             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a> = <span class="keyword">true</span>;
<a name="l01785"></a>01785                     }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787                     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;<span class="stringliteral">&quot;DequeueOutboundDataMsg() found chunk (&quot;</span>&lt;&lt;&amp;datMsg&lt;&lt;<span class="stringliteral">&quot;) in the stream queue &quot;</span>&lt;&lt;&amp;iter-&gt;first&lt;&lt;<span class="stringliteral">&quot;(&quot;</span>&lt;&lt;streamQ&lt;&lt;<span class="stringliteral">&quot;) queue size=&quot;</span>&lt;&lt;streamQ-&gt;getLength()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01788"></a>01788                  }
<a name="l01789"></a>01789             }
<a name="l01790"></a>01790             <span class="keywordflow">break</span>;
<a name="l01791"></a>01791         }
<a name="l01792"></a>01792     }
<a name="l01793"></a>01793     <span class="keywordflow">if</span> (datMsg != NULL)
<a name="l01794"></a>01794     {
<a name="l01795"></a>01795         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#ac6621d7d6e88ca8e038fe040adcc5beb">roomSumSendStreams</a> -= <a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>( (check_and_cast&lt;SCTPSimpleMessage*&gt;(datMsg-&gt;getEncapsulatedMsg())-&gt;getBitLength()/8+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>));
<a name="l01796"></a>01796         <a class="code" href="class_s_c_t_p_association.html#a0ba2392369634e6a9b6d1c27ecfa4d57">qCounter</a>.<a class="code" href="struct_s_c_t_p_association_1_1counter.html#aab189302bf40c67f2eec631bcd7de51f">bookedSumSendStreams</a> -= datMsg-&gt;<a class="code" href="class_s_c_t_p_data_msg.html#a03a901a81d7a4ac6b1074870ac9ea099">getBooksize</a>();
<a name="l01797"></a>01797     }
<a name="l01798"></a>01798     <span class="keywordflow">return</span> (datMsg);
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 
<a name="l01802"></a><a class="code" href="class_s_c_t_p_association.html#afcdda96737a59959b556a07031d9ad98">01802</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#afcdda96737a59959b556a07031d9ad98">SCTPAssociation::nextChunkFitsIntoPacket</a>(int32 bytes)
<a name="l01803"></a>01803 {
<a name="l01804"></a>01804     int32 nextStream = -1;
<a name="l01805"></a>01805     <a class="code" href="class_s_c_t_p_send_stream.html">SCTPSendStream</a>* stream;
<a name="l01806"></a>01806 
<a name="l01807"></a>01807     <span class="comment">/* Only change stream if we don&apos;t have to finish a fragmented message */</span>
<a name="l01808"></a>01808     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7afc09bdeea747f08bd02cb60f9d4828">lastMsgWasFragment</a>)
<a name="l01809"></a>01809         nextStream = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a65115dee13a7bb06bf17e24ac33ff4c4">lastStreamScheduled</a>;
<a name="l01810"></a>01810     <span class="keywordflow">else</span>
<a name="l01811"></a>01811         nextStream = (this-&gt;*<a class="code" href="class_s_c_t_p_association.html#a9988effc78d17db9b32a8d6a976c2288">ssFunctions</a>.<a class="code" href="struct_s_c_t_p_association_1_1stream_scheduling_functions.html#ad1b6db0c49758dcf9cb642afec4ea4a7">ssGetNextSid</a>)(<span class="keyword">true</span>);
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="keywordflow">if</span> (nextStream == -1)
<a name="l01814"></a>01814         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     stream = <a class="code" href="class_s_c_t_p_association.html#a8d3fc12f609dc4d894f830d0e201642a">sendStreams</a>.find(nextStream)-&gt;second;
<a name="l01817"></a>01817 
<a name="l01818"></a>01818     <span class="keywordflow">if</span> (stream)
<a name="l01819"></a>01819     {
<a name="l01820"></a>01820         cQueue* streamQ = NULL;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822         <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>()-&gt;empty())
<a name="l01823"></a>01823             streamQ = stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#a819f071b624d554ee5c7d54417bc3a31">getUnorderedStreamQ</a>();
<a name="l01824"></a>01824         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>()-&gt;empty())
<a name="l01825"></a>01825             streamQ = stream-&gt;<a class="code" href="class_s_c_t_p_send_stream.html#ac278c3ed4a46cba2cd4744113886e003">getStreamQ</a>();
<a name="l01826"></a>01826 
<a name="l01827"></a>01827         <span class="keywordflow">if</span> (streamQ)
<a name="l01828"></a>01828         {
<a name="l01829"></a>01829             int32 b=<a class="code" href="_s_c_t_p_association_8h.html#a34c6101299ca6658c48834e679883867">ADD_PADDING</a>( (check_and_cast&lt;SCTPSimpleMessage*&gt;(((<a class="code" href="class_s_c_t_p_data_msg.html">SCTPDataMsg</a>*)streamQ-&gt;front())-&gt;getEncapsulatedMsg())-&gt;getByteLength()+<a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>));
<a name="l01830"></a>01830 
<a name="l01831"></a>01831             <span class="comment">/* Check if next message would be fragmented */</span>
<a name="l01832"></a>01832             <span class="keywordflow">if</span> (b &gt; (int32) <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> - <a class="code" href="_s_c_t_p_association_8h.html#a294612afcb62d33531f390a08f0c3209">IP_HEADER_LENGTH</a> - <a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a>)
<a name="l01833"></a>01833             {
<a name="l01834"></a>01834                 <span class="comment">/* Test if fragment fits */</span>
<a name="l01835"></a>01835                 <span class="keywordflow">if</span> (bytes &gt;= (int32) <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> - <a class="code" href="_s_c_t_p_association_8h.html#a294612afcb62d33531f390a08f0c3209">IP_HEADER_LENGTH</a> - <a class="code" href="_s_c_t_p_association_8h.html#a5cd94d6b80cfc4869b11f345c9de4d93">SCTP_COMMON_HEADER</a> - <a class="code" href="_s_c_t_p_association_8h.html#aad0be78d1352b9d9fa6a695ed18c9d65">SCTP_DATA_CHUNK_LENGTH</a>)
<a name="l01836"></a>01836                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01837"></a>01837                 <span class="keywordflow">else</span>
<a name="l01838"></a>01838                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01839"></a>01839             }
<a name="l01840"></a>01840 
<a name="l01841"></a>01841             <span class="comment">/* Message doesn&apos;t need to be fragmented, just try if it fits */</span>
<a name="l01842"></a>01842             <span class="keywordflow">if</span> (b &lt;= bytes)
<a name="l01843"></a>01843                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01844"></a>01844             <span class="keywordflow">else</span>
<a name="l01845"></a>01845                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01846"></a>01846         }
<a name="l01847"></a>01847     }
<a name="l01848"></a>01848 
<a name="l01849"></a>01849     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01850"></a>01850 }
<a name="l01851"></a>01851 
<a name="l01852"></a>01852 
<a name="l01853"></a><a class="code" href="class_s_c_t_p_association.html#a54a47746095fa64e6976d22bdbb8e884">01853</a> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* <a class="code" href="class_s_c_t_p_association.html#a54a47746095fa64e6976d22bdbb8e884">SCTPAssociation::getNextPath</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* oldPath)<span class="keyword"> const</span>
<a name="l01854"></a>01854 <span class="keyword"></span>{
<a name="l01855"></a>01855     int32 hit = 0;
<a name="l01856"></a>01856     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.size() &gt; 1) {
<a name="l01857"></a>01857         <span class="keywordflow">for</span> (SCTPPathMap::const_iterator iterator = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.begin();
<a name="l01858"></a>01858               iterator != <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end(); iterator++) {
<a name="l01859"></a>01859             <span class="keywordflow">if</span> (iterator-&gt;second == oldPath) {
<a name="l01860"></a>01860                 <span class="keywordflow">if</span> (++hit == 1) {
<a name="l01861"></a>01861                     <span class="keywordflow">continue</span>;
<a name="l01862"></a>01862                 }
<a name="l01863"></a>01863                 <span class="keywordflow">else</span> {
<a name="l01864"></a>01864                     <span class="keywordflow">break</span>;
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866             }
<a name="l01867"></a>01867             <span class="keywordflow">if</span> (iterator-&gt;second-&gt;activePath) {
<a name="l01868"></a>01868                 <span class="keywordflow">return</span> iterator-&gt;second;
<a name="l01869"></a>01869             }
<a name="l01870"></a>01870         }
<a name="l01871"></a>01871     }
<a name="l01872"></a>01872     <span class="keywordflow">return</span>(NULL);
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a><a class="code" href="class_s_c_t_p_association.html#ab4f6847bb20adea148ebf8cf2a071871">01875</a> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* <a class="code" href="class_s_c_t_p_association.html#ab4f6847bb20adea148ebf8cf2a071871">SCTPAssociation::getNextDestination</a>(<a class="code" href="class_s_c_t_p_data_variables.html">SCTPDataVariables</a>* <a class="code" href="structchunk.html">chunk</a>)<span class="keyword"> const</span>
<a name="l01876"></a>01876 <span class="keyword"></span>{
<a name="l01877"></a>01877     <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* next;
<a name="l01878"></a>01878     <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* last;
<a name="l01879"></a>01879 
<a name="l01880"></a>01880     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Running getNextDestination()&quot;</span> &lt;&lt; endl;
<a name="l01881"></a>01881     <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#af9410192fb1add58020e8c9fd14928c1">numberOfTransmissions</a> == 0) {
<a name="l01882"></a>01882         <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a24112a5f40c053aa671d3279afd415ad">getInitialDestinationPath</a>() == NULL) {
<a name="l01883"></a>01883             next = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#afaefe95090e09d43d24794cf47a1ec0c">getPrimaryPath</a>();
<a name="l01884"></a>01884         }
<a name="l01885"></a>01885         <span class="keywordflow">else</span> {
<a name="l01886"></a>01886             next = chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#a24112a5f40c053aa671d3279afd415ad">getInitialDestinationPath</a>();
<a name="l01887"></a>01887         }
<a name="l01888"></a>01888     }
<a name="l01889"></a>01889     <span class="keywordflow">else</span> {
<a name="l01890"></a>01890         <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ab5595233870d7a9b0dc74b020ae7c9a1">hasBeenFastRetransmitted</a>) {
<a name="l01891"></a>01891             <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Chunk is scheduled for FastRetransmission. Next destination = &quot;</span>
<a name="l01892"></a>01892                       &lt;&lt; chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#aab8ca4e56deac9cab60e83c2fa7c2c6f">getLastDestination</a>() &lt;&lt; endl;
<a name="l01893"></a>01893             <span class="keywordflow">return</span>(chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ad2160ca859be158877f7259d0e3d8ff8">getLastDestinationPath</a>());
<a name="l01894"></a>01894         }
<a name="l01895"></a>01895         <span class="comment">// If this is a retransmission, we should choose another, active path.</span>
<a name="l01896"></a>01896         last = chunk-&gt;<a class="code" href="class_s_c_t_p_data_variables.html#ad2160ca859be158877f7259d0e3d8ff8">getLastDestinationPath</a>();
<a name="l01897"></a>01897         next = <a class="code" href="class_s_c_t_p_association.html#a54a47746095fa64e6976d22bdbb8e884">getNextPath</a>(last);
<a name="l01898"></a>01898         <span class="keywordflow">if</span>( (next == NULL) || (next-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#afb5df73d90e27abfe7ca3108beb051f6">confirmed</a> == <span class="keyword">false</span>) ) {
<a name="l01899"></a>01899             next = last;
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901     }
<a name="l01902"></a>01902 
<a name="l01903"></a>01903     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;getNextDestination(): chunk was last sent to &quot;</span> &lt;&lt; last-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>
<a name="l01904"></a>01904               &lt;&lt; <span class="stringliteral">&quot;, will next be sent to path &quot;</span> &lt;&lt; next-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a> &lt;&lt; endl;
<a name="l01905"></a>01905     <span class="keywordflow">return</span> (next);
<a name="l01906"></a>01906 }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908 
<a name="l01909"></a><a class="code" href="class_s_c_t_p_association.html#a5015c5c13fbe8608b1370a85fc06806f">01909</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a5015c5c13fbe8608b1370a85fc06806f">SCTPAssociation::pmDataIsSentOn</a>(<a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path)
<a name="l01910"></a>01910 {
<a name="l01911"></a>01911     <span class="comment">/* restart hb_timer on this path */</span>
<a name="l01912"></a>01912     <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>);
<a name="l01913"></a>01913     <span class="keywordflow">if</span> (<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a443c8e2a234674a5b8bb385831bf147f">enableHeartbeats</a>)
<a name="l01914"></a>01914     {
<a name="l01915"></a>01915         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8ea7a908e771155785f375bc4bb05661">heartbeatTimeout</a> = path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> + (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;hbInterval&quot;</span>);
<a name="l01916"></a>01916         <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>, path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8ea7a908e771155785f375bc4bb05661">heartbeatTimeout</a>);
<a name="l01917"></a>01917         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Restarting HB timer on path &quot;</span>&lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>
<a name="l01918"></a>01918                   &lt;&lt; <span class="stringliteral">&quot; to expire at time &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8ea7a908e771155785f375bc4bb05661">heartbeatTimeout</a> &lt;&lt; endl;
<a name="l01919"></a>01919     }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921     path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a51b69ce98294df53f826541717c0b2bd">cwndTimeout</a> = path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>;
<a name="l01922"></a>01922     <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7696cc66ad659fbd0259cdc91808117a">CwndTimer</a>);
<a name="l01923"></a>01923     <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7696cc66ad659fbd0259cdc91808117a">CwndTimer</a>, path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a51b69ce98294df53f826541717c0b2bd">cwndTimeout</a>);
<a name="l01924"></a>01924 
<a name="l01925"></a>01925     <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Restarting CWND timer on path &quot;</span>&lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>
<a name="l01926"></a>01926               &lt;&lt; <span class="stringliteral">&quot; to expire at time &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a51b69ce98294df53f826541717c0b2bd">cwndTimeout</a> &lt;&lt; endl;
<a name="l01927"></a>01927 }
<a name="l01928"></a>01928 
<a name="l01929"></a><a class="code" href="class_s_c_t_p_association.html#ab385b4edb0ddac6e69aa350df14b480a">01929</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#ab385b4edb0ddac6e69aa350df14b480a">SCTPAssociation::pmStartPathManagement</a>()
<a name="l01930"></a>01930 {
<a name="l01931"></a>01931     <a class="code" href="class_routing_table_access.html">RoutingTableAccess</a> routingTableAccess;
<a name="l01932"></a>01932     <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path;
<a name="l01933"></a>01933     int32 i=0;
<a name="l01934"></a>01934     <span class="comment">/* populate path structures !!! */</span>
<a name="l01935"></a>01935     <span class="comment">/* set a high start value...this is appropriately decreased later (below) */</span>
<a name="l01936"></a>01936     <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> = <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a1046a167391f15e9071fda9395588756">localRwnd</a>;
<a name="l01937"></a>01937     <span class="keywordflow">for</span>(SCTPPathMap::iterator piter=<a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.begin(); piter!=<a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end(); piter++)
<a name="l01938"></a>01938     {
<a name="l01939"></a>01939         path=piter-&gt;second;
<a name="l01940"></a>01940         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a1fa3356788646df71c76838733d15c26">pathErrorCount</a> = 0;
<a name="l01941"></a>01941         <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *rtie = routingTableAccess.<a class="code" href="class_module_access.html#a44956ddb52973612afbba0eeecf8bb66">get</a>()-&gt;<a class="code" href="class_i_routing_table.html#a0dda4a87779a949284ccead75001fa30">getInterfaceForDestAddr</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
<a name="l01942"></a>01942         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ad6dd717bdac741be310d027f5b663525">pmtu</a> = rtie-&gt;<a class="code" href="class_interface_entry.html#adbe3ede6fb4652fbfc4abbe2c924cc3b">getMTU</a>();
<a name="l01943"></a>01943         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Path MTU of Interface &quot;</span>&lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ad6dd717bdac741be310d027f5b663525">pmtu</a> &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01944"></a>01944         <span class="keywordflow">if</span> (path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ad6dd717bdac741be310d027f5b663525">pmtu</a> &lt; <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a>)
<a name="l01945"></a>01945         {
<a name="l01946"></a>01946             <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a20d0d3d8a1e728ac8742eba28856799f">assocPmtu</a> = path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ad6dd717bdac741be310d027f5b663525">pmtu</a>;
<a name="l01947"></a>01947         }
<a name="l01948"></a>01948         <a class="code" href="class_s_c_t_p_association.html#a27ab7a3f0d7e82a5b48f47e39e53dd23">initCCParameters</a>(path);
<a name="l01949"></a>01949         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> = (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoInitial&quot;</span>);
<a name="l01950"></a>01950         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a> = path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>;
<a name="l01951"></a>01951         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a570d5d2f28369483f6dca824643d4959">rttvar</a> = SIMTIME_ZERO;
<a name="l01952"></a>01952         <span class="comment">/* from now on we may have one update per RTO/SRTT */</span>
<a name="l01953"></a>01953         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#addd9854620d83632deb90ab177416ed7">updateTime</a> = SIMTIME_ZERO;
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a857673312c2f810885b9d8394eece558">partialBytesAcked</a> = 0;
<a name="l01957"></a>01957         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a39d7029c5e70ee8e6ff6c169aaa7a240">outstandingBytes</a> = 0;
<a name="l01958"></a>01958         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aec73d49b9720a1448d063e211ccefda0">activePath</a> = <span class="keyword">true</span>;
<a name="l01959"></a>01959         <span class="comment">// Timer probably not running, but stop it anyway I.R.</span>
<a name="l01960"></a>01960         <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac772c4fa18747d878152f13413be0098">T3_RtxTimer</a>);
<a name="l01961"></a>01961 
<a name="l01962"></a>01962         <span class="keywordflow">if</span> (path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a> == <a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a6270b0edb7777931a33ff8662288bf25">initialPrimaryPath</a> &amp;&amp; !path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#afb5df73d90e27abfe7ca3108beb051f6">confirmed</a>) {
<a name="l01963"></a>01963             path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#afb5df73d90e27abfe7ca3108beb051f6">confirmed</a> = <span class="keyword">true</span>;
<a name="l01964"></a>01964         }
<a name="l01965"></a>01965         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a>&lt;&lt;getFullPath()&lt;&lt;<span class="stringliteral">&quot; numberOfLocalAddresses=&quot;</span>&lt;&lt;<a class="code" href="class_s_c_t_p_association.html#aa270ad2776ffc5c9481909b11532772c">state</a>-&gt;<a class="code" href="class_s_c_t_p_state_variables.html#a7b2aedff06029b67f2861a902e1bcf54">localAddresses</a>.size()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01966"></a>01966              path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8ea7a908e771155785f375bc4bb05661">heartbeatTimeout</a>= (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;hbInterval&quot;</span>)+i*path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>;
<a name="l01967"></a>01967              <a class="code" href="class_s_c_t_p_association.html#a5929aa6d346d39510a8826dfce06169a">stopTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>);
<a name="l01968"></a>01968              <a class="code" href="class_s_c_t_p_association.html#afc5f06d167b937c0d1267047960bc354">sendHeartbeat</a>(path);
<a name="l01969"></a>01969              <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7fd8160605d99abd3e8dcca004c4956b">HeartbeatTimer</a>, path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a8ea7a908e771155785f375bc4bb05661">heartbeatTimeout</a>);
<a name="l01970"></a>01970              <a class="code" href="class_s_c_t_p_association.html#aafb136543c6d4287ea773d3519593010">startTimer</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a2172a6ce9db9b2108ebe84d98ca52d36">HeartbeatIntervalTimer</a>, path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a7d1aef839313bbde64bfb12f4ddb3852">heartbeatIntervalTimeout</a>);
<a name="l01971"></a>01971         path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a44bb5884f543cbf4672d0dadfa04dae4">statisticsPathRTO</a>-&gt;record(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>);
<a name="l01972"></a>01972         i++;
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 }
<a name="l01975"></a>01975 
<a name="l01976"></a>01976 
<a name="l01977"></a><a class="code" href="class_s_c_t_p_association.html#a8270ebaccc92eb00ffae041a8406b094">01977</a> int32 <a class="code" href="class_s_c_t_p_association.html#a8270ebaccc92eb00ffae041a8406b094">SCTPAssociation::getOutstandingBytes</a>()<span class="keyword"> const</span>
<a name="l01978"></a>01978 <span class="keyword"></span>{
<a name="l01979"></a>01979     int32 osb = 0;
<a name="l01980"></a>01980     <span class="keywordflow">for</span> (SCTPPathMap::const_iterator pm = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.begin(); pm != <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end(); pm++) {
<a name="l01981"></a>01981         osb += pm-&gt;second-&gt;outstandingBytes;
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     <span class="keywordflow">return</span> osb;
<a name="l01984"></a>01984 }
<a name="l01985"></a>01985 
<a name="l01986"></a><a class="code" href="class_s_c_t_p_association.html#a0fc1eef21b0fbadd97e0b4739213d35e">01986</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a0fc1eef21b0fbadd97e0b4739213d35e">SCTPAssociation::pmClearPathCounter</a>(<a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path)
<a name="l01987"></a>01987 {
<a name="l01988"></a>01988     path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a1fa3356788646df71c76838733d15c26">pathErrorCount</a> = 0;
<a name="l01989"></a>01989     <span class="keywordflow">if</span> (path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aec73d49b9720a1448d063e211ccefda0">activePath</a> == <span class="keyword">false</span>) {
<a name="l01990"></a>01990         <span class="comment">/* notify the application */</span>
<a name="l01991"></a>01991         <a class="code" href="class_s_c_t_p_association.html#aee07b10bc3e9c1999e15c025d5e7db5f">pathStatusIndication</a>(path, <span class="keyword">true</span>);
<a name="l01992"></a>01992         <a class="code" href="_s_c_t_p_8h.html#ae124292366093a18d977ca18bd0c19f1">sctpEV3</a> &lt;&lt; <span class="stringliteral">&quot;Path &quot;</span> &lt;&lt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>
<a name="l01993"></a>01993                   &lt;&lt; <span class="stringliteral">&quot; state changes from INACTIVE to ACTIVE !!!&quot;</span> &lt;&lt; endl;
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 }
<a name="l01996"></a>01996 
<a name="l01997"></a><a class="code" href="class_s_c_t_p_association.html#aee07b10bc3e9c1999e15c025d5e7db5f">01997</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#aee07b10bc3e9c1999e15c025d5e7db5f">SCTPAssociation::pathStatusIndication</a>(<span class="keyword">const</span> <a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path,
<a name="l01998"></a>01998                                                          <span class="keyword">const</span> <span class="keywordtype">bool</span>                   status)
<a name="l01999"></a>01999 {
<a name="l02000"></a>02000     cPacket* msg = <span class="keyword">new</span> cPacket(<span class="stringliteral">&quot;StatusInfo&quot;</span>);
<a name="l02001"></a>02001     msg-&gt;setKind(<a class="code" href="_s_c_t_p_command_8h.html#a066d6fbbc858ac42638c402e8ab1a5f3abbf25758d570841736d12727b53ff2be">SCTP_I_STATUS</a>);
<a name="l02002"></a>02002     <a class="code" href="class_s_c_t_p_status_info.html">SCTPStatusInfo</a>* cmd = <span class="keyword">new</span> <a class="code" href="class_s_c_t_p_status_info.html">SCTPStatusInfo</a>();
<a name="l02003"></a>02003     cmd-&gt;<a class="code" href="class_s_c_t_p_status_info.html#ad362258a445e9e783951bf0306c6ae7b">setPathId</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#aa633bf8cbecd1b7152d64e56365dcd1a">remoteAddress</a>);
<a name="l02004"></a>02004     cmd-&gt;<a class="code" href="class_s_c_t_p_command.html#aba989bb5fd07d31faf68d42bd90cbd02">setAssocId</a>(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l02005"></a>02005     cmd-&gt;<a class="code" href="class_s_c_t_p_status_info.html#a58210fbec91a82936c82e571dec76860">setActive</a>(status);
<a name="l02006"></a>02006     msg-&gt;setControlInfo(cmd);
<a name="l02007"></a>02007     <span class="keywordflow">if</span> (!status) {
<a name="l02008"></a>02008         SCTP::AssocStatMap::iterator iter=<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;<a class="code" href="class_s_c_t_p.html#a43c9f3107b99f1c969a4d5ca9c168bd3">assocStatMap</a>.find(<a class="code" href="class_s_c_t_p_association.html#a135afa4887cc640b0e8410dc95a29972">assocId</a>);
<a name="l02009"></a>02009         iter-&gt;second.numPathFailures++;
<a name="l02010"></a>02010     }
<a name="l02011"></a>02011     <a class="code" href="class_s_c_t_p_association.html#a35a8d95a64b2977c79bf24b1353c0c8e">sendToApp</a>(msg);
<a name="l02012"></a>02012 }
<a name="l02013"></a>02013 
<a name="l02014"></a><a class="code" href="class_s_c_t_p_association.html#a02104ef95fcdab0f90cc9b03da82a675">02014</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a02104ef95fcdab0f90cc9b03da82a675">SCTPAssociation::pmRttMeasurement</a>(<a class="code" href="class_s_c_t_p_path_variables.html">SCTPPathVariables</a>* path,
<a name="l02015"></a>02015                                                     <span class="keyword">const</span> simtime_t&amp;     rttEstimation)
<a name="l02016"></a>02016 {
<a name="l02017"></a>02017     <span class="keywordflow">if</span> (rttEstimation &lt; MAXTIME) {
<a name="l02018"></a>02018         <span class="keywordflow">if</span> (simTime() &gt; path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#addd9854620d83632deb90ab177416ed7">updateTime</a>) {
<a name="l02019"></a>02019             <span class="keywordflow">if</span> (path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#addd9854620d83632deb90ab177416ed7">updateTime</a> == SIMTIME_ZERO) {
<a name="l02020"></a>02020                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a570d5d2f28369483f6dca824643d4959">rttvar</a>  = rttEstimation.dbl() / 2;
<a name="l02021"></a>02021                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>    = rttEstimation;
<a name="l02022"></a>02022                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> = 3.0 * rttEstimation.dbl();
<a name="l02023"></a>02023                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> = <a class="code" href="_s_c_t_p_association_8h.html#afdb84bd44c7cbd3fc9cbe1e3bf07d948">max</a>(<a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>.dbl(), (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoMax&quot;</span>)),
<a name="l02024"></a>02024                                           (<span class="keywordtype">double</span>)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoMin&quot;</span>));
<a name="l02025"></a>02025             }
<a name="l02026"></a>02026             <span class="keywordflow">else</span> {
<a name="l02027"></a>02027                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a570d5d2f28369483f6dca824643d4959">rttvar</a>  = (1.0 - (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoBeta&quot;</span>)) * path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a570d5d2f28369483f6dca824643d4959">rttvar</a>.dbl() +
<a name="l02028"></a>02028                                          (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoBeta&quot;</span>) * fabs(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>.dbl() - rttEstimation.dbl());
<a name="l02029"></a>02029                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>    = (1.0 - (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoAlpha&quot;</span>)) * path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>.dbl() +
<a name="l02030"></a>02030                                          (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoAlpha&quot;</span>) * rttEstimation.dbl();
<a name="l02031"></a>02031                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> = path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>.dbl() + 4.0 * path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a570d5d2f28369483f6dca824643d4959">rttvar</a>.dbl();
<a name="l02032"></a>02032                 path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a> = <a class="code" href="_s_c_t_p_association_8h.html#afdb84bd44c7cbd3fc9cbe1e3bf07d948">max</a>(<a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">min</a>(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>.dbl(), (double)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoMax&quot;</span>)),
<a name="l02033"></a>02033                                           (<span class="keywordtype">double</span>)<a class="code" href="class_s_c_t_p_association.html#a3b2775352d3150256445a957de26926b">sctpMain</a>-&gt;par(<span class="stringliteral">&quot;rtoMin&quot;</span>));
<a name="l02034"></a>02034             }
<a name="l02035"></a>02035 <span class="comment">/*</span>
<a name="l02036"></a>02036 <span class="comment">            std::cout &lt;&lt; simTime() &lt;&lt; &quot;: Updating timer values for path &quot; &lt;&lt; path-&gt;remoteAddress &lt;&lt; &quot;:&quot;</span>
<a name="l02037"></a>02037 <span class="comment">                      &lt;&lt; &quot; RTO=&quot;              &lt;&lt; path-&gt;pathRto</span>
<a name="l02038"></a>02038 <span class="comment">                      &lt;&lt; &quot; rttEstimation=&quot; &lt;&lt; rttEstimation</span>
<a name="l02039"></a>02039 <span class="comment">                      &lt;&lt; &quot; SRTT=&quot;             &lt;&lt; path-&gt;srtt</span>
<a name="l02040"></a>02040 <span class="comment">                      &lt;&lt; &quot; --&gt;  RTTVAR=&quot;      &lt;&lt; path-&gt;rttvar &lt;&lt; endl;</span>
<a name="l02041"></a>02041 <span class="comment">*/</span>
<a name="l02042"></a>02042             <span class="comment">// RFC 2960, sect. 6.3.1: new RTT measurements SHOULD be made no more</span>
<a name="l02043"></a>02043             <span class="comment">//                                than once per round-trip.</span>
<a name="l02044"></a>02044             path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#addd9854620d83632deb90ab177416ed7">updateTime</a> = simTime() + path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ae266c152e209421111fd4948dd539dd5">srtt</a>;
<a name="l02045"></a>02045             path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a44bb5884f543cbf4672d0dadfa04dae4">statisticsPathRTO</a>-&gt;record(path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#ac2470e5c12a744d1b567a728edf9b307">pathRto</a>);
<a name="l02046"></a>02046             path-&gt;<a class="code" href="class_s_c_t_p_path_variables.html#a2c6f1c4f3eea5efadb824e736a8a994f">statisticsPathRTT</a>-&gt;record(rttEstimation);
<a name="l02047"></a>02047         }
<a name="l02048"></a>02048     }
<a name="l02049"></a>02049 }
<a name="l02050"></a>02050 
<a name="l02051"></a><a class="code" href="class_s_c_t_p_association.html#ae691d69b908141f2b120ce25f824b683">02051</a> <span class="keywordtype">bool</span> <a class="code" href="class_s_c_t_p_association.html#ae691d69b908141f2b120ce25f824b683">SCTPAssociation::allPathsInactive</a>()<span class="keyword"> const</span>
<a name="l02052"></a>02052 <span class="keyword"></span>{
<a name="l02053"></a>02053     <span class="keywordflow">for</span>(SCTPPathMap::const_iterator it = <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.begin(); it != <a class="code" href="class_s_c_t_p_association.html#a32f0e2f4ef1678a91a307b96a3bb1822">sctpPathMap</a>.end(); it++) {
<a name="l02054"></a>02054         <span class="keywordflow">if</span> (it-&gt;second-&gt;activePath) {
<a name="l02055"></a>02055             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02056"></a>02056         }
<a name="l02057"></a>02057     }
<a name="l02058"></a>02058     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02059"></a>02059 }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061 
<a name="l02062"></a><a class="code" href="class_s_c_t_p_association.html#a24959906501442490b4767253bbd658c">02062</a> <span class="keywordtype">void</span> <a class="code" href="class_s_c_t_p_association.html#a24959906501442490b4767253bbd658c">SCTPAssociation::disposeOf</a>(<a class="code" href="class_s_c_t_p_message.html">SCTPMessage</a>* sctpmsg)
<a name="l02063"></a>02063 {
<a name="l02064"></a>02064     <a class="code" href="class_s_c_t_p_chunk.html">SCTPChunk</a>* <a class="code" href="structchunk.html">chunk</a>;
<a name="l02065"></a>02065     uint32 numberOfChunks = sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#a6f20de2280586794996c56c77bf5c479">getChunksArraySize</a>();
<a name="l02066"></a>02066     <span class="keywordflow">if</span> (numberOfChunks&gt;0)
<a name="l02067"></a>02067     <span class="keywordflow">for</span> (uint32 i=0; i&lt;numberOfChunks; i++)
<a name="l02068"></a>02068     {
<a name="l02069"></a>02069         chunk = (<a class="code" href="class_s_c_t_p_chunk.html">SCTPChunk</a>*)(sctpmsg-&gt;<a class="code" href="class_s_c_t_p_message.html#aa0f9b611f85c4e718a400e9f7379f4b8">removeChunk</a>());
<a name="l02070"></a>02070         <span class="keywordflow">if</span> (chunk-&gt;<a class="code" href="class_s_c_t_p_chunk.html#a752caf91430fcd3157a12e7e91361471">getChunkType</a>()==<a class="code" href="_consts80211_8h.html#ad70ed57eb996b190fc586f309107250ea9d7d6f31868d66330397c967c4afd2d2">DATA</a>)
<a name="l02071"></a>02071             <span class="keyword">delete</span> (<a class="code" href="class_s_c_t_p_simple_message.html">SCTPSimpleMessage</a>*)chunk-&gt;decapsulate();
<a name="l02072"></a>02072         <span class="keyword">delete</span> chunk;
<a name="l02073"></a>02073     }
<a name="l02074"></a>02074     <span class="keyword">delete</span> sctpmsg;
<a name="l02075"></a>02075 }
<a name="l02076"></a>02076 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:29 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
