<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: OSPFInterface.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_493eba74639f722aa88bd3d010f621b5.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_10b2eb36c3bc5c55e7882141837be45a.html">networklayer</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_61429c994d0cab36f72bf07190cd4d82.html">ospfv2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_2d7975455ea41775b3b3c7b8a4b868c2.html">interface</a>
  </div>
</div>
<div class="contents">
<h1>OSPFInterface.cc</h1><a href="_o_s_p_f_interface_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// Copyright (C) 2006 Andras Babos and Andras Varga</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment">// modify it under the terms of the GNU Lesser General Public License</span>
<a name="l00006"></a>00006 <span class="comment">// as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment">// of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment">// GNU Lesser General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00015"></a>00015 <span class="comment">// along with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_o_s_p_f_interface_8h.html">OSPFInterface.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_o_s_p_f_interface_state_down_8h.html">OSPFInterfaceStateDown.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_interface_table_access_8h.html">InterfaceTableAccess.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_i_pv4_interface_data_8h.html">IPv4InterfaceData.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_message_handler_8h.html">MessageHandler.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_o_s_p_f_area_8h.html">OSPFArea.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_o_s_p_f_router_8h.html">OSPFRouter.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;memory.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a35e19d6d44125ed42ef53da87de403a3">00028</a> <a class="code" href="class_o_s_p_f_1_1_interface.html#a35e19d6d44125ed42ef53da87de403a3">OSPF::Interface::Interface</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4ac">OSPF::Interface::OSPFInterfaceType</a> ifType) :
<a name="l00029"></a>00029     interfaceType(ifType),
<a name="l00030"></a>00030     ifIndex(0),
<a name="l00031"></a>00031     mtu(0),
<a name="l00032"></a>00032     interfaceAddressRange(OSPF::<a class="code" href="namespace_o_s_p_f.html#ad8bce8fb1420d6747aba9a122e7300ea">NullIPv4AddressRange</a>),
<a name="l00033"></a>00033     areaID(OSPF::<a class="code" href="namespace_o_s_p_f.html#adb591659bd229b640cdc32ebaef95222">BackboneAreaID</a>),
<a name="l00034"></a>00034     transitAreaID(OSPF::<a class="code" href="namespace_o_s_p_f.html#adb591659bd229b640cdc32ebaef95222">BackboneAreaID</a>),
<a name="l00035"></a>00035     helloInterval(10),
<a name="l00036"></a>00036     pollInterval(120),
<a name="l00037"></a>00037     routerDeadInterval(40),
<a name="l00038"></a>00038     interfaceTransmissionDelay(1),
<a name="l00039"></a>00039     routerPriority(0),
<a name="l00040"></a>00040     designatedRouter(OSPF::<a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">NullDesignatedRouterID</a>),
<a name="l00041"></a>00041     backupDesignatedRouter(OSPF::<a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">NullDesignatedRouterID</a>),
<a name="l00042"></a>00042     interfaceOutputCost(1),
<a name="l00043"></a>00043     retransmissionInterval(5),
<a name="l00044"></a>00044     acknowledgementDelay(1),
<a name="l00045"></a>00045     authenticationType(OSPF::<a class="code" href="namespace_o_s_p_f.html#a2e0cad18e6b80ee3a427a65a0b395aafaa912eb1946419ebf910b2b8322788ca9">NullType</a>),
<a name="l00046"></a>00046     parentArea(NULL)
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048     <a class="code" href="class_o_s_p_f_1_1_interface.html#a30e23532102fe3c76c22032d4c70355f">state</a> = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_down.html">OSPF::InterfaceStateDown</a>;
<a name="l00049"></a>00049     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a> = NULL;
<a name="l00050"></a>00050     <a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a> = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_timer.html">OSPFTimer</a>;
<a name="l00051"></a>00051     <a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>-&gt;<a class="code" href="class_o_s_p_f_timer.html#a0466771c5b2cff0c46ea2fadad1a5752">setTimerKind</a>(<a class="code" href="_o_s_p_f_timer__m_8h.html#a849e21fd541ff90a1e41cbe36d769f01ae04537efd5224ea50c066c595d8733b5">InterfaceHelloTimer</a>);
<a name="l00052"></a>00052     <a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00053"></a>00053     <a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>-&gt;setName(<span class="stringliteral">&quot;OSPF::Interface::InterfaceHelloTimer&quot;</span>);
<a name="l00054"></a>00054     <a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a> = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_timer.html">OSPFTimer</a>;
<a name="l00055"></a>00055     <a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>-&gt;<a class="code" href="class_o_s_p_f_timer.html#a0466771c5b2cff0c46ea2fadad1a5752">setTimerKind</a>(<a class="code" href="_o_s_p_f_timer__m_8h.html#a849e21fd541ff90a1e41cbe36d769f01a331e575a92c02a9b51419e5217f32fc1">InterfaceWaitTimer</a>);
<a name="l00056"></a>00056     <a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00057"></a>00057     <a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>-&gt;setName(<span class="stringliteral">&quot;OSPF::Interface::InterfaceWaitTimer&quot;</span>);
<a name="l00058"></a>00058     <a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a> = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_timer.html">OSPFTimer</a>;
<a name="l00059"></a>00059     <a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>-&gt;<a class="code" href="class_o_s_p_f_timer.html#a0466771c5b2cff0c46ea2fadad1a5752">setTimerKind</a>(<a class="code" href="_o_s_p_f_timer__m_8h.html#a849e21fd541ff90a1e41cbe36d769f01a82cd4bee72f6840893a6a639c535d643">InterfaceAcknowledgementTimer</a>);
<a name="l00060"></a>00060     <a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
<a name="l00061"></a>00061     <a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>-&gt;setName(<span class="stringliteral">&quot;OSPF::Interface::InterfaceAcknowledgementTimer&quot;</span>);
<a name="l00062"></a>00062     memset(<a class="code" href="class_o_s_p_f_1_1_interface.html#a433bf99728cfe9fed8ef9a0c3f75a889">authenticationKey</a>.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#a09102c74d106ef556c423ea0438aed4a">bytes</a>, 0, 8 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#aef212290dc8f40986ae42a631a78a6b8">00065</a> <a class="code" href="class_o_s_p_f_1_1_interface.html#aef212290dc8f40986ae42a631a78a6b8">OSPF::Interface::~Interface</a>(<span class="keywordtype">void</span>)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <a class="code" href="class_o_s_p_f_1_1_message_handler.html">MessageHandler</a>* messageHandler = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>();
<a name="l00068"></a>00068     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>);
<a name="l00069"></a>00069     <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>;
<a name="l00070"></a>00070     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>);
<a name="l00071"></a>00071     <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>;
<a name="l00072"></a>00072     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>);
<a name="l00073"></a>00073     <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>;
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a> != NULL) {
<a name="l00075"></a>00075         <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a>;
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077     <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a30e23532102fe3c76c22032d4c70355f">state</a>;
<a name="l00078"></a>00078     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00079"></a>00079     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00080"></a>00080         <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i];
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a7c4201bb2f873917dd32fc330daef413">00084</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a7c4201bb2f873917dd32fc330daef413">OSPF::Interface::SetIfIndex</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> index)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a> = index;
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca263b7ca858c5d2f55a787e0209cd7a17">OSPF::Interface::UnknownType</a>) {
<a name="l00088"></a>00088         <a class="code" href="class_interface_entry.html">InterfaceEntry</a>* routingInterface = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get()-&gt;getInterfaceById(<a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>);
<a name="l00089"></a>00089         <a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a> = <a class="code" href="_o_s_p_fcommon_8h.html#add192341579a523d6fa090e1f434630e">IPv4AddressFromAddressString</a>(routingInterface-&gt;<a class="code" href="class_interface_entry.html#ad47857e772397cc2d00de3a8cf464993">ipv4Data</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#aec8ebefd03acad479ac89d31d7228331">getIPAddress</a>().<a class="code" href="class_i_p_address.html#a50f58febbf2ded78b9f6e32e579f5d2b">str</a>().c_str());
<a name="l00090"></a>00090         <a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a452878c3f507f27d1de9c5b7cda2ae70">mask</a> = <a class="code" href="_o_s_p_fcommon_8h.html#add192341579a523d6fa090e1f434630e">IPv4AddressFromAddressString</a>(routingInterface-&gt;<a class="code" href="class_interface_entry.html#ad47857e772397cc2d00de3a8cf464993">ipv4Data</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#adcd91eac3ced30ab46a8ad5d481dbb58">getNetmask</a>().<a class="code" href="class_i_p_address.html#a50f58febbf2ded78b9f6e32e579f5d2b">str</a>().c_str());
<a name="l00091"></a>00091         <a class="code" href="class_o_s_p_f_1_1_interface.html#a53345717126363978a61c3645b8f3e36">mtu</a> = routingInterface-&gt;<a class="code" href="class_interface_entry.html#adbe3ede6fb4652fbfc4abbe2c924cc3b">getMTU</a>();
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#ab7b6f16457d743ff9e525beb5f0647de">00095</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#ab7b6f16457d743ff9e525beb5f0647de">OSPF::Interface::ChangeState</a>(<a class="code" href="class_o_s_p_f_1_1_interface_state.html">OSPF::InterfaceState</a>* newState, <a class="code" href="class_o_s_p_f_1_1_interface_state.html">OSPF::InterfaceState</a>* currentState)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a> != NULL) {
<a name="l00098"></a>00098         <span class="keyword">delete</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a>;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     <a class="code" href="class_o_s_p_f_1_1_interface.html#a30e23532102fe3c76c22032d4c70355f">state</a> = newState;
<a name="l00101"></a>00101     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7907f473ff18206d62a0cb1ff4db4f10">previousState</a> = currentState;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a7efb487b2f5c22c8734c71535f05edb7">00104</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a7efb487b2f5c22c8734c71535f05edb7">OSPF::Interface::ProcessEvent</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#ae0aca9ab8ca338c25d9afa6e65fc8824">OSPF::Interface::InterfaceEventType</a> event)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106     <a class="code" href="class_o_s_p_f_1_1_interface.html#a30e23532102fe3c76c22032d4c70355f">state</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a2a41c0f4f5decb321c67e0fcceac9bca">ProcessEvent</a>(<span class="keyword">this</span>, event);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#aa74a52ba5410d79366928fd4a2074baa">00109</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#aa74a52ba5410d79366928fd4a2074baa">OSPF::Interface::Reset</a>(<span class="keywordtype">void</span>)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <a class="code" href="class_o_s_p_f_1_1_message_handler.html">MessageHandler</a>* messageHandler = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>();
<a name="l00112"></a>00112     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#abefefb9638d2eff253ca6077f879b175">helloTimer</a>);
<a name="l00113"></a>00113     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a91db223e4833e9c782f38638a29c76ab">waitTimer</a>);
<a name="l00114"></a>00114     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a49719380085c8b71bcf46cbcafa8dd58">ClearTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>);
<a name="l00115"></a>00115     <a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a> = <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">NullDesignatedRouterID</a>;
<a name="l00116"></a>00116     <a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a> = <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">NullDesignatedRouterID</a>;
<a name="l00117"></a>00117     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00118"></a>00118     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00119"></a>00119         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;ProcessEvent(<a class="code" href="class_o_s_p_f_1_1_neighbor.html#aa11c941b2bc4a36c36fba1cb453a4172a3fbd4b922a50537533cf7a4dd45268e0">OSPF::Neighbor::KillNeighbor</a>);
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#af5bcfcd208d73be7deeda67c1072ec19">00123</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#af5bcfcd208d73be7deeda67c1072ec19">OSPF::Interface::SendHelloPacket</a>(<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address.html">OSPF::IPv4Address</a> destination, <span class="keywordtype">short</span> ttl)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <a class="code" href="struct_o_s_p_f_options.html">OSPFOptions</a> options;
<a name="l00126"></a>00126     <a class="code" href="class_o_s_p_f_hello_packet.html">OSPFHelloPacket</a>* helloPacket = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_hello_packet.html">OSPFHelloPacket</a>;
<a name="l00127"></a>00127     std::vector&lt;OSPF::IPv4Address&gt; neighbors;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a7839127100306f0d32de845322dc5d16">setRouterID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());
<a name="l00130"></a>00130     helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a8330f979e87055012a3c3acf8adf785f">setAreaID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a5cbe0e459923e9c74db35df51031cb8d">GetAreaID</a>());
<a name="l00131"></a>00131     helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a2e003d1dd0afa513157935fdf62b4ebe">setAuthenticationType</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a146ecbf957430b57f2d7c7340ddaea4f">authenticationType</a>);
<a name="l00132"></a>00132     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
<a name="l00133"></a>00133         helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a50fd50be5a73b14c4859a7f1274bd9f8">setAuthentication</a>(i, <a class="code" href="class_o_s_p_f_1_1_interface.html#a433bf99728cfe9fed8ef9a0c3f75a889">authenticationKey</a>.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#a09102c74d106ef556c423ea0438aed4a">bytes</a>[i]);
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (((<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca4dac0c4eca27454daabf38ea32f47775">PointToPoint</a>) &amp;&amp;
<a name="l00137"></a>00137          (<a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a74993d6571119644535ac918c4240722">address</a> == <a class="code" href="namespace_o_s_p_f.html#a8948acb62332232ba35305c0a0babc8e">OSPF::NullIPv4Address</a>)) ||
<a name="l00138"></a>00138         (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">Virtual</a>))
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a6cbd2f72eff475c263ac3943255a10f7">setNetworkMask</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a4da9e68bb3ffcba090d1b07a5f812ce3">ULongFromIPv4Address</a>(<a class="code" href="namespace_o_s_p_f.html#a8948acb62332232ba35305c0a0babc8e">OSPF::NullIPv4Address</a>));
<a name="l00141"></a>00141     } <span class="keywordflow">else</span> {
<a name="l00142"></a>00142         helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a6cbd2f72eff475c263ac3943255a10f7">setNetworkMask</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a4da9e68bb3ffcba090d1b07a5f812ce3">ULongFromIPv4Address</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a834f58c4cc265ce24378a70ea4d6964b">interfaceAddressRange</a>.<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address_range.html#a452878c3f507f27d1de9c5b7cda2ae70">mask</a>));
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     memset(&amp;options, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct_o_s_p_f_options.html">OSPFOptions</a>));
<a name="l00145"></a>00145     options.<a class="code" href="struct_o_s_p_f_options.html#ae52711a2db18ba8c2c34ffbb9ac162e9">E_ExternalRoutingCapability</a> = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#aab71c3614910d8eacb48abd45ef8bff7">GetExternalRoutingCapability</a>();
<a name="l00146"></a>00146     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a1fc14fe89689d00c894e2f3610cfebb3">setOptions</a>(options);
<a name="l00147"></a>00147     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a66520dfc48764a154e1b0a8b0374979c">setHelloInterval</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a3c89dcbbb7f5eb2553e0677acdaf2f84">helloInterval</a>);
<a name="l00148"></a>00148     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#ae016c856afac462f26eb6e3f5eb990a3">setRouterPriority</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#acf81bf9cd0a68e514565465f8ca63bb9">routerPriority</a>);
<a name="l00149"></a>00149     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a7f70b1033a4b76a9c470f37f9e716a24">setRouterDeadInterval</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a06c0f30ef9dbf5b988e987ad72e3946f">routerDeadInterval</a>);
<a name="l00150"></a>00150     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a4ad669b79f54a9abf5e5ecc9a13e1e73">setDesignatedRouter</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a4da9e68bb3ffcba090d1b07a5f812ce3">ULongFromIPv4Address</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a>));
<a name="l00151"></a>00151     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a77893d31ad75948deeb959e07ba18df3">setBackupDesignatedRouter</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a4da9e68bb3ffcba090d1b07a5f812ce3">ULongFromIPv4Address</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a3e44bfb89c52a2179bfe69cbd73fc30e">ipInterfaceAddress</a>));
<a name="l00152"></a>00152     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00153"></a>00153     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> j = 0; j &lt; neighborCount; j++) {
<a name="l00154"></a>00154         <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[j]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aad7b22d69601f22f77b0839c2ae33cccd">OSPF::Neighbor::InitState</a>) {
<a name="l00155"></a>00155             neighbors.push_back(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[j]-&gt;GetAddress());
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> initedNeighborCount = neighbors.size();
<a name="l00159"></a>00159     helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#a9d52500a193c4b014e1b15a29ee7ecdb">setNeighborArraySize</a>(initedNeighborCount);
<a name="l00160"></a>00160     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; initedNeighborCount; k++) {
<a name="l00161"></a>00161         helloPacket-&gt;<a class="code" href="class_o_s_p_f_hello_packet.html#abe2d6ced06edef783933f3415aea74b7">setNeighbor</a>(k, <a class="code" href="_o_s_p_fcommon_8h.html#a4da9e68bb3ffcba090d1b07a5f812ce3">ULongFromIPv4Address</a>(neighbors[k]));
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a7f38186b1ebbe2bc924c809054a41">setPacketLength</a>(0); <span class="comment">// TODO: Calculate correct length</span>
<a name="l00165"></a>00165     helloPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a629a73a19fbe1184c60e9594d579f">setChecksum</a>(0); <span class="comment">// TODO: Calculate correct cheksum(16-bit one&apos;s complement of the entire packet)</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(helloPacket, destination, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a18eb0e118ec0cbff1659da14b08ba695">00170</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a18eb0e118ec0cbff1659da14b08ba695">OSPF::Interface::SendLSAcknowledgement</a>(<a class="code" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a>* lsaHeader, <a class="code" href="struct_o_s_p_f_1_1_i_pv4_address.html">IPv4Address</a> destination)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172     <a class="code" href="struct_o_s_p_f_options.html">OSPFOptions</a>                         options;
<a name="l00173"></a>00173     <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>* lsAckPacket = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a91cf3984eedf6f3ceb4c0c09c1fc6c6a">setType</a>(<a class="code" href="_o_s_p_f_packet__m_8h.html#ad5f914914dbd3735397f61053e4ff3cca3f9f236adc60a2c841577d429c0cf7b0">LinkStateAcknowledgementPacket</a>);
<a name="l00176"></a>00176     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a7839127100306f0d32de845322dc5d16">setRouterID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());
<a name="l00177"></a>00177     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a8330f979e87055012a3c3acf8adf785f">setAreaID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a5cbe0e459923e9c74db35df51031cb8d">GetAreaID</a>());
<a name="l00178"></a>00178     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a2e003d1dd0afa513157935fdf62b4ebe">setAuthenticationType</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a146ecbf957430b57f2d7c7340ddaea4f">authenticationType</a>);
<a name="l00179"></a>00179     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
<a name="l00180"></a>00180         lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a50fd50be5a73b14c4859a7f1274bd9f8">setAuthentication</a>(i, <a class="code" href="class_o_s_p_f_1_1_interface.html#a433bf99728cfe9fed8ef9a0c3f75a889">authenticationKey</a>.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#a09102c74d106ef556c423ea0438aed4a">bytes</a>[i]);
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#a3ff44a1b5c77d68528004c0dfe5ce72e">setLsaHeadersArraySize</a>(1);
<a name="l00184"></a>00184     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#addd8a17e084845d9a5fce73818155521">setLsaHeaders</a>(0, *lsaHeader);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a7f38186b1ebbe2bc924c809054a41">setPacketLength</a>(0); <span class="comment">// TODO: Calculate correct length</span>
<a name="l00187"></a>00187     lsAckPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a629a73a19fbe1184c60e9594d579f">setChecksum</a>(0); <span class="comment">// TODO: Calculate correct cheksum(16-bit one&apos;s complement of the entire packet)</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordtype">int</span> ttl = (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">OSPF::Interface::Virtual</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a1d4e674fb39c33571b1b8b8f28f02b52">VIRTUAL_LINK_TTL</a> : 1;
<a name="l00190"></a>00190     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(lsAckPacket, destination, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a62df5516c0a1c6080c654c87927554c0">00194</a> <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* <a class="code" href="class_o_s_p_f_1_1_interface.html#a62df5516c0a1c6080c654c87927554c0">OSPF::Interface::GetNeighborByID</a>(<a class="code" href="namespace_o_s_p_f.html#ad64f22839cca7ec05fee5b7596411197">OSPF::RouterID</a> neighborID)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     std::map&lt;OSPF::RouterID, OSPF::Neighbor*&gt;::iterator neighborIt = <a class="code" href="class_o_s_p_f_1_1_interface.html#a2be31e851d95a480b0d2a9a328efd264">neighboringRoutersByID</a>.find(neighborID);
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (neighborIt != <a class="code" href="class_o_s_p_f_1_1_interface.html#a2be31e851d95a480b0d2a9a328efd264">neighboringRoutersByID</a>.end()) {
<a name="l00198"></a>00198         <span class="keywordflow">return</span> (neighborIt-&gt;second);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200     <span class="keywordflow">else</span> {
<a name="l00201"></a>00201         <span class="keywordflow">return</span> NULL;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a7d77a0ec7d5dea0713174e7e2c678645">00205</a> <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* <a class="code" href="class_o_s_p_f_1_1_interface.html#a7d77a0ec7d5dea0713174e7e2c678645">OSPF::Interface::GetNeighborByAddress</a>(<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address.html">OSPF::IPv4Address</a> address)
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207     std::map&lt;OSPF::IPv4Address, OSPF::Neighbor*, OSPF::IPv4Address_Less&gt;::iterator neighborIt = <a class="code" href="class_o_s_p_f_1_1_interface.html#aaa76c62dacc7f8ee62fbe5f3785bef2f">neighboringRoutersByAddress</a>.find(address);
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (neighborIt != <a class="code" href="class_o_s_p_f_1_1_interface.html#aaa76c62dacc7f8ee62fbe5f3785bef2f">neighboringRoutersByAddress</a>.end()) {
<a name="l00209"></a>00209         <span class="keywordflow">return</span> (neighborIt-&gt;second);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordflow">else</span> {
<a name="l00212"></a>00212         <span class="keywordflow">return</span> NULL;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a906b7bb39eaf75d7ccc6e7aaa710c724">00216</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a906b7bb39eaf75d7ccc6e7aaa710c724">OSPF::Interface::AddNeighbor</a>(<a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <a class="code" href="class_o_s_p_f_1_1_interface.html#a2be31e851d95a480b0d2a9a328efd264">neighboringRoutersByID</a>[neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ad80d61e8d0737c7e0a12f1837ac99ffb">GetNeighborID</a>()] = neighbor;
<a name="l00219"></a>00219     <a class="code" href="class_o_s_p_f_1_1_interface.html#aaa76c62dacc7f8ee62fbe5f3785bef2f">neighboringRoutersByAddress</a>[neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#afb8fc0467b13a32ccd3b088528bb9266">GetAddress</a>()] = neighbor;
<a name="l00220"></a>00220     neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a0a4b934cc0fb0b8d327c3e76a64b76e1">SetInterface</a>(<span class="keyword">this</span>);
<a name="l00221"></a>00221     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.push_back(neighbor);
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">00224</a> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">OSPF::Interface::InterfaceStateType</a> <a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">OSPF::Interface::GetState</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00225"></a>00225 <span class="keyword"></span>{
<a name="l00226"></a>00226     <span class="keywordflow">return</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a30e23532102fe3c76c22032d4c70355f">state</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a67e02942e33a243dd57f1130015f41b6">GetState</a>();
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a606390b6d25b4326720aa4674558beec">00229</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="class_o_s_p_f_1_1_interface.html#a606390b6d25b4326720aa4674558beec">OSPF::Interface::GetStateString</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249">OSPF::Interface::InterfaceStateType</a> stateType)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231     <span class="keywordflow">switch</span> (stateType) {
<a name="l00232"></a>00232         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249ab3a6716ba0f851245d5e2e50bf425035">DownState</a>:                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;Down&quot;</span>;
<a name="l00233"></a>00233         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249acff1fbaa2721aa7da821f6d067d918a3">LoopbackState</a>:             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Loopback&quot;</span>;
<a name="l00234"></a>00234         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4b12c46ab26b94b0f002e9a8f54ae385">WaitingState</a>:              <span class="keywordflow">return</span> <span class="stringliteral">&quot;Waiting&quot;</span>;
<a name="l00235"></a>00235         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a4afd8475ebf100839309f695531289d4">PointToPointState</a>:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;PointToPoint&quot;</span>;
<a name="l00236"></a>00236         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39ffb348308b078fa08b177dbaa77fa1">NotDesignatedRouterState</a>:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;NotDesignatedRouter&quot;</span>;
<a name="l00237"></a>00237         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a9d19f5853d01eca65e69e75665a010cd">BackupState</a>:               <span class="keywordflow">return</span> <span class="stringliteral">&quot;Backup&quot;</span>;
<a name="l00238"></a>00238         <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">DesignatedRouterState</a>:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;DesignatedRouter&quot;</span>;
<a name="l00239"></a>00239         <span class="keywordflow">default</span>:                        ASSERT(<span class="keyword">false</span>);
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#aa8054b75c3d15d159962186f65f432e4">00244</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#aa8054b75c3d15d159962186f65f432e4">OSPF::Interface::HasAnyNeighborInStates</a>(<span class="keywordtype">int</span> states)<span class="keyword"> const</span>
<a name="l00245"></a>00245 <span class="keyword"></span>{
<a name="l00246"></a>00246     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00247"></a>00247     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00248"></a>00248         <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0a">OSPF::Neighbor::NeighborStateType</a> neighborState = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;GetState();
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (neighborState &amp; states) {
<a name="l00250"></a>00250             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a561af59933cfbf37a2a648ab4b0b9edf">00256</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a561af59933cfbf37a2a648ab4b0b9edf">OSPF::Interface::RemoveFromAllRetransmissionLists</a>(<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00259"></a>00259     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00260"></a>00260         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;RemoveFromRetransmissionList(lsaKey);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a5beaa088d57b627586cde7dbb56b1f13">00264</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a5beaa088d57b627586cde7dbb56b1f13">OSPF::Interface::IsOnAnyRetransmissionList</a>(<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey)<span class="keyword"> const</span>
<a name="l00265"></a>00265 <span class="keyword"></span>{
<a name="l00266"></a>00266     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00267"></a>00267     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;IsLSAOnRetransmissionList(lsaKey)) {
<a name="l00269"></a>00269             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00278"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#adaf7b6e469c924c1461eae6af743ee3d">00278</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#adaf7b6e469c924c1461eae6af743ee3d">OSPF::Interface::FloodLSA</a>(<a class="code" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a>* lsa, <a class="code" href="class_o_s_p_f_1_1_interface.html">OSPF::Interface</a>* intf, <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <span class="keywordtype">bool</span> floodedBackOut = <span class="keyword">false</span>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keywordflow">if</span> (
<a name="l00283"></a>00283         (
<a name="l00284"></a>00284          (lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a5ec5eaa7d91ea4e1447766fe076d7207">getLsType</a>() == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba4c38291b3c8571803e6cd756f84d0c85">ASExternalLSAType</a>) &amp;&amp;
<a name="l00285"></a>00285          (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> != <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">OSPF::Interface::Virtual</a>) &amp;&amp;
<a name="l00286"></a>00286          (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#aab71c3614910d8eacb48abd45ef8bff7">GetExternalRoutingCapability</a>())
<a name="l00287"></a>00287         ) ||
<a name="l00288"></a>00288         (
<a name="l00289"></a>00289          (lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a5ec5eaa7d91ea4e1447766fe076d7207">getLsType</a>() != <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba4c38291b3c8571803e6cd756f84d0c85">ASExternalLSAType</a>) &amp;&amp;
<a name="l00290"></a>00290          (
<a name="l00291"></a>00291           (
<a name="l00292"></a>00292            (<a class="code" href="class_o_s_p_f_1_1_interface.html#aa56c3151f51534e8af8318c86b85dd5a">areaID</a> != <a class="code" href="namespace_o_s_p_f.html#adb591659bd229b640cdc32ebaef95222">OSPF::BackboneAreaID</a>) &amp;&amp;
<a name="l00293"></a>00293            (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> != <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">OSPF::Interface::Virtual</a>)
<a name="l00294"></a>00294           ) ||
<a name="l00295"></a>00295           (<a class="code" href="class_o_s_p_f_1_1_interface.html#aa56c3151f51534e8af8318c86b85dd5a">areaID</a> == <a class="code" href="namespace_o_s_p_f.html#adb591659bd229b640cdc32ebaef95222">OSPF::BackboneAreaID</a>)
<a name="l00296"></a>00296          )
<a name="l00297"></a>00297         )
<a name="l00298"></a>00298        )
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300         <span class="keywordtype">long</span>              neighborCount                = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00301"></a>00301         <span class="keywordtype">bool</span>              lsaAddedToRetransmissionList = <span class="keyword">false</span>;
<a name="l00302"></a>00302         <a class="code" href="namespace_o_s_p_f.html#a8ac3195d08bc351276d08e1c28e0d2dc">OSPF::LinkStateID</a> linkStateID                  = lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a2f146ccaa3d51bae77fd76f429b52abe">getLinkStateID</a>();
<a name="l00303"></a>00303         <a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a>  lsaKey;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305         lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#a3a05e7e193451f3979803d5e93362ead">linkStateID</a> = linkStateID;
<a name="l00306"></a>00306         lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#a583e0f1cf5e052a08dc21dbcd405e8b6">advertisingRouter</a> = lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a85083aabf7994ed37c3458e06337d183">getAdvertisingRouter</a>().<a class="code" href="class_i_p_address.html#a807ca46964a8403cf0c70f0772179524">getInt</a>();
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {  <span class="comment">// (1)</span>
<a name="l00309"></a>00309             <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aab642c302eb79dfe9cd827bc8af960e28">OSPF::Neighbor::ExchangeState</a>) {   <span class="comment">// (1) (a)</span>
<a name="l00310"></a>00310                 <span class="keywordflow">continue</span>;
<a name="l00311"></a>00311             }
<a name="l00312"></a>00312             <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aa040ad05c4a2d67aa2a167e45d4b74788">OSPF::Neighbor::FullState</a>) {   <span class="comment">// (1) (b)</span>
<a name="l00313"></a>00313                 <a class="code" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a>* requestLSAHeader = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;FindOnRequestList(lsaKey);
<a name="l00314"></a>00314                 <span class="keywordflow">if</span> (requestLSAHeader != NULL) {
<a name="l00315"></a>00315                     <span class="comment">// operator&lt; and operator== on OSPFLSAHeaders determines which one is newer(less means older)</span>
<a name="l00316"></a>00316                     <span class="keywordflow">if</span> (lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>() &lt; (*requestLSAHeader)) {
<a name="l00317"></a>00317                         <span class="keywordflow">continue</span>;
<a name="l00318"></a>00318                     }
<a name="l00319"></a>00319                     <span class="keywordflow">if</span> (<span class="keyword">operator</span>== (lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>(), (*requestLSAHeader))) {
<a name="l00320"></a>00320                         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;RemoveFromRequestList(lsaKey);
<a name="l00321"></a>00321                         <span class="keywordflow">continue</span>;
<a name="l00322"></a>00322                     }
<a name="l00323"></a>00323                     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;RemoveFromRequestList(lsaKey);
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326             <span class="keywordflow">if</span> (neighbor == <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]) {     <span class="comment">// (1) (c)</span>
<a name="l00327"></a>00327                 <span class="keywordflow">continue</span>;
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329             <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;AddToRetransmissionList(lsa);   <span class="comment">// (1) (d)</span>
<a name="l00330"></a>00330             lsaAddedToRetransmissionList = <span class="keyword">true</span>;
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (lsaAddedToRetransmissionList) {     <span class="comment">// (2)</span>
<a name="l00333"></a>00333             <span class="keywordflow">if</span> ((intf != <span class="keyword">this</span>) ||
<a name="l00334"></a>00334                 ((neighbor != NULL) &amp;&amp;
<a name="l00335"></a>00335                  (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ad80d61e8d0737c7e0a12f1837ac99ffb">GetNeighborID</a>() != <a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>) &amp;&amp;
<a name="l00336"></a>00336                  (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ad80d61e8d0737c7e0a12f1837ac99ffb">GetNeighborID</a>() != <a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>)))  <span class="comment">// (3)</span>
<a name="l00337"></a>00337             {
<a name="l00338"></a>00338                 <span class="keywordflow">if</span> ((intf != <span class="keyword">this</span>) || (<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() != <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a9d19f5853d01eca65e69e75665a010cd">OSPF::Interface::BackupState</a>)) {  <span class="comment">// (4)</span>
<a name="l00339"></a>00339                     <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>* updatePacket = <a class="code" href="class_o_s_p_f_1_1_interface.html#a052082a12b71791be8b9f903b6f2767c">CreateUpdatePacket</a>(lsa);    <span class="comment">// (5)</span>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341                     <span class="keywordflow">if</span> (updatePacket != NULL) {
<a name="l00342"></a>00342                         <span class="keywordtype">int</span>                   ttl            = (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">OSPF::Interface::Virtual</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a1d4e674fb39c33571b1b8b8f28f02b52">VIRTUAL_LINK_TTL</a> : 1;
<a name="l00343"></a>00343                         <a class="code" href="class_o_s_p_f_1_1_message_handler.html">OSPF::MessageHandler</a>* messageHandler = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>();
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                         <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca15decf080ad941585245418cfb9458c9">OSPF::Interface::Broadcast</a>) {
<a name="l00346"></a>00346                             <span class="keywordflow">if</span> ((<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) ||
<a name="l00347"></a>00347                                 (<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a9d19f5853d01eca65e69e75665a010cd">OSPF::Interface::BackupState</a>) ||
<a name="l00348"></a>00348                                 (<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a> == <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>))
<a name="l00349"></a>00349                             {
<a name="l00350"></a>00350                                 messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(updatePacket, <a class="code" href="namespace_o_s_p_f.html#afdf11c20cc9287464a9a673199e01004">OSPF::AllSPFRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00351"></a>00351                                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> k = 0; k &lt; neighborCount; k++) {
<a name="l00352"></a>00352                                     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[k]-&gt;AddToTransmittedLSAList(lsaKey);
<a name="l00353"></a>00353                                     <span class="keywordflow">if</span> (!<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[k]-&gt;IsUpdateRetransmissionTimerActive()) {
<a name="l00354"></a>00354                                         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[k]-&gt;StartUpdateRetransmissionTimer();
<a name="l00355"></a>00355                                     }
<a name="l00356"></a>00356                                 }
<a name="l00357"></a>00357                             } <span class="keywordflow">else</span> {
<a name="l00358"></a>00358                                 messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(updatePacket, <a class="code" href="namespace_o_s_p_f.html#a3f675193744b50804fea173a3f6f6bdd">OSPF::AllDRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00359"></a>00359                                 <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* dRouter = <a class="code" href="class_o_s_p_f_1_1_interface.html#a62df5516c0a1c6080c654c87927554c0">GetNeighborByID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>);
<a name="l00360"></a>00360                                 <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* backupDRouter = <a class="code" href="class_o_s_p_f_1_1_interface.html#a62df5516c0a1c6080c654c87927554c0">GetNeighborByID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a1c438d26ca9d60a131c2040f20376334">backupDesignatedRouter</a>.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#a7132bdabe0f15493518622d1b9e84f0f">routerID</a>);
<a name="l00361"></a>00361                                 <span class="keywordflow">if</span> (dRouter != NULL) {
<a name="l00362"></a>00362                                     dRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#af0029c47d548b629b1aa87ee87a228f2">AddToTransmittedLSAList</a>(lsaKey);
<a name="l00363"></a>00363                                     <span class="keywordflow">if</span> (!dRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ada9f6a84cfa9bf0de8d711eb18349754">IsUpdateRetransmissionTimerActive</a>()) {
<a name="l00364"></a>00364                                         dRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ab904bd50a7bec507ba8a7008d49ab789">StartUpdateRetransmissionTimer</a>();
<a name="l00365"></a>00365                                     }
<a name="l00366"></a>00366                                 }
<a name="l00367"></a>00367                                 <span class="keywordflow">if</span> (backupDRouter != NULL) {
<a name="l00368"></a>00368                                     backupDRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#af0029c47d548b629b1aa87ee87a228f2">AddToTransmittedLSAList</a>(lsaKey);
<a name="l00369"></a>00369                                     <span class="keywordflow">if</span> (!backupDRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ada9f6a84cfa9bf0de8d711eb18349754">IsUpdateRetransmissionTimerActive</a>()) {
<a name="l00370"></a>00370                                         backupDRouter-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#ab904bd50a7bec507ba8a7008d49ab789">StartUpdateRetransmissionTimer</a>();
<a name="l00371"></a>00371                                     }
<a name="l00372"></a>00372                                 }
<a name="l00373"></a>00373                             }
<a name="l00374"></a>00374                         } <span class="keywordflow">else</span> {
<a name="l00375"></a>00375                             <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca4dac0c4eca27454daabf38ea32f47775">OSPF::Interface::PointToPoint</a>) {
<a name="l00376"></a>00376                                 messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(updatePacket, <a class="code" href="namespace_o_s_p_f.html#afdf11c20cc9287464a9a673199e01004">OSPF::AllSPFRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00377"></a>00377                                 <span class="keywordflow">if</span> (neighborCount &gt; 0) {
<a name="l00378"></a>00378                                     <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[0]-&gt;AddToTransmittedLSAList(lsaKey);
<a name="l00379"></a>00379                                     <span class="keywordflow">if</span> (!<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[0]-&gt;IsUpdateRetransmissionTimerActive()) {
<a name="l00380"></a>00380                                         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[0]-&gt;StartUpdateRetransmissionTimer();
<a name="l00381"></a>00381                                     }
<a name="l00382"></a>00382                                 }
<a name="l00383"></a>00383                             } <span class="keywordflow">else</span> {
<a name="l00384"></a>00384                                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m = 0; m &lt; neighborCount; m++) {
<a name="l00385"></a>00385                                     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[m]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aab642c302eb79dfe9cd827bc8af960e28">OSPF::Neighbor::ExchangeState</a>) {
<a name="l00386"></a>00386                                         messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(updatePacket, <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[m]-&gt;GetAddress(), <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00387"></a>00387                                         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[m]-&gt;AddToTransmittedLSAList(lsaKey);
<a name="l00388"></a>00388                                         <span class="keywordflow">if</span> (!<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[m]-&gt;IsUpdateRetransmissionTimerActive()) {
<a name="l00389"></a>00389                                             <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[m]-&gt;StartUpdateRetransmissionTimer();
<a name="l00390"></a>00390                                         }
<a name="l00391"></a>00391                                     }
<a name="l00392"></a>00392                                 }
<a name="l00393"></a>00393                             }
<a name="l00394"></a>00394                         }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                         <span class="keywordflow">if</span> (intf == <span class="keyword">this</span>) {
<a name="l00397"></a>00397                             floodedBackOut = <span class="keyword">true</span>;
<a name="l00398"></a>00398                         }
<a name="l00399"></a>00399                     }
<a name="l00400"></a>00400                 }
<a name="l00401"></a>00401             }
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">return</span> floodedBackOut;
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a052082a12b71791be8b9f903b6f2767c">00408</a> <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>* <a class="code" href="class_o_s_p_f_1_1_interface.html#a052082a12b71791be8b9f903b6f2767c">OSPF::Interface::CreateUpdatePacket</a>(<a class="code" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a>* lsa)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410     <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89b">LSAType</a> lsaType                  = <span class="keyword">static_cast&lt;</span><a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89b">LSAType</a><span class="keyword">&gt;</span> (lsa-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a5ec5eaa7d91ea4e1447766fe076d7207">getLsType</a>());
<a name="l00411"></a>00411     <a class="code" href="class_o_s_p_f_router_l_s_a.html">OSPFRouterLSA</a>* routerLSA         = (lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89baf0d156f2d439c02650ae0bb67f9385d9">RouterLSAType</a>) ? dynamic_cast&lt;OSPFRouterLSA*&gt; (lsa) : NULL;
<a name="l00412"></a>00412     <a class="code" href="class_o_s_p_f_network_l_s_a.html">OSPFNetworkLSA</a>* networkLSA       = (lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba872178b0c61ee0bd5c16db015e98b396">NetworkLSAType</a>) ? dynamic_cast&lt;OSPFNetworkLSA*&gt; (lsa) : NULL;
<a name="l00413"></a>00413     <a class="code" href="class_o_s_p_f_summary_l_s_a.html">OSPFSummaryLSA</a>* summaryLSA       = ((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba2c45e949f7ba6ed95c10beb07aa3f4a8">SummaryLSA_NetworksType</a>) ||
<a name="l00414"></a>00414                                         (lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba44e2dd86881d83d6655cc876460308cd">SummaryLSA_ASBoundaryRoutersType</a>)) ? dynamic_cast&lt;OSPFSummaryLSA*&gt; (lsa) : NULL;
<a name="l00415"></a>00415     <a class="code" href="class_o_s_p_f_a_s_external_l_s_a.html">OSPFASExternalLSA</a>* asExternalLSA = (lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba4c38291b3c8571803e6cd756f84d0c85">ASExternalLSAType</a>) ? dynamic_cast&lt;OSPFASExternalLSA*&gt; (lsa) : NULL;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89baf0d156f2d439c02650ae0bb67f9385d9">RouterLSAType</a>) &amp;&amp; (routerLSA != NULL)) ||
<a name="l00418"></a>00418         ((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba872178b0c61ee0bd5c16db015e98b396">NetworkLSAType</a>) &amp;&amp; (networkLSA != NULL)) ||
<a name="l00419"></a>00419         (((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba2c45e949f7ba6ed95c10beb07aa3f4a8">SummaryLSA_NetworksType</a>) || (lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba44e2dd86881d83d6655cc876460308cd">SummaryLSA_ASBoundaryRoutersType</a>)) &amp;&amp; (summaryLSA != NULL)) ||
<a name="l00420"></a>00420         ((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba4c38291b3c8571803e6cd756f84d0c85">ASExternalLSAType</a>) &amp;&amp; (asExternalLSA != NULL)))
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422         <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>* updatePacket = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a91cf3984eedf6f3ceb4c0c09c1fc6c6a">setType</a>(<a class="code" href="_o_s_p_f_packet__m_8h.html#ad5f914914dbd3735397f61053e4ff3cca075a9331436d1c9bb03d82857c0921a6">LinkStateUpdatePacket</a>);
<a name="l00425"></a>00425         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a7839127100306f0d32de845322dc5d16">setRouterID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());
<a name="l00426"></a>00426         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a8330f979e87055012a3c3acf8adf785f">setAreaID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#aa56c3151f51534e8af8318c86b85dd5a">areaID</a>);
<a name="l00427"></a>00427         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a2e003d1dd0afa513157935fdf62b4ebe">setAuthenticationType</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a146ecbf957430b57f2d7c7340ddaea4f">authenticationType</a>);
<a name="l00428"></a>00428         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
<a name="l00429"></a>00429             updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a50fd50be5a73b14c4859a7f1274bd9f8">setAuthentication</a>(j, <a class="code" href="class_o_s_p_f_1_1_interface.html#a433bf99728cfe9fed8ef9a0c3f75a889">authenticationKey</a>.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#a09102c74d106ef556c423ea0438aed4a">bytes</a>[j]);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a29338ad99d58a16fed2b0193fdeb45cb">setNumberOfLSAs</a>(1);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434         <span class="keywordflow">switch</span> (lsaType) {
<a name="l00435"></a>00435             <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89baf0d156f2d439c02650ae0bb67f9385d9">RouterLSAType</a>:
<a name="l00436"></a>00436                 {
<a name="l00437"></a>00437                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#adc72cd2f8068d2887a2f4dcdf3878254">setRouterLSAsArraySize</a>(1);
<a name="l00438"></a>00438                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#ae991462c1ccf79412da38e63a7014e7b">setRouterLSAs</a>(0, *routerLSA);
<a name="l00439"></a>00439                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lsAge = updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a664259d01bcec48edf920542db26b4e5">getRouterLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#abfa986a01e651197c287f6ee1898e1a5">getLsAge</a>();
<a name="l00440"></a>00440                     <span class="keywordflow">if</span> (lsAge &lt; <a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a> - <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>) {
<a name="l00441"></a>00441                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a664259d01bcec48edf920542db26b4e5">getRouterLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(lsAge + <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>);
<a name="l00442"></a>00442                     } <span class="keywordflow">else</span> {
<a name="l00443"></a>00443                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a664259d01bcec48edf920542db26b4e5">getRouterLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
<a name="l00444"></a>00444                     }
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446                 <span class="keywordflow">break</span>;
<a name="l00447"></a>00447             <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba872178b0c61ee0bd5c16db015e98b396">NetworkLSAType</a>:
<a name="l00448"></a>00448                 {
<a name="l00449"></a>00449                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a26ee951bef71223b82d3546b552e39c4">setNetworkLSAsArraySize</a>(1);
<a name="l00450"></a>00450                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a9fb5573553bbb1e8150e5eaeab25aa68">setNetworkLSAs</a>(0, *networkLSA);
<a name="l00451"></a>00451                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lsAge = updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#adc6782663a70e2f7945afeae66aaaf06">getNetworkLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#abfa986a01e651197c287f6ee1898e1a5">getLsAge</a>();
<a name="l00452"></a>00452                     <span class="keywordflow">if</span> (lsAge &lt; <a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a> - <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>) {
<a name="l00453"></a>00453                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#adc6782663a70e2f7945afeae66aaaf06">getNetworkLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(lsAge + <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>);
<a name="l00454"></a>00454                     } <span class="keywordflow">else</span> {
<a name="l00455"></a>00455                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#adc6782663a70e2f7945afeae66aaaf06">getNetworkLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
<a name="l00456"></a>00456                     }
<a name="l00457"></a>00457                 }
<a name="l00458"></a>00458                 <span class="keywordflow">break</span>;
<a name="l00459"></a>00459             <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba2c45e949f7ba6ed95c10beb07aa3f4a8">SummaryLSA_NetworksType</a>:
<a name="l00460"></a>00460             <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba44e2dd86881d83d6655cc876460308cd">SummaryLSA_ASBoundaryRoutersType</a>:
<a name="l00461"></a>00461                 {
<a name="l00462"></a>00462                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a38ac5f32dd3de9bd32d45a5f1290fd97">setSummaryLSAsArraySize</a>(1);
<a name="l00463"></a>00463                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#ac304f1aaef1c9eb29a3bf1e41eab8f25">setSummaryLSAs</a>(0, *summaryLSA);
<a name="l00464"></a>00464                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lsAge = updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a027b0f409d40a41a0035dd9d9f26609f">getSummaryLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#abfa986a01e651197c287f6ee1898e1a5">getLsAge</a>();
<a name="l00465"></a>00465                     <span class="keywordflow">if</span> (lsAge &lt; <a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a> - <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>) {
<a name="l00466"></a>00466                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a027b0f409d40a41a0035dd9d9f26609f">getSummaryLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(lsAge + <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>);
<a name="l00467"></a>00467                     } <span class="keywordflow">else</span> {
<a name="l00468"></a>00468                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a027b0f409d40a41a0035dd9d9f26609f">getSummaryLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
<a name="l00469"></a>00469                     }
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471                 <span class="keywordflow">break</span>;
<a name="l00472"></a>00472             <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a13a450dbb578c4bd7714af8581c4f89ba4c38291b3c8571803e6cd756f84d0c85">ASExternalLSAType</a>:
<a name="l00473"></a>00473                 {
<a name="l00474"></a>00474                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#aa7165bc83e681a7609d148ac518895d0">setAsExternalLSAsArraySize</a>(1);
<a name="l00475"></a>00475                     updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#aeaa7944ee4181ffe13de5804bdf9b2ee">setAsExternalLSAs</a>(0, *asExternalLSA);
<a name="l00476"></a>00476                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> lsAge = updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a07acebc88a55bd3158858c67a6fa2858">getAsExternalLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#abfa986a01e651197c287f6ee1898e1a5">getLsAge</a>();
<a name="l00477"></a>00477                     <span class="keywordflow">if</span> (lsAge &lt; <a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a> - <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>) {
<a name="l00478"></a>00478                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a07acebc88a55bd3158858c67a6fa2858">getAsExternalLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(lsAge + <a class="code" href="class_o_s_p_f_1_1_interface.html#a528d267bd3a86cc3a95d811920cfc69e">interfaceTransmissionDelay</a>);
<a name="l00479"></a>00479                     } <span class="keywordflow">else</span> {
<a name="l00480"></a>00480                         updatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a07acebc88a55bd3158858c67a6fa2858">getAsExternalLSAs</a>(0).<a class="code" href="class_o_s_p_f_l_s_a.html#a2c9acdc68e5e66deb1826ee41a07b7d1">getHeader</a>().<a class="code" href="class_o_s_p_f_l_s_a_header.html#ae9da0df1ade356d3da9daaf68aa77c0d">setLsAge</a>(<a class="code" href="_o_s_p_fcommon_8h.html#a22c87c874ff5382c5d082b860110e363">MAX_AGE</a>);
<a name="l00481"></a>00481                     }
<a name="l00482"></a>00482                 }
<a name="l00483"></a>00483                 <span class="keywordflow">break</span>;
<a name="l00484"></a>00484             <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a7f38186b1ebbe2bc924c809054a41">setPacketLength</a>(0); <span class="comment">// TODO: Calculate correct length</span>
<a name="l00488"></a>00488         updatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a629a73a19fbe1184c60e9594d579f">setChecksum</a>(0); <span class="comment">// TODO: Calculate correct cheksum(16-bit one&apos;s complement of the entire packet)</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">return</span> updatePacket;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492     <span class="keywordflow">return</span> NULL;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#a6c0ab797cd72372506650ec8803c4702">00495</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#a6c0ab797cd72372506650ec8803c4702">OSPF::Interface::AddDelayedAcknowledgement</a>(<a class="code" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a>&amp; lsaHeader)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca15decf080ad941585245418cfb9458c9">OSPF::Interface::Broadcast</a>) {
<a name="l00498"></a>00498         <span class="keywordflow">if</span> ((<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) ||
<a name="l00499"></a>00499             (<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a9d19f5853d01eca65e69e75665a010cd">OSPF::Interface::BackupState</a>) ||
<a name="l00500"></a>00500             (<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a> == <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>))
<a name="l00501"></a>00501         {
<a name="l00502"></a>00502             <a class="code" href="class_o_s_p_f_1_1_interface.html#af119a27aa6b3d21ac48352abd2cf2818">delayedAcknowledgements</a>[<a class="code" href="namespace_o_s_p_f.html#afdf11c20cc9287464a9a673199e01004">OSPF::AllSPFRouters</a>].push_back(lsaHeader);
<a name="l00503"></a>00503         } <span class="keywordflow">else</span> {
<a name="l00504"></a>00504             <a class="code" href="class_o_s_p_f_1_1_interface.html#af119a27aa6b3d21ac48352abd2cf2818">delayedAcknowledgements</a>[<a class="code" href="namespace_o_s_p_f.html#a3f675193744b50804fea173a3f6f6bdd">OSPF::AllDRouters</a>].push_back(lsaHeader);
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506     } <span class="keywordflow">else</span> {
<a name="l00507"></a>00507         <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00508"></a>00508         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00509"></a>00509             <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#abe30518a64009a9ae44944c1036a4c0aab642c302eb79dfe9cd827bc8af960e28">OSPF::Neighbor::ExchangeState</a>) {
<a name="l00510"></a>00510                 <a class="code" href="class_o_s_p_f_1_1_interface.html#af119a27aa6b3d21ac48352abd2cf2818">delayedAcknowledgements</a>[<a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;GetAddress()].push_back(lsaHeader);
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#af95c6306ce9369415e0604b2682a920d">00516</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#af95c6306ce9369415e0604b2682a920d">OSPF::Interface::SendDelayedAcknowledgements</a>(<span class="keywordtype">void</span>)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518     <a class="code" href="class_o_s_p_f_1_1_message_handler.html">OSPF::MessageHandler</a>* messageHandler = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#ab2b6452dadb00d2970e3432b0b29e17f">GetMessageHandler</a>();
<a name="l00519"></a>00519     <span class="keywordtype">long</span>                  maxPacketSize  = ((<a class="code" href="_o_s_p_fcommon_8h.html#a8bdcf4ab14fb83327455dab814a215ea">IPV4_HEADER_LENGTH</a> + <a class="code" href="_o_s_p_fcommon_8h.html#a29da58cf15534d57f74adcd17bbae811">OSPF_HEADER_LENGTH</a> + <a class="code" href="_o_s_p_fcommon_8h.html#addec1389ab60c9ffd1fb82b2af2a013e">OSPF_LSA_HEADER_LENGTH</a>) &gt; <a class="code" href="class_o_s_p_f_1_1_interface.html#a53345717126363978a61c3645b8f3e36">mtu</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a18347bf2e66afb72fec8e790c2c21107">IPV4_DATAGRAM_LENGTH</a> : <a class="code" href="class_o_s_p_f_1_1_interface.html#a53345717126363978a61c3645b8f3e36">mtu</a>;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="keywordflow">for</span> (std::map&lt;<a class="code" href="struct_o_s_p_f_1_1_i_pv4_address.html">IPv4Address</a>, std::list&lt;OSPFLSAHeader&gt;, <a class="code" href="class_o_s_p_f_1_1_i_pv4_address___less.html">OSPF::IPv4Address_Less</a>&gt;::iterator delayIt = <a class="code" href="class_o_s_p_f_1_1_interface.html#af119a27aa6b3d21ac48352abd2cf2818">delayedAcknowledgements</a>.begin();
<a name="l00522"></a>00522          delayIt != <a class="code" href="class_o_s_p_f_1_1_interface.html#af119a27aa6b3d21ac48352abd2cf2818">delayedAcknowledgements</a>.end();
<a name="l00523"></a>00523          delayIt++)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         <span class="keywordtype">int</span> ackCount = delayIt-&gt;second.size();
<a name="l00526"></a>00526         <span class="keywordflow">if</span> (ackCount &gt; 0) {
<a name="l00527"></a>00527             <span class="keywordflow">while</span> (!(delayIt-&gt;second.empty())) {
<a name="l00528"></a>00528                 <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>* ackPacket  = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>;
<a name="l00529"></a>00529                 <span class="keywordtype">long</span>                                packetSize = <a class="code" href="_o_s_p_fcommon_8h.html#a8bdcf4ab14fb83327455dab814a215ea">IPV4_HEADER_LENGTH</a> + <a class="code" href="_o_s_p_fcommon_8h.html#a29da58cf15534d57f74adcd17bbae811">OSPF_HEADER_LENGTH</a>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a91cf3984eedf6f3ceb4c0c09c1fc6c6a">setType</a>(<a class="code" href="_o_s_p_f_packet__m_8h.html#ad5f914914dbd3735397f61053e4ff3cca3f9f236adc60a2c841577d429c0cf7b0">LinkStateAcknowledgementPacket</a>);
<a name="l00532"></a>00532                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a7839127100306f0d32de845322dc5d16">setRouterID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a7a0c392cb0be636208fc0c2bc3ae520f">parentArea</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a6aee4ce011dc75bc4c42269d90b71192">GetRouter</a>()-&gt;<a class="code" href="class_o_s_p_f_1_1_router.html#a12b09f4263d005f7b0cd808502c1de48">GetRouterID</a>());
<a name="l00533"></a>00533                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a8330f979e87055012a3c3acf8adf785f">setAreaID</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#aa56c3151f51534e8af8318c86b85dd5a">areaID</a>);
<a name="l00534"></a>00534                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a2e003d1dd0afa513157935fdf62b4ebe">setAuthenticationType</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a146ecbf957430b57f2d7c7340ddaea4f">authenticationType</a>);
<a name="l00535"></a>00535                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
<a name="l00536"></a>00536                     ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a50fd50be5a73b14c4859a7f1274bd9f8">setAuthentication</a>(i, <a class="code" href="class_o_s_p_f_1_1_interface.html#a433bf99728cfe9fed8ef9a0c3f75a889">authenticationKey</a>.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#a09102c74d106ef556c423ea0438aed4a">bytes</a>[i]);
<a name="l00537"></a>00537                 }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539                 <span class="keywordflow">while</span> ((!(delayIt-&gt;second.empty())) &amp;&amp; (packetSize &lt;= (maxPacketSize - <a class="code" href="_o_s_p_fcommon_8h.html#addec1389ab60c9ffd1fb82b2af2a013e">OSPF_LSA_HEADER_LENGTH</a>))) {
<a name="l00540"></a>00540                     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   headerCount = ackPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#a36b419c0775c3b0f2f5edd13274b6ba2">getLsaHeadersArraySize</a>();
<a name="l00541"></a>00541                     ackPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#a3ff44a1b5c77d68528004c0dfe5ce72e">setLsaHeadersArraySize</a>(headerCount + 1);
<a name="l00542"></a>00542                     ackPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#addd8a17e084845d9a5fce73818155521">setLsaHeaders</a>(headerCount, *(delayIt-&gt;second.begin()));
<a name="l00543"></a>00543                     delayIt-&gt;second.pop_front();
<a name="l00544"></a>00544                     packetSize += <a class="code" href="_o_s_p_fcommon_8h.html#addec1389ab60c9ffd1fb82b2af2a013e">OSPF_LSA_HEADER_LENGTH</a>;
<a name="l00545"></a>00545                 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a7f38186b1ebbe2bc924c809054a41">setPacketLength</a>(0); <span class="comment">// TODO: Calculate correct length</span>
<a name="l00548"></a>00548                 ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#ad9a629a73a19fbe1184c60e9594d579f">setChecksum</a>(0); <span class="comment">// TODO: Calculate correct cheksum(16-bit one&apos;s complement of the entire packet)</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550                 <span class="keywordtype">int</span> ttl = (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4acaf27b340cd6ffc282630c03185294088b">OSPF::Interface::Virtual</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a1d4e674fb39c33571b1b8b8f28f02b52">VIRTUAL_LINK_TTL</a> : 1;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552                 <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca15decf080ad941585245418cfb9458c9">OSPF::Interface::Broadcast</a>) {
<a name="l00553"></a>00553                     <span class="keywordflow">if</span> ((<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a39fb4e003926b18827b15d54a71a3ce2">OSPF::Interface::DesignatedRouterState</a>) ||
<a name="l00554"></a>00554                         (<a class="code" href="class_o_s_p_f_1_1_interface.html#a93b0578a717b1d7ed98780108305c9d5">GetState</a>() == <a class="code" href="class_o_s_p_f_1_1_interface.html#a68805ad1115c7149d5f8a139437e6249a9d19f5853d01eca65e69e75665a010cd">OSPF::Interface::BackupState</a>) ||
<a name="l00555"></a>00555                         (<a class="code" href="class_o_s_p_f_1_1_interface.html#a2aa7970a1a4f77bbe3718c1669e0f9a9">designatedRouter</a> == <a class="code" href="namespace_o_s_p_f.html#a1025f956e059380bda5d71fc1e3324f6">OSPF::NullDesignatedRouterID</a>))
<a name="l00556"></a>00556                     {
<a name="l00557"></a>00557                         messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(ackPacket, <a class="code" href="namespace_o_s_p_f.html#afdf11c20cc9287464a9a673199e01004">OSPF::AllSPFRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00558"></a>00558                     } <span class="keywordflow">else</span> {
<a name="l00559"></a>00559                         messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(ackPacket, <a class="code" href="namespace_o_s_p_f.html#a3f675193744b50804fea173a3f6f6bdd">OSPF::AllDRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00560"></a>00560                     }
<a name="l00561"></a>00561                 } <span class="keywordflow">else</span> {
<a name="l00562"></a>00562                     <span class="keywordflow">if</span> (<a class="code" href="class_o_s_p_f_1_1_interface.html#a8d7ae4be845b975503eb1178c4a3d749">interfaceType</a> == <a class="code" href="class_o_s_p_f_1_1_interface.html#a558b3988a38b079460b57f092eacf4aca4dac0c4eca27454daabf38ea32f47775">OSPF::Interface::PointToPoint</a>) {
<a name="l00563"></a>00563                         messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(ackPacket, <a class="code" href="namespace_o_s_p_f.html#afdf11c20cc9287464a9a673199e01004">OSPF::AllSPFRouters</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00564"></a>00564                     } <span class="keywordflow">else</span> {
<a name="l00565"></a>00565                         messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a55453afdec67b74ad3cd39a8a49ad73a">SendPacket</a>(ackPacket, delayIt-&gt;first, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23bdd2ac5845fa6a5c244044f846b3a0">ifIndex</a>, ttl);
<a name="l00566"></a>00566                     }
<a name="l00567"></a>00567                 }
<a name="l00568"></a>00568             }
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     messageHandler-&gt;<a class="code" href="class_o_s_p_f_1_1_message_handler.html#a7680ccb9763e25c9841911992bc7caa5">StartTimer</a>(<a class="code" href="class_o_s_p_f_1_1_interface.html#a5658b96b836b7910111190ca530dad01">acknowledgementTimer</a>, <a class="code" href="class_o_s_p_f_1_1_interface.html#a23e3ef1bdf8266d8729f20d62f106509">acknowledgementDelay</a>);
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="class_o_s_p_f_1_1_interface.html#ae269c6e1a2d29001ca1dd2202c2318cb">00574</a> <span class="keywordtype">void</span> <a class="code" href="class_o_s_p_f_1_1_interface.html#ae269c6e1a2d29001ca1dd2202c2318cb">OSPF::Interface::AgeTransmittedLSALists</a>(<span class="keywordtype">void</span>)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <span class="keywordtype">long</span> neighborCount = <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>.size();
<a name="l00577"></a>00577     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; neighborCount; i++) {
<a name="l00578"></a>00578         <a class="code" href="class_o_s_p_f_1_1_interface.html#a7435ebb20414f378a2b5a12f06b7572a">neighboringRouters</a>[i]-&gt;AgeTransmittedLSAList();
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Mar 23 17:08:28 2010 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
